---
title: "修復と再送信のカスタム例外ハンドラーのサンプルを実行している |Microsoft ドキュメント"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 7363c440-44aa-4d08-8290-72787d17ac60
caps.latest.revision: "2"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: b8b33765cbe3ca1c8c0c7c3e7679e543678325af
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/20/2017
---
# <a name="running-the-repair-and-resubmit-custom-exception-handler-sample"></a><span data-ttu-id="fc027-102">修復と再送信のカスタム例外ハンドラーのサンプルを実行しています。</span><span class="sxs-lookup"><span data-stu-id="fc027-102">Running the Repair and Resubmit Custom Exception Handler Sample</span></span>
<span data-ttu-id="fc027-103">修復と再送信のカスタム例外ハンドラーのサンプルでは、人間の介入を ESB ベンダーおよび Microsoft BizTalk ベースのアプリケーションを処理し、便利なデザイン パターンを実装に統合するために非常に効果的な方法を示します。</span><span class="sxs-lookup"><span data-stu-id="fc027-103">The Repair and Resubmit Custom Exception Handler sample demonstrates an extremely effective technique for integrating human intervention into ESB and Microsoft BizTalk–based application processes and implements a useful design pattern.</span></span> <span data-ttu-id="fc027-104">サンプル コードは、ESB 例外管理システムにシームレスに統合します。</span><span class="sxs-lookup"><span data-stu-id="fc027-104">The sample code integrates seamlessly into the ESB exception management system.</span></span>  
  
 <span data-ttu-id="fc027-105">サンプルは、オーケストレーションでのカスタム例外ハンドラーを使用する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="fc027-105">The sample shows how you can use a custom exception handler in an orchestration.</span></span> <span data-ttu-id="fc027-106">オーケストレーション (EAIProcess.odx) でプロセスには、エラーが発生すると、例外ハンドラーが生成し、ESB フォールト メッセージを公開します。</span><span class="sxs-lookup"><span data-stu-id="fc027-106">When a process in the orchestration (EAIProcess.odx) encounters an error, the exception handler generates and publishes an ESB fault message.</span></span> <span data-ttu-id="fc027-107">このエラー メッセージにはでそのペイロードに"インフライト"であった (と、BizTalk に関連するコンテキスト プロパティを含む) メッセージが含まれます、例外が発生したときと、現在 System.Exception インスタンス、BizTalk オーケストレーション エンジンによってキャッチされました。</span><span class="sxs-lookup"><span data-stu-id="fc027-107">This fault message includes in its payload the messages (including their BizTalk-related context properties) that were "in flight" when the exception occurred and the current System.Exception instance caught by the BizTalk Orchestration engine.</span></span> <span data-ttu-id="fc027-108">この問題が発生すると、「拒否」メッセージと"Approved"メッセージが、エラー メッセージに永続化されます。</span><span class="sxs-lookup"><span data-stu-id="fc027-108">When this occurs, a "Denied" message and an "Approved" message are persisted with the fault message.</span></span>  
  
 <span data-ttu-id="fc027-109">EAIProcessHandler.odx、分離された方法が展開されており、カスタム例外ハンドラーとして機能し、これをという名前の 2 番目のオーケストレーションは EAIProcess.odx オーケストレーションで生成された特定のエラー コードをサブスクライブし、エラー メッセージを使用します。</span><span class="sxs-lookup"><span data-stu-id="fc027-109">A second orchestration named EAIProcessHandler.odx, which is deployed in a decoupled manner and acts as a custom exception handler, subscribes to the specific fault code generated in the EAIProcess.odx orchestration and consumes the fault message.</span></span> <span data-ttu-id="fc027-110">この例外ハンドラーは、元のメッセージ (として型指定されたドキュメント) を抽出し、System.Exception インスタンスは当初、エラー メッセージに永続化します。</span><span class="sxs-lookup"><span data-stu-id="fc027-110">This exception handler extracts the original messages (as typed documents) and the System.Exception instances originally persisted in the fault message.</span></span>  
  
 <span data-ttu-id="fc027-111">元のメッセージは、ここで、元のすべてのコンテキスト プロパティと処理に使用できるになります。</span><span class="sxs-lookup"><span data-stu-id="fc027-111">The original messages now become available for processing with all their original context properties.</span></span> <span data-ttu-id="fc027-112">カスタム例外ハンドラー (EAIProcessHandler.odx) では、次の場所にファイル システムに"Denied"と"Approved"メッセージの両方をし、書き込みます。</span><span class="sxs-lookup"><span data-stu-id="fc027-112">The custom exception handler (EAIProcessHandler.odx) then writes both the "Denied" and the "Approved" messages to the file system in the following locations:</span></span>  
  
-   <span data-ttu-id="fc027-113">承認済みメッセージ:</span><span class="sxs-lookup"><span data-stu-id="fc027-113">Approved message:</span></span>  
  
    -   <span data-ttu-id="fc027-114">\Source\Samples\Exception Handling\Test\Filedrop\EAIProcess.PostApproval</span><span class="sxs-lookup"><span data-stu-id="fc027-114">\Source\Samples\Exception Handling\Test\Filedrop\EAIProcess.PostApproval</span></span>  
  
-   <span data-ttu-id="fc027-115">修復と再送信のメッセージを拒否:</span><span class="sxs-lookup"><span data-stu-id="fc027-115">Denied message for repair and resubmit:</span></span>  
  
    -   <span data-ttu-id="fc027-116">\Source\Samples\Exception Handling\Test\Filedrop\EAIProcessHandler.RepairSubmit</span><span class="sxs-lookup"><span data-stu-id="fc027-116">\Source\Samples\Exception Handling\Test\Filedrop\EAIProcessHandler.RepairSubmit</span></span>  
  
-   <span data-ttu-id="fc027-117">拒否されたメッセージは:</span><span class="sxs-lookup"><span data-stu-id="fc027-117">Denied message:</span></span>  
  
    -   <span data-ttu-id="fc027-118">\Source\Samples\Exception Handling\Test\Filedrop\EAIProcessHandler.PostDecline</span><span class="sxs-lookup"><span data-stu-id="fc027-118">\Source\Samples\Exception Handling\Test\Filedrop\EAIProcessHandler.PostDecline</span></span>  
  
 <span data-ttu-id="fc027-119">例外ハンドラーは、Microsoft InfoPath 処理命令を使用して、ファイル システムに再実行して修復の"Denied"メッセージをシリアル化します。</span><span class="sxs-lookup"><span data-stu-id="fc027-119">The exception handler serializes the "Denied" message for Repair and Resubmit to the file system using a Microsoft InfoPath processing instruction.</span></span> <span data-ttu-id="fc027-120">InfoPath テンプレートでは、フォームを編集し、結果を再送信するユーザー (図 1 を参照)、メッセージを検証する EAIProcess.odx オーケストレーションを開始します。</span><span class="sxs-lookup"><span data-stu-id="fc027-120">An InfoPath template allows the user to edit the form and resubmit the result (see Figure 1), which starts the EAIProcess.odx orchestration that validates the message.</span></span>  
  
 <span data-ttu-id="fc027-121">![再送信の修復](../esb-toolkit/media/ch6-repairresubmit.gif "Ch6 RepairResubmit")</span><span class="sxs-lookup"><span data-stu-id="fc027-121">![Repair Resubmit](../esb-toolkit/media/ch6-repairresubmit.gif "Ch6-RepairResubmit")</span></span>  
  
 <span data-ttu-id="fc027-122">**図 1**</span><span class="sxs-lookup"><span data-stu-id="fc027-122">**Figure 1**</span></span>  
  
 <span data-ttu-id="fc027-123">**InfoPath の修復と再送信テンプレートによって生成されたテスト メッセージ**</span><span class="sxs-lookup"><span data-stu-id="fc027-123">**A test message generated by the InfoPath Repair and Resubmit template**</span></span>  
  
 <span data-ttu-id="fc027-124">さらに、ALL という名前の汎用的な送信ポートがあります。GlobalFaultProcessor パイプラインを使用するように構成 Exceptions_FILE です。</span><span class="sxs-lookup"><span data-stu-id="fc027-124">Additionally, there is a generic send port named ALL.Exceptions_FILE that is configured to use the GlobalFaultProcessor pipeline.</span></span> <span data-ttu-id="fc027-125">このポートは、システム内のすべての例外をサブスクライブ、両方の BizTalk は、メッセージをルーティングするメッセージと ESB エラー メッセージが失敗しました。</span><span class="sxs-lookup"><span data-stu-id="fc027-125">This port subscribes to all exceptions in the system, both BizTalk failed message routing messages and ESB fault messages.</span></span> <span data-ttu-id="fc027-126">例外管理フレームワークでは、それらをすべて 1 つの形式に正規化され、フォルダー \Source\Samples\Exception Handling\Test\Filedrop\All_Exceptions に InfoPath 処理命令を使用してシリアル化します。</span><span class="sxs-lookup"><span data-stu-id="fc027-126">The Exception Management Framework normalizes them all to a single format and serializes them using an InfoPath processing instruction to the folder \Source\Samples\Exception Handling\Test\Filedrop\All_Exceptions.</span></span>  
  
## <a name="installation"></a><span data-ttu-id="fc027-127">インストール</span><span class="sxs-lookup"><span data-stu-id="fc027-127">Installation</span></span>  
 <span data-ttu-id="fc027-128">すべての例外管理サンプルは、同じコア サービスと BizTalk アプリケーションのアイテムのセットを使用します。</span><span class="sxs-lookup"><span data-stu-id="fc027-128">All the exception management samples use the same set of core services and BizTalk application artifacts.</span></span> <span data-ttu-id="fc027-129">そのため、すべての例外の管理のサンプルを実行するために例外管理サンプル アイテム 1 回だけをインストールする必要があります。</span><span class="sxs-lookup"><span data-stu-id="fc027-129">Therefore, you have to install the exception management sample artifacts only once to be able to run all the exception management samples.</span></span> <span data-ttu-id="fc027-130">例外の管理のサンプルをインストールする方法については、次を参照してください。[例外管理のサンプルをインストールする](../esb-toolkit/installing-the-exception-management-samples.md)です。</span><span class="sxs-lookup"><span data-stu-id="fc027-130">For information about how to install the exception management samples, see [Installing the Exception Management Samples](../esb-toolkit/installing-the-exception-management-samples.md).</span></span>  
  
## <a name="running-the-sample-application"></a><span data-ttu-id="fc027-131">サンプル アプリケーションの実行</span><span class="sxs-lookup"><span data-stu-id="fc027-131">Running the Sample Application</span></span>  
 <span data-ttu-id="fc027-132">**修復と再送信のカスタム例外ハンドラーのサンプルを実行するには**</span><span class="sxs-lookup"><span data-stu-id="fc027-132">**To run the Repair and Resubmit Custom Exception Handler sample**</span></span>  
  
1.  <span data-ttu-id="fc027-133">最初にこのサンプルを実行する前に、受信場所と送信ポートの Url が \Source\Samples\Exception Handling\Test\Filedrop フォルダーに適切なディレクトリを指していることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="fc027-133">Before you run this sample for the first time, make sure that the receive location and send port URLs point to the appropriate directories in the \Source\Samples\Exception Handling\Test\Filedrop folder.</span></span> <span data-ttu-id="fc027-134">受信場所が EAIProcess.RequestPort、フォルダーを指定する必要があり、送信ポートの Url は EAIProcess.PostApproval と EAIProcessHandler.PostDecline フォルダーを指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="fc027-134">The receive location should specify the folder EAIProcess.RequestPort, and the send port URLs should specify the folders EAIProcess.PostApproval and EAIProcessHandler.PostDecline.</span></span>  
  
2.  <span data-ttu-id="fc027-135">GlobalBank.ESB アプリケーションが既に実行されていない場合は、BizTalk 管理コンソールを使用して、開始します。</span><span class="sxs-lookup"><span data-stu-id="fc027-135">If the GlobalBank.ESB application is not already running, use the BizTalk Administration Console to start it.</span></span>  
  
3.  <span data-ttu-id="fc027-136">EAIProcess.RequestPort_FILE 受信場所の指定されたフォルダーに、\Source\Samples\Exception Handling\Test\Data フォルダーにある Request_EAIProcessHandler.xml をという名前のサンプル ファイルをコピーして、サンプルを開始する: \Source\Samples\例外 Handling\Test\Filedrop\EAIProcess.RequestPort です。</span><span class="sxs-lookup"><span data-stu-id="fc027-136">Start the sample by copying the sample file named Request_EAIProcessHandler.xml, located in the \Source\Samples\Exception Handling\Test\Data folder, to the folder specified for the EAIProcess.RequestPort_FILE receive location: \Source\Samples\Exception Handling\Test\Filedrop\EAIProcess.RequestPort.</span></span>  
  
4.  <span data-ttu-id="fc027-137">(フォルダーにある \Source\Samples\Exception Handling\Test\Filedrop) EAIProcessHandler.PostDecline をという名前のフォルダーを開きます。</span><span class="sxs-lookup"><span data-stu-id="fc027-137">Open the folder named EAIProcessHandler.PostDecline (in the \Source\Samples\Exception Handling\Test\Filedrop folder).</span></span> <span data-ttu-id="fc027-138">例外処理オーケストレーションによって生成された「拒否済み *」メッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="fc027-138">You will see the "Declined*" message generated by the exception handling orchestration.</span></span>  
  
5.  <span data-ttu-id="fc027-139">(フォルダーにある \Source\Samples\Exception Handling\Test\Filedrop) EAIProcessHandler.RepairSubmit をという名前のフォルダーを開きます。</span><span class="sxs-lookup"><span data-stu-id="fc027-139">Open the folder named EAIProcessHandler.RepairSubmit (in the \Source\Samples\Exception Handling\Test\Filedrop folder).</span></span> <span data-ttu-id="fc027-140">例外処理オーケストレーションによって生成された"RepairSubmit"メッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="fc027-140">You will see a "RepairSubmit" message generated by the exception handling orchestration.</span></span>  
  
6.  <span data-ttu-id="fc027-141">適切な InfoPath テンプレートで開く RepairSubmit ファイルをダブルクリックします。</span><span class="sxs-lookup"><span data-stu-id="fc027-141">Double-click the RepairSubmit file to open it in the appropriate InfoPath template.</span></span> <span data-ttu-id="fc027-142">編集して再送信の準備完了のメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="fc027-142">You will see the message ready for edit and resubmission.</span></span>  
  
7.  <span data-ttu-id="fc027-143">値を変更、 **Unit Price**からフィールド**0**に**2**、をクリックし、**送信**InfoPath のツールバーにボタンがありますBizTalk 処理のために編集したドキュメントを送信するフォーム。</span><span class="sxs-lookup"><span data-stu-id="fc027-143">Change the value of the **Unit Price** field from **0** to **2**, and then click the **Submit** button located on the toolbar of the InfoPath form to submit the edited document back to BizTalk for processing.</span></span> <span data-ttu-id="fc027-144">受信場所が、送信プロセス HTTP を使用して、BizTalk 構成します。</span><span class="sxs-lookup"><span data-stu-id="fc027-144">The submit process uses a BizTalk-configured HTTP receive location.</span></span>  
  
8.  <span data-ttu-id="fc027-145">(フォルダーにある \Source\Samples\Exception Handling\Test\Filedrop) EAIProcess.PostApproval フォルダーに移動します。</span><span class="sxs-lookup"><span data-stu-id="fc027-145">Navigate to the EAIProcess.PostApproval folder (in the \Source\Samples\Exception Handling\Test\Filedrop folder).</span></span> <span data-ttu-id="fc027-146">「承認 *」を含んだドキュメントは、単価の更新後の値が表示されます。</span><span class="sxs-lookup"><span data-stu-id="fc027-146">You will now see the "Approval*" document containing the updated value for the unit price.</span></span>  
  
## <a name="how-the-sample-works"></a><span data-ttu-id="fc027-147">このサンプルのしくみ</span><span class="sxs-lookup"><span data-stu-id="fc027-147">How the Sample Works</span></span>  
 <span data-ttu-id="fc027-148">メッセージを送信するには、EAIProcess オーケストレーションがアクティブにします。</span><span class="sxs-lookup"><span data-stu-id="fc027-148">The message you submit activates the EAIProcess orchestration.</span></span> <span data-ttu-id="fc027-149">では、EAIProcess オーケストレーションでは、メッセージを処理するとき、単価で 1 を除算しようとします。</span><span class="sxs-lookup"><span data-stu-id="fc027-149">When the EAIProcess orchestration processes the message, it attempts to divide 1 by the unit price.</span></span> <span data-ttu-id="fc027-150">単価はゼロであるため、0 除算の例外が発生します。</span><span class="sxs-lookup"><span data-stu-id="fc027-150">Because the unit price is zero, a divide-by-zero exception occurs.</span></span> <span data-ttu-id="fc027-151">オーケストレーションのイベント ハンドラーのコードでは、この例外をキャッチし、エラー メッセージを作成します。</span><span class="sxs-lookup"><span data-stu-id="fc027-151">Code in the event handler of the orchestration catches this exception and creates a fault message.</span></span> <span data-ttu-id="fc027-152">ビジネス ロジックでこの例外があるために、メッセージの注文数量は 10 より大きく、 **FaultCode**フィールドの値の**1000**です。</span><span class="sxs-lookup"><span data-stu-id="fc027-152">The order quantity in the message is greater than 10, so the business logic dictates that this exception has a **FaultCode** field value of **1000**.</span></span>  
  
 <span data-ttu-id="fc027-153">オーケストレーションが終了し、では、EAIProcess オーケストレーションが直接バインド ポートを通じて BizTalk メッセージ ボックスに、エラー メッセージを発行します。</span><span class="sxs-lookup"><span data-stu-id="fc027-153">The EAIProcess orchestration then publishes the fault message to the BizTalk Message Box through a direct-bound port, and the orchestration ends.</span></span>  
  
 <span data-ttu-id="fc027-154">メッセージをサブスクライブする EAIProcessHandler をという名前のカスタム エラー ハンドラー オーケストレーション、 **FaultCode**フィールドの値の**1000**、新しいエラー メッセージを取得します。</span><span class="sxs-lookup"><span data-stu-id="fc027-154">A custom fault handler orchestration named EAIProcessHandler, which subscribes to messages with a **FaultCode** field value of **1000**, picks up the new fault message.</span></span> <span data-ttu-id="fc027-155">オーケストレーション内のコードは"Denied"メッセージと、InfoPath ファイルを作成しに配置し、この EAIProcessHandler.PostDecline と EAIProcessHandler.RepairSubmit フォルダーにユーザーが介入の準備ができてです。</span><span class="sxs-lookup"><span data-stu-id="fc027-155">The code in the orchestration creates the "Denied" message and the InfoPath file, and then it places this into the EAIProcessHandler.PostDecline and EAIProcessHandler.RepairSubmit folders ready for human intervention.</span></span>