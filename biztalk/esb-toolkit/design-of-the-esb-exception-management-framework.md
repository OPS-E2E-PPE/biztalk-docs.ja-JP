---
title: ESB 例外管理フレームワークの設計 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: cfc2688c-c01c-4244-9e35-3d482135d8b7
caps.latest.revision: 4
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 14c7c7e8f6ba2632e68ed81e98a562e5ef316120
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/07/2019
ms.locfileid: "65394638"
---
# <a name="design-of-the-esb-exception-management-framework"></a><span data-ttu-id="4cbfd-102">ESB 例外管理フレームワークの設計</span><span class="sxs-lookup"><span data-stu-id="4cbfd-102">Design of the ESB Exception Management Framework</span></span>
<span data-ttu-id="4cbfd-103">例外を管理するための一貫性と再利用可能なパターンが任意の開発プロジェクトの主要な考慮事項です。保守容易性を最大化し、デプロイ後にアプリケーションをサポートするために容易にできるようにするのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-103">Consistent and re-usable patterns for managing exceptions are a core consideration of any development project; they help to maximize maintainability and make it easier to support the application after deployment.</span></span>  
  
 <span data-ttu-id="4cbfd-104">一般的な BizTalk アプリケーション可能性があります、BizTalk メッセージング機能を使用して、必要に応じて、オーケストレーションの処理を開始、ビジネス ルール エンジンを呼び出す、いくつかの基幹業務 (LOB) またはエンタープライズ リソース プランニング (ERP) システムと対話およびを返す、別のサードパーティ製システムへの応答です。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-104">A typical BizTalk application might use the BizTalk messaging features, optionally start processing an orchestration, call the Business Rule Engine, interact with several line-of-business (LOB) or enterprise resource planning (ERP) systems, and return a response to a separate third-party system.</span></span> <span data-ttu-id="4cbfd-105">さらに、BizTalk のサブシステムを含む、これらのコンポーネントの実行時の場所は、現在の環境全体に分散 1 つまたは複数のサーバーに配置する場合があります。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-105">In addition, the run-time location of these components, including the BizTalk subsystems, may reside on one or more servers distributed throughout the current environment.</span></span> <span data-ttu-id="4cbfd-106">一般的なシナリオは、これをキャッチして、ESB BizTalk のいずれかで発生する例外のサブシステムを分離するか、さまざまなサードパーティ製 LOB システムでそれぞれが独自の例外処理の制約を持つレポートをサポートするためにシステムが必要です。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-106">This is a typical scenario and requires the system to support catching and reporting exceptions that may occur in any of the ESB or BizTalk decoupled subsystems or in the various third-party LOB systems, each of which has its own exception handling constraints.</span></span> <span data-ttu-id="4cbfd-107">メインフレームの可能性があります。 通常の処理サイクル中に Web サイトから送信された注文を拒否するなどWeb サイトは、このエラーを補正し、ユーザーに通知する必要があります。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-107">For example, the mainframe may reject an order sent from a Web site during a normal processing cycle; the Web site must compensate for this error and notify the user.</span></span>  
  
 <span data-ttu-id="4cbfd-108">ESB アプリケーションの複雑さ、その環境のため、アプリケーション例外の管理のための一貫したソリューションの開発は、次の一般的な設計目標を具現化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-108">Because of the complexity of ESB applications and their environment, development of a consistent solution for application exception management should embody the following common design goals:</span></span>  
  
- <span data-ttu-id="4cbfd-109">検出して、BizTalk Server 環境で発生する例外の処理の標準化された手法を提供する (つまり、メッセージングおよびオーケストレーションのサブシステムで)。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-109">Provide a standardized approach for detecting and handling exceptions that occur in the BizTalk Server environment (that is, in the messaging and orchestration subsystems).</span></span>  
  
- <span data-ttu-id="4cbfd-110">自動化されたプロセスに反応し、アプリケーションの例外を管理できるようにするための一般的なパターンを提供します。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-110">Provide common patterns that allow automated processes to react to and manage application exceptions.</span></span>  
  
- <span data-ttu-id="4cbfd-111">再利用を容易にする疎結合の例外管理パターンを提供します。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-111">Provide a loosely coupled exception management pattern that facilitates reuse.</span></span>  
  
- <span data-ttu-id="4cbfd-112">アプリケーションの例外と、使用可能なメッセージの状態の任意の BizTalk サブシステムに適用できる共通のレポート メカニズムを提供します。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-112">Provide a common reporting mechanism for application exceptions and their available message states that can apply to any BizTalk subsystem.</span></span>  
  
  <span data-ttu-id="4cbfd-113">理由を理解する、[!INCLUDE[esbToolkit](../includes/esbtoolkit-md.md)]カスタム エラー メカニズムを提供しますつまり、例外管理フレームワークとそのしくみ、BizTalk Server となぜこれらの機能は完全に利用可能な例外の管理機能を理解する必要が。前のデザイン目標を達成できること。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-113">To understand why the [!INCLUDE[esbToolkit](../includes/esbtoolkit-md.md)] provides a custom error mechanism, namely the Exception Management Framework, and how it works, it is necessary to understand the exception management features available in BizTalk Server and why these features are not fully capable of meeting the preceding design goals.</span></span>  
  
## <a name="biztalk-server-exception-reporting"></a><span data-ttu-id="4cbfd-114">BizTalk Server 例外レポート</span><span class="sxs-lookup"><span data-stu-id="4cbfd-114">BizTalk Server Exception Reporting</span></span>  
 <span data-ttu-id="4cbfd-115">BizTalk Server は、次の例外処理およびレポート メカニズムをサポートしています。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-115">BizTalk Server supports the following exception handling and reporting mechanisms:</span></span>  
  
- <span data-ttu-id="4cbfd-116">失敗したメッセージのルーティング</span><span class="sxs-lookup"><span data-stu-id="4cbfd-116">Failed Message Routing</span></span>  
  
- <span data-ttu-id="4cbfd-117">BizTalk Server 管理コンソール</span><span class="sxs-lookup"><span data-stu-id="4cbfd-117">BizTalk Server Administration Console</span></span>  
  
- <span data-ttu-id="4cbfd-118">Microsoft イベントのログ</span><span class="sxs-lookup"><span data-stu-id="4cbfd-118">Microsoft Event Log</span></span>  
  
- <span data-ttu-id="4cbfd-119">カスタム開発オプション</span><span class="sxs-lookup"><span data-stu-id="4cbfd-119">Custom development options</span></span>  
  
  <span data-ttu-id="4cbfd-120">既定では、例外を処理するための BizTalk Server の機能はオペレーターの介入に大きく依存します。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-120">By default, BizTalk Server's capabilities for handling exceptions rely a great deal on operator intervention.</span></span> <span data-ttu-id="4cbfd-121">たとえば、ユーザーが検証ステージ中に例外の原因となる BizTalk Server にメッセージを送信するような状況を検討してください。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-121">For example, consider the situation where a user submits a message to BizTalk Server that causes an exception during the validation stage.</span></span> <span data-ttu-id="4cbfd-122">既定では、メッセージは保留キューにルーティングされる場合、メッセージ ボックス データベースに公開します。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-122">By default, the message is published to the Message Box database, where it is routed to a suspended queue.</span></span> <span data-ttu-id="4cbfd-123">つまり、オペレーターは、行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-123">This means that an operator must do the following:</span></span>  
  
- <span data-ttu-id="4cbfd-124">個別に検出する例外が発生しました。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-124">Independently detect that an exception occurred.</span></span>  
  
- <span data-ttu-id="4cbfd-125">手動で、BizTalk Server 管理コンソールを使用してディスクに失敗したメッセージを保存します。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-125">Manually save the failed message to disk using the BizTalk Server Administration Console.</span></span>  
  
- <span data-ttu-id="4cbfd-126">手動で編集し、メッセージの修正し、システムに再送信します。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-126">Manually edit and correct the message and re-submit it to the system.</span></span> <span data-ttu-id="4cbfd-127">このプロセスでは、いくつかのインスタンスでの重要なコンテキスト情報を失う可能性があります。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-127">In some instances, this process has the potential for losing important context information.</span></span>  
  
  <span data-ttu-id="4cbfd-128">これらの問題を解決するのには、BizTalk Server は、失敗のメッセージのルーティング メカニズムを提供します。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-128">To resolve these issues, BizTalk Server provides the Failed Message Routing mechanism.</span></span> <span data-ttu-id="4cbfd-129">開発者と管理者はこれを使用してプロセスのオーケストレーションまたはメッセージング サブシステムで発生する例外をサブスクライブするように構成するメッセージの送信ポートを作成します。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-129">Developers and administrators can use this to create orchestration processes or messaging send ports configured to subscribe to any exceptions that occur in the messaging subsystem.</span></span> <span data-ttu-id="4cbfd-130">これは、エラーの自動検出と、元のメッセージの状態を保持し、例外の検出の問題を解決してルーティング メカニズムを提供します。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-130">This provides an automated error-detection and routing mechanism that preserves the original message state and solves the problem of detecting exceptions.</span></span>  
  
  <span data-ttu-id="4cbfd-131">オーケストレーション プロセスの失敗したメッセージの自動ルーティングが指定されていないため、開発者はスコープ図形をオーケストレーションに例外ハンドラー ブロックを追加することでエラー アカウントする必要があります。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-131">Because automatic failed message routing is not provided for orchestration processes, the developer must account for errors by adding exception handler blocks to orchestration scope shapes.</span></span> <span data-ttu-id="4cbfd-132">このソリューションでは、各オーケストレーションは、独自の例外処理を持つことができますが、処理機能が複数のオーケストレーション間の例外を再利用するためのメカニズムはありません。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-132">With this solution, each orchestration can have its own exception handling, but there is no mechanism for reusing exception handling functionality across multiple orchestrations.</span></span>  
  
  <span data-ttu-id="4cbfd-133">これはいるがメッセージングの例外を処理し、BizTalk Server システムで管理されている 2 つの非常にさまざまな方法と例外を処理するオーケストレーションに 3 番目の方法を意味します。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-133">This means that there are now two very different ways in which messaging exceptions are processed and managed in a BizTalk Server system, and a third way in which orchestration exceptions are processed.</span></span> <span data-ttu-id="4cbfd-134">そのため、開発者は、例外処理メカニズムはこのセクションで説明した要件に一致するシステムを実装する場合は、独自の要件に合わせてをカスタマイズする必要があります。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-134">Therefore, developers must customize the exception handling mechanism to suit their own requirements if they want to implement a system that matches the requirements described earlier in this section.</span></span>  
  
## <a name="biztalk-server-administration-console"></a><span data-ttu-id="4cbfd-135">BizTalk Server 管理コンソール</span><span class="sxs-lookup"><span data-stu-id="4cbfd-135">BizTalk Server Administration Console</span></span>  
 <span data-ttu-id="4cbfd-136">BizTalk Server 管理コンソールでは、BizTalk グループのハブと呼ばれる、グループの概要ページのセットを提供します。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-136">The BizTalk Server Administration Console provides a set of Group Overview pages, referred to as the BizTalk Group Hub.</span></span> <span data-ttu-id="4cbfd-137">これらのページを使用して、管理者を照会できます中断されたメッセージと例外がアプリケーション、サービス名、エラー コード、または URI でグループ化された図 1 に示すようにします。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-137">Using these pages, administrators can query for suspended messages and exceptions grouped by application, service name, error code, or URI, as shown in Figure 1.</span></span>  
  
 <span data-ttu-id="4cbfd-138">![管理コンソール](../esb-toolkit/media/ch4-adminconsole.gif "Ch4 AdminConsole")</span><span class="sxs-lookup"><span data-stu-id="4cbfd-138">![Admin Console](../esb-toolkit/media/ch4-adminconsole.gif "Ch4-AdminConsole")</span></span>  
  
 <span data-ttu-id="4cbfd-139">**図 1**</span><span class="sxs-lookup"><span data-stu-id="4cbfd-139">**Figure 1**</span></span>  
  
 <span data-ttu-id="4cbfd-140">**BizTalk Server 管理コンソールのグループ概要ページ**</span><span class="sxs-lookup"><span data-stu-id="4cbfd-140">**The BizTalk Server Administration Console Group Overview pages**</span></span>  
  
 <span data-ttu-id="4cbfd-141">グループの概要機能には、例外を表示する一般的なユーザー インターフェイスが用意されていますが、ビューは、「ライブ」サービス インスタンスに制限されます。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-141">Although the Group Overview feature provides a common user interface to view exceptions, the views are limited to "live" service instances.</span></span> <span data-ttu-id="4cbfd-142">管理者は各項目にツリーをドリル ダウンする必要がありますので、状態を調べる面倒な作業できます。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-142">Examining the state can be a cumbersome task because administrators must drill down through the tree to each item.</span></span> <span data-ttu-id="4cbfd-143">さらに、その他のいくつかの要因は、アプリケーション例外レポート ツールとして BizTalk Server 管理コンソールの機能を制限します。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-143">In addition, several other factors limit the BizTalk Server Administration Console capabilities as an application exception-reporting tool:</span></span>  
  
- <span data-ttu-id="4cbfd-144">ビジネス インテリジェンス用データ マイニングの機能はありません。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-144">There is no capability for mining the data for business intelligence.</span></span> <span data-ttu-id="4cbfd-145">たとえば、月単位で最悪の場合問題のあるアプリケーションのクエリまたはアプリケーションの例外の四半期ごとの傾向を確認できません。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-145">For example, you cannot query for the worst offending applications on a monthly basis or examine quarterly trends for application exceptions.</span></span>  
  
- <span data-ttu-id="4cbfd-146">ビジネスはアラートが発生します。 特定のアプリケーション例外が発生した場合、または特定のしきい値に達する必要がありますが、これらの種類の例外イベントにサブスクライブする機能はありません。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-146">The business may require alerts to be raised when certain application exceptions occur or when reaching specific thresholds, but there is no facility to subscribe to these types of exception events.</span></span>  
  
- <span data-ttu-id="4cbfd-147">Microsoft 管理コンソール (MMC) が、管理コンソールとして使用する、ユーザー インターフェイス (UI) メカニズムがない、最適なインターフェイスとは常に運用環境にアクセスする便利なされません。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-147">The Microsoft Management Console (MMC) that the Administration Console uses as its user interface (UI) mechanism is not an ideal interface, and it is not always convenient to access in production environments.</span></span> <span data-ttu-id="4cbfd-148">少なくとも、ユーザーが、BizTalk オペレータ ロールのメンバーである必要があります。され、運用環境での MMC へのアクセス、通常はのみターミナル サーバーを使用します。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-148">At minimum, it requires users to be members of the BizTalk Operators role; and, in production environments, access to the MMC is usually only possible through Terminal Server.</span></span>  
  
- <span data-ttu-id="4cbfd-149">コンソールには、未処理の例外 (中断されたサービス インスタンス) のみが表示されます。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-149">The console displays only unhandled exceptions (suspended service instances).</span></span> <span data-ttu-id="4cbfd-150">開発者は、オーケストレーションで例外を処理する場合オーケストレーションを正常に完了例外情報はことはありません、管理コンソールに表示します。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-150">If the developer handles the exception in the orchestration, allowing the orchestration to complete normally, the exception information will never appear in the Administration Console.</span></span>  
  
  <span data-ttu-id="4cbfd-151">[!INCLUDE[esbToolkit](../includes/esbtoolkit-md.md)] ESB 失敗オーケストレーションの例外ルーティング メカニズムを通じてこれらの制限に対処します。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-151">The [!INCLUDE[esbToolkit](../includes/esbtoolkit-md.md)] addresses these limitations through the ESB Failed Orchestration Exception Routing mechanism.</span></span> <span data-ttu-id="4cbfd-152">BizTalk Server の失敗のメッセージのルーティング メカニズムに似ています。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-152">This closely resembles the Failed Message Routing mechanism of BizTalk Server.</span></span> <span data-ttu-id="4cbfd-153">さらに、 [!INCLUDE[esbToolkit](../includes/esbtoolkit-md.md)] ESB 失敗オーケストレーションの例外ルーティング メカニズムと失敗のメッセージのルーティング メカニズムの両方から生成されたメッセージをサブスクライブする送信ポートのパイプライン コンポーネントが含まれていて、それらを正規化します。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-153">In addition, the [!INCLUDE[esbToolkit](../includes/esbtoolkit-md.md)] includes a pipeline component in a send port that subscribes to messages generated from both the ESB Failed Orchestration Exception Routing mechanism and the Failed Message Routing mechanism and normalizes them.</span></span>  
  
  <span data-ttu-id="4cbfd-154">ESB 例外管理フレームワークは、BizTalk Server で、サブスクリプション モデル、およびイベントに基づくビジネス アクティビティ監視 (BAM) などの他の機能を活用を受け取る。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-154">The ESB Exception Management Framework takes advantage of other features in BizTalk Server, such as the subscription model, and event-based Business Activity Monitoring (BAM).</span></span> <span data-ttu-id="4cbfd-155">つまり、ESB 例外管理フレームワークが例外のデータ ポイントが、BAM の追跡、監視するための BizTalk BAM ポータルに公開できます。</span><span class="sxs-lookup"><span data-stu-id="4cbfd-155">This means that the ESB Exception Management Framework can track the exception data points with BAM, and then publish them to the BizTalk BAM Portal for monitoring.</span></span>