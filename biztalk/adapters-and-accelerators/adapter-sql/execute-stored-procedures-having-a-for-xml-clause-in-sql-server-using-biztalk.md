---
title: BizTalk Server を使用して SQL Server での FOR XML 句を含むストアド プロシージャの実行 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 1d8fe927-90bf-48fc-a418-63b920b409ed
caps.latest.revision: 13
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: d68473929852b8a57acb25317656fd52a38880b6
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/07/2019
ms.locfileid: "65369643"
---
# <a name="execute-stored-procedures-having-a-for-xml-clause-in-sql-server-using-biztalk-server"></a><span data-ttu-id="c95b0-102">BizTalk Server を使用して SQL Server での FOR XML 句を含むストアド プロシージャを実行します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-102">Execute stored procedures having a FOR XML clause in SQL Server using BizTalk Server</span></span>
<span data-ttu-id="c95b0-103">SQL SELECT ステートメントには、FOR XML 句を XML として行セットではなく、クエリの結果を返すことができます。</span><span class="sxs-lookup"><span data-stu-id="c95b0-103">An SQL SELECT statement can have a FOR XML clause that returns the query result as XML instead of a rowset.</span></span> <span data-ttu-id="c95b0-104">ストアド プロシージャは FOR XML 句を使用した SELECT ステートメントをすることもできます。</span><span class="sxs-lookup"><span data-stu-id="c95b0-104">You can also have a stored procedure that has a SELECT statement with a FOR XML clause.</span></span> <span data-ttu-id="c95b0-105">[FOR XML (SQL Server)](https://msdn.microsoft.com/library/ms178107.aspx)の詳細。</span><span class="sxs-lookup"><span data-stu-id="c95b0-105">[FOR XML (SQL Server)](https://msdn.microsoft.com/library/ms178107.aspx) has more information.</span></span>
  
 <span data-ttu-id="c95b0-106">WCF ベースを使用する[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]ストアド プロシージャなどを実行します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-106">You can use the WCF-based [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)] to execute such stored procedures.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="c95b0-107">「ネイティブ」の SQL アダプターで使用可能な[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]に SELECT ステートメントの一部として、FOR XML 句を指定のストアド プロシージャが必要です。</span><span class="sxs-lookup"><span data-stu-id="c95b0-107">The “native” SQL adapter available with [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] requires stored procedures to have the FOR XML clause as part of the SELECT statement.</span></span> <span data-ttu-id="c95b0-108">このようなストアド プロシージャを使用するには、WCF ベースで[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]ストアド プロシージャの定義に変更を加えずにします。</span><span class="sxs-lookup"><span data-stu-id="c95b0-108">You can use such stored procedures with the WCF-based [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)] without making any changes to the stored procedure definition.</span></span>  
> 
>  <span data-ttu-id="c95b0-109">以前のバージョンの指定された 'native' の SQL アダプターを使用して生成されたスキーマを使用することが常に[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-109">You can always use the schemas generated using the ‘native’ SQL adapter provided with earlier versions of [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)].</span></span> <span data-ttu-id="c95b0-110">詳細については、次を参照してください。 [WCF-SQL アダプターを使用して FOR XML クエリ](http://go.microsoft.com/fwlink/?LinkId=223428)(<http://go.microsoft.com/fwlink/?LinkId=223428>)。</span><span class="sxs-lookup"><span data-stu-id="c95b0-110">For more information, see [Using FOR XML queries with the WCF-SQL Adapter](http://go.microsoft.com/fwlink/?LinkId=223428) (<http://go.microsoft.com/fwlink/?LinkId=223428>).</span></span>  
  
## <a name="how-to-invoke-stored-procedures-with-for-xml-clause"></a><span data-ttu-id="c95b0-111">FOR XML 句を使用したストアド プロシージャを呼び出す方法</span><span class="sxs-lookup"><span data-stu-id="c95b0-111">How to Invoke Stored Procedures with FOR XML Clause</span></span>  
 <span data-ttu-id="c95b0-112">SQL Server Management Studio または SQL アダプターで使用可能なを使用して FOR XML 句を使用してストアド プロシージャを呼び出すと[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]出力は、xml メッセージの形式。</span><span class="sxs-lookup"><span data-stu-id="c95b0-112">When you invoke a stored procedure with FOR XML clause in SQL Server Management Studio or using the SQL adapter available with [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)], the output is in the form of an xml message.</span></span> <span data-ttu-id="c95b0-113">WCF ベースでこれらの手順を使用する[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]、出力メッセージのスキーマがあります。</span><span class="sxs-lookup"><span data-stu-id="c95b0-113">To use these procedures with the WCF-based [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)], you must have the schema for the output message.</span></span> <span data-ttu-id="c95b0-114">WCF ベース[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]FOR XML 句を使用してストアド プロシージャを実行した後、SQL Server から応答メッセージを受信中にこのスキーマが必要です。</span><span class="sxs-lookup"><span data-stu-id="c95b0-114">The WCF-based [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)] requires this schema while receiving the response message from SQL Server after executing a stored procedure with FOR XML clause.</span></span> <span data-ttu-id="c95b0-115">このストアド プロシージャを呼び出す要求メッセージがアダプター自体によって生成されることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="c95b0-115">Note that the request message to invoke this stored procedure will be generated by the adapter itself.</span></span>  
  
 <span data-ttu-id="c95b0-116">応答メッセージのスキーマとは別で、WCF ベースを使用して FOR XML 句でストアド プロシージャを呼び出す特定のタスクを実行する必要がありますも[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-116">Apart from having the schema for the response message, you must also perform certain tasks to invoke a stored procedure with FOR XML clause using the WCF-based [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)].</span></span>  
  
1. <span data-ttu-id="c95b0-117">FOR XML 句を使用してストアド プロシージャの応答メッセージのスキーマを生成します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-117">Generate the schema for the response message for the stored procedure with FOR XML clause.</span></span> <span data-ttu-id="c95b0-118">使用可能な「ネイティブ」の SQL アダプターによって生成される応答のスキーマがあれば[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]、この手順をスキップすることができます。</span><span class="sxs-lookup"><span data-stu-id="c95b0-118">If you already have the response schema generated by the “native” SQL adapter available with [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)], you can skip this step.</span></span>  
  
2. <span data-ttu-id="c95b0-119">BizTalk プロジェクトを作成し、生成されたスキーマをプロジェクトに追加します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-119">Create a BizTalk project and add the generated schema to the project.</span></span>  
  
3. <span data-ttu-id="c95b0-120">WCF ベースを使用して FOR XML 句を使用して、ストアド プロシージャのスキーマを生成[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-120">Generate schema for the stored procedure with FOR XML clause using the WCF-based [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)].</span></span> <span data-ttu-id="c95b0-121">これは、アダプター ストアド プロシージャを呼び出すには、SQL Server に送信する要求メッセージのスキーマを提供します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-121">This provides the schema for the request message that the adapter sends to SQL Server to invoke the stored procedure.</span></span>  
  
4. <span data-ttu-id="c95b0-122">SQL Server からメッセージを送受信する BizTalk プロジェクトでは、メッセージを作成します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-122">Create messages in the BizTalk project to send and receive messages from SQL Server.</span></span> <span data-ttu-id="c95b0-123">要求メッセージは、アダプターによって生成された要求メッセージのスキーマに準拠している必要があります。</span><span class="sxs-lookup"><span data-stu-id="c95b0-123">The request message must conform to the schema of the request message generated by the adapter.</span></span> <span data-ttu-id="c95b0-124">応答メッセージは、または SQL Server Management Studio での FOR XML 句を使用してストアド プロシージャを実行することによって、「ネイティブ」の SQL アダプターを使用して取得した応答メッセージのスキーマに準拠する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c95b0-124">The response message must conform to the schema of the response message obtained either using the “native” SQL adapter or by executing the stored procedure with FOR XML clause in SQL Server Management Studio.</span></span>  
  
5. <span data-ttu-id="c95b0-125">SQL Server データベースでストアド プロシージャを呼び出すオーケストレーションを作成します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-125">Create an orchestration to invoke the stored procedure in the SQL Server database.</span></span>  
  
6. <span data-ttu-id="c95b0-126">ビルドし、BizTalk プロジェクトを配置します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-126">Build and deploy the BizTalk project.</span></span>  
  
7. <span data-ttu-id="c95b0-127">BizTalk 物理を作成してアプリケーションの送信および受信ポートを構成します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-127">Configure the BizTalk application by creating physical send and receive ports.</span></span>  
  
8. <span data-ttu-id="c95b0-128">BizTalk アプリケーションを起動します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-128">Start the BizTalk application.</span></span>  
  
##  <a name="BKMK_RespSchema"></a> <span data-ttu-id="c95b0-129">ストアド プロシージャの応答メッセージのスキーマを生成します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-129">Generating Schema for the Response Message for Stored Procedure</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="c95b0-130">使用可能な SQL アダプターによって生成される応答のスキーマがある場合は、この手順を実行する必要はありません[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-130">You do not need to perform this step if you have the response schema generated by the SQL adapter available with [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)].</span></span>  
  
 <span data-ttu-id="c95b0-131">ストアド プロシージャで応答メッセージのスキーマを生成するには、ストアド プロシージャの SELECT ステートメントがある提供される、`xmlschema`句、`for xml`句。</span><span class="sxs-lookup"><span data-stu-id="c95b0-131">You can generate the schema for the response message for the stored procedure, provided the SELECT statement in the stored procedure has the `xmlschema` clause with the `for xml` clause.</span></span> <span data-ttu-id="c95b0-132">このトピックで指定された従業員 ID の従業員の詳細情報を取得する GET_EMP_DETAILS_FOR_XML ストアド プロシージャを使用します</span><span class="sxs-lookup"><span data-stu-id="c95b0-132">In this topic, we use the GET_EMP_DETAILS_FOR_XML stored procedure that retrieves the employee details for a given employee ID.</span></span> <span data-ttu-id="c95b0-133">ストアド プロシージャを実行することによって、スキーマを取得するには、は、SELECT ステートメントは、次のようになります。</span><span class="sxs-lookup"><span data-stu-id="c95b0-133">To retrieve the schema by executing the stored procedure, the SELECT statement looks like the following:</span></span>  
  
```  
SELECT [Employee_ID] ,[Name] ,[DOJ] ,[Designation] ,[Job_Description] ,[Photo] ,cast([Rating] as varchar(100)) as Rating ,[Salary] ,[Last_Modified] ,[Status] ,[Address]   
FROM [Adapt_Doc].[dbo].[Employee] for xml auto, xmlschema  
```  
  
 <span data-ttu-id="c95b0-134">応答メッセージのスキーマを取得するこのストアド プロシージャを実行します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-134">Execute this stored procedure to get the schema for the response message.</span></span> <span data-ttu-id="c95b0-135">ストアド プロシージャからの応答には、ストアド プロシージャの実行からのデータだけでなく、スキーマが含まれているに注意してください。</span><span class="sxs-lookup"><span data-stu-id="c95b0-135">Note that the response from the stored procedure contains the schema as well as the data from executing the stored procedure.</span></span> <span data-ttu-id="c95b0-136">応答からスキーマをコピーし、テキストのパッドに保存する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c95b0-136">You must copy the schema from the response and save it to a text pad.</span></span> <span data-ttu-id="c95b0-137">このスキーマを名前をこの例では、 **ResponseSchema.xsd**します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-137">For this example, you can name this schema as **ResponseSchema.xsd**.</span></span> <span data-ttu-id="c95b0-138">BizTalk プロジェクトを作成する必要が今すぐ[!INCLUDE[btsVStudioNoVersion](../../includes/btsvstudionoversion-md.md)]し、このスキーマをプロジェクトに追加します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-138">You must now create a BizTalk project in [!INCLUDE[btsVStudioNoVersion](../../includes/btsvstudionoversion-md.md)] and add this schema to the project.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="c95b0-139">削除するかどうかを確認、`xmlschema`スキーマを生成するストアド プロシージャを実行した後の句。</span><span class="sxs-lookup"><span data-stu-id="c95b0-139">Make sure you remove the `xmlschema` clause after you have executed the stored procedure to generate the schema.</span></span> <span data-ttu-id="c95b0-140">最後に、BizTalk からストアド プロシージャを実行するときにこれを行うに失敗した場合は、応答メッセージのスキーマを再度生成されます。</span><span class="sxs-lookup"><span data-stu-id="c95b0-140">If you fail to do this, when you finally execute the stored procedure through BizTalk, you will again generate the schema in the response message.</span></span> <span data-ttu-id="c95b0-141">削除する必要があります xml として応答メッセージを取得するため、`xmlschema`句。</span><span class="sxs-lookup"><span data-stu-id="c95b0-141">So, to get the response message as xml you must remove the `xmlschema` clause.</span></span>  
  
#### <a name="to-add-the-schema-to-a-biztalk-project"></a><span data-ttu-id="c95b0-142">スキーマを BizTalk プロジェクトに追加するには</span><span class="sxs-lookup"><span data-stu-id="c95b0-142">To add the schema to a BizTalk project</span></span>  
  
1. <span data-ttu-id="c95b0-143">BizTalk プロジェクトを作成[!INCLUDE[btsVStudioNoVersion](../../includes/btsvstudionoversion-md.md)]です。</span><span class="sxs-lookup"><span data-stu-id="c95b0-143">Create a BizTalk project in [!INCLUDE[btsVStudioNoVersion](../../includes/btsvstudionoversion-md.md)].</span></span>  
  
2. <span data-ttu-id="c95b0-144">BizTalk プロジェクトにストアド プロシージャ用に生成した応答スキーマを追加します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-144">Add the response schema you generated for the stored procedure to the BizTalk project.</span></span> <span data-ttu-id="c95b0-145">ソリューション エクスプ ローラーで BizTalk プロジェクトを右クリックし、[**追加**、] をクリックし、**既存項目の**します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-145">Right-click the BizTalk project in the Solution Explorer, point to **Add**, and then click **Existing Item**.</span></span> <span data-ttu-id="c95b0-146">既存項目の追加 ダイアログ ボックスで、スキーマとクリックを保存した場所に移動します。**追加**します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-146">In the Add Existing Item dialog box, navigate to the location where you saved the schema and click **Add**.</span></span>  
  
3. <span data-ttu-id="c95b0-147">スキーマを開き[!INCLUDE[btsVStudioNoVersion](../../includes/btsvstudionoversion-md.md)]次の変更を行います。</span><span class="sxs-lookup"><span data-stu-id="c95b0-147">Open the schema in [!INCLUDE[btsVStudioNoVersion](../../includes/btsvstudionoversion-md.md)] and make the following changes.</span></span>  
  
   1.  <span data-ttu-id="c95b0-148">スキーマにノードを追加し、新しく追加されたこのノードの下の既存のルート ノードを移動します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-148">Add a node to the schema and move the existing root node under this newly added node.</span></span> <span data-ttu-id="c95b0-149">ルート ノードに名前を付けます。</span><span class="sxs-lookup"><span data-stu-id="c95b0-149">Give a name to the root node.</span></span> <span data-ttu-id="c95b0-150">このトピックでは、名前を変更するルート ノード**ルート**します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-150">For this topic, rename the root node to **Root**.</span></span>  
  
   2.  <span data-ttu-id="c95b0-151">ストアド プロシージャの生成、応答スキーマを sqltypes.xsd を参照します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-151">The response schema generated for the stored procedure references a sqltypes.xsd.</span></span> <span data-ttu-id="c95b0-152">Sqltypes.xsd スキーマから取得できます[ http://go.microsoft.com/fwlink/?LinkId=131087](http://go.microsoft.com/fwlink/?LinkId=131087)します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-152">You can get the sqltypes.xsd schema from [http://go.microsoft.com/fwlink/?LinkId=131087](http://go.microsoft.com/fwlink/?LinkId=131087).</span></span> <span data-ttu-id="c95b0-153">Sqltypes.xsd スキーマを BizTalk プロジェクトに追加します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-153">Add the sqltypes.xsd schema to the BizTalk project.</span></span>  
  
   3.  <span data-ttu-id="c95b0-154">ストアド プロシージャの生成、スキーマ内の値を変更`import schemaLocation`以下。</span><span class="sxs-lookup"><span data-stu-id="c95b0-154">In the schema generated for the stored procedure, change the value of `import schemaLocation` to the following.</span></span>  
  
       ```  
       import schemaLocation=”sqltypes.xsd”  
       ```  
  
        <span data-ttu-id="c95b0-155">Sqltypes.xsd スキーマは、BizTalk プロジェクトに既に追加されたために実行します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-155">You do this because you have already added the sqltypes.xsd schema to your BizTalk project.</span></span>  
  
   4.  <span data-ttu-id="c95b0-156">スキーマのターゲットの名前空間を提供します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-156">Provide a target namespace for the schema.</span></span> <span data-ttu-id="c95b0-157">をクリックして、 **\<スキーマ\>** ノード プロパティ ウィンドウで名前空間を指定し、 **Target Namespace**プロパティ。</span><span class="sxs-lookup"><span data-stu-id="c95b0-157">Click the **\<Schema\>** node, and in the properties pane, specify a namespace in the **Target Namespace** property.</span></span> <span data-ttu-id="c95b0-158">このトピックでは、名前空間を与える`http://ForXmlStoredProcs/namespace`します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-158">For this topic, give the namespace as `http://ForXmlStoredProcs/namespace`.</span></span>  
  
## <a name="generating-schema-for-the-request-message-to-invoke-the-stored-procedure"></a><span data-ttu-id="c95b0-159">ストアド プロシージャを呼び出す要求メッセージのスキーマを生成します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-159">Generating Schema for the Request Message to Invoke the Stored Procedure</span></span>  
 <span data-ttu-id="c95b0-160">使用することが要求メッセージのスキーマを生成する、[!INCLUDE[consumeadapterservshort](../../includes/consumeadapterservshort-md.md)]で BizTalk プロジェクトから[!INCLUDE[btsVStudioNoVersion](../../includes/btsvstudionoversion-md.md)]します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-160">To generate schema for the request message you can use the [!INCLUDE[consumeadapterservshort](../../includes/consumeadapterservshort-md.md)] from a BizTalk project in [!INCLUDE[btsVStudioNoVersion](../../includes/btsvstudionoversion-md.md)].</span></span> <span data-ttu-id="c95b0-161">このトピックでは、GET_EMP_DETAILS_FOR_XML ストアド プロシージャのスキーマを生成します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-161">For this topic, generate the schema for the GET_EMP_DETAILS_FOR_XML stored procedure.</span></span> <span data-ttu-id="c95b0-162">使用してスキーマを生成する方法の詳細についての[!INCLUDE[consumeadapterservshort](../../includes/consumeadapterservshort-md.md)]を参照してください[SQL アダプターを使用して Visual Studio での SQL Server 操作のメタデータを取得する](../../adapters-and-accelerators/adapter-sql/get-metadata-for-sql-server-operations-in-visual-studio-using-the-sql-adapter.md)します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-162">For more information about how to generate the schema using [!INCLUDE[consumeadapterservshort](../../includes/consumeadapterservshort-md.md)], see [Retrieving Metadata for SQL Server Operations in Visual Studio using the SQL adapter](../../adapters-and-accelerators/adapter-sql/get-metadata-for-sql-server-operations-in-visual-studio-using-the-sql-adapter.md).</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="c95b0-163">プロシージャからのみを選択して、スキーマを生成する必要があります、**プロシージャ**ノード[!INCLUDE[consumeadapterservshort](../../includes/consumeadapterservshort-md.md)]します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-163">You must generate the schema by selecting the procedure only from the **Procedures** node in [!INCLUDE[consumeadapterservshort](../../includes/consumeadapterservshort-md.md)].</span></span>  
  
## <a name="defining-messages-and-message-types"></a><span data-ttu-id="c95b0-164">メッセージおよびメッセージの種類を定義します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-164">Defining Messages and Message Types</span></span>  
 <span data-ttu-id="c95b0-165">先に生成したスキーマは、オーケストレーションのメッセージに求められる "型" を記述します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-165">The schema that you generated earlier describes the “types” required for the messages in the orchestration.</span></span> <span data-ttu-id="c95b0-166">メッセージは、通常、対象の型が、対応するスキーマで定義されている、変数です。</span><span class="sxs-lookup"><span data-stu-id="c95b0-166">A message is typically a variable, the type for which is defined by the corresponding schema.</span></span> <span data-ttu-id="c95b0-167">オーケストレーションでは、メッセージを作成し、前の手順で生成したスキーマにリンクする必要がありますようになりました。</span><span class="sxs-lookup"><span data-stu-id="c95b0-167">You must now create messages for the orchestration, and link them to schemas that you generated in the previous step.</span></span>  
  
#### <a name="to-create-messages-and-link-to-schema"></a><span data-ttu-id="c95b0-168">メッセージを作成し、スキーマにリンクするには</span><span class="sxs-lookup"><span data-stu-id="c95b0-168">To create messages and link to schema</span></span>  
  
1.  <span data-ttu-id="c95b0-169">オーケストレーションを BizTalk プロジェクトに追加します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-169">Add an orchestration to the BizTalk project.</span></span> <span data-ttu-id="c95b0-170">ソリューション エクスプ ローラーで、BizTalk プロジェクト名を右クリックして**追加**、 をクリックし、**新しい項目の**します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-170">From Solution Explorer, right-click the BizTalk project name, point to **Add**, and then click **New Item**.</span></span> <span data-ttu-id="c95b0-171">BizTalk オーケストレーションの名前を入力し、クリックして**追加**します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-171">Type a name for the BizTalk orchestration, and then click **Add**.</span></span>  
  
2.  <span data-ttu-id="c95b0-172">開いていない場合は、BizTalk プロジェクトのオーケストレーションの種類 ウィンドウを開きます。</span><span class="sxs-lookup"><span data-stu-id="c95b0-172">Open the Orchestration View window of the BizTalk project, if it is not already open.</span></span> <span data-ttu-id="c95b0-173">これを行うには、次のようにクリックします。**ビュー**、 をポイント**その他の Windows**、順にクリックします**オーケストレーション**します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-173">To do so, click **View**, point to **Other Windows**, and then click **Orchestration View**.</span></span>  
  
3.  <span data-ttu-id="c95b0-174">オーケストレーション ビューで右クリックして**メッセージ**、 をクリックし、**新しいメッセージ**します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-174">In Orchestration View, right-click **Messages**, and then click **New Message**.</span></span>  
  
4.  <span data-ttu-id="c95b0-175">新しく作成されたメッセージを右クリックし、**プロパティ ウィンドウ**します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-175">Right-click the newly created message, and then select **Properties Window**.</span></span>  
  
5.  <span data-ttu-id="c95b0-176">**プロパティ**のウィンドウ、 **Message_1**次の操作を行います。</span><span class="sxs-lookup"><span data-stu-id="c95b0-176">In the **Properties** pane for the **Message_1**, do the following:</span></span>  
  
    |<span data-ttu-id="c95b0-177">プロパティ</span><span class="sxs-lookup"><span data-stu-id="c95b0-177">Use this</span></span>|<span data-ttu-id="c95b0-178">目的</span><span class="sxs-lookup"><span data-stu-id="c95b0-178">To do this</span></span>|  
    |--------------|----------------|  
    |<span data-ttu-id="c95b0-179">[Identifier]</span><span class="sxs-lookup"><span data-stu-id="c95b0-179">Identifier</span></span>|<span data-ttu-id="c95b0-180">「`Request`」と入力します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-180">Type `Request`</span></span>|  
    |<span data-ttu-id="c95b0-181">メッセージ型</span><span class="sxs-lookup"><span data-stu-id="c95b0-181">Message Type</span></span>|<span data-ttu-id="c95b0-182">ドロップダウン リストから展開**スキーマ**、し、 *ForXMLProcedure.Procedure_dbo します。GET_EMP_DETAILS_FOR_XML*ForXMLProcedure は、BizTalk プロジェクトの名前です。</span><span class="sxs-lookup"><span data-stu-id="c95b0-182">From the drop-down list, expand **Schemas**, and then select *ForXMLProcedure.Procedure_dbo.GET_EMP_DETAILS_FOR_XML*, where ForXMLProcedure is the name of your BizTalk project.</span></span> <span data-ttu-id="c95b0-183">Procedure_dbo は GET_EMP_DETAILS_FOR_XML プロシージャを呼び出すために生成されたスキーマを示します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-183">Procedure_dbo is the schema generated for invoking the GET_EMP_DETAILS_FOR_XML procedure.</span></span>|  
  
6.  <span data-ttu-id="c95b0-184">新しいメッセージを作成する 2 の手順を繰り返します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-184">Repeat step 2 to create a new message.</span></span> <span data-ttu-id="c95b0-185">**プロパティ**ウィンドウで、新しいメッセージの場合は、次を実行します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-185">In the **Properties** pane for the new message, do the following:</span></span>  
  
    |<span data-ttu-id="c95b0-186">プロパティ</span><span class="sxs-lookup"><span data-stu-id="c95b0-186">Use this</span></span>|<span data-ttu-id="c95b0-187">目的</span><span class="sxs-lookup"><span data-stu-id="c95b0-187">To do this</span></span>|  
    |--------------|----------------|  
    |<span data-ttu-id="c95b0-188">[Identifier]</span><span class="sxs-lookup"><span data-stu-id="c95b0-188">Identifier</span></span>|<span data-ttu-id="c95b0-189">「`Response`」と入力します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-189">Type `Response`</span></span>|  
    |<span data-ttu-id="c95b0-190">メッセージ型</span><span class="sxs-lookup"><span data-stu-id="c95b0-190">Message Type</span></span>|<span data-ttu-id="c95b0-191">ドロップダウン リストから展開**スキーマ**、し、 *ForXMLProcedure.ResponseSchema*ResponseSchema としてストアド プロシージャの実行によって生成される応答スキーマの名前です「[ストアド プロシージャの応答メッセージ スキーマを生成する](#BKMK_RespSchema)します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-191">From the drop-down list, expand **Schemas**, and then select *ForXMLProcedure.ResponseSchema*, where ResponseSchema is the name of the response schema generated by executing the stored procedure as described under [Generating Schema for the Response Message for Stored Procedure](#BKMK_RespSchema).</span></span>|  
  
## <a name="setting-up-the-orchestration"></a><span data-ttu-id="c95b0-192">オーケストレーションのセットアップ</span><span class="sxs-lookup"><span data-stu-id="c95b0-192">Setting up the Orchestration</span></span>  
 <span data-ttu-id="c95b0-193">使用する BizTalk オーケストレーションを作成する必要があります[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]の SQL Server ストアド プロシージャを実行します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-193">You must create a BizTalk orchestration to use [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] for executing a stored procedure in SQL Server.</span></span> <span data-ttu-id="c95b0-194">このオーケストレーションでの要求メッセージを削除する、定義されている受信場所。</span><span class="sxs-lookup"><span data-stu-id="c95b0-194">In this orchestration, you drop a request message at a defined receive location.</span></span> <span data-ttu-id="c95b0-195">[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]がこのメッセージを使用して、SQL Server に渡します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-195">The [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)] consumes this message and passes it on to SQL Server.</span></span> <span data-ttu-id="c95b0-196">SQL Server からの応答は、別の場所に保存されます。</span><span class="sxs-lookup"><span data-stu-id="c95b0-196">The response from SQL Server is saved to another location.</span></span> <span data-ttu-id="c95b0-197">送信を含めるし、受信図形を SQL Server にメッセージを送信し、それぞれ、応答を受信する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c95b0-197">You must include Send and Receive shapes to send messages to SQL Server and receive responses, respectively.</span></span> <span data-ttu-id="c95b0-198">プロシージャを呼び出すためのサンプル オーケストレーションには、次のようになります。</span><span class="sxs-lookup"><span data-stu-id="c95b0-198">A sample orchestration for invoking a procedure resembles the following:</span></span>  
  
 <span data-ttu-id="c95b0-199">![ストアド プロシージャを呼び出すオーケストレーション](../../adapters-and-accelerators/adapter-sql/media/eac6e8b6-f0f4-44af-8218-03ca3864b267.gif "eac6e8b6-f0f4-44af-8218-03ca3864b267")</span><span class="sxs-lookup"><span data-stu-id="c95b0-199">![Orchestration to invoke stored procedures](../../adapters-and-accelerators/adapter-sql/media/eac6e8b6-f0f4-44af-8218-03ca3864b267.gif "eac6e8b6-f0f4-44af-8218-03ca3864b267")</span></span>  
  
### <a name="adding-message-shapes"></a><span data-ttu-id="c95b0-200">メッセージの構築図形を追加します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-200">Adding Message Shapes</span></span>  
 <span data-ttu-id="c95b0-201">メッセージの構築図形のごとに、次のプロパティを指定することを確認します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-201">Make sure you specify the following properties for each of the message shapes.</span></span> <span data-ttu-id="c95b0-202">図形の列に示した名前は、単に説明したオーケストレーションに表示されるメッセージの構築図形の名前です。</span><span class="sxs-lookup"><span data-stu-id="c95b0-202">The names listed in the Shape column are the names of the message shapes as displayed in the just-mentioned orchestration.</span></span>  
  
|<span data-ttu-id="c95b0-203">図形</span><span class="sxs-lookup"><span data-stu-id="c95b0-203">Shape</span></span>|<span data-ttu-id="c95b0-204">図形の種類</span><span class="sxs-lookup"><span data-stu-id="c95b0-204">Shape Type</span></span>|<span data-ttu-id="c95b0-205">[プロパティ]</span><span class="sxs-lookup"><span data-stu-id="c95b0-205">Properties</span></span>|  
|-----------|----------------|----------------|  
|<span data-ttu-id="c95b0-206">ReceiveMessage</span><span class="sxs-lookup"><span data-stu-id="c95b0-206">ReceiveMessage</span></span>|<span data-ttu-id="c95b0-207">Receive</span><span class="sxs-lookup"><span data-stu-id="c95b0-207">Receive</span></span>|<span data-ttu-id="c95b0-208">-設定**名前**に*ReceiveMessage*</span><span class="sxs-lookup"><span data-stu-id="c95b0-208">-   Set **Name** to *ReceiveMessage*</span></span><br /><span data-ttu-id="c95b0-209">-設定**アクティブ**に*は True。*</span><span class="sxs-lookup"><span data-stu-id="c95b0-209">-   Set **Activate** to *True*</span></span>|  
|<span data-ttu-id="c95b0-210">SendMessage</span><span class="sxs-lookup"><span data-stu-id="c95b0-210">SendMessage</span></span>|<span data-ttu-id="c95b0-211">Send</span><span class="sxs-lookup"><span data-stu-id="c95b0-211">Send</span></span>|<span data-ttu-id="c95b0-212">-設定**名前**に*SendMessage*</span><span class="sxs-lookup"><span data-stu-id="c95b0-212">-   Set **Name** to *SendMessage*</span></span>|  
|<span data-ttu-id="c95b0-213">ReceiveResponse</span><span class="sxs-lookup"><span data-stu-id="c95b0-213">ReceiveResponse</span></span>|<span data-ttu-id="c95b0-214">Receive</span><span class="sxs-lookup"><span data-stu-id="c95b0-214">Receive</span></span>|<span data-ttu-id="c95b0-215">-設定**名前**に*ReceiveResponse*</span><span class="sxs-lookup"><span data-stu-id="c95b0-215">-   Set **Name** to *ReceiveResponse*</span></span><br /><span data-ttu-id="c95b0-216">-設定**アクティブ**に*False*</span><span class="sxs-lookup"><span data-stu-id="c95b0-216">-   Set **Activate** to *False*</span></span>|  
|<span data-ttu-id="c95b0-217">SendResponse</span><span class="sxs-lookup"><span data-stu-id="c95b0-217">SendResponse</span></span>|<span data-ttu-id="c95b0-218">Send</span><span class="sxs-lookup"><span data-stu-id="c95b0-218">Send</span></span>|<span data-ttu-id="c95b0-219">-設定**名前**に*SendResponse*</span><span class="sxs-lookup"><span data-stu-id="c95b0-219">-   Set **Name** to *SendResponse*</span></span>|  
  
### <a name="adding-ports"></a><span data-ttu-id="c95b0-220">ポートの追加</span><span class="sxs-lookup"><span data-stu-id="c95b0-220">Adding Ports</span></span>  
 <span data-ttu-id="c95b0-221">論理ポートごとに、次のプロパティを指定することを確認します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-221">Make sure you specify the following properties for each of the logical ports.</span></span> <span data-ttu-id="c95b0-222">ポート列に示した名前は、オーケストレーションで表示されているポートの名前です。</span><span class="sxs-lookup"><span data-stu-id="c95b0-222">The names listed in the Port column are the names of the ports as displayed in the orchestration.</span></span>  
  
|<span data-ttu-id="c95b0-223">Port</span><span class="sxs-lookup"><span data-stu-id="c95b0-223">Port</span></span>|<span data-ttu-id="c95b0-224">[プロパティ]</span><span class="sxs-lookup"><span data-stu-id="c95b0-224">Properties</span></span>|  
|----------|----------------|  
|<span data-ttu-id="c95b0-225">MessageIn</span><span class="sxs-lookup"><span data-stu-id="c95b0-225">MessageIn</span></span>|<span data-ttu-id="c95b0-226">-設定**識別子**に*MessageIn*</span><span class="sxs-lookup"><span data-stu-id="c95b0-226">-   Set **Identifier** to *MessageIn*</span></span><br /><span data-ttu-id="c95b0-227">-設定**型**に*MessageInType*</span><span class="sxs-lookup"><span data-stu-id="c95b0-227">-   Set **Type** to *MessageInType*</span></span><br /><span data-ttu-id="c95b0-228">-設定**通信パターン**に*一方向*</span><span class="sxs-lookup"><span data-stu-id="c95b0-228">-   Set **Communication Pattern** to *One-Way*</span></span><br /><span data-ttu-id="c95b0-229">-設定**通信方向**に*受信*</span><span class="sxs-lookup"><span data-stu-id="c95b0-229">-   Set **Communication Direction** to *Receive*</span></span>|  
|<span data-ttu-id="c95b0-230">LOBPort</span><span class="sxs-lookup"><span data-stu-id="c95b0-230">LOBPort</span></span>|<span data-ttu-id="c95b0-231">-設定**識別子**に*LOBPort*</span><span class="sxs-lookup"><span data-stu-id="c95b0-231">-   Set **Identifier** to *LOBPort*</span></span><br /><span data-ttu-id="c95b0-232">-設定**型**に*LOBPortType*</span><span class="sxs-lookup"><span data-stu-id="c95b0-232">-   Set **Type** to *LOBPortType*</span></span><br /><span data-ttu-id="c95b0-233">-設定**通信パターン**に*要求-応答*</span><span class="sxs-lookup"><span data-stu-id="c95b0-233">-   Set **Communication Pattern** to *Request-Response*</span></span><br /><span data-ttu-id="c95b0-234">-設定**通信方向**に*送受信*</span><span class="sxs-lookup"><span data-stu-id="c95b0-234">-   Set **Communication Direction** to *Send-Receive*</span></span>|  
|<span data-ttu-id="c95b0-235">ResponseOut</span><span class="sxs-lookup"><span data-stu-id="c95b0-235">ResponseOut</span></span>|<span data-ttu-id="c95b0-236">-設定**識別子**に*ResponseOut*</span><span class="sxs-lookup"><span data-stu-id="c95b0-236">-   Set **Identifier** to *ResponseOut*</span></span><br /><span data-ttu-id="c95b0-237">-設定**型**に*ResponseOutType*</span><span class="sxs-lookup"><span data-stu-id="c95b0-237">-   Set **Type** to *ResponseOutType*</span></span><br /><span data-ttu-id="c95b0-238">-設定**通信パターン**に*一方向*</span><span class="sxs-lookup"><span data-stu-id="c95b0-238">-   Set **Communication Pattern** to *One-Way*</span></span><br /><span data-ttu-id="c95b0-239">-設定**通信方向**に*送信*</span><span class="sxs-lookup"><span data-stu-id="c95b0-239">-   Set **Communication Direction** to *Send*</span></span>|  
  
### <a name="specify-messages-for-action-shapes-and-connect-them-to-ports"></a><span data-ttu-id="c95b0-240">アクション図形は、メッセージを指定し、ポートに接続</span><span class="sxs-lookup"><span data-stu-id="c95b0-240">Specify Messages for Action Shapes, and Connect Them to Ports</span></span>  
 <span data-ttu-id="c95b0-241">次の表では、プロパティとアクション図形のメッセージを指定して、メッセージ ポートにリンクを設定する必要があります、値を指定します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-241">The following table specifies the properties and their values that you should set to specify messages for action shapes and to link the messages to the ports.</span></span> <span data-ttu-id="c95b0-242">図形の列に示した名前は、前に説明したオーケストレーションに表示されるメッセージの構築図形の名前です。</span><span class="sxs-lookup"><span data-stu-id="c95b0-242">The names listed in the Shape column are the names of the message shapes as displayed in the orchestration mentioned earlier.</span></span>  
  
|<span data-ttu-id="c95b0-243">図形</span><span class="sxs-lookup"><span data-stu-id="c95b0-243">Shape</span></span>|<span data-ttu-id="c95b0-244">[プロパティ]</span><span class="sxs-lookup"><span data-stu-id="c95b0-244">Properties</span></span>|  
|-----------|----------------|  
|<span data-ttu-id="c95b0-245">ReceiveMessage</span><span class="sxs-lookup"><span data-stu-id="c95b0-245">ReceiveMessage</span></span>|<span data-ttu-id="c95b0-246">-設定**メッセージ**に*要求*</span><span class="sxs-lookup"><span data-stu-id="c95b0-246">-   Set **Message** to *Request*</span></span><br /><span data-ttu-id="c95b0-247">-設定**操作**に*MessageIn.FOR_XML します。要求*</span><span class="sxs-lookup"><span data-stu-id="c95b0-247">-   Set **Operation** to *MessageIn.FOR_XML.Request*</span></span>|  
|<span data-ttu-id="c95b0-248">SendMessage</span><span class="sxs-lookup"><span data-stu-id="c95b0-248">SendMessage</span></span>|<span data-ttu-id="c95b0-249">-設定**メッセージ**に*要求*</span><span class="sxs-lookup"><span data-stu-id="c95b0-249">-   Set **Message** to *Request*</span></span><br /><span data-ttu-id="c95b0-250">-設定**操作**に*LOBPort.FOR_XML します。要求*</span><span class="sxs-lookup"><span data-stu-id="c95b0-250">-   Set **Operation** to *LOBPort.FOR_XML.Request*</span></span>|  
|<span data-ttu-id="c95b0-251">ReceiveResponse</span><span class="sxs-lookup"><span data-stu-id="c95b0-251">ReceiveResponse</span></span>|<span data-ttu-id="c95b0-252">-設定**メッセージ**に*応答*</span><span class="sxs-lookup"><span data-stu-id="c95b0-252">-   Set **Message** to *Response*</span></span><br /><span data-ttu-id="c95b0-253">-設定**操作**に*LOBPort.FOR_XML します。応答*</span><span class="sxs-lookup"><span data-stu-id="c95b0-253">-   Set **Operation** to *LOBPort.FOR_XML.Response*</span></span>|  
|<span data-ttu-id="c95b0-254">SendResponse</span><span class="sxs-lookup"><span data-stu-id="c95b0-254">SendResponse</span></span>|<span data-ttu-id="c95b0-255">-設定**メッセージ**に*応答*</span><span class="sxs-lookup"><span data-stu-id="c95b0-255">-   Set **Message** to *Response*</span></span><br /><span data-ttu-id="c95b0-256">-設定**操作**に*ResponseOut.FOR_XML します。要求*</span><span class="sxs-lookup"><span data-stu-id="c95b0-256">-   Set **Operation** to *ResponseOut.FOR_XML.Request*</span></span>|  
  
 <span data-ttu-id="c95b0-257">これらのプロパティを指定したら、メッセージの構築図形とポートが接続されているし、オーケストレーションが完了します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-257">After you have specified these properties, the message shapes and ports are connected and your orchestration is complete.</span></span>  
  
 <span data-ttu-id="c95b0-258">ここで、BizTalk ソリューションをビルドしに配置する必要があります、[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-258">You must now build the BizTalk solution and deploy it to a [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)].</span></span> <span data-ttu-id="c95b0-259">詳細については、次を参照してください。[を実行しているオーケストレーションのビルドと](../../core/building-and-running-orchestrations.md)します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-259">For more information, see [Building and Running Orchestrations](../../core/building-and-running-orchestrations.md).</span></span>
  
## <a name="configuring-the-biztalk-application"></a><span data-ttu-id="c95b0-260">BizTalk アプリケーションを構成します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-260">Configuring the BizTalk Application</span></span>  
 <span data-ttu-id="c95b0-261">[オーケストレーション] ペインで先ほど作成したオーケストレーションが表示されている BizTalk プロジェクトを配置した後、[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]管理コンソール。</span><span class="sxs-lookup"><span data-stu-id="c95b0-261">After you have deployed the BizTalk project, the orchestration you created earlier is listed under the Orchestrations pane in the [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] Administration console.</span></span> <span data-ttu-id="c95b0-262">使用する必要があります、[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]管理コンソールにアプリケーションを構成します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-262">You must use the [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] Administration console to configure the application.</span></span> <span data-ttu-id="c95b0-263">チュートリアルについては、次を参照してください。[チュートリアル。基本的な BizTalk アプリケーション展開](Walkthrough:%20Deploying%20a%20Basic%20BizTalk%20Application.md)します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-263">For a walkthrough, see [Walkthrough: Deploying a Basic BizTalk Application](Walkthrough:%20Deploying%20a%20Basic%20BizTalk%20Application.md).</span></span>
  
 <span data-ttu-id="c95b0-264">アプリケーションを構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c95b0-264">Configuring an application involves:</span></span>  
  
- <span data-ttu-id="c95b0-265">アプリケーションのホストを選択します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-265">Selecting a host for the application.</span></span>  
  
- <span data-ttu-id="c95b0-266">物理ポートにオーケストレーションで作成したポートのマッピング、[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]管理コンソール。</span><span class="sxs-lookup"><span data-stu-id="c95b0-266">Mapping the ports that you created in your orchestration to physical ports in the [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] Administration console.</span></span> <span data-ttu-id="c95b0-267">このオーケストレーションの次の操作を行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="c95b0-267">For this orchestration you must:</span></span>  
  
  - <span data-ttu-id="c95b0-268">ハード ディスクと、要求メッセージをドロップする場所、対応するファイル ポートでの場所を定義します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-268">Define a location on the hard disk and a corresponding file port where you will drop a request message.</span></span> <span data-ttu-id="c95b0-269">BizTalk オーケストレーションは要求メッセージを使用し、SQL Server データベースに送信します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-269">The BizTalk orchestration will consume the request message and send it to SQL Server database.</span></span>  
  
  - <span data-ttu-id="c95b0-270">ハード ディスクと、対応するファイル ポートを BizTalk オーケストレーションが SQL Server データベースからの応答を含む応答メッセージをドロップする場所の場所を定義します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-270">Define a location on the hard disk and a corresponding file port where the BizTalk orchestration will drop the response message containing the response from SQL Server database.</span></span>  
  
  - <span data-ttu-id="c95b0-271">SQL Server データベースにメッセージを送信する物理 Wcf-custom または WCF-SQL 送信ポートを定義します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-271">Define a physical WCF-Custom or WCF-SQL send port to send messages to SQL Server database.</span></span> <span data-ttu-id="c95b0-272">送信ポートを作成する方法については、次を参照してください。 [SQL アダプターを物理ポートのバインドを手動で構成](../../adapters-and-accelerators/adapter-sql/manually-configure-a-physical-port-binding-to-the-sql-adapter.md)します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-272">For instructions on how to create a send port, see [Manually configure a physical port binding to the SQL adapter](../../adapters-and-accelerators/adapter-sql/manually-configure-a-physical-port-binding-to-the-sql-adapter.md).</span></span>
  
     <span data-ttu-id="c95b0-273">送信ポートでアクションを指定することも必要があります。</span><span class="sxs-lookup"><span data-stu-id="c95b0-273">You must also specify the action in the send port.</span></span> <span data-ttu-id="c95b0-274">FOR XML 句を含む手順については、次の形式でアクションを設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c95b0-274">For procedures that contain the FOR XML clause, you must set the action in the following format.</span></span>  
  
    ```  
    XmlProcedure/<schema_name>/<procedure_name>  
    ```  
  
     <span data-ttu-id="c95b0-275">そのため、このトピックでは GET_EMP_DETAILS_FOR_XML プロシージャを実行しましたが、アクションになります。</span><span class="sxs-lookup"><span data-stu-id="c95b0-275">So, for this topic where we are executing the GET_EMP_DETAILS_FOR_XML procedure, the action will be:</span></span>  
  
    ```  
    XmlProcedure/dbo/GET_EMP_DETAILS_FOR_XML  
    ```  
  
     <span data-ttu-id="c95b0-276">設定アクションの詳細については、次を参照してください。 [SQL アダプタの SOAP アクションを構成する](../../adapters-and-accelerators/adapter-sql/configure-the-soap-action-for-the-sql-adapter.md)します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-276">For more information about setting action, see [Configure the SOAP action for the SQL adapter ](../../adapters-and-accelerators/adapter-sql/configure-the-soap-action-for-the-sql-adapter.md).</span></span>
  
     <span data-ttu-id="c95b0-277">FOR XML 句を使用してストアド プロシージャを実行するときに、次のバインドのプロパティを設定することも必要があります。</span><span class="sxs-lookup"><span data-stu-id="c95b0-277">You must also set the following binding properties when executing a stored procedure with the FOR XML clause.</span></span>  
  
    |<span data-ttu-id="c95b0-278">バインドのプロパティ名</span><span class="sxs-lookup"><span data-stu-id="c95b0-278">Binding property name</span></span>|<span data-ttu-id="c95b0-279">これを設定します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-279">Set this to</span></span>|  
    |---------------------------|-----------------|  
    |<span data-ttu-id="c95b0-280">XmlStoredProcedureRootNodeName</span><span class="sxs-lookup"><span data-stu-id="c95b0-280">XmlStoredProcedureRootNodeName</span></span>|<span data-ttu-id="c95b0-281">トピックに示すように、ストアド プロシージャ用に生成した応答スキーマに追加したルート ノードの名前を指定[ストアド プロシージャの応答メッセージのスキーマを生成する](#BKMK_RespSchema)します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-281">Specify the name of the root node that you added to the response schema you generated for the stored procedure, as described under [Generating Schema for the Response Message for Stored Procedure](#BKMK_RespSchema).</span></span> <span data-ttu-id="c95b0-282">このトピックに設定**ルート**します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-282">For this topic, set this to **Root**.</span></span>|  
    |<span data-ttu-id="c95b0-283">XmlStoredProcedureRootNodeNamespace</span><span class="sxs-lookup"><span data-stu-id="c95b0-283">XmlStoredProcedureRootNodeNamespace</span></span>|<span data-ttu-id="c95b0-284">トピックに示すように、ストアド プロシージャ用に生成した応答スキーマのターゲット名前空間を指定[ストアド プロシージャの応答メッセージのスキーマを生成する](#BKMK_RespSchema)します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-284">Specify the target namespace for the response schema you generated for the stored procedure, as described under [Generating Schema for the Response Message for Stored Procedure](#BKMK_RespSchema).</span></span> <span data-ttu-id="c95b0-285">このトピックに設定`http://ForXmlStoredProcs/namespace`します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-285">For this topic, set this to `http://ForXmlStoredProcs/namespace`.</span></span>|  
  
     <span data-ttu-id="c95b0-286">バインドのプロパティの値を指定する方法については、次を参照してください。 [SQL アダプタのバインドのプロパティを構成する](../../adapters-and-accelerators/adapter-sql/configure-the-binding-properties-for-the-sql-adapter.md)します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-286">For more information about specifying values for binding properties, see [Configure the binding properties for the SQL adapter](../../adapters-and-accelerators/adapter-sql/configure-the-binding-properties-for-the-sql-adapter.md).</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="c95b0-287">使用して、スキーマの生成、[!INCLUDE[consumeadapterservlong](../../includes/consumeadapterservlong-md.md)]ポートとそれらのポートに設定するアクションに関する情報を含むバインド ファイルも作成されます。</span><span class="sxs-lookup"><span data-stu-id="c95b0-287">Generating the schema using the [!INCLUDE[consumeadapterservlong](../../includes/consumeadapterservlong-md.md)] also creates a binding file that contains information about the ports and the actions to be set for those ports.</span></span> <span data-ttu-id="c95b0-288">このバインド ファイルをインポートすることができます、[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]管理コンソール (発信) の送信ポートを作成したり (着信) 用のポートを受信します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-288">You can import this binding file from the [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] Administration console to create send ports (for outbound calls) or receive ports (for inbound calls).</span></span> <span data-ttu-id="c95b0-289">詳細については、次を参照してください。 [SQL アダプターを使用するポートのバインド ファイルを使用して物理的なポート バインドを構成する](../../adapters-and-accelerators/adapter-sql/configure-a-physical-port-binding-using-a-port-binding-file-to-sql-adapter.md)します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-289">For more information, see [Configure a physical port binding using a port binding file to use the SQL adapter](../../adapters-and-accelerators/adapter-sql/configure-a-physical-port-binding-using-a-port-binding-file-to-sql-adapter.md).</span></span>
  
## <a name="starting-the-application"></a><span data-ttu-id="c95b0-290">アプリケーションの起動</span><span class="sxs-lookup"><span data-stu-id="c95b0-290">Starting the Application</span></span>  
 <span data-ttu-id="c95b0-291">SQL Server データベースでは、プロシージャを呼び出す BizTalk アプリケーションを開始する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c95b0-291">You must start the BizTalk application for invoking procedures in SQL Server database.</span></span> <span data-ttu-id="c95b0-292">BizTalk アプリケーションを開始する手順については、次を参照してください。[オーケストレーションを開始する方法](../../core/how-to-start-an-orchestration.md)します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-292">For instructions on starting a BizTalk application, see [How to Start an Orchestration](../../core/how-to-start-an-orchestration.md).</span></span>
  
 <span data-ttu-id="c95b0-293">この段階で、ことを確認します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-293">At this stage, make sure:</span></span>  
  
-   <span data-ttu-id="c95b0-294">ファイルは、オーケストレーションが実行中の要求メッセージを受信するポートを受信します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-294">The FILE receive port to receive request messages for the orchestration is running.</span></span>  
  
-   <span data-ttu-id="c95b0-295">オーケストレーションから応答メッセージを受信する FILE 送信ポートが実行されています。</span><span class="sxs-lookup"><span data-stu-id="c95b0-295">The FILE send port to receive the response messages from the orchestration is running.</span></span>  
  
-   <span data-ttu-id="c95b0-296">SQL Server データベースにメッセージを送信する Wcf-custom または WCF-SQL 送信ポートが実行されています。</span><span class="sxs-lookup"><span data-stu-id="c95b0-296">The WCF-Custom or WCF-SQL send port to send messages to SQL Server database is running.</span></span>  
  
-   <span data-ttu-id="c95b0-297">操作の BizTalk オーケストレーションが実行されています。</span><span class="sxs-lookup"><span data-stu-id="c95b0-297">The BizTalk orchestration for the operation is running.</span></span>  
  
## <a name="executing-the-operation"></a><span data-ttu-id="c95b0-298">操作の実行</span><span class="sxs-lookup"><span data-stu-id="c95b0-298">Executing the Operation</span></span>  
 <span data-ttu-id="c95b0-299">ファイルに要求メッセージを削除する必要があります、アプリケーションを実行した後の受信場所。</span><span class="sxs-lookup"><span data-stu-id="c95b0-299">After you run the application, you must drop a request message to the FILE receive location.</span></span> <span data-ttu-id="c95b0-300">要求メッセージのスキーマを使用して生成する手順については、要求スキーマに準拠している必要があります、[!INCLUDE[consumeadapterservshort](../../includes/consumeadapterservshort-md.md)]します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-300">The schema for the request message must conform to the request schema for the procedure you generated using the [!INCLUDE[consumeadapterservshort](../../includes/consumeadapterservshort-md.md)].</span></span> <span data-ttu-id="c95b0-301">たとえば、GET_EMP_DETAILS_FOR XML を起動する要求メッセージには。</span><span class="sxs-lookup"><span data-stu-id="c95b0-301">For example, the request message to invoke the GET_EMP_DETAILS_FOR XML is:</span></span>  
  
```  
<GET_EMP_DETAILS_FOR_XML xmlns="http://schemas.microsoft.com/Sql/2008/05/Procedures/dbo">  
  <emp_id>10765</emp_id>  
</GET_EMP_DETAILS_FOR_XML>  
```  
  
 <span data-ttu-id="c95b0-302">参照してください[プロシージャと関数のメッセージ スキーマ](../../adapters-and-accelerators/adapter-sql/message-schemas-for-procedures-and-functions.md)を使用して、データベースの SQL Server でプロシージャを呼び出すための要求メッセージ スキーマの詳細については、[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-302">See [Message Schemas for Procedures and Functions](../../adapters-and-accelerators/adapter-sql/message-schemas-for-procedures-and-functions.md) for more information about the request message schema for invoking procedures in SQL Server database using the [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)].</span></span>  
  
 <span data-ttu-id="c95b0-303">オーケストレーションはメッセージを使用し、SQL Server データベースに送信します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-303">The orchestration consumes the message and sends it to SQL Server database.</span></span> <span data-ttu-id="c95b0-304">SQL Server データベースからの応答は、オーケストレーションの一部として定義されているその他のファイルの場所に保存されます。</span><span class="sxs-lookup"><span data-stu-id="c95b0-304">The response from SQL Server database is saved at the other FILE location defined as part of the orchestration.</span></span> <span data-ttu-id="c95b0-305">たとえば、前の要求メッセージ用の SQL Server データベースからの応答には。</span><span class="sxs-lookup"><span data-stu-id="c95b0-305">For example, the response from SQL Server database for the preceding request message is:</span></span>  
  
```  
<?xml version="1.0" encoding="utf-8"?>  
<Root xmlns="http://ForXmlStoredProcs/namespace">  
  <Adapt_Doc.dbo.Employee Employee_ID="10765" Name="John" Designation="asdfaf" Salary="3434.00" Last_Modified="AAAAAAAANso=" Status="0" xmlns="" />  
</Root>  
```  
  
 <span data-ttu-id="c95b0-306">ストアド プロシージャの実行によって生成される、同じスキーマで応答を受信することに注意してください。</span><span class="sxs-lookup"><span data-stu-id="c95b0-306">Notice that the response is received in the same schema as generated by executing the stored procedure.</span></span> <span data-ttu-id="c95b0-307">なお、ルート ノードと名前空間は、値として指定したものと同じである**XmlStoredProcedureRootNodeName**と**XmlStoredProcedureRootNodeNamespace**それぞれバインドのプロパティ。</span><span class="sxs-lookup"><span data-stu-id="c95b0-307">Also note that the root node and the namespace is the same you specified as values for **XmlStoredProcedureRootNodeName** and **XmlStoredProcedureRootNodeNamespace** binding properties respectively.</span></span>  
  
## <a name="best-practices"></a><span data-ttu-id="c95b0-308">ベスト プラクティス</span><span class="sxs-lookup"><span data-stu-id="c95b0-308">Best Practices</span></span>  
 <span data-ttu-id="c95b0-309">展開し、BizTalk プロジェクトの構成後は、バインド ファイルと呼ばれる XML ファイル構成設定をエクスポートできます。</span><span class="sxs-lookup"><span data-stu-id="c95b0-309">After you have deployed and configured the BizTalk project, you can export configuration settings to an XML file called the binding file.</span></span> <span data-ttu-id="c95b0-310">バインド ファイルを生成した、送信ポートなどの項目を作成し、同じオーケストレーション用のポートを受信する必要はありませんように構成設定、ファイルからインポートできます。</span><span class="sxs-lookup"><span data-stu-id="c95b0-310">Once you generate a binding file, you can import the configuration settings from the file, so that you do not need to create items such as send ports and receive ports for the same orchestration.</span></span> <span data-ttu-id="c95b0-311">バインド ファイルの詳細については、次を参照してください。[アダプターのバインドを再利用](../../adapters-and-accelerators/adapter-sql/reuse-sql-adapter-bindings.md)します。</span><span class="sxs-lookup"><span data-stu-id="c95b0-311">For more information about binding files, see [Reuse adapter bindings](../../adapters-and-accelerators/adapter-sql/reuse-sql-adapter-bindings.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="c95b0-312">参照</span><span class="sxs-lookup"><span data-stu-id="c95b0-312">See Also</span></span>  
[<span data-ttu-id="c95b0-313">SQL アダプターを使用して BizTalk アプリケーションを開発する</span><span class="sxs-lookup"><span data-stu-id="c95b0-313">Develop BizTalk applications using the SQL adapter</span></span>](../../adapters-and-accelerators/adapter-sql/develop-biztalk-applications-using-the-sql-adapter.md)