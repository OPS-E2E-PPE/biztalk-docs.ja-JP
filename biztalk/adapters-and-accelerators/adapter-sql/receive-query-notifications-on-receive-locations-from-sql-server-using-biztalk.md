---
title: BizTalk Server を使用して SQL からのクエリ通知で複数受信場所の受信 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 9afbe98e-8901-417c-a807-8db97fd7a24b
caps.latest.revision: 7
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 3e18e105c0438fd526a4aae2a1ef229707788dca
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/07/2019
ms.locfileid: "65368286"
---
# <a name="receive-query-notifications-on-multiple-receive-locations-from-sql-using-biztalk-server"></a><span data-ttu-id="2b55f-102">BizTalk Server を使用して SQL のクエリ通知で複数受信場所を受信します。</span><span class="sxs-lookup"><span data-stu-id="2b55f-102">Receive query notifications On Multiple Receive Locations from SQL using BizTalk Server</span></span>
<span data-ttu-id="2b55f-103">同じデータベース内の複数の受信場所が同じテーブル (例: 従業員) のクエリ通知を受信するように構成の異なる BizTalk アプリケーションの一部として作成する必要があるシナリオを検討してください。</span><span class="sxs-lookup"><span data-stu-id="2b55f-103">Consider a scenario where you have multiple receive locations created as part of different BizTalk applications configured to receive query notifications for the same table (e.g. Employee) in the same database.</span></span> <span data-ttu-id="2b55f-104">100 個のレコードを挿入して、同じテーブルに、すべての受信場所で、通知メッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="2b55f-104">If a hundred records are inserted into the same table, all the receive locations will get the notification message.</span></span> <span data-ttu-id="2b55f-105">効果的に間での通知を受信する複数の受信場所、その受信場所のいずれかで通知を受信した場合、このような方法で BizTalk アプリケーションから操作を呼び出すことが、その他の受信場所と同じ通知を取得できません。</span><span class="sxs-lookup"><span data-stu-id="2b55f-105">To effectively receive notifications across multiple receive locations, you can call operations from your BizTalk application in such a way that if a notification is received by one receive location, the other receive location does not get the same notification.</span></span> <span data-ttu-id="2b55f-106">そのため、複数の場所で受信した負荷分散通知すること効果的にできます。</span><span class="sxs-lookup"><span data-stu-id="2b55f-106">So, you can effectively load-balance notifications received on multiple locations.</span></span>  

 <span data-ttu-id="2b55f-107">負荷分散通知を受信するオーケストレーションを設定するために必要なタスクがの場合と同じ[受信クエリ通知増分 BizTalk Server を使用して SQL から](../../adapters-and-accelerators/adapter-sql/receive-query-notifications-incrementally-from-sql-using-biztalk-server.md)します。</span><span class="sxs-lookup"><span data-stu-id="2b55f-107">The tasks required to set up an orchestration to load-balance receiving notifications are same as that for [Receive Query Notifications Incrementally from SQL using BizTalk Server](../../adapters-and-accelerators/adapter-sql/receive-query-notifications-incrementally-from-sql-using-biztalk-server.md).</span></span> <span data-ttu-id="2b55f-108">このトピックの一覧のみ、2 つのアプローチの違い。</span><span class="sxs-lookup"><span data-stu-id="2b55f-108">This topic lists the only the difference between the two approaches.</span></span>  

## <a name="load-balancing-query-notifications-across-multiple-receive-locations"></a><span data-ttu-id="2b55f-109">複数のクエリ通知の負荷分散の受信場所</span><span class="sxs-lookup"><span data-stu-id="2b55f-109">Load-Balancing Query Notifications Across Multiple Receive Locations</span></span>  
 <span data-ttu-id="2b55f-110">などのトピックで[受信クエリ通知増分 BizTalk Server を使用して SQL から](../../adapters-and-accelerators/adapter-sql/receive-query-notifications-incrementally-from-sql-using-biztalk-server.md)、既にを受け取るレコードで UPDATE ステートメントを実行してインクリメンタル通知を構成します。</span><span class="sxs-lookup"><span data-stu-id="2b55f-110">Like in the topic [Receive Query Notifications Incrementally from SQL using BizTalk Server](../../adapters-and-accelerators/adapter-sql/receive-query-notifications-incrementally-from-sql-using-biztalk-server.md), you configured incremental notifications by executing an UPDATE statement on the records that are already notified for.</span></span> <span data-ttu-id="2b55f-111">負荷分散を構成するには、レコードの通知を削除するストアド プロシージャを実行できます。</span><span class="sxs-lookup"><span data-stu-id="2b55f-111">To configure load-balancing, you could execute a stored procedure that deletes the records that have been notified for.</span></span> <span data-ttu-id="2b55f-112">たとえば、次の定義のストアド プロシージャ PROCESS_EMPLOYEE を検討してください。</span><span class="sxs-lookup"><span data-stu-id="2b55f-112">For example, consider a stored procedure PROCESS_EMPLOYEE with the following definition:</span></span>  

```  
DECLARE @var int  
SELECT TOP 1 @var = Employee_ID FROM Employee  
SELECT * FROM Employee WHERE Employee_ID=@var  
DELETE FROM Employee WHERE Employee_ID=@var  
```  

 <span data-ttu-id="2b55f-113">BizTalk アプリケーションの一部としてこのストアド プロシージャを実行するときに通知が受信した既にレコードが削除されます。</span><span class="sxs-lookup"><span data-stu-id="2b55f-113">When you execute this stored procedure as part of the BizTalk application, the record for which notification is already received gets deleted.</span></span> <span data-ttu-id="2b55f-114">そのため、この他は、次のレコードの場所を取得の通知を受信します。</span><span class="sxs-lookup"><span data-stu-id="2b55f-114">So, the other receive location gets notification for the next record.</span></span>  

 <span data-ttu-id="2b55f-115">通知を受信するための負荷分散を構成する必要がありますを実行する手順の概要を次に示します。</span><span class="sxs-lookup"><span data-stu-id="2b55f-115">Here are the high-level steps you must perform to configure load-balancing for receiving notifications.</span></span>  

1. <span data-ttu-id="2b55f-116">スキーマを作成**通知**(入力方向の操作) と**PROCESS_EMPLOYEE**ストアド プロシージャ (送信操作)。</span><span class="sxs-lookup"><span data-stu-id="2b55f-116">Create schema for **Notification** (inbound operation) and **PROCESS_EMPLOYEE** stored procedure (outbound operation).</span></span>  

2. <span data-ttu-id="2b55f-117">オーケストレーションを追加し、追加の 3 つのメッセージの通知を受け取る、ストアド プロシージャを実行するストアド プロシージャの応答を取得します。</span><span class="sxs-lookup"><span data-stu-id="2b55f-117">Add an orchestration and add three messages for receiving notification, executing stored procedure, and getting response for the stored procedure.</span></span>  

3. <span data-ttu-id="2b55f-118">オーケストレーションを作成するには、送信および受信図形、メッセージの構築図形、およびポートを追加します。</span><span class="sxs-lookup"><span data-stu-id="2b55f-118">Create an orchestration by adding Send and Receive shapes, Construct Message shape, and ports.</span></span> <span data-ttu-id="2b55f-119">メッセージを構築するための同じサンプル コードを使用すると、PROCESS_EMPLOYEE ストアド プロシージャを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="2b55f-119">You can use the same sample code for constructing a message to invoke the PROCESS_EMPLOYEE stored procedure.</span></span> <span data-ttu-id="2b55f-120">操作を実行中に注意して[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]が必要な管理コンソールで、場所 C:\TestLocation\MessageIn でストアド プロシージャを PROCESS_EMPLOYEE の要求メッセージ。</span><span class="sxs-lookup"><span data-stu-id="2b55f-120">Note that while performing the operation in [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] Administration console, you must have the request message for the PROCESS_EMPLOYEE stored procedure in the location C:\TestLocation\MessageIn.</span></span> <span data-ttu-id="2b55f-121">作成されたオーケストレーションの一部として、コード スニペットを呼び出すため、これは[受信クエリ通知増分 BizTalk Server を使用して SQL から](../../adapters-and-accelerators/adapter-sql/receive-query-notifications-incrementally-from-sql-using-biztalk-server.md)C:\ に存在する XML 要求に基づいて要求メッセージを作成します。TestLocation\MessageIn します。</span><span class="sxs-lookup"><span data-stu-id="2b55f-121">You do so because the code snippet you invoke as part of the orchestration created in [Receive Query Notifications Incrementally from SQL using BizTalk Server](../../adapters-and-accelerators/adapter-sql/receive-query-notifications-incrementally-from-sql-using-biztalk-server.md) creates a request message based on the request XML present in C:\TestLocation\MessageIn.</span></span>  

4. <span data-ttu-id="2b55f-122">構築し、アプリケーションをデプロイします。</span><span class="sxs-lookup"><span data-stu-id="2b55f-122">Build and deploy the application.</span></span> <span data-ttu-id="2b55f-123">負荷分散を示すためには、する必要がありますを展開するこのオーケストレーションを少なくとも 2 つの異なるコンピューターに[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]と[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]をインストールします。</span><span class="sxs-lookup"><span data-stu-id="2b55f-123">To demonstrate load-balancing, you must deploy this orchestration at least on two different computers that have [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] and [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)] installed.</span></span>  

5. <span data-ttu-id="2b55f-124">[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]両方のコンピューターでの管理コンソールは、バインドのプロパティ、Wcf-custom または WCF SQL の受信場所を指定します。</span><span class="sxs-lookup"><span data-stu-id="2b55f-124">In the [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] Administration console on both the computers, specify the following binding properties for the WCF-Custom or WCF-SQL receive location:</span></span>  


   |     <span data-ttu-id="2b55f-125">プロパティのバインド</span><span class="sxs-lookup"><span data-stu-id="2b55f-125">Binding Property</span></span>      |                                                                                                                  <span data-ttu-id="2b55f-126">値</span><span class="sxs-lookup"><span data-stu-id="2b55f-126">Value</span></span>                                                                                                                  |
   |---------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
   | <span data-ttu-id="2b55f-127">**InboundOperationType**</span><span class="sxs-lookup"><span data-stu-id="2b55f-127">**InboundOperationType**</span></span>  |                                                                                                      <span data-ttu-id="2b55f-128">これを設定**通知**します。</span><span class="sxs-lookup"><span data-stu-id="2b55f-128">Set this to **Notification**.</span></span>                                                                                                      |
   | <span data-ttu-id="2b55f-129">**NotificationStatement**</span><span class="sxs-lookup"><span data-stu-id="2b55f-129">**NotificationStatement**</span></span> | <span data-ttu-id="2b55f-130">これを設定します。</span><span class="sxs-lookup"><span data-stu-id="2b55f-130">Set this to:</span></span><br /><br /> `SELECT Employee_ID, Name FROM dbo.Employee WHERE Status=0`<br /><br /> <span data-ttu-id="2b55f-131">**注:**、通知のステートメントは、常にスキーマ名とテーブル名を指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2b55f-131">**Note:** For notification statements, you must always specify the table name along with the schema name.</span></span> <span data-ttu-id="2b55f-132">たとえば、`dbo.Employee` のようにします。</span><span class="sxs-lookup"><span data-stu-id="2b55f-132">For example, `dbo.Employee`.</span></span> |
   | <span data-ttu-id="2b55f-133">**NotifyOnListenerStart**</span><span class="sxs-lookup"><span data-stu-id="2b55f-133">**NotifyOnListenerStart**</span></span> |                                                                                                          <span data-ttu-id="2b55f-134">これを設定**True**します。</span><span class="sxs-lookup"><span data-stu-id="2b55f-134">Set this to **True**.</span></span>                                                                                                          |


6. <span data-ttu-id="2b55f-135">BizTalk アプリケーションを起動します。</span><span class="sxs-lookup"><span data-stu-id="2b55f-135">Start the BizTalk application.</span></span>  

7. <span data-ttu-id="2b55f-136">通知の受信を開始するには、EMPLOYEE テーブルに 100 個のレコードを挿入します。</span><span class="sxs-lookup"><span data-stu-id="2b55f-136">To start receiving notifications, insert a hundred records into the EMPLOYEE table.</span></span> <span data-ttu-id="2b55f-137">中に、XML 要求、PROCESS_EMPLOYEE を呼び出すストアド プロシージャを使用できる C:\TestLocation\MessageIn でいることを確認します。</span><span class="sxs-lookup"><span data-stu-id="2b55f-137">While doing so, make sure the request XML for invoking the PROCESS_EMPLOYEE stored procedure is available in C:\TestLocation\MessageIn.</span></span>  

8. <span data-ttu-id="2b55f-138">BizTalk アプリケーションによって通知メッセージが削除されます (両方のコンピューター) での場所を監視します。</span><span class="sxs-lookup"><span data-stu-id="2b55f-138">Monitor the location (on both the computers) where the BizTalk application will be dropping the notification messages.</span></span> <span data-ttu-id="2b55f-139">挿入されたレコードの数百の 1 つの場所を取得するレコードの一部の通知、他の場所が、残りのレコードの通知を取得中に表示されます。</span><span class="sxs-lookup"><span data-stu-id="2b55f-139">You will notice that of the hundred records inserted, one location gets notifications for some records while the other location gets notification for the remaining records.</span></span> <span data-ttu-id="2b55f-140">同時に、両方の場所には、数百のすべてのレコードの通知が届きます。</span><span class="sxs-lookup"><span data-stu-id="2b55f-140">Together, both the locations will get notification for all the hundred records.</span></span>  

## <a name="see-also"></a><span data-ttu-id="2b55f-141">参照</span><span class="sxs-lookup"><span data-stu-id="2b55f-141">See Also</span></span>  
 [<span data-ttu-id="2b55f-142">BizTalk Server を使用して SQL クエリ通知を受け取る</span><span class="sxs-lookup"><span data-stu-id="2b55f-142">Receive SQL Query Notifications using BizTalk Server</span></span>](../../adapters-and-accelerators/adapter-sql/receive-sql-query-notifications-using-biztalk-server.md)