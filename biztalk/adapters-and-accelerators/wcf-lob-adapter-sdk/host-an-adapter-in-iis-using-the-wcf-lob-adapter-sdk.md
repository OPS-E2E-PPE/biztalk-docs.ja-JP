---
title: WCF LOB Adapter SDK を使用して、IIS でアダプターのホスト |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 90b6cd97-01b3-4c98-a190-c6e0ccf24d2b
caps.latest.revision: 16
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 51d6958bb740b3707748459281769077eb69d008
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/07/2019
ms.locfileid: "65363604"
---
# <a name="host-an-adapter-in-iis-using-the-wcf-lob-adapter-sdk"></a>WCF LOB Adapter SDK を使用して、IIS でアダプターをホストします。
このセクションを使用して構築されたアダプターをホストする方法について説明、[!INCLUDE[afproductnamelong](../../includes/afproductnamelong-md.md)]インターネット インフォメーション サービス (IIS)。 その他のホスティング オプションの詳細については、次を参照してください。[ホスティング サービス](https://msdn.microsoft.com/library/ms730158.aspx)します。

## <a name="use-iis-and-aspnet"></a>IIS と ASP.NET を使用して、
 IIS は、WCF LOB Adapter SDK で作成されたアダプターの発行を有効になっている ASP.NET で使用することができます。 によって作成されたアダプターをホストする、 [!INCLUDE[afproductnameshort](../../includes/afproductnameshort-md.md)]、WCF サービスを公開するためにインターネット インフォメーション サービス (IIS) を構成します。 次に、ASP.NET、WCF adapterwith を使用する方法を検討してください。

 使用可能なホスティング モードには、IIS で WCF サービスをホストする場合:**サイド バイ サイドで**と A**SP.NET 互換モード**します。 既定のホスティング モードでは、サイド バイ サイドでです。 サイド バイ サイド モードは、ホスティング ソリューションの他の WCF で一貫して動作します。 そのため、IIS でホストされる WCF サービスでは、コンソール アプリケーションでホストされているいずれかと同じでは動作します。 ただし、このことがありますできません望ましい web 開発者予想どおりの動作を ASP.NET に似ています。 たとえば、サイド バイ サイドでのモードで WCF に準拠していないで指定された、URL ベースの承認規則、 `<system.web> <authorization>` web.config の構成要素。  

 ASP.NET 互換モードにより、WCF サービスの ASP.NET のすべての機能を使用して、ASPX ページと同様に動作するにはただし、この機能を有効にする、WCF アダプターを作成するときに、追加の手順を実行する必要があります。 詳細については、以下をご覧ください。 

 [WCF サービスと ASP.NET](https://msdn.microsoft.com/library/aa702682.aspx)

[インターネット インフォメーション サービスでのホスティング](https://msdn.microsoft.com/library/ms734710.aspx)

[WCF サービスをホストしています。](https://msdn.microsoft.com/library/ms730158.aspx)

## <a name="use-the-wcf-adapter-service-development-wizard"></a>WCF アダプター サービス開発ウィザードを使用します。

使用して、[!INCLUDE[afsvcdevwizlong](../../includes/afsvcdevwizlong-md.md)]インターネット インフォメーション サービス (IIS) 内で、アダプターをホストするための Web プロジェクトの作成を自動化します。 Windows Communication Framework (WCF) または Web サービスを使用してクライアントでホストされているアダプターを使用できます。  

### <a name="publish-an-adapter-as-a-wcf-service-hosted-in-iis"></a>IIS でホストされる WCF サービスとしてアダプターを発行します。  

1. [!INCLUDE[btsVStudioNoVersion_md](../../includes/btsvstudionoversion-md.md)]を開きます。 **ファイル**メニューの **新規**、し、 **Web サイト**します。  

2. **テンプレート**を選択します**Visual c#**、選択および**WCF アダプタ サービス**します。  

3. クリックして、ソリューションを保存するフォルダーを入力して**OK**します。 **WCF アダプター サービス開発ウィザード**を開始します。  

4. **概要**] ページで [**次**。  

5. **選択操作**ページで、このホステッド サービスを使用するには、バインディング、コントラクト、および操作を指定します。  

   1.  **バインディングを選択**一覧で、使用する をクリックし、アダプターのバインドを選択します。**構成**します。 これが表示されます、**アダプターの構成** ダイアログ ボックス。 アダプターを呼び出すと、操作のメタデータを取得するために必要な値を提供します。  

   2.  **セキュリティ**] タブで、[、**クライアント資格情報の種類**クライアント資格情報をアダプターに渡すときに使用します。  

       |[資格情報の種類]|説明|  
       |---------------------|-----------------|  
       |**なし**|クライアントは、資格情報を提示する必要はありません。|  
       |**Windows**|クライアントでは、Windows 資格情報を使用します。|  
       |**ユーザー名**|ユーザー名とパスワード、クライアントが提供されます。|  
       |**[MSSQLSERVER のプロトコルのプロパティ]**|クライアントは、X.509 証明書を使用して認証されます。 この値が設定されている場合は、クリックして**参照**で、**クライアント証明書**領域、および使用する証明書を選択します。|  

   3.  **URI プロパティ**タブで、アダプターに必要な URI パラメーターを指定します。 このタブに表示されるエントリで公開されるプロパティによって異なります、`ConnectionUri Properties`のアダプター クラス。  

   4.  **バインド プロパティ** タブで、アダプターに必要なバインドのプロパティの値を指定します。 **全般**セクションには、タイムアウト値などの一般的な設定が含まれています。 追加のプロパティの一覧はで公開されているカスタム プロパティに基づいて、`AdapterBinding`クラス。  

6. 構成値を指定したら、クリックして**Connect**します。  

   1.  **選択コントラクト型**一覧で、使用するコントラクトを選択します。 これによって、**カテゴリを選択**ツリー コントロールのカテゴリと、このアダプターから実行できる操作の一覧。 アダプターが使用して検索機能を実装している場合、`MetadataRetrievalClient`クラスで検索用語を入力することができます、**カテゴリで検索**カテゴリと、検索用語が含まれている操作のみを返すフィールド。  

       > [!NOTE]
       >  送信操作のみが選択可能な。  

   2.  **利用可能なカテゴリと操作**ボックスに追加するをクリックする項目を選択、**追加**します。 目的の項目を追加した後にをクリックして**次**します。  

7. **サービスの構成およびエンドポイントの動作** ページで、このアダプターの目的の動作を設定します。  

   1.  **サービス動作構成**セクションには、サービスの動作を制御するエントリが含まれています。 ウィザードを実行した後は、web.config ファイルを編集して、選択したサービスの動作を変更できます。  

       |プロパティ|説明|  
       |--------------|-----------------|  
       |**EnableMetadataExchange**|この値を設定**True**クライアントの要求にメタデータの公開をサービスすることができます。 これを変更しても設定できます\< **serviceMetadata httpGetEnabled =""** \> web.config にします。既定値は**False**|  
       |**IncludeExceptionDetailsinFault**|この値を設定**True**をクライアントに SOAP エラー マネージ例外情報で結果が返されます。 これを変更しても設定できます\< **serviceDebug usingincludeExceptionDetailInFaults =""** \> web.config にします。既定値は**False**します。|  
       |**名前**|サービス動作の構成の名前です。|  
       |**UseServiceCertificate**|この値は、サービスがクライアント プロセスに自身を認証する X.509 証明書を使用しているかどうかを決定します。 既定値は**True**します。|  
       |**FindValue**|この値は、証明書ストアに特定の X.509 証明書の検索に使用されます。 これを変更しても設定できます\< **serviceCredentials findValue =""** \> web.config**に注意してください。** 場合にのみ、このプロパティの値を指定**UseServiceCertificate**に設定されている**True**します。|  
       |**StoreLocation**|この値は、指定された証明書を検索するシステム ストアの場所を指定します。 これを変更しても設定できます\< **serviceCredentials storeLocation =""** \> web.config にします。**注:** 場合にのみ、このプロパティの値を指定**UseServiceCertificate**に設定されている**True**します。|  
       |**StoreName**|この値は、指定された証明書を検索する特定のシステム ストアを指定します。 これを変更しても設定できます\< **serviceCredentials storeName =""** \> web.config**に注意してください。** 場合にのみ、このプロパティの値を指定**UseServiceCertificate**に設定されている**True**します。|  
       |**X509FindType**|使用する特定の証明書を確認するには、検索を使用した、FindValue の型が前に指定します。 これを変更しても設定できます\< **serviceCredentials x509FindType =""** \> web.config**に注意してください。** 場合にのみ、このプロパティの値を指定**UseServiceCertificate**に設定されている**True**します。|  

   2.  **エンドポイント動作の構成**セクションは、エンドポイントの動作を制御します。  

       |プロパティ|説明|  
       |--------------|-----------------|  
       |**名前**|エンドポイントの動作の名前|  
       |**AuthenticationType**|この値は、クライアントの受信ドキュメントの資格情報を取得する場所をアダプターに指示します。 設定、サービスに対する認証にクライアント証明書を指定するクライアントを有効にする**ClientCredentialUsernamePassword**します。 設定する HTTP ヘッダーの一部として、ユーザー名とパスワードを指定するクライアントを有効にする、 **HTTPUsernamePassword**します。 設定、ClientCredential インターフェイスを通じて資格情報を指定するクライアントを有効にする**自動**します。これが失敗すると、クライアントは、HTTP ヘッダーの一部として資格情報を渡すことができます。<br /><br /> この値は変更することによっても設定する\< **endpointBehavior adapterSecurityBridgeType** \> web.config にします。既定値は**自動**します。|  
       |**UsernameHeader**|これには、サービスにユーザー名を渡すために使用されるヘッダーの名前を指定します。 HTTP ヘッダーの詳細については、用に「カスタム HTTP および SOAP ヘッダーのサポート」を参照してください。 [http://go.microsoft.com/fwlink/?LinkId=106692](http://go.microsoft.com/fwlink/?LinkId=106692)<br /><br /> この値は変更することによっても設定する\< **endpointBehavior usernameHttpHeader** \> web.config にします。**注:** 場合、このプロパティの値を指定する必要があります、 **AuthenticationType**に設定されている**HTTPUserNamePassword**します。  場合設定**自動**、このプロパティは省略可能です。|  
       |**PasswordHeader**|これには、サービスにユーザーのパスワードを渡すに使用されるヘッダーの名前を指定します。 HTTP ヘッダーの詳細についてを参照してください「のサポートのカスタム HTTP ヘッダーと SOAP ヘッダー」 [http://go.microsoft.com/fwlink/?LinkId=106692](http://go.microsoft.com/fwlink/?LinkId=106692)<br /><br /> この値は、変更することによっても設定できます <**endpointBehavior passwordHttpHeader**< web.config にします。**注:** 場合、このプロパティの値を指定する必要があります、 **AuthenticationType**に設定されている**HTTPUserNamePassword**します。 場合設定**自動**、このプロパティは省略可能です。|  

   3.  目的の動作を設定した後には、次のようにクリックします。**次**を続行します。  

8. **構成サービスのエンドポイントのバインドとアドレス** ページで、契約のアドレスとバインディングのプロパティを構成できます。 内のコントラクトを選択、**を構成する契約を選択**しで目的の値を入力します、**アドレスとコントラクトのバインディングを構成する** ダイアログ ボックス。  

   1.  選択、 **BindingConfiguration**バインドのプロパティの下のエントリ。 ウィザードは、バインド構成のフィールドは自動的に設定するためのみ基本的な HTTP バインディングをサポート**System.ServiceModel.Configuration.BasicHttpBindingElement**します。 このバインディングの構成プロパティを変更する、省略記号ボタンをクリックします **。** ボタンをクリックします。 セキュリティで保護された通信チャネルを使用する必要があります常に設定する、**モード**プロパティを**トランスポート**します。 これが既定値です。  

   2.  選択、 **EndpointName**、エンドポイントの必要な名前を入力します。  

   3.  をクリックして変更を適用するには、**適用**します。  

9. 続行するには、 **[次へ]** をクリックします。 [概要] ページには、選択されたアダプターの操作のツリー構造が一覧表示します。  

10. 概要を確認し、**完了**します。  

11. ウィザードでは、Web プロジェクトを作成し、次のファイルを追加します。  


    |    ファイル    |                                                説明                                                 |
    |------------|------------------------------------------------------------------------------------------------------------|
    |    .svc    |                               WCF プロキシを参照するサービス ファイル。                               |
    |    .cs     |                                         WCF プロキシを実装します。                                          |
    | web.config | 含む\<**エンドポイント**\, \<**バインド**\>、および\<**動作**\>要素\<**システム。ServiceModel**\> |


12. WCF サービス プロジェクトを発行します。  

    1.  ソリューション エクスプ ローラーでプロジェクトを右クリックし、をクリックし、**発行**します。  

    2.  **Web サイトの発行** ダイアログ ボックスで、WCF サービスの対象 URL を指定します。  

    3.  選択**このプリコンパイル済みサイトの更新を許可する**します。  

    4.  選択**固定名およびシングル ページ アセンブリを使用する**します。  

    5.  選択**プリコンパイル済みアセンブリで厳密な名前を有効にする**、しを使用する署名キーを指定します。  

13. Web サイトを発行する をクリックして**OK**します。  

14. サービスが正常に発行されることを確認します。  

    1.  IIS 管理コンソールを起動します。  クリックして**開始**、 をポイント**管理ツール**、順にクリックします**インターネット インフォメーション サービス**します。  

    2.  サービスを発行したノードに移動します。  サービス発行されていた場合 http://localhost/myservice に移動します**インターネット インフォメーション サービス**> **コンピューター名**> **Websites**> **既定の Web サイト**> **myservice**します。  

    3.  右側のウィンドウで、.svc ファイルを右クリックし、**参照**します。 サービスに関する情報を含む Web ページが表示されます。 クライアント アプリケーションから WCF または Web サービスの呼び出しを使用してこのサービスを使用できるようになりました。 

## <a name="security"></a>Security
アダプターが、サービス内でホストされているときに、クライアント アプリケーションからの呼び出しはアダプター セキュリティ ブリッジを使用して、クライアントの資格情報をアダプターに渡す。  

 WCF クライアントで認証を WCF サービスに送信すると、通常、サービスでは、認証が消費されます。 ただし、アダプターの場合は、基になる LOB システムで使用するための認証情報をキャプチャするにという考え方は。 これは、エンドポイントの動作として表示されますが、アダプターのセキュリティ ブリッジを介して実装されます。 アダプターの開発者として何もないこの機能を活用するために実装する必要があります。ただし、アダプターを展開する場合は、どのクライアントによってサービスに資格情報が提供する検討する必要があります。  

 メッセージ レベルのセキュリティを使用している場合、アダプターのセキュリティのブリッジは任意のバインディングでクライアント アプリケーションによって送信される ClientCredentials を取得できます。 基本 HTTP バインディングを使用している場合、カスタム ヘッダーを使用してユーザー名とパスワード情報を渡す代わりに選択できます。 多くの Web サービス クライアント アプリケーションは、カスタム ヘッダーを使用して資格情報を渡す必要がありますが、資格情報を渡す WCF に用意された、ClientCredential クラスを使用することをお勧めします。  

 アダプターがクライアント アプリケーションが提供する ClientCredentials で資格情報を検索する場所、構成の例を次に示します。 見つからない場合、アダプターは、指定された HTTP 要求ヘッダーで検索します。  

```  
<endpointBehaviors>  
   <behavior name="customEndpointBehavior">  
      <endpointBehavior usernameHttpHeader="UNHdr" passwordHttpHeader="PWHdr"  
         adapterSecurityBridgeType="Auto" />  
    </behavior>  
</endpointBehaviors>  
```      

## <a name="see-also"></a>参照  
 [開発アクティビティ](../../esb-toolkit/development-activities.md)