---
title: Oracle データベース アダプターのポーリングに基づいたデータ変更メッセージを受信 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- polling-base notification, support for
ms.assetid: 043afb88-701c-41d8-8b8e-84702bd0d984
caps.latest.revision: 16
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 8f8ee32a7907cc37daf4a6b6b7d3971a28cf1b94
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/27/2018
ms.locfileid: "36968939"
---
# <a name="receive-polling-based-data-changed-messages-in-oracle-database-adapter"></a>Oracle データベース アダプターのポーリングに基づいたデータ変更メッセージを受信します。
[!INCLUDE[adapteroracle](../../includes/adapteroracle-md.md)] Oracle データベースをポーリングすることによってポーリングに基づいたデータ変更メッセージの受信をサポートしています。 アダプターは、によって、アプリケーションにメッセージを提供します。  

- データがポーリングに使用できるかどうかを判断する SQL SELECT クエリを実行します。 定期的にまたは継続的には、SQL SELECT クエリを実行するアダプターを構成することができます。  

- Oracle のテーブルまたはビューに対して SQL SELECT クエリの実行や、実行は、プロシージャ、関数、またはパッケージ化されたプロシージャおよび関数を格納します。  

- Oracle データベースで、省略可能な後ポーリング PL/SQL コード ブロックを実行しています。 ターゲット内のクエリ対象のレコードにフィールドを更新する、または別のテーブルまたはビューにクエリのレコードを移動する、次のコード ブロックがよく使用されます。  

- 結果のクエリ結果を返す、POLLINGSTMT 操作またはストアド プロシージャ、関数、またはパッケージ化されたプロシージャおよびポーリング操作として公開されている関数を呼び出すことによって設定します。  

  アダプターは、すべての Oracle トランザクション内でこれらの操作を実行します。  

  アダプターでは、同じアプリケーションで公開することにより Oracle 成果物の複数のデータ変更メッセージを受信することもできます、`PollingId`接続 URI のパラメーター。 このパラメーターは、POLLINGSTMT 操作のターゲットの名前空間を変更します。  

## <a name="change-the-target-namespace-of-pollingstmt"></a>POLLINGSTMT のターゲットの名前空間を変更します。  
 POLLINGSTMT 操作のターゲットの名前空間を変更するには、設定、`PollingId`接続 URI の文字列パラメーターをクエリします。 場合、`PollingId`接続 URI で指定されて、[!INCLUDE[adapteroracle_short](../../includes/adapteroracle-short-md.md)]で指定された文字列を追加、 `PollingId` POLLINGSTMT 操作の既定のターゲット名前空間へのパラメーター: `http://microsoft.lobservices.oracledb/2007/03/POLLINGSTMT`。 POLLINGSTMT 操作のメッセージのアクションは変更されません。  

 たとえば、次の接続 URI が指定されている場合: `OracleDb://User=SCOTT;Password=TIGER@Adapter?PollingId=AcctActivity`、ターゲット名前空間になります`http:/microsoft.lobservices.oracledb/2007/03/POLLINGSTMTAcctActivity`します。  

 各 POLLINGSTMT 操作、一意の名前空間を提供し、アプリケーションで複数の Oracle のテーブルおよびビューのデータ変更メッセージを受信できます。  

 詳細については、[!INCLUDE[adapteroracle_short](../../includes/adapteroracle-short-md.md)]接続 URI を参照してください[Oracle Database 接続 URI の作成](../../adapters-and-accelerators/adapter-oracle-database/create-the-oracle-database-connection-uri.md)です。  

## <a name="receive-data-changed-messages-using-binding-properties"></a>バインドのプロパティを使用して、データ変更メッセージを受信します。
 構成する、[!INCLUDE[adapteroracle_short](../../includes/adapteroracle-short-md.md)]バインドのプロパティの一部またはすべてを設定して、データ変更メッセージを受信します。  


|         プロパティのバインド         |                                                                                                                                                                                                                                                                                                                                                                   値                                                                                                                                                                                                                                                                                                                                                                    |      既定       |                                                                                  必須/省略可                                                                                  |
|----------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|     **InboundOperationType**     |                                                                                                                                                                                                                                                                                                                                              値が設定されていることを確認**ポーリング**します。                                                                                                                                                                                                                                                                                                                                               |      ポーリング       |                                                           必須。 指定しない場合、明示的に設定、既定値に適用されます。                                                            |
| **PolledDataAvailableStatement** | すべてのデータが特定のテーブルのポーリングに使用できるかどうかを判断するために実行する SELECT ステートメントを指定します。 指定したステートメントには、結果の行と列で構成されるセットを返す必要があります。 結果セットの最初のセルの値は、アダプターが指定された値を実行するかどうかを示します、 **PollingStatement**プロパティをバインドします。 結果の最初のセルに正の値が含まれている場合、アダプターは、ポーリング ステートメントを実行します。 たとえば、このバインドのプロパティの有効なステートメントになります。<br /><br /> `Select * from <table_name>`<br /><br /> **注:** ストアド プロシージャをこのバインドのプロパティを指定する必要があります。 また、このステートメントは、基になる Oracle データベースを変更する必要があります。 | デュアルから 1 を選択します | 必須。 表示ない場合は、明示的に設定、既定値が適用される、アダプターがポーリングされるテーブルがかどうかにデータをどのようにがかどうかに関係なくポーリングを続行する必要がありますが含まれています。 |
|        **PollingAction**         |                                                                                                                                                                                                                                        ポーリング操作のアクションを指定します。 特定の操作を使用して、操作を生成するメタデータからのポーリング アクションを決定することができます、[!INCLUDE[consumeadapterservshort](../../includes/consumeadapterservshort-md.md)]します。                                                                                                                                                                                                                                         |        null        |                                                   テーブルとビューの SELECT ステートメントを使用してポーリング操作の省略可能。                                                   |
|       **PollingInterval**        |                                                                                                                                         アダプターは、Oracle データベースを照会する秒単位で間隔を設定します。 このプロパティは、ポーリング間隔とポーリング トランザクションのタイムアウトを指定します。値は、クエリおよび (指定されている場合)、Oracle データベースでのポーリング後ステートメントの実行にかかる時間の量とクライアントがクエリ データを処理し、ポーリング応答メッセージを返すのためにかかる時間より大きくする必要があります。                                                                                                                                          |        500         |                                                           必須。 指定しない場合、明示的に設定、既定値に適用されます。                                                            |
|       **PollingStatement**       |                                                                                                                                       次のいずれかを指定します。<br /><br /> Oracle データベースに対して実行される SQL SELECT ステートメント。 このステートメントは、FOR UPDATE 句を含める必要があります。 FOR UPDATE 句については、次を参照してください。[ポーリング ステートメントで FOR UPDATE 句を指定する](#ForUpdate)このトピックで後述します。<br /><br /> -ストアド プロシージャ、関数、またはプロシージャまたは関数をポーリングするパッケージ内のメッセージを要求します。                                                                                                                                        |        null        |                                                     必須。 設定**PollingStatement** null 以外の値のポーリングで有効にします。                                                     |
|      **PollWhileDataFound**      |                                                                                                                                                                                             指定するかどうか、[!INCLUDE[adapteroracle_short](../../includes/adapteroracle-short-md.md)]ポーリング間隔を無視し、継続的にデータがポーリングされるテーブルで使用できる場合は、Oracle データベースをポーリングします。 指定されたポーリング間隔で SQL ステートメントを実行する、テーブルで使用できるデータがない場合は、アダプターを元に戻します                                                                                                                                                                                              |       False        |                                                           必須。 指定しない場合、明示的に設定、既定値に適用されます。                                                            |
|      **PostPollStatement**       |                                                                                                                                                                                                                                                                                          クエリを実行すると、クエリの前に、データがクライアントに返される後、アダプターによって実行される PL/SQL コード ブロックに設定します。                                                                                                                                                                                                                                                                                           |        null        |                                                     任意。 値が指定されていない場合は、ポーリング後ステートメントは実行されません。                                                      |

> [!NOTE]
>  設定する必要がある、WCF サービス モデルまたは WCF チャネル モデルを使用している場合、 **AcceptCredentialsInUri**プロパティをバインドします。  

##  <a name="ForUpdate"></a> ポーリング ステートメントでの更新プログラムを入力します。  
 ポーリング ステートメントと SELECT ステートメントで指定された行に影響するポーリング後ステートメントを実行する SELECT ステートメントを使用する場合は、ポーリング ステートメントで FOR UPDATE 句を使用する必要があります。 FOR UPDATE 句を指定することにより、トランザクション中に、ポーリング ステートメントによって選択されたレコードがロックされていることと、ポーリング後ステートメントがそれらの任意の必要な更新プログラムを実行できます。  

> [!CAUTION]
>  複数のレコードは、ポーリングとポーリング後ステートメント間の時間枠のどこのシナリオを設定することが、ポーリング後ステートメントの条件を満たすテーブルに追加されます。 このような状況では、条件を満たすすべてのレコードとポーリング ステートメントの一部として選択されたレコードだけでなく、ポーリング後ステートメントを更新します。  

 ポーリング後ステートメントが指定されたポーリング ステートメントに FOR UPDATE 句が含まれていない場合、次の 2 つの条件のいずれかが発生します。  

- 場合**TransactionIsolationLevel**に設定されている**ReadCommitted**、後のポーリング クエリでは、選択した行は更新されません。  

- 場合**TransactionIsolationLevel**に設定されている**Serializable**、次の対象のシステム例外 (**Microsoft.ServiceModel.Channels.Common.TargetSystemException**) は、ポーリング後ステートメントが実行されるときに発生します。"ora-08177 シリアル化できませんこのトランザクションへのアクセス"。 このような場合は、設定する必要があります、 **PollingRetryCount**数を定義するプロパティのバインド アダプターは、同じトランザクションを再試行する回数。  

  トランザクション分離レベルを設定する方法の詳細については、次を参照してください。 [Oracle データベースとトランザクション分離レベルとトランザクションのタイムアウトを構成する](../../adapters-and-accelerators/adapter-oracle-database/configure-transaction-isolation-level-and-transaction-timeout-with-oracle-db.md)します。  

  トランザクションとの値を使用するアダプターのクライアントが構成されている場合、ポーリングとポーリング後ステートメントがトランザクションで実行される、 **UseAmbientTransaction**に設定されているプロパティのバインド**True**アダプター。  

  FOR UPDATE オプションを使用して、ポーリング クエリの例を示します。  

```  
SELECT * from EMP WHERE FLAG = 'Y' FOR UPDATE  
```  

### <a name="enter-a-nowait-clause-in-the-polling-statement"></a>ポーリング ステートメントで NOWAIT 句を入力します。  
 同時実行スレッドがポーリングされるテーブルへのアクセスのシナリオを必要に応じて、テーブルが多すぎるの競合をリードします。 テーブルの行ロックを取得するブロックされるポーリング クエリがある可能性があります。 ポーリング ステートメントと SELECT ステートメントを使用する場合、SELECT ステートメントで FOR UPDATE キーワードと共に NOWAIT キーワードを指定することがあります。 これにより、ポーリング クエリの実行を選択しようとして、ポーリング クエリの行にロックがあるかどうかにすぐに返すアダプター内で。 例外は通常このような条件下で Oracle によってスローされます。 アダプター クライアントを再び使用することがあります、 **PollingInterval**データをポーリングする時間間隔後アダプター クライアントが再試行する必要がありますを指定するプロパティをバインドします。  

 NOWAIT オプションを使用して、ポーリング クエリの例を示します。  

```  
SELECT * from EMP WHERE FLAG = 'Y' FOR UPDATE NOWAIT  
```  

### <a name="enter-a-skip-locked-clause-in-the-polling-statement"></a>ポーリング ステートメントでロックされたスキップ句を入力します。  
 同時実行スレッドがポーリングされるテーブルにアクセスするためのポーリング クエリで指定した WHERE 句の結果セットでいくつかの行はロックされているシナリオがあります。 たとえば、ポーリング クエリが; テーブルから 6 つの行を返しますこれら 6 つの行から 4 は既に、他のトランザクションのためロックされています。 ここで、WHERE 句で指定された行をロックして、既にロックされていることが判明しているすべての行をスキップしようとするように指示される FOR UPDATE キーワードと共に SKIP がロックされているキーワードを指定します。 トランザクション中に、WHERE 句でロックされていない行がロックされているし、ポーリング後ステートメントは、これらの行が再度ポーリングしないようにに、それらでの任意の必要な更新プログラムを実行できます。 これにより、WHERE 句ではロックされている指定したすべての行になるまでポーリング メッセージを受信するまで待機する必要はありません。  

 ロックされたスキップ キーワードは、データベースで同じテーブルをポーリングしている複数のコンピューターでアダプター クライアントがあるシナリオに便利です。 WHERE 句で指定された時間の時点でロックされている行のデータの変更のポーリング ベースのメッセージが表示されるように、ポーリング操作を構成することによってアダプター クライアントの間で負荷しことを確認する行を更新することができます。クライアントがアダプターによってポーリング ベースのデータ変更メッセージを受信する場合、その他のクライアントは取得しません、同じメッセージ。  

 ロックされたスキップ オプションを使用して、ポーリング クエリの例を示します。  

```  
SELECT * from EMP WHERE FLAG = 'Y' FOR UPDATE SKIP LOCKED  
```  

## <a name="support-for-ordered-delivery-fifo"></a>順次配送 (FIFO) のサポート  
 運用環境では、Oracle データベースのデータ変更を監視するポーリングを使用できます。 使用してアダプター クライアントがこれらのデータ変更メッセージを受信、[!INCLUDE[adapteroracle_short](../../includes/adapteroracle-short-md.md)]します。 ビジネス シナリオに基づいて、データ変更メッセージが正しい順序でアダプター クライアントによって受信される重要ながなります。  

 [!INCLUDE[adapteroracle_short](../../includes/adapteroracle-short-md.md)]配信または最初先出しの順序付けをサポートしている Oracle データベースからメッセージが受信される順序を維持するには、(FIFO)。 受信のシナリオでの FIFO のサポートに関連するいくつかの考慮事項をここでは、[!INCLUDE[adapteroracle_short](../../includes/adapteroracle-short-md.md)]します。  

- メッセージがオーケストレーションによって処理される場合、オーケストレーションが設定からの受信メッセージの順次配送をいる必要があります、[!INCLUDE[adapteroracle_short](../../includes/adapteroracle-short-md.md)]受信ポート。  

- 送信ポートにする必要があります設定からの受信メッセージの配信が注文されている場合は、メッセージは、送信ポート (ルーティングでは、コンテンツ ベース) のシナリオで使用されている、[!INCLUDE[adapteroracle_short](../../includes/adapteroracle-short-md.md)]受信ポート。  

  Wcf-custom または Wcf-oracledb アダプター プロパティがある**エラー発生時に要求メッセージを保留**受信処理に失敗した要求メッセージを保留するかどうかを指定します。 このプロパティを設定することができます、**メッセージ**Wcf-custom または Wcf-oracledb のタブの下のポートの受信、**エラー処理**セクション。 次の表では、このプロパティを設定するかどうかと、メッセージのサブスクライバー (オーケストレーションやポート) の状態に基づいて、受信メッセージの処理方法を説明するシナリオを示します。  

|Port プロパティ|参加解除状態のサブスクライバー|停止状態が参加済みでサブスクライバー|  
|-------------------|------------------------------------|----------------------------------------------|  
|**エラー発生時に要求メッセージを中断**プロパティ|、中断 (再開不可メッセージ) としてルーティング エラー報告が生成されます。<br /><br /> -実際のメッセージが中断されていません。<br /><br /> -投稿のトランザクションが中止された取得と、ポーリング クエリは実行されません。 そのためにポーリングが繰り返され、もう一度、行がフェッチされます。<br /><br /> -エラーの内容を記述するログが発生したイベントを報告します。|-「エラー」と見なされます。 イベント ログにエラー メッセージはありません。<br /><br /> -実際のメッセージは、中断 (再開可能) キューに配置されます。<br /><br /> -サブスクライブしているポートまたはオーケストレーションの開始時に、メッセージが自動的に再開します。 順次配送がサブスクライバーに設定されている場合は、これが適用されます。<br /><br /> -メッセージを手動で再開も可能性があります。|  
|**エラー発生時に要求メッセージを中断**プロパティの設定|、中断 (再開不可メッセージ) としてルーティング エラー報告が生成されます。<br /><br /> -実際のメッセージが中断されました。<br /><br /> -投稿のトランザクションが中止された取得と、ポーリング クエリは実行されません。 そのためにポーリングが繰り返され、もう一度、行がフェッチされます。<br /><br /> -エラーの内容を記述するログが発生したイベントを報告します。|-「エラー」と見なされます。 イベント ログにエラー メッセージはありません。<br /><br /> -実際のメッセージは、中断 (再開可能) キューに配置されます。<br /><br /> -サブスクライブしているポートまたはオーケストレーションの開始時に、メッセージが自動的に再開します。 順次配送がサブスクライバーに設定されている場合は、これが適用されます。<br /><br /> -メッセージを手動で再開も可能性があります。|  

## <a name="see-also"></a>参照  
[Oracle データベース アプリケーションの開発](../../adapters-and-accelerators/adapter-oracle-database/develop-your-oracle-database-applications.md)  
 [BizTalk Server を使用してポーリング Oracle データベース](../../adapters-and-accelerators/adapter-oracle-database/poll-oracle-database-using-biztalk-server.md)   
 [WCF サービス モデルを使用して Oracle データベースでのポーリングに基づいたデータ変更メッセージを受信します。](../../adapters-and-accelerators/adapter-oracle-database/receive-polling-based-data-changed-messages-in-oracle-db-using-a-wcf-service.md)   
 [WCF チャネル モデルを使用して Oracle データベースでのポーリングに基づいたデータ変更メッセージを受信します。](../../adapters-and-accelerators/adapter-oracle-database/receive-polling-based-data-changed-messages-in-oracle-db-using-a-wcf-channel.md)