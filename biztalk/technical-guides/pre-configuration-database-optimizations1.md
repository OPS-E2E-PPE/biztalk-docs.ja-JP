---
title: "事前構成データベース Optimizations1 |Microsoft ドキュメント"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: ebd0b32a-490d-4db2-a1fc-bf3bef93aeea
caps.latest.revision: "9"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 3c1333f956afc4411ff8b105c777214467155ae7
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/20/2017
---
# <a name="pre-configuration-database-optimizations"></a><span data-ttu-id="8fbfc-102">事前構成データベースの最適化</span><span class="sxs-lookup"><span data-stu-id="8fbfc-102">Pre-Configuration Database Optimizations</span></span>
<span data-ttu-id="8fbfc-103">BizTalk Server は、Microsoft SQL Server で最大 13 個の独立したデータベースの作成を必要とするデータベースを非常に大量に消費するアプリケーションです。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-103">BizTalk Server is an extremely database-intensive application that may require the creation of up to 13 separate databases in Microsoft SQL Server.</span></span> <span data-ttu-id="8fbfc-104">ため、BizTalk Server 環境で SQL Server が再生される重要な役割がきわめて重要 SQL Server では、パフォーマンスを最適に構成されているチューニングがあります。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-104">Because of the critical role that SQL Server plays in any BizTalk Server environment, it is of paramount importance that SQL Server is configured/tuned for optimal performance.</span></span> <span data-ttu-id="8fbfc-105">SQL Server が正しく実行するチューニングされなかった場合は、BizTalk Server で使用するデータベースがボトルネックになり、BizTalk Server 環境の全体的なパフォーマンスが低下します。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-105">If SQL Server is not tuned to perform well, then the databases used by BizTalk Server will become a bottleneck and the overall performance of the BizTalk Server environment will suffer.</span></span> <span data-ttu-id="8fbfc-106">このトピックでは、BizTalk Server をインストールして、BizTalk Server データベースを構成する前に従う必要があります複数の SQL Server パフォーマンス最適化機能について説明します。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-106">This topic describes several SQL Server performance optimizations that should be followed before installing BizTalk Server and configuring the BizTalk Server databases.</span></span>  
  
## <a name="set-ntfs-file-allocation-unit"></a><span data-ttu-id="8fbfc-107">NTFS ファイル アロケーション ユニットを設定します。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-107">Set NTFS File Allocation Unit</span></span>  
 <span data-ttu-id="8fbfc-108">SQL Server では、そのデータを格納する**エクステント**、8 8 K ページのグループがあります。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-108">SQL Server stores its data in **Extents**, which are groups of eight 8K pages.</span></span> <span data-ttu-id="8fbfc-109">そのため、ディスクのパフォーマンスを最適化するために、NTFS アロケーション ユニット サイズ 64 KB に設定のベスト プラクティス記事「デプロイメント前 I/O のベスト プラクティス」で利用可能な SQL Server の"ディスク構成のベスト プラクティス"セクションで説明した[http://go.microsoft.com/fwlink/ しますか。LinkId = 140818](http://go.microsoft.com/fwlink/?LinkId=140818)です。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-109">Therefore, to optimize disk performance, set the NTFS Allocation Unit size to 64KB as described in the “Disk Configuration Best Practices” section of the SQL Server best practices article “Predeployment I/O Best Practices” available at [http://go.microsoft.com/fwlink/?LinkId=140818](http://go.microsoft.com/fwlink/?LinkId=140818).</span></span> <span data-ttu-id="8fbfc-110">SQL Server のページとエクステントの詳細については、次を参照してください。、[!INCLUDE[btsSQLServer2008](../includes/btssqlserver2008-md.md)]オンライン ブックの「[ページとエクステントについて](http://go.microsoft.com/fwlink/?LinkId=148939)(ハイパーリンク"http://go.microsoft.com/fwlink/?LinkId=148939"http://go.microsoft.com/fwlink/?LinkId=148939)。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-110">For more information about SQL Server pages and extents see the [!INCLUDE[btsSQLServer2008](../includes/btssqlserver2008-md.md)] Books Online topic [Understanding Pages and Extents](http://go.microsoft.com/fwlink/?LinkId=148939) ( HYPERLINK "http://go.microsoft.com/fwlink/?LinkId=148939" http://go.microsoft.com/fwlink/?LinkId=148939).</span></span>  
  
## <a name="database-planning-considerations"></a><span data-ttu-id="8fbfc-111">データベースの計画に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="8fbfc-111">Database planning considerations</span></span>  
 <span data-ttu-id="8fbfc-112">ホストすることをお勧め、 [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] (たとえば、高速な SAN ディスクまたは高速の SCSI ディスクなど) の高速記憶域上のデータベースです。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-112">We recommend that you host your [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] databases on fast storage (for example, fast SAN disks or fast SCSI disks).</span></span> <span data-ttu-id="8fbfc-113">RAID 5 ではなく RAID 10 (1 + 0) は、raid 5 が書き込み時に遅いためお勧めします。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-113">We recommend RAID 10 (1+0) instead of RAID 5 because raid 5 is slower at writing.</span></span> <span data-ttu-id="8fbfc-114">新しい SAN ディスクでは、このような場合は、RAID の選択は、重要ではないで非常に大きなメモリ キャッシュがあります。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-114">Newer SAN disks have very large memory caches, so in these cases, the RAID selection is not as important.</span></span> <span data-ttu-id="8fbfc-115">パフォーマンスを向上させるには、データベースおよびログ ファイルが別々 の物理ディスクに配置できます。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-115">To increase performance, databases and their log files can reside on different physical disks.</span></span>  
  
## <a name="install-the-latest-service-pack-and-cumulative-updates-for-sql-server"></a><span data-ttu-id="8fbfc-116">SQL Server の最新の service pack と累積的な更新プログラムをインストールします。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-116">Install the latest service pack and cumulative updates for SQL Server</span></span>  
 <span data-ttu-id="8fbfc-117">SQL Server 2005 および SQL Server 2008 だけでなく、最新の .NET Framework サービス パックの最新のサービス パックと最新の累積的更新プログラムをインストールします。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-117">Install the latest service packs and the latest cumulative updates for SQL Server 2005 and SQL Server 2008 as well as the latest .NET Framework service packs.</span></span>  
  
## <a name="install-sql-service-packs-on-both-biztalk-server-and-sql-server"></a><span data-ttu-id="8fbfc-118">BizTalk Server と SQL Server の両方で SQL サービス パックをインストールします。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-118">Install SQL Service Packs on both BizTalk Server and SQL Server</span></span>  
 <span data-ttu-id="8fbfc-119">を SQL Server のサービス パックをインストールする場合も、BizTalk Server コンピューターのサービス パックをインストールします。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-119">When installing service packs for SQL Server, also install the service pack on the BizTalk Server computer.</span></span> <span data-ttu-id="8fbfc-120">BizTalk Server では、SQL Server service pack で更新される SQL クライアント コンポーネントを使用します。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-120">BizTalk Server uses SQL Client components that are updated by the SQL Server service packs.</span></span>  
  
## <a name="consider-implementing-the-sql-server-2008-data-collector-and-management-data-warehouse"></a><span data-ttu-id="8fbfc-121">SQL Server 2008 のデータ コレクターと管理データ ウェアハウスを実装することを検討してください。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-121">Consider implementing the SQL Server 2008 Data Collector and Management Data Warehouse</span></span>  
 <span data-ttu-id="8fbfc-122">SQL Server 2008 は、新しいの使用に対応環境/データベースのパフォーマンスを収集するには、データ コレクターや管理データ ウェアハウスに関連したテストと傾向分析のためのデータ。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-122">SQL Server 2008 accommodates the use of the new Data Collector and Management Data Warehouse to collect environment/database performance related data for test and trend analysis.</span></span> <span data-ttu-id="8fbfc-123">データ コレクターは、指定の管理データ ウェアハウスに収集されたすべてのデータを保持します。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-123">The Data Collector persists all collected data to the specified Management Data Warehouse.</span></span> <span data-ttu-id="8fbfc-124">これはパフォーマンスの最適化ではありません、これがパフォーマンスの問題の分析の役に立ちます。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-124">While this is not a performance optimization, this will be useful for analysis of any performance issues.</span></span>  
  
## <a name="grant-the-account-which-is-used-for-sql-server-the-windows-lock-pages-in-memory-privilege"></a><span data-ttu-id="8fbfc-125">Windows Lock Pages Memory 特権 In SQL Server に使用されるアカウントに付与します。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-125">Grant the account which is used for SQL Server the Windows Lock Pages In Memory privilege</span></span>  
 <span data-ttu-id="8fbfc-126">Windows の"Lock Pages in Memory"は、SQL Server サービス アカウントに特権を付与します。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-126">Grant the Windows “Lock Pages in Memory” privilege to the SQL Server service account.</span></span> <span data-ttu-id="8fbfc-127">これは、物理メモリにバッファー プールに割り当てられているメモリをロックすることにより、SQL Server プロセスのバッファー プール メモリのページングから Windows オペレーティング システムを防ぐために行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-127">This should be done to prevent the Windows operating system from paging out the buffer pool memory of the SQL Server process by locking memory that is allocated for the buffer pool in physical memory.</span></span> <span data-ttu-id="8fbfc-128">詳細についてで Microsoft サポート技術情報の記事 914483「64 ビット バージョンの SQL Server 2005 でバッファー プール メモリのページングを削減する方法」を参照してください。 [http://go.microsoft.com/fwlink/?LinkId=148948](http://go.microsoft.com/fwlink/?LinkId=148948)です。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-128">For more information, see Microsoft Knowledge Base article 914483 “How to reduce paging of buffer pool memory in the 64-bit version of SQL Server 2005” at [http://go.microsoft.com/fwlink/?LinkId=148948](http://go.microsoft.com/fwlink/?LinkId=148948).</span></span>  
  
## <a name="grant-the-semanagevolumename-right-to-the-sql-server-service-account"></a><span data-ttu-id="8fbfc-129">SQL Server サービス アカウントに SE_MANAGE_VOLUME_NAME を付与します。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-129">Grant the SE_MANAGE_VOLUME_NAME right to the SQL Server Service account</span></span>  
 <span data-ttu-id="8fbfc-130">SQL Server サービスを実行しているアカウントが「実行ボリュームの保守タスク」Windows 特権を持つことを確認またはセキュリティ グループに属していることを確認します。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-130">Ensure the account running the SQL Server service has the “Perform Volume Maintenance Tasks” Windows privilege or ensure it belongs to a security group which does.</span></span> <span data-ttu-id="8fbfc-131">これは、データベースの自動拡張する場合に最適なパフォーマンスを保証するファイルの瞬時初期化が許可されます。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-131">This will allow instant file initialization ensuring optimum performance if a database has to auto-grow.</span></span>  
  
## <a name="set-min-and-max-server-memory"></a><span data-ttu-id="8fbfc-132">Min および Max Server Memory を設定します。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-132">Set Min and Max Server Memory</span></span>  
 <span data-ttu-id="8fbfc-133">実行するコンピューター[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]をホストする SQL Server を実行して、BizTalk Server データベースで占有できる必要があります。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-133">The computers running [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] that host the BizTalk Server databases should be dedicated to running SQL Server.</span></span> <span data-ttu-id="8fbfc-134">"Min server memory"と各 SQL Server インスタンス上の"max server memory"オプションが設定に SQL Server に割り当てるメモリの固定量を指定することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-134">We recommend that the “min server memory” and “max server memory” options on each SQL Server instance are set to specify the fixed amount of memory to allocate to SQL Server.</span></span> <span data-ttu-id="8fbfc-135">この場合、する必要があります"min server memory"と"max server memory"、同じ値に設定 (SQL Server が使用される物理メモリの最大量に等しい)。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-135">In this case, you should set the “min server memory” and “max server memory” to the same value (equal to the maximum amount of physical memory that SQL Server will use).</span></span> <span data-ttu-id="8fbfc-136">これが減少それ以外の場合にこれらの値を動的に管理する SQL Server で使用されるオーバーヘッドです。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-136">This will reduce overhead that would otherwise be used by SQL Server dynamically managing these values.</span></span> <span data-ttu-id="8fbfc-137">SQL Server に割り当てるメモリの固定量を指定するには、各 SQL Server コンピューターで、次の T-SQL コマンドを実行します。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-137">Run the following T-SQL commands on each SQL Server computer to specify the fixed amount of memory to allocate to SQL Server:</span></span>  
  
```  
sp_configure ‘Max Server memory (MB)’,(max size in MB)  
sp_configure ‘Min Server memory (MB)’,(min size in MB)  
```  
  
 <span data-ttu-id="8fbfc-138">SQL Server のメモリの量を設定すると、前に、合計物理メモリから Windows Server に必要なメモリを差し引くことで適切なメモリ設定を決定します。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-138">Before you set the amount of memory for SQL Server, determine the appropriate memory setting by subtracting the memory required for Windows Server from the total physical memory.</span></span> <span data-ttu-id="8fbfc-139">これは、SQL Server に割り当てるメモリの最大量です。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-139">This is the maximum amount of memory you can assign to SQL Server.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="8fbfc-140">ホストする SQL Server を実行するコンピューターが、BizTalk Server データベースもホストする場合、エンタープライズ シングル サインオン マスター シークレット サーバー、したい場合があります、エンタープライズ シングル サインオンを実行するための十分なメモリがあることを確認するには、この値を調整するにはサービス。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-140">If the computer(s) running SQL Server that host the BizTalk Server databases also host the Enterprise Single Sign-On Master Secret Server, then you may need to adjust this value to ensure that there is sufficient memory available to run the Enterprise Single Sign-On Service.</span></span> <span data-ttu-id="8fbfc-141">マスター シークレット サーバーの高可用性を実現する SQL Server クラスターでクラスター化されたエンタープライズ シングル サインオン サービスのインスタンスを実行することは珍しくの実習ではないです。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-141">It is not an uncommon practice to run a clustered instance of the Enterprise Single Sign-On service on a SQL Server cluster to provide high availability for the Master Secret Server.</span></span> <span data-ttu-id="8fbfc-142">エンタープライズ シングル サインオン マスター シークレット サーバーをクラスタ リングの詳細についてを参照してください"Cluster Server する方法、マスター シークレット"で、[!INCLUDE[btsBizTalkServer2006r3](../includes/btsbiztalkserver2006r3-md.md)]ドキュメント[http://go.microsoft.com/fwlink/?LinkID=106874](http://go.microsoft.com/fwlink/?LinkID=106874)です。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-142">For more information about clustering the Enterprise Single Sign-On Master Secret Server, see the topic “How to Cluster the Master Secret Server” in the [!INCLUDE[btsBizTalkServer2006r3](../includes/btsbiztalkserver2006r3-md.md)]documentation at [http://go.microsoft.com/fwlink/?LinkID=106874](http://go.microsoft.com/fwlink/?LinkID=106874).</span></span>  
  
## <a name="split-the-tempdb-database-into-multiple-data-files-of-equal-size-on-each-sql-server-instance-used-by-biztalk-server"></a><span data-ttu-id="8fbfc-143">Tempdb データベースを同じサイズの BizTalk Server で使用される各 SQL Server インスタンス上の複数のデータ ファイルに分割します。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-143">Split the tempdb database into multiple data files of equal size on each SQL Server instance used by BizTalk Server</span></span>  
 <span data-ttu-id="8fbfc-144">プロポーショナル フィル アルゴリズムを使用しているために重要なことを確認するための tempdb データ ファイルと同じサイズの[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]データ ファイルのサイズに基づきます。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-144">Ensuring that the data files used for the tempdb are of equal size is critical because the proportional fill algorithm used by [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] is based on the size of the data files.</span></span> <span data-ttu-id="8fbfc-145">このアルゴリズムが、いることを確認しようとしています。[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]ほぼ同時に、最大容量に届くようにそのファイル内の空き領域に比例して各ファイルの残りがいっぱいになった。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-145">This algorithm attempts to ensure that [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] fills each file in proportion to the free space left in that file so that they reach their maximum capacity at about the same time.</span></span> <span data-ttu-id="8fbfc-146">サイズの異なるデータ ファイルが作成する場合、比例アルゴリズムは、それによってが無意味に複数のデータ ファイルを作成するすべてのファイル間での割り当てを展開するのではなく、GAM の割り当ての最大のファイルを使用します。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-146">If data files are created with unequal sizes, the proportional fill algorithm will use the largest file more for GAM allocations rather than spreading the allocations between all the files, thereby defeating the purpose of creating multiple data files.</span></span> <span data-ttu-id="8fbfc-147">少なくとも SQL Server に割り当てられているプロセッサの数と等しくなります tempdb データベースのデータ ファイルの数を構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-147">The number of data files for the tempdb database should be configured to be at least equal to the number of processors assigned for SQL Server.</span></span>  
  
## <a name="enable-trace-flag-t1118-as-a-startup-parameter-for-all-instances-of-sql-server"></a><span data-ttu-id="8fbfc-148">SQL Server のすべてのインスタンスの起動時のパラメーターとしてトレース フラグ-t1118 を実装を有効にします。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-148">Enable Trace Flag T1118 as a startup parameter for all instances of SQL Server</span></span>  
 <span data-ttu-id="8fbfc-149">トレースを実装するフラグ –-t1118 を実装では、ほとんどすべての単一のページ割り当てを削除することで、SQL Server インスタンス間での競合を減らすことができます。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-149">Implementing Trace Flag –T1118 helps reduce contention across the SQL Server instances by removing almost all single page allocations.</span></span> <span data-ttu-id="8fbfc-150">詳細については、Microsoft サポート技術情報の記事 328551 を参照してください。"[prb]: tempdb データベースの同時実行制御の拡張機能"で[http://go.microsoft.com/fwlink/?LinkID=103713](http://go.microsoft.com/fwlink/?LinkID=103713)です。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-150">For more information, see Microsoft Knowledge Base article 328551 "PRB: Concurrency enhancements for the tempdb database" at [http://go.microsoft.com/fwlink/?LinkID=103713](http://go.microsoft.com/fwlink/?LinkID=103713).</span></span>  
  
## <a name="do-not-change-default-sql-server-settings-for-max-degree-of-parallelism-sql-server-statistics-or-database-index-rebuilds-and-defragmentation"></a><span data-ttu-id="8fbfc-151">Max degree of parallelism、SQL Server 統計情報、またはデータベースのインデックス再構築と最適化の既定の SQL Server 設定を変更しません。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-151">Do not change default SQL Server settings for max degree of parallelism, SQL Server statistics, or database index rebuilds and defragmentation</span></span>  
 <span data-ttu-id="8fbfc-152">SQL Server インスタンスには、BizTalk Server データベースを格納する場合、し、特定の SQL Server 設定する必要があります変更されません。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-152">If a SQL Server instance will house BizTalk Server databases, then certain SQL Server settings should not be changed.</span></span> <span data-ttu-id="8fbfc-153">具体的には、SQL Server max degree of parallelism、メッセージ ボックス データベース、およびデータベースのインデックスの設定 SQL Server の統計を再構築し、最適化は変更できません。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-153">Specifically, the SQL Server max degree of parallelism, the SQL Server statistics on the MessageBox database, and the settings for the database index rebuilds and defragmentation should not be modified.</span></span> <span data-ttu-id="8fbfc-154">詳細についてを参照してください「SQL Server の設定を変更しないで」で BizTalk Server Operations guide の「 [http://go.microsoft.com/fwlink/?LinkId=114358](http://go.microsoft.com/fwlink/?LinkId=114358)です。</span><span class="sxs-lookup"><span data-stu-id="8fbfc-154">For more information, see the topic “SQL Server Settings That Should Not Be Changed” in the BizTalk Server Operations Guide at [http://go.microsoft.com/fwlink/?LinkId=114358](http://go.microsoft.com/fwlink/?LinkId=114358).</span></span>