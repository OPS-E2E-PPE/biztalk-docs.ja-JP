---
title: "メッセージ ボックス データベース Database1 のボトルネックを特定する方法 |Microsoft ドキュメント"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 1a039164-5ca6-4cbc-b307-c5d4ae800689
caps.latest.revision: "7"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: b25a575f8cd6a3f7d7239ce20cb4d3befdde1966
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/20/2017
---
# <a name="how-to-identify-bottlenecks-in-the-messagebox-database"></a><span data-ttu-id="0b786-102">メッセージ ボックス データベースのボトルネックを特定する方法</span><span class="sxs-lookup"><span data-stu-id="0b786-102">How to Identify Bottlenecks in the MessageBox Database</span></span>
<span data-ttu-id="0b786-103">メッセージ ボックス データベースのボトルネックを特定するには、まず SQL Server エージェント サービスが開始されていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="0b786-103">To identify bottlenecks in the MessageBox database, first ensure that the SQL-Server-Agent Service is started.</span></span> <span data-ttu-id="0b786-104">サービスのスタートアップ状態手動からに変更自動場合は、サーバーを再起動すると、サービスが自動的に再起動できるようにします。</span><span class="sxs-lookup"><span data-stu-id="0b786-104">Change the Service startup state from Manual to Auto so that if the server is restarted, the service will automatically restart.</span></span>  
  
 <span data-ttu-id="0b786-105">既定では、Spool、TrackingData、または ApplicationQ テーブルのサイズの場合、BizTalk サービスを制限します。</span><span class="sxs-lookup"><span data-stu-id="0b786-105">By default, the BizTalk service will throttle if the Spool, TrackingData, or ApplicationQ tables grow.</span></span> <span data-ttu-id="0b786-106">これらのテーブルは、実行されていませんが、スプールの増大を引き起こす場合制限が開始して、追加の不足からデータベースを保護する SQL エージェント ジョブによって排除されます。</span><span class="sxs-lookup"><span data-stu-id="0b786-106">These tables are pruned by SQL-Agent jobs, which, if not running will cause the Spool to grow causing throttling to start and protect the database from additional pressure.</span></span> <span data-ttu-id="0b786-107">以下のパフォーマンス カウンターの状態を確認します。</span><span class="sxs-lookup"><span data-stu-id="0b786-107">Check the status of the following performance counters:</span></span>  
  
-   <span data-ttu-id="0b786-108">BizTalk:Message Agent (Host Name) Message Delivery Throttling State</span><span class="sxs-lookup"><span data-stu-id="0b786-108">BizTalk:Message Agent (Host Name) Message Delivery Throttling State</span></span>  
  
-   <span data-ttu-id="0b786-109">BizTalk:Message Agent (Host Name) Message Publishing Throttling State</span><span class="sxs-lookup"><span data-stu-id="0b786-109">BizTalk:Message Agent (Host Name) Message Publishing Throttling State</span></span>  
  
 <span data-ttu-id="0b786-110">「0」の値は、調整が実行されていないを示します。</span><span class="sxs-lookup"><span data-stu-id="0b786-110">A value of “0” indicates no throttling is occurring.</span></span> <span data-ttu-id="0b786-111">「6」の値は、システムは、データベース サイズの増加に起因する制限を示します。</span><span class="sxs-lookup"><span data-stu-id="0b786-111">A value of “6” indicates the system is throttling due to database growth.</span></span> <span data-ttu-id="0b786-112">これらのカウンターの値を解釈する方法については、次を参照してください。[ホスト制限とは何ですか。](http://go.microsoft.com/fwlink/?LinkID=154694)</span><span class="sxs-lookup"><span data-stu-id="0b786-112">For information about how to interpret the values of these counters, see [What is Host Throttling?](http://go.microsoft.com/fwlink/?LinkID=154694)</span></span> <span data-ttu-id="0b786-113">(http://go.microsoft.com/fwlink/?LinkID=154694) および[ホスト制限パフォーマンス カウンター](http://go.microsoft.com/fwlink/?LinkID=155285) (http://go.microsoft.com/fwlink/?LinkID=155285)、BizTalk Server 2010 ドキュメント。</span><span class="sxs-lookup"><span data-stu-id="0b786-113">(http://go.microsoft.com/fwlink/?LinkID=154694) and [Host Throttling Performance Counters](http://go.microsoft.com/fwlink/?LinkID=155285) (http://go.microsoft.com/fwlink/?LinkID=155285) in the BizTalk Server 2010 documentation.</span></span>  
  
## <a name="spool-table-growth"></a><span data-ttu-id="0b786-114">スプール テーブルの増加</span><span class="sxs-lookup"><span data-stu-id="0b786-114">Spool table growth</span></span>  
 <span data-ttu-id="0b786-115">Spool のサイズが増加し始める原因は複数あります。</span><span class="sxs-lookup"><span data-stu-id="0b786-115">The Spool can start growing for multiple reasons.</span></span> <span data-ttu-id="0b786-116">スプールの増大の理由の 1 つは、アプリケーション キューが成長しています。</span><span class="sxs-lookup"><span data-stu-id="0b786-116">One reason for Spool growth is if the Application Queues are growing.</span></span> <span data-ttu-id="0b786-117">下流のボトルネックやリソースの競合などの理由によりが大きくなる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="0b786-117">They could grow due to reasons such as downstream bottlenecks and/or resource contention.</span></span>  
  
 <span data-ttu-id="0b786-118">アプリケーション キューが小さいと、スプールが大きなも場合、は、purge ジョブを把握することを確認します。</span><span class="sxs-lookup"><span data-stu-id="0b786-118">If the Application Queues are small and the Spool is still large, verify that the purge jobs are keeping up.</span></span> <span data-ttu-id="0b786-119">SQL エージェント サービスが実行されていることを確かめたうえで、以下のジョブが正常に完了しているかどうかを確認してください。</span><span class="sxs-lookup"><span data-stu-id="0b786-119">Ensure that the SQL-Agent Service is running and then verify that the following jobs are successfully completing:</span></span>  
  
-   <span data-ttu-id="0b786-120">MessageBox_Message_Cleanup_BizTalkMessageBoxDb</span><span class="sxs-lookup"><span data-stu-id="0b786-120">MessageBox_Message_Cleanup_BizTalkMessageBoxDb</span></span>  
  
-   <span data-ttu-id="0b786-121">MessageBox_Parts_Cleanup_BizTalkMessageBoxDb</span><span class="sxs-lookup"><span data-stu-id="0b786-121">MessageBox_Parts_Cleanup_BizTalkMessageBoxDb</span></span>  
  
 <span data-ttu-id="0b786-122">MessageZeroSum テーブルが大きい場合は、メッセージが処理されていることを示します。</span><span class="sxs-lookup"><span data-stu-id="0b786-122">If the MessageZeroSum table is large, it indicates that the messages have been processed.</span></span> <span data-ttu-id="0b786-123">つまり、行が削除のフラグが設定された、デキューが正常に完了し、アプリケーション キュー テーブルからデータを削除します。</span><span class="sxs-lookup"><span data-stu-id="0b786-123">This means that DeQueue has successfully completed and deleted data from the Application Queue tables and the rows have been flagged for deletion.</span></span> <span data-ttu-id="0b786-124">Purge ジョブによるデータの削除が追いついていないことを示します。</span><span class="sxs-lookup"><span data-stu-id="0b786-124">However, the purge jobs are unable to keep up with deleting the data.</span></span> <span data-ttu-id="0b786-125">これは、SQL Server を実行しているコンピューターには、CPU 不足のための時間差を purge ジョブの機能に影響を与えず、深刻な CPU の競合が発生している場合に発生することができます。</span><span class="sxs-lookup"><span data-stu-id="0b786-125">This can happen if the computer running SQL Server is experiencing severe CPU contention, affecting the ability of the purge jobs to keep up due to CPU starvation.</span></span>  
  
## <a name="application-queue-table-growth"></a><span data-ttu-id="0b786-126">アプリケーション キュー テーブル サイズの増加</span><span class="sxs-lookup"><span data-stu-id="0b786-126">Application queue table growth</span></span>  
 <span data-ttu-id="0b786-127">アプリケーション キューがホスト インフライト移行データは、処理された、DeQueue によってクリーンアップされます。</span><span class="sxs-lookup"><span data-stu-id="0b786-127">Application Queues host in-flight transition data that, once processed, are cleaned up by DeQueue.</span></span>  
  
 <span data-ttu-id="0b786-128">これらのメッセージを処理した後は、(これらの行への参照を保持している)、スプール テーブルをクリーンアップすることができます。</span><span class="sxs-lookup"><span data-stu-id="0b786-128">After these messages are processed, the Spool table (holding references to these rows) can be cleaned.</span></span>  
  
 <span data-ttu-id="0b786-129">たとえば、RxHostQ はオーケストレーション PxHostQ にデータを発行します。</span><span class="sxs-lookup"><span data-stu-id="0b786-129">For example, the RxHostQ publishes data to the orchestration PxHostQ.</span></span> <span data-ttu-id="0b786-130">このキューは、スプール テーブルに行を参照して各に送信側に、データに発行します。</span><span class="sxs-lookup"><span data-stu-id="0b786-130">This queue publishes data to the sending TxHostQ each referencing a row in the Spool table.</span></span> <span data-ttu-id="0b786-131">システムでは、特定の HostQ に対するメッセージは処理が正常に、これらの行は DeQueue によって削除されます。</span><span class="sxs-lookup"><span data-stu-id="0b786-131">After the messages for a particular HostQ have successfully processed through the system, these rows are deleted by DeQueue.</span></span> <span data-ttu-id="0b786-132">削除後は、(それらの行によって参照されなくなった) Spool を Purge ジョブでクリーンアップできるようになります。</span><span class="sxs-lookup"><span data-stu-id="0b786-132">After these rows are deleted, the Spool (which is no longer referenced by these rows) can then be cleaned by the purge jobs.</span></span>  
  
 <span data-ttu-id="0b786-133">アプリケーション キューの増加率では、アプリケーション キューのドレインを担当するホスト インスタンスが、受信速度追いついていないことを示します。</span><span class="sxs-lookup"><span data-stu-id="0b786-133">Application Queue growth indicates that the host instances responsible for draining the Application Queue are unable to keep up with the incoming rate.</span></span>  
  
 <span data-ttu-id="0b786-134">たとえば、オーケストレーションの処理を担うサーバーが CPU に依存していて処理を高速化できないことが原因で、オーケストレーション アプリケーション キュー (PxHostQ) のサイズが増加する場合があります。</span><span class="sxs-lookup"><span data-stu-id="0b786-134">For example, the orchestration application queue (PxHostQ) may grow because the server responsible for processing orchestrations is CPU bound and unable to process any faster.</span></span> <span data-ttu-id="0b786-135">ただし、受信側のサーバーが高速な場合は、可能性があります発行オーケストレーション サーバーがアプリケーション キューの増加につながるを処理できるよりも高速です。</span><span class="sxs-lookup"><span data-stu-id="0b786-135">However, if the receiving server is fast it may publish faster than what the orchestration server can process leading to the Application Queue growth.</span></span>  
  
 <span data-ttu-id="0b786-136">オーケストレーション キューの増加の原因としては、メモリの競合が考えられます。</span><span class="sxs-lookup"><span data-stu-id="0b786-136">Another reason for orchestration queue growth could be due to memory contention.</span></span> <span data-ttu-id="0b786-137">多くの実行時間の長いオーケストレーション インスタンスは、メモリ内インスタンス化されるとは同時に、メモリの肥大化とが間接的メモリ不足が解消されるまで、スレッド プールを圧縮する調整します。</span><span class="sxs-lookup"><span data-stu-id="0b786-137">When many long running orchestration instances are concurrently instantiated in memory, memory bloat indirectly causes throttling to shrink the thread pool until memory pressure is relieved.</span></span>  
  
 <span data-ttu-id="0b786-138">なぜ送信アプリケーション キューのサイズが増加する理由は、ダウン ストリーム システムができないかどうかはメッセージを受信する (BizTalk Server から送信) ほど高速です。</span><span class="sxs-lookup"><span data-stu-id="0b786-138">A reason why the send application queue may grow is if the downstream system is unable to receive messages (outgoing from BizTalk Server) fast enough.</span></span> <span data-ttu-id="0b786-139">したがって、メッセージは引き続き、BizTalk システム発生アプリケーション キューの増加率内に存在します。</span><span class="sxs-lookup"><span data-stu-id="0b786-139">Thus the messages will continue to reside within the BizTalk system causing Application Queue growth.</span></span> <span data-ttu-id="0b786-140">これには、調整を開始およびシステムの全体的なスループットに影響を与えず受信速度低下する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="0b786-140">This can cause throttling to start and reduce the receiving rate impacting the overall throughput of the system.</span></span>  
  
## <a name="trackingdata-table-growth"></a><span data-ttu-id="0b786-141">TrackingData テーブルの増加</span><span class="sxs-lookup"><span data-stu-id="0b786-141">TrackingData table growth</span></span>  
 <span data-ttu-id="0b786-142">メッセージ ボックス データベースの TrackingData テーブルは、インターセプターが両方の正常性とアクティビティ (HAT) およびビジネス アクティビティ監視 (BAM) 追跡の追跡データを書き込む先移行テーブルです。</span><span class="sxs-lookup"><span data-stu-id="0b786-142">The TrackingData table in the MessageBox database is a transition table into which interceptors write tracking data for both Health and Activity (HAT) and Business Activity Monitoring (BAM) tracking.</span></span> <span data-ttu-id="0b786-143">追跡が無効になっている場合、このテーブルは空になります。</span><span class="sxs-lookup"><span data-stu-id="0b786-143">If tracking is disabled, this table should be empty.</span></span> <span data-ttu-id="0b786-144">既定では、パイプラインおよびオーケストレーション送受信イベントの HAT 追跡が有効にします。</span><span class="sxs-lookup"><span data-stu-id="0b786-144">By default, HAT-tracking is enabled for the pipelines and orchestrations In/Out events.</span></span>  
  
 <span data-ttu-id="0b786-145">メッセージ本文の追跡が有効になっている場合は、メッセージ ボックス データベース サーバー (つまり、ホスト「ホストの追跡を許可する」) が実行されていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="0b786-145">If Message Body Tracking is enabled, ensure that the MessageBox database server (that is, the host with "allow host tracking") is running.</span></span> <span data-ttu-id="0b786-146">「ホストの追跡を許可する」を持つホストが実行されていることを確認すると、ホストは、BizTalk 追跡データベースのテーブルでは、メッセージ ボックス データベースの TrackingData テーブルからデータを移動すると、ボトルネックの発生の可能性が低くなります。</span><span class="sxs-lookup"><span data-stu-id="0b786-146">Ensuring that the host with "allow host tracking" is running will reduce the chance of a bottleneck occurring as the host moves data from TrackingData table in the MessageBox database to the BizTalk Tracking database tables.</span></span>  
  
 <span data-ttu-id="0b786-147">たとえばカスタム HAT 追跡を有効にしてカスタム イベントを追跡することがのプロパティおよびメッセージ本文の追跡を昇格します。</span><span class="sxs-lookup"><span data-stu-id="0b786-147">It is possible to track custom events by enabling custom HAT-tracking, for example, on promoted properties and message body tracking.</span></span> <span data-ttu-id="0b786-148">HAT 追跡データだけでなく BAM データも、TrackingData テーブルに書き込まれます。</span><span class="sxs-lookup"><span data-stu-id="0b786-148">In addition to HAT-tracking data, BAM data is also written to the TrackingData table.</span></span> <span data-ttu-id="0b786-149">Tracking Data Decode Service (TDDS、追跡が有効になっているホスト インスタンスで実行される) は、BizTalk 追跡データベースと BAM プライマリ インポート データベースにメッセージ ボックス データベースからこのデータの移動を担当します。</span><span class="sxs-lookup"><span data-stu-id="0b786-149">The Tracking Data Decode Service (TDDS, which runs on the host instance on which tracking is enabled) is responsible for moving this data from the MessageBox database to the BizTalk Tracking and BAM Primary Import databases.</span></span> <span data-ttu-id="0b786-150">データが正常に移動すると後、TDDS は、このデータを削除します。</span><span class="sxs-lookup"><span data-stu-id="0b786-150">Then after the data is successfully moved, TDDS deletes this data.</span></span> <span data-ttu-id="0b786-151">メッセージ本文の追跡データは、SQL エージェント ジョブ TrackedMessages_Copy_BizTalkMsgBoxDb によって別途移動されます。</span><span class="sxs-lookup"><span data-stu-id="0b786-151">Message body tracking data is moved separately by a SQL-Agent job TrackedMessages_Copy_BizTalkMsgBoxDb.</span></span>  
  
 <span data-ttu-id="0b786-152">TDDS が、インターセプターが TrackingData テーブルにデータを書き込んでいるレートでしきれない場合は、このテーブルが大きくなる、制限が開始します。</span><span class="sxs-lookup"><span data-stu-id="0b786-152">If TDDS is unable to keep up with the rate at which the interceptors are writing data to the TrackingData table, this table will grow, causing throttling to start.</span></span> <span data-ttu-id="0b786-153">これにより、維持可能なスループットが影響します。</span><span class="sxs-lookup"><span data-stu-id="0b786-153">This impacts sustainable throughput.</span></span> <span data-ttu-id="0b786-154">この問題を軽減するには、追跡を有効に少なくとも 1 つのホストが実行されていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="0b786-154">To lessen this problem, ensure at least one host is running with tracking enabled.</span></span>  
  
 <span data-ttu-id="0b786-155">データがまだ蓄積する場合は、BizTalk 追跡データベースがコントロールから増加していないことを確認します。</span><span class="sxs-lookup"><span data-stu-id="0b786-155">If the data still builds up, ensure the BizTalk Tracking database is not growing out of control.</span></span> <span data-ttu-id="0b786-156">また、アーカイブを確認し、ジョブの消去が実行されていてデータの到着率継続できるようにします。</span><span class="sxs-lookup"><span data-stu-id="0b786-156">Also, ensure the archiving and purging job is running and is able to keep up with the rate at which data is arriving.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="0b786-157">既定では、purge ジョブでは、このデータはアーカイブされたまで、BizTalk 追跡データベース テーブルからデータを削除することです。</span><span class="sxs-lookup"><span data-stu-id="0b786-157">By default, the purge job is unable to delete data from the BizTalk Tracking database tables until this data has been archived.</span></span> <span data-ttu-id="0b786-158">追跡データをアーカイブする必要がない場合は、次の手順に従って、アーカイブしないで、BizTalk 追跡データベースを削除するジョブを変更できます[BizTalk 追跡データベースからデータを消去する方法](http://go.microsoft.com/fwlink/?LinkID=153817)(http://go.microsoft.com/fwlink/しますか?LinkID = 153817)。</span><span class="sxs-lookup"><span data-stu-id="0b786-158">If you do not need to archive the tracking data, you can modify the job to purge the BizTalk Tracking database without archiving by following the steps at [How to Purge Data from the BizTalk Tracking Database](http://go.microsoft.com/fwlink/?LinkID=153817) (http://go.microsoft.com/fwlink/?LinkID=153817).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="0b786-159">参照</span><span class="sxs-lookup"><span data-stu-id="0b786-159">See Also</span></span>  
 [<span data-ttu-id="0b786-160">データベース層のボトルネック</span><span class="sxs-lookup"><span data-stu-id="0b786-160">Bottlenecks in the Database Tier</span></span>](../technical-guides/bottlenecks-in-the-database-tier.md)