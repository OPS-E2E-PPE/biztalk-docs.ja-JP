---
title: "メッセージ ボックス データベース Database1 のボトルネックを特定する方法 |Microsoft ドキュメント"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 1a039164-5ca6-4cbc-b307-c5d4ae800689
caps.latest.revision: "7"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: b25a575f8cd6a3f7d7239ce20cb4d3befdde1966
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/20/2017
---
# <a name="how-to-identify-bottlenecks-in-the-messagebox-database"></a>メッセージ ボックス データベースのボトルネックを特定する方法
メッセージ ボックス データベースのボトルネックを特定するには、まず SQL Server エージェント サービスが開始されていることを確認します。 サービスのスタートアップ状態手動からに変更自動場合は、サーバーを再起動すると、サービスが自動的に再起動できるようにします。  
  
 既定では、Spool、TrackingData、または ApplicationQ テーブルのサイズの場合、BizTalk サービスを制限します。 これらのテーブルは、実行されていませんが、スプールの増大を引き起こす場合制限が開始して、追加の不足からデータベースを保護する SQL エージェント ジョブによって排除されます。 以下のパフォーマンス カウンターの状態を確認します。  
  
-   BizTalk:Message Agent (Host Name) Message Delivery Throttling State  
  
-   BizTalk:Message Agent (Host Name) Message Publishing Throttling State  
  
 「0」の値は、調整が実行されていないを示します。 「6」の値は、システムは、データベース サイズの増加に起因する制限を示します。 これらのカウンターの値を解釈する方法については、次を参照してください。[ホスト制限とは何ですか。](http://go.microsoft.com/fwlink/?LinkID=154694) (http://go.microsoft.com/fwlink/?LinkID=154694) および[ホスト制限パフォーマンス カウンター](http://go.microsoft.com/fwlink/?LinkID=155285) (http://go.microsoft.com/fwlink/?LinkID=155285)、BizTalk Server 2010 ドキュメント。  
  
## <a name="spool-table-growth"></a>スプール テーブルの増加  
 Spool のサイズが増加し始める原因は複数あります。 スプールの増大の理由の 1 つは、アプリケーション キューが成長しています。 下流のボトルネックやリソースの競合などの理由によりが大きくなる可能性があります。  
  
 アプリケーション キューが小さいと、スプールが大きなも場合、は、purge ジョブを把握することを確認します。 SQL エージェント サービスが実行されていることを確かめたうえで、以下のジョブが正常に完了しているかどうかを確認してください。  
  
-   MessageBox_Message_Cleanup_BizTalkMessageBoxDb  
  
-   MessageBox_Parts_Cleanup_BizTalkMessageBoxDb  
  
 MessageZeroSum テーブルが大きい場合は、メッセージが処理されていることを示します。 つまり、行が削除のフラグが設定された、デキューが正常に完了し、アプリケーション キュー テーブルからデータを削除します。 Purge ジョブによるデータの削除が追いついていないことを示します。 これは、SQL Server を実行しているコンピューターには、CPU 不足のための時間差を purge ジョブの機能に影響を与えず、深刻な CPU の競合が発生している場合に発生することができます。  
  
## <a name="application-queue-table-growth"></a>アプリケーション キュー テーブル サイズの増加  
 アプリケーション キューがホスト インフライト移行データは、処理された、DeQueue によってクリーンアップされます。  
  
 これらのメッセージを処理した後は、(これらの行への参照を保持している)、スプール テーブルをクリーンアップすることができます。  
  
 たとえば、RxHostQ はオーケストレーション PxHostQ にデータを発行します。 このキューは、スプール テーブルに行を参照して各に送信側に、データに発行します。 システムでは、特定の HostQ に対するメッセージは処理が正常に、これらの行は DeQueue によって削除されます。 削除後は、(それらの行によって参照されなくなった) Spool を Purge ジョブでクリーンアップできるようになります。  
  
 アプリケーション キューの増加率では、アプリケーション キューのドレインを担当するホスト インスタンスが、受信速度追いついていないことを示します。  
  
 たとえば、オーケストレーションの処理を担うサーバーが CPU に依存していて処理を高速化できないことが原因で、オーケストレーション アプリケーション キュー (PxHostQ) のサイズが増加する場合があります。 ただし、受信側のサーバーが高速な場合は、可能性があります発行オーケストレーション サーバーがアプリケーション キューの増加につながるを処理できるよりも高速です。  
  
 オーケストレーション キューの増加の原因としては、メモリの競合が考えられます。 多くの実行時間の長いオーケストレーション インスタンスは、メモリ内インスタンス化されるとは同時に、メモリの肥大化とが間接的メモリ不足が解消されるまで、スレッド プールを圧縮する調整します。  
  
 なぜ送信アプリケーション キューのサイズが増加する理由は、ダウン ストリーム システムができないかどうかはメッセージを受信する (BizTalk Server から送信) ほど高速です。 したがって、メッセージは引き続き、BizTalk システム発生アプリケーション キューの増加率内に存在します。 これには、調整を開始およびシステムの全体的なスループットに影響を与えず受信速度低下する可能性があります。  
  
## <a name="trackingdata-table-growth"></a>TrackingData テーブルの増加  
 メッセージ ボックス データベースの TrackingData テーブルは、インターセプターが両方の正常性とアクティビティ (HAT) およびビジネス アクティビティ監視 (BAM) 追跡の追跡データを書き込む先移行テーブルです。 追跡が無効になっている場合、このテーブルは空になります。 既定では、パイプラインおよびオーケストレーション送受信イベントの HAT 追跡が有効にします。  
  
 メッセージ本文の追跡が有効になっている場合は、メッセージ ボックス データベース サーバー (つまり、ホスト「ホストの追跡を許可する」) が実行されていることを確認します。 「ホストの追跡を許可する」を持つホストが実行されていることを確認すると、ホストは、BizTalk 追跡データベースのテーブルでは、メッセージ ボックス データベースの TrackingData テーブルからデータを移動すると、ボトルネックの発生の可能性が低くなります。  
  
 たとえばカスタム HAT 追跡を有効にしてカスタム イベントを追跡することがのプロパティおよびメッセージ本文の追跡を昇格します。 HAT 追跡データだけでなく BAM データも、TrackingData テーブルに書き込まれます。 Tracking Data Decode Service (TDDS、追跡が有効になっているホスト インスタンスで実行される) は、BizTalk 追跡データベースと BAM プライマリ インポート データベースにメッセージ ボックス データベースからこのデータの移動を担当します。 データが正常に移動すると後、TDDS は、このデータを削除します。 メッセージ本文の追跡データは、SQL エージェント ジョブ TrackedMessages_Copy_BizTalkMsgBoxDb によって別途移動されます。  
  
 TDDS が、インターセプターが TrackingData テーブルにデータを書き込んでいるレートでしきれない場合は、このテーブルが大きくなる、制限が開始します。 これにより、維持可能なスループットが影響します。 この問題を軽減するには、追跡を有効に少なくとも 1 つのホストが実行されていることを確認します。  
  
 データがまだ蓄積する場合は、BizTalk 追跡データベースがコントロールから増加していないことを確認します。 また、アーカイブを確認し、ジョブの消去が実行されていてデータの到着率継続できるようにします。  
  
> [!NOTE]  
>  既定では、purge ジョブでは、このデータはアーカイブされたまで、BizTalk 追跡データベース テーブルからデータを削除することです。 追跡データをアーカイブする必要がない場合は、次の手順に従って、アーカイブしないで、BizTalk 追跡データベースを削除するジョブを変更できます[BizTalk 追跡データベースからデータを消去する方法](http://go.microsoft.com/fwlink/?LinkID=153817)(http://go.microsoft.com/fwlink/しますか?LinkID = 153817)。  
  
## <a name="see-also"></a>参照  
 [データベース層のボトルネック](../technical-guides/bottlenecks-in-the-database-tier.md)