---
title: メッセージ ボックス データベース 1 のボトルネックを特定する方法 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 1a039164-5ca6-4cbc-b307-c5d4ae800689
caps.latest.revision: 7
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 60a2c736c191bf38fe1b11d42b900f2d10aece8d
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/07/2019
ms.locfileid: "65400423"
---
# <a name="how-to-identify-bottlenecks-in-the-messagebox-database"></a>メッセージ ボックス データベースのボトルネックを特定する方法
メッセージ ボックス データベースのボトルネックを特定するには、まず SQL Server エージェント サービスが開始されていることを確認します。 サーバーが再起動された場合、サービスが自動的に再起動できるように、サービスのスタートアップ状態を Auto に手動から変更します。  
  
 既定では、Spool、TrackingData、または ApplicationQ テーブルを拡張した場合に、BizTalk サービスがスロットルします。 これらのテーブルは、実行されていないと、スプールの増大に場合制限が起動し、さらに負荷からデータベースを保護する SQL エージェント ジョブで排除されます。 以下のパフォーマンス カウンターの状態を確認します。  
  
- BizTalk:Message Agent (ホスト名) メッセージの配信制限の状態  
  
- BizTalk:Message Agent (ホスト名) メッセージの公開の制限の状態  
  
  「0」の値は、調整が実行されていないことを示します。 「6」の値は、システムは、データベース サイズの増加に起因する制限を示します。 これらのカウンターの値を解釈する方法については、次を参照してください[ホスト制限とは何ですか?。](http://go.microsoft.com/fwlink/?LinkID=154694) (http://go.microsoft.com/fwlink/?LinkID=154694)と[ホスト制限パフォーマンス カウンター](http://go.microsoft.com/fwlink/?LinkID=155285) (http://go.microsoft.com/fwlink/?LinkID=155285) BizTalk Server 2010 のドキュメント。  
  
## <a name="spool-table-growth"></a>スプール テーブルの拡張  
 Spool のサイズが増加し始める原因は複数あります。 スプールの増大の理由の 1 つは、アプリケーション キューが成長しています。 下流のボトルネックやリソースの競合などの理由が大きくなる可能性があります。  
  
 アプリケーション キューのサイズが小さいと、スプールが大きなまだ、purge ジョブは維持することを確認します。 SQL エージェント サービスが実行されていることを確かめたうえで、以下のジョブが正常に完了しているかどうかを確認してください。  
  
- MessageBox_Message_Cleanup_BizTalkMessageBoxDb  
  
- MessageBox_Parts_Cleanup_BizTalkMessageBoxDb  
  
  MessageZeroSum テーブルが大きい場合、メッセージが処理されたことを示します。 つまり、デキューが正常に完了し、アプリケーション キュー テーブルからデータを削除し、行が削除のフラグが設定されました。 Purge ジョブによるデータの削除が追いついていないことを示します。 これは、SQL Server を実行しているコンピューターには、CPU 不足のために、purge ジョブの機能に影響を与えず、深刻な CPU の競合が発生した場合に発生することができます。  
  
## <a name="application-queue-table-growth"></a>アプリケーション キュー テーブル サイズの増加  
 アプリケーション キューがホスト インフライト移行データは、処理された、DeQueue によってクリーンアップされます。  
  
 これらのメッセージが処理された後は、(これらの行への参照を保持している)、スプール テーブルをクリーンアップできます。  
  
 たとえば、RxHostQ はオーケストレーション PxHostQ にデータを発行します。 このキューは、スプール テーブルの行を参照する各に送信側の TxHostQ に、データに発行します。 システムでは、特定の HostQ に対するメッセージは処理が正常に、これらの行は DeQueue によって削除されます。 削除後は、(それらの行によって参照されなくなった) Spool を Purge ジョブでクリーンアップできるようになります。  
  
 アプリケーション キュー サイズの増加は、アプリケーション キューのドレインを担うホスト インスタンスが受信速度に追いついていないことを示します。  
  
 たとえば、オーケストレーションの処理を担うサーバーが CPU に依存していて処理を高速化できないことが原因で、オーケストレーション アプリケーション キュー (PxHostQ) のサイズが増加する場合があります。 ただし、受信側のサーバーが高速な場合を発行してはオーケストレーション サーバーの処理能力をアプリケーション キューの増加率よりも高速です。  
  
 オーケストレーション キューの増加の原因としては、メモリの競合が考えられます。 多くの実行時間の長いオーケストレーション インスタンスのメモリ内で同時にインスタンス化、メモリが肥大化直接としないメモリ負荷が軽減されるまで、スレッド プールを圧縮するために調整します。  
  
 なぜアプリケーションの送信キューのサイズが増加する理由は、ダウン ストリーム システムが十分に高速 (BizTalk Server から送信) メッセージを受信できるかどうかです。 したがって、メッセージは、BizTalk システムの原因となるアプリケーション キュー拡張内に存在し続けます。 調整を開始し、システムの全体的なスループットに影響を与える受信速度を低下する可能性があります。  
  
## <a name="trackingdata-table-growth"></a>TrackingData テーブルの拡張  
 メッセージ ボックス データベースの TrackingData テーブルでは、インターセプターの両方の正常性とアクティビティ (HAT)、およびビジネス アクティビティ監視 (BAM) 追跡の追跡データの書き込み先の移行テーブルです。 追跡が無効になっている場合、このテーブルは空になります。 既定では、パイプラインおよびオーケストレーション送受信イベントの HAT 追跡が有効にします。  
  
 メッセージ本文の追跡が有効になっている場合は、メッセージ ボックス データベース サーバー (つまり、「ホストの追跡を許可する」でホスト) が実行されていることを確認します。 「ホストの追跡を許可する」を持つホストが実行されていることを確認すると、ホストがメッセージ ボックス データベースの TrackingData テーブルから BizTalk 追跡データベースのテーブル データを移動すると、ボトルネックの発生の可能性が減少します。  
  
 たとえばカスタム HAT 追跡を有効にすると、カスタム イベントを追跡することがのプロパティとメッセージ本文の追跡を昇格します。 HAT 追跡データに加えて BAM データも、TrackingData テーブルに書き込まれます。 Tracking Data Decode Service (TDDS、追跡が有効になっているホスト インスタンスで実行される) は、このデータをメッセージ ボックス データベースから BizTalk 追跡と BAM プライマリ インポート データベースを移動します。 データが正常に移動すると、TDDS によってこのデータが削除されます。 メッセージ本文の追跡データは、SQL エージェント ジョブ TrackedMessages_Copy_BizTalkMsgBoxDb によって別途移動されます。  
  
 TDDS が、インターセプターが TrackingData テーブルにデータを書き込んでいる速度維持できる場合は、制限開始がこのテーブルが増大します。 これにより、維持可能なスループットが影響します。 この問題を軽減するために、追跡を有効に少なくとも 1 つのホストが実行されていることを確認します。  
  
 それでもデータがた場合、は、コントロールから BizTalk 追跡データベースが増加していないことを確認します。 また、アーカイブを確認と消去ジョブが実行されており、データの到着率維持することができます。  
  
> [!NOTE]  
>  既定では、purge ジョブでは、このデータはアーカイブされたまで、BizTalk 追跡データベースのテーブルからデータを削除できません。 追跡データをアーカイブする必要がない場合は、次の手順に従ってアーカイブしないで BizTalk 追跡データベースを消去するジョブを変更できます[BizTalk 追跡データベースからのデータの削除方法](http://go.microsoft.com/fwlink/?LinkID=153817)(http://go.microsoft.com/fwlink/?LinkID=153817)します。  
  
## <a name="see-also"></a>参照  
 [データベース層のボトルネック](../technical-guides/bottlenecks-in-the-database-tier.md)