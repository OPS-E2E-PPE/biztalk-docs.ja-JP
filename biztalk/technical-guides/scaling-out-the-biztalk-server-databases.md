---
title: スケール アウトは、BizTalk Server データベース |Microsoft Docs
ms.custom: ''
ms.date: 11/29/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 18853ceb-7975-4c30-878f-6b162005f795
caps.latest.revision: 2
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 68da9abc7291c61c0eb9fcdd6d82c6f87aad6e44
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/27/2018
ms.locfileid: "36980755"
---
# <a name="scaling-out-the-biztalk-server-databases"></a>BizTalk Server データベースのスケール アウト
BizTalk Server データベースの高可用性を実現するには、Windows クラスターで SQL Server を実行している 2 台のコンピューターを構成します。 これらのコンピューターは、アクティブ/アクティブ、アクティブ/パッシブまたはアクティブ/アクティブ/パッシブ (3 台のコンピューターが必要) で実行できます冗長性実現のための構成と共有ドライブ上のデータを格納できる (など、RAID 1 + 0 SCSI ディスク アレイ) やストレージ エリア ネットワーク (SAN)。  
  
何らかの理由で SQL Server サービスが使用できなくなった場合、データベース クラスターは、アクティブ側コンピューターからパッシブ側コンピューターにリソースを転送します。 このフェールオーバー処理中に BizTalk Server サービスのインスタンスがデータベース接続の障害を検出すると、自動的にデータベースの再接続が実行されます。 正常に動作しているデータベース コンピューター (先ほどまでパッシブ側であったコンピューター) が、フェールオーバーでリソースを引き継いだ後、データベース接続の処理を開始します。  
  
については、BizTalk Server データベースをクラスタ リング[、BizTalk Server Databases2 をクラスタ リング](../technical-guides/clustering-the-biztalk-server-databases2.md)します。 このセクションでは、高可用性を提供する BizTalk Server データベースのスケール アウトについて説明します。  
  
## <a name="providing-high-availability-for-the-biztalk-messagebox-database"></a>BizTalk メッセージ ボックス データベースの高可用性を実現します。  
 このセクションでは、高可用性のための BizTalk メッセージ ボックス データベースを構成する情報を提供します。  
  
### <a name="running-multiple-messagebox-databases"></a>複数のメッセージ ボックス データベースの実行  
アドレス CPU 使用率が高く、メッセージ ボックス データベースの SQL Server コンピューターに BizTalk Server データベースのスケーラビリティを強化するためには、複数のメッセージ ボックス データベース間でデータを格納する BizTalk Server を構成できます。 最初のメッセージ ボックス データベースは、構成ウィザードの実行時に作成されます。 このメッセージ ボックス データベースは、マスターのメッセージ ボックス データベースです。 個々の BizTalk Server 環境には、マスターのメッセージ ボックス データベースが 1 つ含まれています。 マスターのメッセージ ボックス データベースは、マスターのサブスクリプション情報を含み、メッセージを適切なメッセージ ボックス データベースにルーティングします。 通常、専用のルーティングのみを実行するマスター メッセージ ボックス データベースと他のメッセージ ボックス データベースに対して処理を実行できるようにします。 ルーティングのみを実行するメッセージ ボックス データベースをするためには、次のように選択します。**新しいメッセージの公開を無効にする**から BizTalk 管理コンソールで、メッセージ ボックスのプロパティ。  
  
 メッセージ ボックス データベースの処理フローの例は次のとおりです。  
  
1. マスター メッセージ ボックス データベースが新しいアクティベーション メッセージを受信すると、ビジネス プロセス、またはサブスクリプション メッセージの新しいインスタンス-マスター メッセージ ボックス データベースは、[次へ] の使用可能なメッセージ ボックス データベースにアクティブ化メッセージを配信します。 たとえば、1 つのマスター メッセージ ボックス データベースと 2 つのメッセージ ボックス データベースを使用する場合、マスター メッセージ ボックス データベースは、ラウンドロビン方式で、最初のアクティベーション メッセージをメッセージ ボックス データベース 1 に、2 つ目のアクティベーション メッセージをメッセージ ボックス データベース 2 に、3 つ目のアクティベーション メッセージをメッセージ ボックス データベース 1 に送信します。 マスターのメッセージ ボックス データベースでは、負荷分散のロジックを組み込んでいるので、追加の負荷分散メカニズムは必要ありません。  
  
2. マスターのメッセージ ボックス データベースがアクティベーション メッセージを特定のメッセージ ボックス データベース (メッセージ ボックス データベース 1 など) に送信してから、ビジネス プロセスがメモリに読み込まれ、実行されます。  
  
3. ビジネス プロセスは、メッセージを待機する必要があります、待機時間は数秒より長い場合は、ビジネス プロセスは、メッセージ ボックス データベース 1 に保存されます。 ビジネス プロセスは、関連メッセージを待機しています。  
  
4. マスター メッセージ ボックス データベースで関連メッセージが到着すると、メッセージ エンジンは、(この例では、メッセージ ボックス 1) で関連メッセージの状態を含むメッセージ ボックス データベースのデータベースでルックアップ操作を行います。 マスター メッセージ ボックス データベースには、ビジネス プロセスを含むメッセージ ボックス データベースにメッセージが配信されます。  
  
5. ビジネス プロセスは処理が完了するまで、または別の相関関係のメッセージを待機する必要があるまで引き続きメモリに戻されました。  
  
   BizTalk Server は、メッセージ ボックス データベースのすべての状態を格納します。各メッセージ ボックス データベースには、異なるビジネス プロセスの状態情報が格納されます。 信頼性を確保するため、マスター メッセージ ボックス データベースおよびセカンダリ メッセージ ボックス データベースを含むすべてのメッセージ ボックス データベースをクラスター化する必要があります。  
  
   複数のメッセージ ボックス データベースを構成するには、BizTalk Server 管理コンソールを使用して SQL Server を実行しているコンピューターを追加します。 管理的には、新しいメッセージ ボックス データベースを追加する必要があるだけです。 BizTalk Server では、アクティベーション メッセージのラウンドロビン配信を自動的に処理し、関連メッセージを正しいメッセージ ボックス データベースに送信します。  
  
   環境内で複数のメッセージ ボックス データベースを構成する場合、BizTalk Server グループの 3 つのメッセージ ボックス データベースの最小値を作成する必要があり、マスター メッセージ ボックス データベースにメッセージの公開を無効にする必要があります。 この推奨事項は、メッセージ ボックス データベース間のメッセージのルーティングのマスター メッセージ ボックス データベースによってオーバーヘッドが追加のメッセージ ボックス データベースを追加するためになります。 2 つのメッセージ ボックス データベースにのみ構成する場合、追加のメッセージ ボックス データベースによって得られたメリットのほとんどは、メッセージのルーティング、マスター メッセージ ボックス データベースのオーバーヘッドで相殺されます。  
  
> [!IMPORTANT]  
>  BizTalk Server は、メッセージ ボックス データベースのすべての状態を格納します。各メッセージ ボックス データベースには、異なるビジネス プロセスの状態情報が格納されます。 信頼性を確保するため、マスター メッセージ ボックス データベースおよびセカンダリ メッセージ ボックス データベースを含むすべてのメッセージ ボックス データベースをクラスター化する必要があります。  
  
### <a name="providing-high-availability-for-multiple-messagebox-databases"></a>複数のメッセージ ボックス データベースの高可用性を実現する  
 メッセージ ボックス データベースを BizTalk Server の展開に追加するには、スケーラビリティが向上します、これは提供しません高可用性各メッセージ ボックス データベースで一意で独立したあり、BizTalk Server のエラーの 1 つのポイントは、可能性があるため環境。 冗長性を拡張するには、各メッセージ ボックス データベースについてサーバー クラスターを構成します。 BizTalk Server により、複数のメッセージ ボックス データベース間でデータが分散されるので、データベース間でデータが共有されることなく、サーバーをクラスター化しないで冗長性を提供できます。  
  
## <a name="providing-high-availability-for-the-biztalk-tracking-database"></a>BizTalk 追跡データベースの高可用性を実現する  
 個々の環境での要件によっては、別の SQL Server コンピューターに BizTalk 追跡データベースを分離し、ホスト追跡用の別の BizTalk ホストを作成することで、追跡のパフォーマンスを向上できる場合もあります。 次の図は、2 つのホスト インスタンスとクラスター化されたデータベースを備えた専用の追跡ホストの一覧です。  
  
 ![追跡データベースのスケール アウト](../technical-guides/media/4fc1d448-2a6c-4cea-ac17-96c1263dfb68.gif "4fc1d448-2a6c-4cea-ac17-96c1263dfb68")  
  
 スループットが高く、これらのメッセージのデータを大量に追跡する環境であれば、SQL Server を実行しているコンピューター上にあるリソースの多くを追跡のオーバーヘッドで消費してしまう可能性があります。 メッセージは、その他の BizTalk Server を実行するために必要なリソースを上回るこのような状況が発生し、BizTalk Server が、リソースが追跡するために必要なため、新しいメッセージの処理にことはできません、ポイントに達すると、受信メッセージの割合が高いが続く場合コンポーネント (など、メッセージを受信して、それらのメッセージ ボックス データベースに永続化) します。  
  
 パフォーマンスとセキュリティを向上させるのには、(受信場所、オーケストレーション、パイプラインなど) その他の項目が含まれていない追跡のためのホストを専用にしてを処理、および送信ホスト、受信からの追跡を無効にすることを勧めします。 追跡ホストの高可用性を実現するには、追跡ホストの複数のインスタンスを作成します。 参照してください[新しいホストを作成](../core/how-to-create-a-new-host.md)です。
  
 BizTalk Server メッセージ ボックス データベースごとに、1 つだけの追跡を使用してメッセージをメッセージ ボックス データベースから BizTalk 追跡データベース (BizTalkDTADb) に移動するホスト インスタンス。 追加のコンピューターで追跡ホストのインスタンスが実行されると、BizTalk Server は、各メッセージ ボックス データベースの処理を追跡ホストの別のインスタンスに自動的にスケールアウトします。 メッセージ ボックス データベースの数が追跡ホストのインスタンスの数よりも多くなった場合は、1 つまたは複数の追跡ホストのインスタンスが、複数のメッセージ ボックス データベースに対するサービスを提供します。  
  
 BizTalk 追跡データベースに高可用性を提供するには、Windows クラスタリングを使用し、SQL Server を実行する 2 台のデータベース コンピューターをアクティブ/パッシブ構成に設定します。  
  
## <a name="providing-high-availability-for-the-bam-databases"></a>BAM データベースの高可用性を実現する  
 *ビジネス アクティビティ監視*(BAM) は、IT の実装のや異種 IT 実装間で独立したビジネス プロセスの可視性を提供します。 BAM SQL Server データベース (BAM スター スキーマ データベース、BAM プライマリ インポート データベース、および BAM アーカイブ データベース) および BAM 分析データベースは、処理対象の監視データとは異なるビジネス アクティビティ データを格納します。 次の図は、BAM データベースのインフラストラクチャを示します。  
  
 ![BAM データベースのインフラストラクチャ](../technical-guides/media/769c3b7c-fe16-4260-967e-6af003c4f08d.gif "769c3b7c-fe16-4260-967e-6af003c4f08d")  
  
 BAM インフラストラクチャの高可用性を確保するには、次の手順を実行します。  
  
-   **BAM プライマリ インポート データベースおよび BAM 分析データベースをクラスタです。** BAM プライマリ インポート データベースは、ビジネス アクティビティ監視システムの中心です。 このため、Windows クラスタリングを使用してこのデータベースの高可用性を実現し、次の 2 つの推奨方法に従ってこのデータベースがいっぱいになるのを防ぐことが重要です。 BAM 分析データベースは、ビジネス アナリストがアクティビティの集計や OLAP キューブの構築に使用するデータを格納する Analysis Services データベースです。このため、このデータベースのダウンタイムは、生産性に影響します。 SQL Server Integration Services (SSIS) パッケージの実行、データが正常に転送されたかどうかを確認して、データベースのサイズを監視するときに、イベント ログでエラーを監視することをお勧めときに、BAM アーカイブ データベースをクラスターする必要はありません、置き換えることができます、前に塗りつぶしをします。  
  
-   **オンライン ウィンドウを定義します。** アクティビティが完了した時点のタイムスタンプに基づいて、テーブルに、BAM プライマリ インポート データベース内のデータ、BAM のパーティションのダウンタイムを回避してパフォーマンスが向上できるようにします。 BAM は、完了したテーブルと同一フォーマットの空のテーブルを定期的に交換して、この機能を実現します。 BAM がこの処理を行った後、BAM は、オンライン ウィンドウに定義されている期間、古いパーティションを保存します。また、追加の完了したアクティビティは、新しいパーティション (テーブル) に格納されます。 BAM プライマリ インポート データベースのパーティション数が大きくなりすぎないように、オンライン ウィンドウを定義する必要があります。 オンラインの windows のスケジュールの詳細については、[プライマリ インポート データベースのデータのアーカイブ](../core/archiving-primary-import-database-data.md)を参照してください。
  
-   **定期的に実行する SSIS パッケージのスケジュールを設定します。** オンライン ウィンドウを定義することにより、古いアクティビティのパーティションで BAM プライマリ インポート データベースがいっぱいになる状態を回避できます。 また、アクティビティ データに対する新しいパーティションを作成して、データを BAM プライマリ インポート データベースの古いパーティションから BAM アーカイブ データベースを移動する、定期的に実行する SSIS パッケージをスケジュールする必要があります。 SSIS パッケージのスケジュール設定の詳細については、[SQL Server Integration Services のパッケージをスケジュール設定](../core/scheduling-sql-server-integration-services-packages.md)を参照してください。
  
-   **慎重にデータ項目 (チェックポイント) の小さなセットを選択し、アクティビティを定義するときに不要なデータ項目が含まれないようにします。**  
  
-   **スケジュールされたスキャンとリアルタイムの集計、集計をデザインするときに間のトレードオフを理解します。** リアルタイムの集計は、SQL Server トリガーによって自動的に保存されます (待機時間ゼロ)。 一部のミッション クリティカルな待機時間の短いシナリオに最適ですが、パフォーマンス、イベントが BAM プライマリ インポート データベースに書き込まれるたびにコストが発生します。 スケジュール済みの集計は、その集計データを更新するキューブの SSIS パッケージをスケジュールに依存します。 それらの待機時間は、SSIS のスケジュール間隔以上が、全体的なパフォーマンスの影響は小さく、BAM プライマリ インポート データベースにあります。  
  
-   **スケジュール済みの集計を選択する場合は、アーカイブの SSIS より頻繁に実行するキューブの SSIS のスケジュールを確認します。** アーカイブの SSIS が BAM アーカイブ データベースにスケジュール済み集計用に処理されたアクティビティ データを移動しないためにです。  
  
-   **フェールオーバーの機能を取得する複数のコンピューターで BAM イベント バス サービスを有効にします。**  
  
## <a name="providing-high-availability-for-the-other-biztalk-server-databases"></a>他の BizTalk Server データベースの高可用性を実現する  
 その他の BizTalk Server データベースの高可用性を実現するには、Windows クラスターで SQL Server を実行している 2 台のコンピューターを構成します。 これらのコンピューターが冗長性では、アクティブ/アクティブまたはアクティブ/パッシブ構成で実行できるし、共有ドライブ上のデータを格納できます (など、RAID 1 + 0 SCSI ディスク アレイ) やストレージ エリア ネットワーク (SAN)。  
  
## <a name="see-also"></a>参照  
 [BizTalk Server Databases2 をクラスタ リング](../technical-guides/clustering-the-biztalk-server-databases2.md)