---
title: データベース ファイル グループの最適化 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: f7dbed4d-95d6-4a41-a69e-737a6f2f5a82
caps.latest.revision: 8
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: a7969280d7fa794820d2e99c164ee00e2ebbecc4
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/07/2019
ms.locfileid: "65291437"
---
# <a name="optimizing-filegroups-for-the-databases"></a><span data-ttu-id="87170-102">データベースのファイルグループの最適化</span><span class="sxs-lookup"><span data-stu-id="87170-102">Optimizing Filegroups for the Databases</span></span>
<span data-ttu-id="87170-103">ファイルは、入出力 (I/O) の競合が制限要因、または運用環境の BizTalk Server 環境で、ボトルネックが頻繁にです。</span><span class="sxs-lookup"><span data-stu-id="87170-103">File input/output (I/O) contention is frequently a limiting factor, or bottleneck, in a production BizTalk Server environment.</span></span> <span data-ttu-id="87170-104">BizTalk Server が非常にデータベースの処理を要するアプリケーションと、さらに、BizTalk Server によって使用される SQL Server データベースは、非常にファイル I/O を集中的に使用します。</span><span class="sxs-lookup"><span data-stu-id="87170-104">BizTalk Server is a very database intensive application and in turn, the SQL Server database used by BizTalk Server is very file I/O intensive.</span></span>  
  
 <span data-ttu-id="87170-105">このトピックでは、ファイルおよびファイル I/O の競合の発生を最小限に抑えるし、BizTalk Server ソリューションの全体的なパフォーマンスを向上する SQL Server のファイル グループの機能の使用を最適化する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="87170-105">This topic describes how to make optimal use of the files and filegroups feature of SQL Server to minimize the occurrence of file I/O contention and improve the overall performance of a BizTalk Server solution.</span></span>  
  
## <a name="overview"></a><span data-ttu-id="87170-106">概要</span><span class="sxs-lookup"><span data-stu-id="87170-106">Overview</span></span>  
 <span data-ttu-id="87170-107">すべての BizTalk Server ソリューションでは、スループットが増加するにつれて、ファイル I/O の競合が最終的に発生します。</span><span class="sxs-lookup"><span data-stu-id="87170-107">Every BizTalk Server solution will eventually encounter file I/O contention as throughput is increased.</span></span> <span data-ttu-id="87170-108">I/O サブシステムまたはストレージ エンジンは、任意のリレーショナル データベースのキー コンポーネントです。</span><span class="sxs-lookup"><span data-stu-id="87170-108">The I/O subsystem, or storage engine, is a key component of any relational database.</span></span> <span data-ttu-id="87170-109">通常、データベースの実装を成功させるには、プロジェクトの初期段階で慎重に計画を立てる必要があります。</span><span class="sxs-lookup"><span data-stu-id="87170-109">A successful database implementation typically requires careful planning at the early stages of a project.</span></span> <span data-ttu-id="87170-110">計画では、次の問題について検討する必要があります。</span><span class="sxs-lookup"><span data-stu-id="87170-110">This planning should include consideration of the following issues:</span></span>  
  
- <span data-ttu-id="87170-111">RAID (Redundant Array of Independent Disks) デバイスなど、使用するディスク ハードウェアの種類。</span><span class="sxs-lookup"><span data-stu-id="87170-111">What type of disk hardware to use, such as RAID (redundant array of independent disks) devices.</span></span> 
  
- <span data-ttu-id="87170-112">ファイルおよびファイル グループを使用してディスク上のデータを分配する方法。</span><span class="sxs-lookup"><span data-stu-id="87170-112">How to apportion data on the disks using files and filegroups.</span></span> <span data-ttu-id="87170-113">SQL Server でのファイルおよびファイル グループの使用に関する詳細については、次を参照してください。 [Database Files and Filegroups](https://docs.microsoft.com/sql/relational-databases/databases/database-files-and-filegroups)します。</span><span class="sxs-lookup"><span data-stu-id="87170-113">For more information about using files and filegroups in SQL Server, see [Database Files and Filegroups](https://docs.microsoft.com/sql/relational-databases/databases/database-files-and-filegroups).</span></span>
  
- <span data-ttu-id="87170-114">データにアクセスする場合は、パフォーマンスを向上させるための最適なインデックスの設計を実装します。</span><span class="sxs-lookup"><span data-stu-id="87170-114">Implementing the optimal index design for improving performance when accessing data.</span></span> <span data-ttu-id="87170-115">インデックスのデザインの詳細については、次を参照してください。[インデックスの設計](https://docs.microsoft.com/sql/relational-databases/sql-server-index-design-guide)します。</span><span class="sxs-lookup"><span data-stu-id="87170-115">For more information about designing indexes, see [Designing Indexes](https://docs.microsoft.com/sql/relational-databases/sql-server-index-design-guide).</span></span>
  
- <span data-ttu-id="87170-116">最適なパフォーマンスを SQL Server の構成パラメーターを設定する方法。</span><span class="sxs-lookup"><span data-stu-id="87170-116">How to set SQL Server configuration parameters for optimal performance.</span></span> <span data-ttu-id="87170-117">SQL Server の最適な構成パラメーターの設定の詳細については、次を参照してください。[サーバー構成オプションの](https://docs.microsoft.com/sql/database-engine/configure-windows/server-configuration-options-sql-server)します。</span><span class="sxs-lookup"><span data-stu-id="87170-117">For more information about setting optimal configuration parameters for SQL Server, see [Server Configuration Options](https://docs.microsoft.com/sql/database-engine/configure-windows/server-configuration-options-sql-server).</span></span> 
  
  <span data-ttu-id="87170-118">BizTalk Server の主な設計目標の 1 つは、メッセージがあることを確認する**決して**失われます。</span><span class="sxs-lookup"><span data-stu-id="87170-118">One of the primary design goals of BizTalk Server is to ensure that a message is **never** lost.</span></span> <span data-ttu-id="87170-119">メッセージの損失の可能性を軽減するためには、メッセージが処理されるメッセージをメッセージ ボックス データベースに書き込まれます頻繁に。</span><span class="sxs-lookup"><span data-stu-id="87170-119">In order to mitigate the possibility of message loss, messages are frequently written to the MessageBox database as the message is processed.</span></span> <span data-ttu-id="87170-120">オーケストレーションによって処理されるは、メッセージ、メッセージがオーケストレーション内のすべての永続化ポイントにあるメッセージ ボックス データベースに書き込まれます。</span><span class="sxs-lookup"><span data-stu-id="87170-120">When messages are processed by an Orchestration, the message is written to the MessageBox database at every persistence point in the orchestration.</span></span> <span data-ttu-id="87170-121">これらの永続性ポイントには、メッセージ ボックスに、物理ディスクへのメッセージと関連する状態の書き込みが発生します。</span><span class="sxs-lookup"><span data-stu-id="87170-121">These persistence points cause the MessageBox to write the message and related state to physical disk.</span></span> <span data-ttu-id="87170-122">高いスループットをでは、この永続化は、かなりのディスクの競合が生じるし、ボトルネックになる可能性があることができます。</span><span class="sxs-lookup"><span data-stu-id="87170-122">At higher throughputs, this persistence can result in considerable disk contention and can potentially become a bottleneck.</span></span>  
  
  <span data-ttu-id="87170-123">ファイルを使用する最適なとを効果的にファイル IO のボトルネックを解決し、BizTalk Server ソリューションの全体的なパフォーマンスを向上させる SQL Server でのファイル グループの機能も示されています。</span><span class="sxs-lookup"><span data-stu-id="87170-123">Making optimal use of the files and filegroups feature in SQL Server has been shown to effectively address File IO bottlenecks and improve overall performance in BizTalk Server solutions.</span></span> <span data-ttu-id="87170-124">この最適化は、経験豊富な SQL Server データベース管理者と後のすべての BizTalk Server データベースを正しくバックアップされているだけでのみ実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="87170-124">This optimization should only be done by an experienced SQL Server database administrator and only after all BizTalk Server databases have been properly backed up.</span></span> <span data-ttu-id="87170-125">この最適化は、BizTalk Server 環境ですべての SQL Server コンピューターで実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="87170-125">This optimization should be performed on all SQL Server computers in the BizTalk Server environment.</span></span>  
  
  <span data-ttu-id="87170-126">SQL Server のファイルおよびファイル グループは、データベース パフォーマンスを向上させるため、この機能により、データベースを作成する複数のディスク、複数のディスク コント ローラーまたは RAID (冗長アレイ独立したディスクの) システムを活用することができます。</span><span class="sxs-lookup"><span data-stu-id="87170-126">SQL Server files and filegroups can be utilized to improve database performance because this functionality allows a database be created across multiple disks, multiple disk controllers, or RAID (redundant array of independent disks) systems.</span></span> <span data-ttu-id="87170-127">たとえば、コンピューターにディスクが 4 個ある場合は、データ ファイル 3 つとログ ファイル 1 つから構成されるデータベースを、各ディスクにファイルを 1 つずつ配置して作成できます。</span><span class="sxs-lookup"><span data-stu-id="87170-127">For example, if your computer has four disks, you can create a database that is made up of three data files and one log file, with one file on each disk.</span></span> <span data-ttu-id="87170-128">データへのアクセスが行われると、4 つの読み取り/書き込みヘッドは並行してデータを同時にアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="87170-128">As data is accessed, four read/write heads can concurrently access the data in parallel.</span></span> <span data-ttu-id="87170-129">これにより速度が、データベース操作が大幅にします。</span><span class="sxs-lookup"><span data-stu-id="87170-129">This speeds up database operations significantly.</span></span> <span data-ttu-id="87170-130">SQL Server のディスクのハードウェア ソリューションの実装の詳細についてを参照してください「データベースのパフォーマンス」、SQL Server オンライン ブックで[ http://go.microsoft.com/fwlink/?LinkID=71419](http://go.microsoft.com/fwlink/?LinkID=71419)します。</span><span class="sxs-lookup"><span data-stu-id="87170-130">For more information about implementing hardware solutions for SQL Server disks, see “Database Performance” in the SQL Server Books online at [http://go.microsoft.com/fwlink/?LinkID=71419](http://go.microsoft.com/fwlink/?LinkID=71419).</span></span>  
  
  <span data-ttu-id="87170-131">さらに、ファイルおよびファイル グループを有効にする、データの配置で特定のファイル グループにテーブルを作成できるためです。</span><span class="sxs-lookup"><span data-stu-id="87170-131">Additionally, files and filegroups enable data placement, because tables can be created in specific filegroups.</span></span> <span data-ttu-id="87170-132">これにより、指定されたテーブルのすべてのファイル I/O は、特定のディスクに向けることがあるために、パフォーマンスが向上します。</span><span class="sxs-lookup"><span data-stu-id="87170-132">This improves performance, because all file I/O for a given table can be directed at a specific disk.</span></span> <span data-ttu-id="87170-133">たとえば、使用頻度の高いテーブルは、1 つのディスク上にあるファイル グループ内のファイルを配置でき、データベース内の他の頻度が低いテーブルを 2 番目のディスク上にある別のファイル グループ内の異なるファイルに配置することができます。</span><span class="sxs-lookup"><span data-stu-id="87170-133">For example, a heavily used table can be placed on a file in a filegroup, located on one disk, and the other less heavily accessed tables in the database can be located on different files in another filegroup, located on a second disk.</span></span>  
  
  <span data-ttu-id="87170-134">ファイル IO のボトルネックがでかなり詳しく説明されている[データベース層のボトルネック](../technical-guides/bottlenecks-in-the-database-tier.md)します。</span><span class="sxs-lookup"><span data-stu-id="87170-134">File IO bottlenecks are discussed in considerable detail in [Bottlenecks in the Database Tier](../technical-guides/bottlenecks-in-the-database-tier.md).</span></span> <span data-ttu-id="87170-135">ファイル I/O (ディスク I/O) がボトルネックである最も一般的なインジケーターでは、「物理ディスク: 平均ディスク キューの長さ」カウンターの値です。</span><span class="sxs-lookup"><span data-stu-id="87170-135">The most common indicator that File I/O (Disk I/O) is a bottleneck is the value of the “Physical Disk:Average Disk Queue Length” counter.</span></span> <span data-ttu-id="87170-136">「物理ディスク: 平均ディスク キューの長さ」カウンターの値が任意の SQL サーバーで特定のディスクの約 3 より大きい場合、ファイル I/O と思われますボトルネックになっています。</span><span class="sxs-lookup"><span data-stu-id="87170-136">When the value of the “Physical Disk:Average Disk Queue Length” counter is greater than about 3 for any given disk on any of the SQL Servers, then file I/O is likely a bottleneck.</span></span>  
  
  <span data-ttu-id="87170-137">ファイルまたはファイル グループの最適化を適用することも、ファイル I/O のボトルネックの問題が解決されない場合があります追加の物理または SAN ドライブを追加することで、ディスク サブシステムのスループットを向上するために必要です。</span><span class="sxs-lookup"><span data-stu-id="87170-137">If applying file or filegroup optimization doesn't resolve a file I/O bottleneck problem, then it may be necessary to increase the throughput of the disk subsystem by adding additional physical or SAN drives.</span></span>  
  
  <span data-ttu-id="87170-138">このトピックでは、手動でファイルおよびファイル グループの最適化を適用する方法を説明しますが、これらの最適化をスクリプト化もできます。</span><span class="sxs-lookup"><span data-stu-id="87170-138">This topic describes how to manually apply file and filegroup optimizations but these optimizations can also be scripted.</span></span> <span data-ttu-id="87170-139">サンプル SQL スクリプトは、このトピックの最後で提供されます。</span><span class="sxs-lookup"><span data-stu-id="87170-139">A sample SQL script is provided at the end of this topic.</span></span> <span data-ttu-id="87170-140">このスクリプトはファイル、ファイル グループ、および任意の BizTalk Server ソリューションの SQL Server データベースによって使用されるディスク構成に合わせて変更する必要があることに注意してください。 重要です。</span><span class="sxs-lookup"><span data-stu-id="87170-140">It is important to note that this script would need to be modified to accommodate the file, filegroup, and disk configuration used by the SQL Server database(s) for any given BizTalk Server solution.</span></span>  
  
 
## <a name="databases-created-with-a-default-biztalk-server-configuration"></a><span data-ttu-id="87170-141">既定の BizTalk Server の構成で作成されたデータベース</span><span class="sxs-lookup"><span data-stu-id="87170-141">Databases created with a default BizTalk Server configuration</span></span>  
 <span data-ttu-id="87170-142">に応じて最大 13 の異なるデータベース、BizTalk Server の構成は SQL Server で作成でき、これらすべてのデータベースが既定のファイル グループの作成時に、機能が有効にします。</span><span class="sxs-lookup"><span data-stu-id="87170-142">Depending on which features are enabled when configuring BizTalk Server, up to 13 different databases may be created in SQL Server and all of these databases are created in the default file group.</span></span> <span data-ttu-id="87170-143">SQL Server の既定のファイル グループは、ALTER DATABASE コマンドを使用して既定のファイル グループが変更されない限り、プライマリ ファイル グループです。</span><span class="sxs-lookup"><span data-stu-id="87170-143">The default filegroup for SQL Server is the PRIMARY filegroup unless the default filegroup is changed by using the ALTER DATABASE command.</span></span> <span data-ttu-id="87170-144">次の表は、BizTalk Server を構成するときに、すべての機能が有効な場合は、SQL Server で作成されたデータベースを一覧表示します。</span><span class="sxs-lookup"><span data-stu-id="87170-144">The table below lists the databases that are created in SQL Server if all features are enabled when configuring BizTalk Server.</span></span>  
  
### <a name="biztalk-server-databases"></a><span data-ttu-id="87170-145">BizTalk Server データベース</span><span class="sxs-lookup"><span data-stu-id="87170-145">BizTalk Server Databases</span></span>  
  
||||  
|-|-|-|  
|<span data-ttu-id="87170-146">**[データベース]**</span><span class="sxs-lookup"><span data-stu-id="87170-146">**Database**</span></span>|<span data-ttu-id="87170-147">**既定のデータベース名**</span><span class="sxs-lookup"><span data-stu-id="87170-147">**Default Database Name**</span></span>|<span data-ttu-id="87170-148">**[説明]**</span><span class="sxs-lookup"><span data-stu-id="87170-148">**Description**</span></span>|  
|<span data-ttu-id="87170-149">構成データベース</span><span class="sxs-lookup"><span data-stu-id="87170-149">Configuration database</span></span>|<span data-ttu-id="87170-150">BizTalkMgmtDb</span><span class="sxs-lookup"><span data-stu-id="87170-150">BizTalkMgmtDb</span></span>|<span data-ttu-id="87170-151">中央メタ情報は、BizTalk Server グループ内の BizTalk Server のすべてのインスタンスを格納します。</span><span class="sxs-lookup"><span data-stu-id="87170-151">The central meta-information store for all instances of BizTalk Server in the BizTalk Server group.</span></span>|  
|<span data-ttu-id="87170-152">BizTalk メッセージ ボックス データベース</span><span class="sxs-lookup"><span data-stu-id="87170-152">BizTalk MessageBox database</span></span>|<span data-ttu-id="87170-153">BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="87170-153">BizTalkMsgBoxDb</span></span>|<span data-ttu-id="87170-154">サブスクリプションの述語を格納します。</span><span class="sxs-lookup"><span data-stu-id="87170-154">Stores subscriptions predicates.</span></span> <span data-ttu-id="87170-155">ホスト プラットフォームし、各 BizTalk Server ホストのキューおよび状態テーブルを保持します。</span><span class="sxs-lookup"><span data-stu-id="87170-155">It is a host platform, and keeps queues and state tables for each BizTalk Server host.</span></span> <span data-ttu-id="87170-156">また、メッセージ ボックス データベースには、メッセージおよびメッセージ プロパティが格納されます。</span><span class="sxs-lookup"><span data-stu-id="87170-156">The MessageBox database also stores the messages and message properties.</span></span>|  
|<span data-ttu-id="87170-157">BizTalk 追跡データベース</span><span class="sxs-lookup"><span data-stu-id="87170-157">BizTalk Tracking database</span></span>|<span data-ttu-id="87170-158">BizTalkDTADb</span><span class="sxs-lookup"><span data-stu-id="87170-158">BizTalkDTADb</span></span>|<span data-ttu-id="87170-159">ビジネスおよび稼動状態の監視、BizTalk Server 追跡エンジンで追跡データを格納します。</span><span class="sxs-lookup"><span data-stu-id="87170-159">Stores business and health monitoring data tracked by the BizTalk Server tracking engine.</span></span>|  
|<span data-ttu-id="87170-160">BAM 分析データベース</span><span class="sxs-lookup"><span data-stu-id="87170-160">BAM Analysis database</span></span>|<span data-ttu-id="87170-161">BAMAnalysis</span><span class="sxs-lookup"><span data-stu-id="87170-161">BAMAnalysis</span></span>|<span data-ttu-id="87170-162">ビジネス アクティビティの集計済み履歴データを保持する SQL Server Analysis Services データベースです。</span><span class="sxs-lookup"><span data-stu-id="87170-162">SQL Server Analysis Services database that keeps the aggregated historical data for Business Activities.</span></span>|  
|<span data-ttu-id="87170-163">BAM スター スキーマ データベース</span><span class="sxs-lookup"><span data-stu-id="87170-163">BAM Star Schema database</span></span>|<span data-ttu-id="87170-164">BAMStarSchema</span><span class="sxs-lookup"><span data-stu-id="87170-164">BAMStarSchema</span></span>|<span data-ttu-id="87170-165">OLAP 処理するために、ビジネス アクティビティの監視から収集されたデータを変換します。</span><span class="sxs-lookup"><span data-stu-id="87170-165">Transforms the data collected from Business Activity Monitoring for OLAP Processing.</span></span> <span data-ttu-id="87170-166">BAM 分析データベースを使用する場合、このデータベースが必要です。</span><span class="sxs-lookup"><span data-stu-id="87170-166">This database is required when using the BAM Analysis database.</span></span>|  
|<span data-ttu-id="87170-167">BAM プライマリ インポート データベース</span><span class="sxs-lookup"><span data-stu-id="87170-167">BAM Primary Import database</span></span>|<span data-ttu-id="87170-168">BAMPrimaryImport</span><span class="sxs-lookup"><span data-stu-id="87170-168">BAMPrimaryImport</span></span>|<span data-ttu-id="87170-169">アクティビティ インスタンスの後に、ビジネス アクティビティの進行状況とデータのクエリからイベントを格納します。</span><span class="sxs-lookup"><span data-stu-id="87170-169">Stores the events from Business Activities and then queries for the progress and data after activity instances.</span></span> <span data-ttu-id="87170-170">このデータベースには、リアルタイム集計も実行します。</span><span class="sxs-lookup"><span data-stu-id="87170-170">This database also performs real-time aggregations.</span></span>|  
|<span data-ttu-id="87170-171">BAM アーカイブ データベース</span><span class="sxs-lookup"><span data-stu-id="87170-171">BAM Archive database</span></span>|<span data-ttu-id="87170-172">BAMArchive</span><span class="sxs-lookup"><span data-stu-id="87170-172">BAMArchive</span></span>|<span data-ttu-id="87170-173">サブスクリプションの述語を格納します。</span><span class="sxs-lookup"><span data-stu-id="87170-173">Stores subscription predicates.</span></span> <span data-ttu-id="87170-174">BAM アーカイブ データベースには、BAM プライマリ インポート データベース内のビジネス アクティビティ データの蓄積が最小限に抑えます。</span><span class="sxs-lookup"><span data-stu-id="87170-174">The BAM Archive database minimizes the accumulation of Business Activity data in the BAM Primary Import database.</span></span>|  
|<span data-ttu-id="87170-175">SSO データベース</span><span class="sxs-lookup"><span data-stu-id="87170-175">SSO database</span></span>|<span data-ttu-id="87170-176">SSODB</span><span class="sxs-lookup"><span data-stu-id="87170-176">SSODB</span></span>|<span data-ttu-id="87170-177">構成を安全に格納の情報の受信場所。</span><span class="sxs-lookup"><span data-stu-id="87170-177">Securely stores the configuration information for receive locations.</span></span> <span data-ttu-id="87170-178">Sso の情報を格納は、すべての関連アプリケーションに暗号化されたユーザー資格情報だけでなく、アプリケーションに関連します。</span><span class="sxs-lookup"><span data-stu-id="87170-178">Stores information for SSO affiliate applications, as well as the encrypted user credentials to all the affiliate applications.</span></span>|  
|<span data-ttu-id="87170-179">ルール エンジン データベース</span><span class="sxs-lookup"><span data-stu-id="87170-179">Rule Engine database</span></span>|<span data-ttu-id="87170-180">BizTalkRuleEngineDb</span><span class="sxs-lookup"><span data-stu-id="87170-180">BizTalkRuleEngineDb</span></span>|<span data-ttu-id="87170-181">リポジトリ:</span><span class="sxs-lookup"><span data-stu-id="87170-181">Repository for:</span></span><br /><br /> <span data-ttu-id="87170-182">-ポリシー、関連するルールのセットであります。</span><span class="sxs-lookup"><span data-stu-id="87170-182">-   Policies, which are sets of related rules.</span></span><br /><span data-ttu-id="87170-183">-ボキャブラリをルール内でデータの参照をドメイン固有のわかりやすい名前のコレクション。</span><span class="sxs-lookup"><span data-stu-id="87170-183">-   Vocabularies, which are collections of user-friendly, domain-specific names for data references in rules.</span></span>|  
|<span data-ttu-id="87170-184">追跡分析サーバーの管理データベース</span><span class="sxs-lookup"><span data-stu-id="87170-184">Tracking Analysis Server Administration database</span></span>|<span data-ttu-id="87170-185">BizTalkAnalysisDb</span><span class="sxs-lookup"><span data-stu-id="87170-185">BizTalkAnalysisDb</span></span>|<span data-ttu-id="87170-186">ビジネスおよび稼動状況監視 OLAP キューブの両方を格納します。</span><span class="sxs-lookup"><span data-stu-id="87170-186">Stores both business and health monitoring OLAP cubes.</span></span>|  
  
## <a name="separation-of-data-files-and-log-files"></a><span data-ttu-id="87170-187">データ ファイルとログ ファイルの分離</span><span class="sxs-lookup"><span data-stu-id="87170-187">Separation of data files and log files</span></span>  
 <span data-ttu-id="87170-188">前述のように、既定の BizTalk Server の構成は、既定のファイル グループ内の 1 つのファイルにメッセージ ボックス データベースを配置します。</span><span class="sxs-lookup"><span data-stu-id="87170-188">As noted above, a default BizTalk Server configuration places the MessageBox Database into a single file in the default filegroup.</span></span> <span data-ttu-id="87170-189">既定では、メッセージ ボックス データベースのデータとトランザクション ログが同じドライブおよびパスに配置されます。</span><span class="sxs-lookup"><span data-stu-id="87170-189">By default, the data and transaction logs for the MessageBox database are placed on the same drive and path.</span></span> <span data-ttu-id="87170-190">これは、1 つのディスクを使用したシステムに対応するためです。</span><span class="sxs-lookup"><span data-stu-id="87170-190">This is done to accommodate systems with a single disk.</span></span> <span data-ttu-id="87170-191">1 つのファイルまたはファイル グループ/ディスク構成が**最適ではない**運用環境でします。</span><span class="sxs-lookup"><span data-stu-id="87170-191">A single file/filegroup/disk configuration is **not optimal** in a production environment.</span></span> <span data-ttu-id="87170-192">最適なパフォーマンス、データ ファイルとログ ファイルを別個のディスクに配置する必要があります。</span><span class="sxs-lookup"><span data-stu-id="87170-192">For optimal performance, the data files and log files should be placed on separate disks.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="87170-193">ログ ファイルは、ファイル グループの一部ではできません。</span><span class="sxs-lookup"><span data-stu-id="87170-193">Log files are never part of a filegroup.</span></span> <span data-ttu-id="87170-194">ログ領域はデータ領域とは別に管理されます。</span><span class="sxs-lookup"><span data-stu-id="87170-194">Log space is managed separately from data space.</span></span>  
  
## <a name="the-8020-rule-of-distributing-biztalk-server-databases"></a><span data-ttu-id="87170-195">BizTalk Server データベースを配布する 80/20 ルール</span><span class="sxs-lookup"><span data-stu-id="87170-195">The 80/20 rule of distributing BizTalk Server databases</span></span>  
 <span data-ttu-id="87170-196">ディスク I/O の競合またはデータベースの競合のため、ほとんどの BizTalk Server ソリューションでの競合の主なソースは、BizTalk Server メッセージ ボックス データベースです。</span><span class="sxs-lookup"><span data-stu-id="87170-196">The main source of contention in most BizTalk Server solutions, either because of disk I/O contention or database contention, is the BizTalk Server MessageBox database.</span></span> <span data-ttu-id="87170-197">これは、単一およびマルチ メッセージ ボックスの両方のシナリオに当てはまります。</span><span class="sxs-lookup"><span data-stu-id="87170-197">This is true in both single and multi-MessageBox scenarios.</span></span> <span data-ttu-id="87170-198">BizTalk データベースを配布する値の 80% をメッセージ ボックス データ ファイルとログ ファイルを最適化することから導き出されますことがあると考えることになります。</span><span class="sxs-lookup"><span data-stu-id="87170-198">It is reasonable to assume that as much as 80% of the value of distributing BizTalk databases will be derived from optimizing the MessageBox data files and log file.</span></span> <span data-ttu-id="87170-199">シナリオの詳細を以下の例はメッセージ ボックス データベースのデータ ファイルの最適化に重点を置いています。</span><span class="sxs-lookup"><span data-stu-id="87170-199">The sample scenario detailed below is focused on optimizing the data files for a MessageBox database.</span></span> <span data-ttu-id="87170-200">次の手順し、後に指定できます他のデータベースなど、必要に応じて、ソリューションが必要な場合、広範な追跡し、追跡データベースを最適化することもします。</span><span class="sxs-lookup"><span data-stu-id="87170-200">These steps can then be followed for other databases as needed, for example, if the solution requires extensive tracking, then the Tracking database can also be optimized.</span></span>  
  
## <a name="manually-adding-files-to-the-messagebox-database-step-by-step"></a><span data-ttu-id="87170-201">ステップ バイ ステップに、メッセージ ボックス データベースにファイルを手動で追加します。</span><span class="sxs-lookup"><span data-stu-id="87170-201">Manually adding files to the MessageBox database, step-by-step</span></span>  
 <span data-ttu-id="87170-202">このセクションでは、メッセージ ボックス データベースにファイルを手動で追加する手順について説明します。</span><span class="sxs-lookup"><span data-stu-id="87170-202">This section describes the steps that can be followed to manually add files to the MessageBox database.</span></span> <span data-ttu-id="87170-203">この例では、次の 3 つのファイル グループが追加され、メッセージ ボックス データベースの複数のディスク ファイルを配布する各ファイル グループにファイルを追加します。</span><span class="sxs-lookup"><span data-stu-id="87170-203">In this example three filegroups are added and then a file is added to each filegroup to distribute the files for the MessageBox across multiple disks.</span></span>   
  
> [!NOTE]  
>  <span data-ttu-id="87170-204">このガイドで行われたパフォーマンス テストのために、ファイル グループは、BizTalk Server パフォーマンス最適化ガイドの一部として発行されるスクリプトを使用して最適化されました。</span><span class="sxs-lookup"><span data-stu-id="87170-204">For purposes of the performance testing done for this guide, filegroups were optimized through the use of a script which will be published as part of the BizTalk Server Performance Optimizations Guide.</span></span> <span data-ttu-id="87170-205">次の手順は、参照用としてのみ提供されます。</span><span class="sxs-lookup"><span data-stu-id="87170-205">The steps below are provided for reference purposes only.</span></span>  
  
### <a name="manually-adding-files-to-the-messagebox-database-on-sql-server"></a><span data-ttu-id="87170-206">SQL Server のメッセージ ボックス データベースにファイルを手動で追加します。</span><span class="sxs-lookup"><span data-stu-id="87170-206">Manually adding files to the MessageBox database on SQL Server</span></span>
  
1. <span data-ttu-id="87170-207">開いている**SQL Server Management Studio**を表示する、**サーバーへの接続** ダイアログ ボックス。</span><span class="sxs-lookup"><span data-stu-id="87170-207">Open **SQL Server Management Studio** to display the **Connect to Server** dialog box.</span></span>  
  
     <span data-ttu-id="87170-208">![SQL Server の管理ログイン画面](../technical-guides/media/641a03f4-362c-4dde-8c9d-ac313d8881e3.gif "641a03f4-362c-4dde-8c9d-ac313d8881e3")</span><span class="sxs-lookup"><span data-stu-id="87170-208">![SQL Server Administration login screen](../technical-guides/media/641a03f4-362c-4dde-8c9d-ac313d8881e3.gif "641a03f4-362c-4dde-8c9d-ac313d8881e3")</span></span>  
  
2.  <span data-ttu-id="87170-209">**サーバー名**のフィールド、**サーバーへの接続**ダイアログ ボックスが、BizTalk Server メッセージ ボックス データベースを格納する SQL Server インスタンスの名前を入力し、クリックして、**接続**を表示するボタン、 **Microsoft SQL Server Management Studio**  ダイアログ ボックス。</span><span class="sxs-lookup"><span data-stu-id="87170-209">In the **Server name** field of the **Connect to Server** dialog box, enter the name of the SQL Server instance that houses the BizTalk Server MessageBox databases, and then click the **Connect** button to display the **Microsoft SQL Server Management Studio** dialog box.</span></span>  
  
     <span data-ttu-id="87170-210">**オブジェクト エクスプ ローラー** SQL Server Management Studio でのウィンドウが展開**データベース**を SQL Server のこのインスタンスのデータベースを表示します。</span><span class="sxs-lookup"><span data-stu-id="87170-210">In the **Object Explorer** pane of SQL Server Management Studio, expand **Databases** to view the databases for this instance of SQL Server.</span></span>  
  
     <span data-ttu-id="87170-211">![SQL Server Management Studio、Object Explorer](../technical-guides/media/81f13912-fedc-48c3-9669-c18863e637b1.gif "81f13912-fedc-48c3-9669-c18863e637b1")</span><span class="sxs-lookup"><span data-stu-id="87170-211">![SQL Server Management Studio, Object Explorer](../technical-guides/media/81f13912-fedc-48c3-9669-c18863e637b1.gif "81f13912-fedc-48c3-9669-c18863e637b1")</span></span>  
  
3.  <span data-ttu-id="87170-212">クリックして、ファイルを追加する対象のデータベースを右クリックして**プロパティ**を表示する、**データベース プロパティ**データベース用のダイアログ ボックス。</span><span class="sxs-lookup"><span data-stu-id="87170-212">Right-click the database for which to add the files, and then click **Properties** to display the **Database Properties** dialog box for the database.</span></span>  
  
     <span data-ttu-id="87170-213">![SQL Server データベースのプロパティ ダイアログ ボックス](../technical-guides/media/82ae7c11-5b3a-4312-876c-70876abdd65c.gif "82ae7c11-5b3a-4312-876c-70876abdd65c")</span><span class="sxs-lookup"><span data-stu-id="87170-213">![SQL Server Database Properties dialog box](../technical-guides/media/82ae7c11-5b3a-4312-876c-70876abdd65c.gif "82ae7c11-5b3a-4312-876c-70876abdd65c")</span></span>  
  
4.  <span data-ttu-id="87170-214">**データベース プロパティ**ダイアログ ボックスで、**ファイル グループ**ページ。</span><span class="sxs-lookup"><span data-stu-id="87170-214">In the **Database Properties** dialog box, select the **Filegroups** page.</span></span> <span data-ttu-id="87170-215">をクリックして、**追加**BizTalkMsgBoxDb データベースの追加のファイル グループを作成するボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="87170-215">Click the **Add** button to create additional filegroups for the BizTalkMsgBoxDb databases.</span></span> <span data-ttu-id="87170-216">次の例では、次の 3 つの追加のファイル グループが追加されます。</span><span class="sxs-lookup"><span data-stu-id="87170-216">In the example below, three additional filegroups are added.</span></span>  
  
     <span data-ttu-id="87170-217">![SQL Server、データベース ファイル グループに追加する](../technical-guides/media/6be47c0e-06c3-45d9-bce2-a42453da7d19.gif "6be47c0e-06c3-45d9-bce2-a42453da7d19")</span><span class="sxs-lookup"><span data-stu-id="87170-217">![SQL Server, adding filegroups to a database](../technical-guides/media/6be47c0e-06c3-45d9-bce2-a42453da7d19.gif "6be47c0e-06c3-45d9-bce2-a42453da7d19")</span></span>  
  
5.  <span data-ttu-id="87170-218">**[データベースのプロパティ]** ダイアログ ボックスで、 **[ファイル]** ページをクリックします。</span><span class="sxs-lookup"><span data-stu-id="87170-218">In the **Database Properties** dialog box, select the **Files** page.</span></span>  
  
     <span data-ttu-id="87170-219">をクリックして、**追加**、ファイル グループに追加する追加ファイルを作成するボタンをクリックし、をクリックし、 **OK**。</span><span class="sxs-lookup"><span data-stu-id="87170-219">Click the **Add** button to create additional files to add to the filegroups, and then click **OK**.</span></span> <span data-ttu-id="87170-220">メッセージ ボックス データベースがパフォーマンスに大きな利点は、1 つのディスク構成を提供する複数のディスクで配布ようになりました。</span><span class="sxs-lookup"><span data-stu-id="87170-220">The MessageBox database is now distributed across multiple disks, which will provide a significant performance advantage over a single disk configuration.</span></span>  
  
     <span data-ttu-id="87170-221">次の例で以前に作成されたファイル グループの各ファイルが作成し、各ファイルが別のディスク上に配置します。</span><span class="sxs-lookup"><span data-stu-id="87170-221">In the example below, a file is created for each of the filegroups that were created earlier and each file is placed on a separate disk.</span></span>  
  
     <span data-ttu-id="87170-222">![SQL Server、ファイルをファイル グループに追加する](../technical-guides/media/d5d5c5df-d483-4f01-8128-f98228de51b9.gif "d5d5c5df-d483-4f01-8128-f98228de51b9")</span><span class="sxs-lookup"><span data-stu-id="87170-222">![SQL Server, adding files to a filegroup](../technical-guides/media/d5d5c5df-d483-4f01-8128-f98228de51b9.gif "d5d5c5df-d483-4f01-8128-f98228de51b9")</span></span>  
  
## <a name="sample-sql-script-for-adding-filegroups-and-files-to-the-biztalk-messagebox-database"></a><span data-ttu-id="87170-223">BizTalk メッセージ ボックス データベースにファイル グループとファイルを追加するためのサンプル SQL スクリプト</span><span class="sxs-lookup"><span data-stu-id="87170-223">Sample SQL script for adding filegroups and files to the BizTalk MessageBox database</span></span>  
 <span data-ttu-id="87170-224">次のサンプル SQL スクリプトは、前のセクションで手動で完了したのと同じタスクを実行します。</span><span class="sxs-lookup"><span data-stu-id="87170-224">The sample SQL script below performs the same tasks that were completed manually in the previous section.</span></span>  
<span data-ttu-id="87170-225">このサンプル スクリプトは、J. を通じて個別の論理ドライブ G の存在を想定していますスクリプトでは、ファイル グループと各ファイル グループのファイルを作成し、J ドライブ上のログ ファイルを配置します。</span><span class="sxs-lookup"><span data-stu-id="87170-225">This sample script assumes the existence of distinct logical drives G through J. The script creates filegroups and files for each filegroup and places the log files on the J drive.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="87170-226">SQL Server のログ ファイルに書き込むと順番に、ために、SQL Server データベースの複数のログ ファイルを作成することに気付きましたパフォーマンス上の利点はありません。</span><span class="sxs-lookup"><span data-stu-id="87170-226">Because SQL Server writes to its log files sequentially, there is no performance advantage realized by creating multiple log files for a SQL Server database.</span></span>  
  
```  
-- Filegroup changes are made using the master database  
USE [master]  
GO  
  
-- Script-wide declarations  
DECLARE @CommandBuffer nvarchar(2048)  
DECLARE @FG1_Path nvarchar(1024)  
DECLARE @FG2_Path nvarchar(1024)  
DECLARE @FG3_Path nvarchar(1024)  
DECLARE @Log_Path nvarchar(1024)  
  
-- Set the default path for all filegroups  
SET @FG1_Path = N'G:\BizTalkMsgBoxDATA\'  
SET @FG2_Path = N'H:\BizTalkMsgBoxDATA\'  
SET @FG3_Path = N'I:\BizTalkMsgBoxDATA\'  
SET @Log_Path = N'J:\BizTalkMsgBoxLog\'  
  
ALTER DATABASE [BizTalkMsgBoxDb] ADD FILEGROUP [BTS_MsgBox_FG1]  
SET @CommandBuffer = N'ALTER DATABASE [BizTalkMsgBoxDb] ADD FILE ( NAME = N''BizTalkMsgBoxDb_FG1'', FILENAME = N''' + @FG1_Path +   
N'BizTalkMsgBoxDb_FG1.ndf'' , SIZE = 102400KB , MAXSIZE = UNLIMITED, FILEGROWTH = 10240KB ) TO FILEGROUP [BTS_MsgBox_FG1]'  
EXECUTE (@CommandBuffer)  
  
ALTER DATABASE [BizTalkMsgBoxDb] ADD FILEGROUP [BTS_MsgBox_FG2]  
SET @CommandBuffer = N'ALTER DATABASE [BizTalkMsgBoxDb] ADD FILE ( NAME = N''BizTalkMsgBoxDb_FG1'', FILENAME = N''' + @FG2_Path +   
N'BizTalkMsgBoxDb_FG2.ndf'' , SIZE = 102400KB , MAXSIZE = UNLIMITED, FILEGROWTH = 10240KB ) TO FILEGROUP [BTS_MsgBox_FG2]'  
EXECUTE (@CommandBuffer)  
  
ALTER DATABASE [BizTalkMsgBoxDb] ADD FILEGROUP [BTS_MsgBox_FG3]  
SET @CommandBuffer = N'ALTER DATABASE [BizTalkMsgBoxDb] ADD FILE ( NAME = N''BizTalkMsgBoxDb_FG1'', FILENAME = N''' + @FG3_Path +   
N'BizTalkMsgBoxDb_FG3.ndf'' , SIZE = 102400KB , MAXSIZE = UNLIMITED, FILEGROWTH = 10240KB ) TO FILEGROUP [BTS_MsgBox_FG3]'  
EXECUTE (@CommandBuffer)  
  
ALTER DATABASE [BizTalkMsgBoxDb] MODIFY FILE ( NAME = N'BizTalkMsgBoxDb_log', SIZE = 10240KB , MAXSIZE = UNLIMITED, FILEGROWTH = 10240KB )  
  
GO -- Completes the previous batch, as necessary  
```  
  
 <span data-ttu-id="87170-227">既定のファイル グループとして特定のファイル グループを設定するのには、次のサンプル SQL スクリプトを使用できます。</span><span class="sxs-lookup"><span data-stu-id="87170-227">The sample SQL script below could be used to set a particular filegroup as the default filegroup:</span></span>  
  
```  
USE [BizTalkMsgBoxDb]  
GO  
declare @isdefault bit  
SELECT @isdefault=convert(bit, (status & 0x10)) FROM sysfilegroups WHERE groupname=N'BTS_MsgBox_FG1'  
if(@isdefault=0)  
ALTER DATABASE [BizTalkMsgBoxDb] MODIFY FILEGROUP [BTS_MsgBox_FG1] DEFAULT  
GO  
```  
  
 <span data-ttu-id="87170-228">スクリプトの利点は、スクリプトに複数のタスクをすばやく実行することができますし、正確に再現することができ、人的ミスの可能性を減らすことです。</span><span class="sxs-lookup"><span data-stu-id="87170-228">The advantage to scripting is that scripts can perform multiple tasks quickly, can be reproduced precisely, and reduce the possibility of human error.</span></span> <span data-ttu-id="87170-229">スクリプトの欠点は、スクリプトが正しく記述の実行が最初から再度構成する BizTalk Server データベースが必要になる重大な問題になることができます可能性があります。</span><span class="sxs-lookup"><span data-stu-id="87170-229">The disadvantage of scripting is that the execution of an incorrectly written script can potentially cause serious problems that could require the BizTalk Server databases to be re-configured from scratch.</span></span> <span data-ttu-id="87170-230">そのためが最も重要な要素をこのトピックで示すサンプル スクリプトなどの SQL スクリプトは、十分にテスト、運用環境で実行する前にします。</span><span class="sxs-lookup"><span data-stu-id="87170-230">Therefore, it is of utmost importance that SQL scripts such as the sample script listed in this topic are thoroughly tested before being executed in a production environment.</span></span>