---
title: 'チェックリスト: HYPER-V のパフォーマンスの測定 |Microsoft ドキュメント'
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: f32c95f4-a4eb-412b-9fa7-140e80b85e5a
caps.latest.revision: ''
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 6aefa415bec4b996fa7b5cd4689c48f834dc36a2
ms.sourcegitcommit: 8418b1a8f38b7f56979cd6e203f0b591e2f40fe1
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/28/2018
---
# <a name="checklist-measuring-performance-on-hyper-v"></a>チェックリスト: HYPER-V のパフォーマンスの測定
コレクション メソッドの多くは、HYPER-V 仮想マシンのパフォーマンスにインストールされているゲスト オペレーティング システムのパフォーマンスを分析する場合の原則のほとんどは、同じ物理コンピューターにインストールされているオペレーティング システムのパフォーマンスを分析するが、します。異なる。 以下のセクションでは、HYPER-V 仮想マシンにインストールされているゲスト オペレーティング システムで実行されている BizTalk Server ソリューションのパフォーマンスを評価するときに、クイック リファレンスとして使用してください。  
  
## <a name="measuring-disk-io-performance"></a>ディスク I/O パフォーマンスの測定  
 HYPER-V 仮想マシンにインストールされているゲスト オペレーティング システム上のディスク I/O パフォーマンスを測定するのにには、次のパフォーマンス モニター カウンターを使用します。  
  
|手順|リファレンス|  
|----------|---------------|  
|**HYPER-V ホストのオペレーティング システム上のディスク待機時間を計測**–"\Logical ディスク (*) \Avg を使用して HYPER-V ホストのオペレーティング システムでディスク パフォーマンスの初期最善の指標が取得されます。Disk sec/Read” and “\Logical Disk(\*)\Avg.Disk Sec/write"パフォーマンス モニター カウンターです。 これらのパフォーマンス モニター カウンターでは、読み取りし、書き込み操作に、オペレーティング システムに応答する時間を時間を測定します。 一般的な則として使うより大きい平均応答時間が最適と見なされます。 一般的な則として使うより大きい平均応答時間が最適と見なされます。 これは、基にして、一般的なシーク 7,200 RPM ディスク キャッシュなしの時間。 Windows アプリケーションとサービスは、オペレーティング システムに表示される物理ディスク (LUN) を指定できます、ドライブ文字として表される論理ドライブを利用しているために、物理ディスクのパフォーマンス モニター カウンターではなく、論理ディスクの使用は推奨します。ディスク配列内の複数の物理ディスク ドライブで構成されます。 \Logical ディスクを使用して HYPER-V ホストのオペレーティング システム上のディスク待機時間を測定するときに、次を大まかな目安を使用して (\*) \Avg です。Disk sec/Read or \Logical Disk(\*)\Avg.ディスク書き込み秒数パフォーマンス モニター カウンター:<br /><br /> これは、基にして、一般的なシーク 7,200 RPM ディスク キャッシュなしの時間。 Windows アプリケーションとサービスは、オペレーティング システムに表示される物理ディスク (LUN) を指定できます、ドライブ文字として表される論理ドライブを利用しているために、物理ディスクのパフォーマンス モニター カウンターではなく、論理ディスクの使用は推奨します。ディスク配列内の複数の物理ディスク ドライブで構成されます。 \Logical ディスクを使用して HYPER-V ホストのオペレーティング システム上のディスク待機時間を測定するときに、次を大まかな目安を使用して (\*) \Avg です。Disk sec/Read or \Logical Disk(\*)\Avg.ディスク書き込み秒数パフォーマンス モニター カウンター:<br /><br /> -1 ミリ秒に使う Healthy を =<br />-使うを 25 = 警告またはモニター<br />-26ms 以上 ="重大"、パフォーマンスが悪影響を受ける**注:**非仮想化環境にインストールされている物理ディスクが HYPER-V ホストのオペレーティング システムを介してアクセス ディスクよりも優れたパフォーマンスを提供します。 ディスクのパフォーマンスは、アプリケーションの全体的なパフォーマンスが重要ですが、のみ、物理ハードウェア上のディスクをホストしていることを検討してください。 **注:**ディスク I/O のパフォーマンスを評価するときに評価している任意のディスク パーティションのスキャンを除外するウイルス対策ソフトウェアを構成することを確認してください。 ウイルス対策スキャンには、パフォーマンスとのずれのテスト結果に悪影響のオーバーヘッドが導入されています。 <br /><br /> **ゲスト オペレーティング システム上のディスク待機時間を計測**– オペレーティング HYPER-V ホストによって使用されるディスクの応答時間を測定するために使用されている、同じパフォーマンス モニター カウンターを使用して、ゲスト オペレーティング システムで使用されているディスクの応答時間を測定することができますシステムです。|ディスク パフォーマンス分析の詳細については、次のリソースを参照してください。<br /><br /> -「を実行している SQL Server 2008 in a Hyper-v 環境 – ベスト プラクティスとパフォーマンスに関する考慮事項」ホワイト ペーパーの「HYPER-V で実行されている SQL Server のパフォーマンスのオーバーヘッド」セクション[ http://go.microsoft.com/fwlink/?LinkId=144622](http://go.microsoft.com/fwlink/?LinkId=144622)です。<br />-でのディスク バインドの問題は除きます[ http://go.microsoft.com/fwlink/?LinkId=120947](http://go.microsoft.com/fwlink/?LinkId=120947)です。<br />SQL Server の展開前 I/O のベスト プラクティスとで[ http://go.microsoft.com/fwlink/?LinkId=120948](http://go.microsoft.com/fwlink/?LinkId=120948)です。<br />-の「I/O ボトルネック」セクションで、"Troubleshooting Performance Problems in SQL Server 2008" に関するホワイト ペーパーで使用可能な[ http://go.microsoft.com/fwlink/?LinkID=202135](http://go.microsoft.com/fwlink/?LinkID=202135)です。<br />-ツールを使用して、Microsoft サーバー パフォーマンス アドバイザー (SPA) でディスク パフォーマンスのボトルネックを特定する方法[ http://go.microsoft.com/fwlink/?LinkID=98096](http://go.microsoft.com/fwlink/?LinkID=98096)です。|  
  
## <a name="measuring-memory-performance"></a>メモリ パフォーマンスの測定  
 使用可能なメモリ、HYPER-V 仮想マシンにインストールされているゲスト オペレーティング システムのパフォーマンスに影響を測定するのにには、次のパフォーマンス モニター カウンターを使用します。  
  
|手順|リファレンス|  
|----------|---------------|  
|**HYPER-V ホストのオペレーティング システムで使用できるメモリを測定**– で"\Memory\Available 領域のメガバイト数"パフォーマンス モニター カウンターを監視することによって、HYPER-V ホストのオペレーティング システムを使用できる物理メモリの量を決定できます、物理コンピューター。 このカウンターは、ホスト オペレーティング システムを使用できる無料の物理メモリの量を報告します。 ホスト オペレーティング システムで使用できる使用可能な物理メモリを評価するときに、次の経験則を使用します。<br /><br /> <ul><li>**\Memory\Available Mbytes** – Available MBytes は、コンピューターにインストールされている物理メモリの割合として、コンピューターで実行されているプロセスに使用できる物理メモリの量を測定します。 このパフォーマンス モニター カウンターの値を測定するときに、次のガイドラインが適用されます。<br /><br /> <ul><li>使用可能な空きメモリの 50% より = 正常または</li><li>使用可能な空きメモリの 25% = モニター</li><li>使用可能な空きメモリの 10% = 警告</li><li>使用可能な空きメモリの 5% 未満 ="重大"、パフォーマンスが悪影響を受ける</li></ul></li><li>**\Memory\Pages/sec** – このパフォーマンス モニター カウンターをページの読み取りまたはハード ページ フォールトを解決するのにはディスクに書き込まれる速度を測定します。 ハード ページ フォールトを解決するには、オペレーティング システムがディスクで、パフォーマンスが低下するためのメモリの内容を交換する必要があります。 使用可能な物理メモリの不足との相関関係の 1 秒あたりのページ数が高には、物理メモリの不足を可能性があります。 このパフォーマンス モニター カウンターの値を測定するときに、次のガイドラインが適用されます。<br /><br /> <ul><li>500 未満 = 正常</li><li>500 ~ 1000 = モニターまたは注意が必要</li><li>1,000 を超える ="重大"、パフォーマンスが悪影響を受ける</li></ul></li></ul><br /> **ゲスト オペレーティング システムで使用できるメモリを測定**– ゲスト オペレーティング システムを使用可能なメモリは、HYPER-V ホストのオペレーティング システムを使用可能なメモリを測定するために使用されている、同じパフォーマンス モニター カウンターで測定できます。|アプリケーション サーバーのパフォーマンス上の使用可能な物理メモリの影響に関する詳細についてで Exchange Server 2003 のヘルプ トピック「ルールをメモリ バインドに関する問題」を参照してください。 [ http://go.microsoft.com/fwlink/?LinkId=121056](http://go.microsoft.com/fwlink/?LinkId=121056)です。|  
  
## <a name="measuring-network-performance"></a>ネットワーク パフォーマンスの測定  
 HYPER-V では、ゲスト コンピューターが同じ物理ネットワーク アダプターを共有できます。 これにより、ハードウェアを統合する、中にしないように注意、物理アダプターが飽和状態です。 次のメソッドを使用して、HYPER-V 仮想マシンで使用されるネットワークの正常性を確認してください。  
  
|手順|リファレンス|  
|----------|---------------|  
|**テスト ネットワークの待機時間**|適切なネットワーク待機時間を確認するには、各仮想マシンに ping を実行します。 1 ミリ秒未満を受信することがローカル エリア ネットワーク上の応答時間。|  
|**パケット損失のテスト**|Pathping.exe ユーティリティを使用すると、仮想マシン間でパケットの損失をテストできます。 Pathping.exe がネットワークでのパケット損失を測定し、すべてのバージョンのでは利用[!INCLUDE[btsWinNoVersion](../includes/btswinnoversion-md.md)]ため[!INCLUDE[btsWin2kSvr](../includes/btswin2ksvr-md.md)]です。 Pathping.exe は大量のネットワークの各ノードに 100 回の ping 要求を送信し、ping の数が返されますを計算します。 ローカル エリア ネットワークで必要がありますいない pathping.exe ユーティリティからの ping 要求が失われる。|  
|**テスト ネットワークのファイル転送**|仮想マシン間で 100 MB のファイルをコピーし、コピーが完了するために必要な時間の長さを測定します。 正常な 100 mbit 上 (メガビット) のネットワーク 10 ~ 20 秒で 100 MB (メガバイト) ファイルをコピーする必要があります。 1 ギガ ビットの正常なネットワークで 100 MB のファイルは、約 3 ~ 5 秒にコピーしなければなりません。 これらのパラメーターの外部でコピー時間は、ネットワークの問題を示しています。 不適切なネットワーク転送の 1 つの一般的な原因の場合は、ネットワーク アダプターがある「自動検出」、10 MB の半二重ネットワークするネットワーク アダプターが使用できる帯域幅をフル活用することができません。|  
|**HYPER-V ホストのオペレーティング システム上のネットワークの使用率のメジャー**|HYPER-V ホストのオペレーティング システム上のネットワーク使用率を測定するのにには、次のパフォーマンス モニター カウンターを使用します。<br /><br /> **\Network Interface(\*)\Bytes Total/sec** – The percentage of network utilization is calculated by multiplying Bytes Total/sec by 8 to convert it to bits, multiply the result by 100, then divide by the network adapter’s current bandwidth. ネットワーク帯域幅の使用率を評価するのにには、次のしきい値を使用します。<br /><br /> -使用されたインターフェイスの 40% 未満 Healthy を =<br />-41 ~ 64% 使用されたインターフェイスのモニターまたは注意を =<br />~ 65 ~ 100% 消費されるインターフェイスの ="重大"、パフォーマンスが悪影響を受ける<br /><br /> **\Network Interface(\*)\Output Queue Length** – The output queue length measures the number of threads waiting on the network adapter. ネットワーク アダプターで待機している 2 つ以上のスレッドがある場合、ネットワーク可能性があります、ボトルネックになっています。 これの一般的な原因は、不適切なネットワーク待機時間やネットワーク上の高い衝突率がします。 出力キューの長さを評価するのにには、次のしきい値を使用します。<br /><br /> -0 = 正常<br />-1-2 = モニターまたは注意が必要<br />2 より大きい ="重大"、パフォーマンスが悪影響を受けます。<br /><br /> 最大転送単位 (MTU) に同じ値を使用するソリューションのすべてのコンピューター (物理およびバーチャル) のネットワーク アダプターが構成されていることを確認します。 MTU 値を構成する方法の詳細についてを参照してください「付録 a: TCP/IP 構成パラメーター」 [ http://go.microsoft.com/fwlink/?LinkId=113716](http://go.microsoft.com/fwlink/?LinkId=113716)です。<br /><br /> 2 以上の出力キューの長さは、測定される場合は、仮想マシンをホストする物理コンピューターに 1 つまたは複数の物理ネットワーク アダプターを追加するを検討し、ゲスト オペレーティング システムでこれらの物理ネットワーク アダプターを使用するネットワーク アダプターにバインドします。|  
|**ゲスト オペレーティング システムでメジャーのネットワーク使用率**|どの仮想ネットワークを識別する"\Hyper-V 仮想ネットワーク アダプター (*) \Bytes/sec"パフォーマンス モニター カウンターの使用を検討し、HYPER-V は、ルート パーティション上のネットワーク アダプターが上記で説明した、パフォーマンス モニター カウンターによって示されるビジー状態である場合は、アダプターは、ほとんどのネットワーク使用率を消費しています。|  
  
 ネットワークのパフォーマンス分析の詳細についてを参照してください「章 15-測定 .NET アプリケーション パフォーマンス」 [ http://go.microsoft.com/fwlink/?LinkId=121073](http://go.microsoft.com/fwlink/?LinkId=121073)です。  
  
## <a name="measuring-processor-performance"></a>プロセッサ パフォーマンスの測定  
 HYPER-V 仮想マシンにインストールされているゲスト オペレーティング システムでプロセッサのパフォーマンスを評価するのに、次のメソッドを使用します。  
  
-   **ゲスト オペレーティング システムのプロセッサ使用率の測定**を使用するプロセッサのパフォーマンスを測定できます従来、"\Processor(*)\\% Processor Time"カウンターのパフォーマンス監視します。 これは、HYPER-V を計測して、仮想マシンに割り当てられているプロセッサの数に対してこの値を報告するためもゲスト オペレーティング システムのプロセッサ使用率を評価するため、正確なカウンターではありません。 各ゲスト オペレーティング システムによって返される値が実際には、物理コンピューターをよりも、仮想マシンを実行するのより多くのプロセッサが割り当てられている場合、"\Processor (\*)\\% Processor Time"カウンターのパフォーマンス監視実際には、プロセッサ使用率は、ボトルネックになっている場合でもは、少なくなります。 これは、仮想プロセッサ、ラウンド ロビン方式で物理プロセッサを利用するために発生します。 各仮想プロセッサとなります自体の全体的なシステム リソースの共有を割り当てるため、4 つの物理プロセッサ システムでシステム リソースの 25% を利用しようと既定では、各仮想プロセッサです。 8 個の仮想プロセッサ作成つまりをまとめて仮想プロセッサは、サーバーの CPU 容量の 200% を利用しようとします。 各仮想プロセッサがで測定された使用率の低いを報告するここで、"\Processor (\*)\\% Processor Time"(、予想されるレベル) への相対パフォーマンス モニター カウンターおよびコンテキストの過度の切り替え、仮想プロセッサと、各仮想マシンのパフォーマンスの低下が発生します。 このシナリオでは、ホスト オペレーティング システム上の HYPER-V 仮想マシンに割り当てられた仮想プロセッサの数を減らすことを検討してください。HYPER-V では、ハイパーバイザー両方論理プロセッサと仮想プロセッサのパフォーマンスを監視するパフォーマンス オブジェクトを提供します。 論理プロセッサのプロセッサまたは物理コンピューターにインストールされているコアの数に直接関連しています。 たとえば、2 つのクアッド コア プロセッサ、物理コンピューターにインストールされているは 8 の論理プロセッサに相関します。 仮想プロセッサがどのような仮想マシンを実際に使用、および仮想プロセッサ ルートと子パーティション内のすべての実行が発生します。  
  
     HYPER-V では、ハイパーバイザー両方論理プロセッサと仮想プロセッサのパフォーマンスを監視するパフォーマンス オブジェクトを提供します。 論理プロセッサのプロセッサまたは物理コンピューターにインストールされているコアの数に直接関連しています。 たとえば、2 つのクアッド コア プロセッサ、物理コンピューターにインストールされているは 8 の論理プロセッサに相関します。 仮想プロセッサがどのような仮想マシンを実際に使用、および仮想プロセッサ ルートと子パーティション内のすべての実行が発生します。  
  
     正確に測定するためにゲスト オペレーティング システムのプロセッサ使用率を使用して、"HYPER-V ハイパーバイザー論理 processor (_total) % の合計実行時間"HYPER-V ホストのオペレーティング システムのパフォーマンス モニター カウンターです。 次のしきい値を使用してゲスト オペレーティング システム プロセッサ使用率を使用して評価を"HYPER-V ハイパーバイザー論理 processor (_total) % の合計実行時間"パフォーマンス カウンターの監視。  
  
    -   60% 未満が消費される健全を =  
  
    -   60%-89% 消費されるモニターまたは注意を =  
  
    -   90 ~ 100% 消費 ="重大"、パフォーマンスが悪影響を受ける  
  
     HYPER-V 環境でのゲスト オペレーティング システムのプロセッサのパフォーマンスをトラブルシューティングするをお勧めのホスト オペレーティング システムにより報告された値の間のバランスを目指しています"\Hyper-V ハイパーバイザー論理 processor (_total)\\% の合計の実行Time"(します) と"\Hyper-V ハイパーバイザー仮想 processor (_total)\\% の合計実行時間"(VPTR)。 しますが高いと VPTR が少ない場合、物理コンピューター上に物理的に使用できるよりも、仮想マシンに割り当てられているより多くのプロセッサがないことを確認します。 使用して、"\Hyper-V ハイパーバイザー仮想 Processor(*)\\ゲストの実行時間の割合"仮想プロセッサを決定するためのカウンターが CPU を消費しているし、仮想プロセッサの一対一マッピングの構成に該当する仮想マシンからの割り当てを解除論理プロセッサに仮想プロセッサです。 仮想プロセッサと論理プロセッサの一対一マッピングの構成に関する詳細についてを参照してください「プロセッサのパフォーマンスを最適化する」[チェックリスト: HYPER-V でのパフォーマンスの最適化](~/technical-guides/checklist-optimizing-performance-on-hyper-v.md)です。 VPTR が高いとしますが少ない場合、使用可能な論理プロセッサがある場合、および追加のプロセッサがゲスト オペレーティング システムでサポートされている場合、仮想マシンに追加のプロセッサを割り当てるを検討します。 物理コンピューターに追加の仮想マシンを追加することでスケール アウトを検討してください VPTR が高い場合、しますが、低、割り当てるには、使用可能な論理プロセッサがあるが、追加のプロセッサがゲスト オペレーティング システムでサポートされていないとこれらの仮想マシンに使用可能なプロセッサを割り当てました。 VPTR およびしますの両方が高い場合は、構成は、物理コンピューターの制限のプッシュが、別の物理コンピューターとその他の HYPER-V 仮想マシンを環境に追加することでスケール アウトを検討してください。 次のフローチャートでは、HYPER-V 環境でのプロセッサのパフォーマンスのトラブルシューティングを行うときに使用するプロセスについて説明します。  
  
     VPTR が高しますが少ない場合は、使用可能な論理プロセッサがある場合、および追加のプロセッサがゲスト オペレーティング システムでサポートされている場合、仮想マシンに追加のプロセッサを割り当てるを検討します。 物理コンピューターに追加の仮想マシンを追加することでスケール アウトを検討してください VPTR が高い場合、しますが、低、割り当てるには、使用可能な論理プロセッサがあるが、追加のプロセッサがゲスト オペレーティング システムでサポートされていないとこれらの仮想マシンに使用可能なプロセッサを割り当てました。 VPTR およびしますの両方が高い場合は、構成は、物理コンピューターの制限のプッシュが、別の物理コンピューターとその他の HYPER-V 仮想マシンを環境に追加することでスケール アウトを検討してください。 次のフローチャートでは、HYPER-V 環境でのプロセッサのパフォーマンスのトラブルシューティングを行うときに使用するプロセスについて説明します。  
  
     ![ハイパースレッディングの CPU パフォーマンスのトラブルシューティング&#45;V](../technical-guides/media/623fdcd6-e80b-4ba9-bf46-5d9b92b6612b.gif "623fdcd6-e80b-4ba9-bf46-5d9b92b6612b")  
HYPER-V 環境での CPU パフォーマンスのトラブルシューティング  
  
    > [!NOTE]  
    >  **ゲスト オペレーティング システムのプロセッサには、物理プロセッサまたはコアをセット アフィニティはありません。** –、ハイパーバイザーは、物理リソースを定義を使用します。 プロセッサ使用率の場合は、ハイパーバイザーは、スレッドの形式で物理的なプロセッサにゲスト プロセッサ時間をスケジュールします。 これは、仮想マシンのプロセッサの負荷分散が物理コンピューターのプロセッサを意味します。 さらに、仮想マシンが構成される 2 つの論理プロセッサを持つコア/8 プロセッサ、物理コンピューター上で実行する単一の仮想マシンが構成されている場合などの論理プロセッサ数のプロセッサ使用率を超えることはできません、仮想マシンは、構成されている論理プロセッサ数 (ここでは 2 つのプロセッサ) のプロセッサの能力を超えることはできません。  
  
-   **HYPER-V は、パフォーマンスを使用して HYPER-V 環境全体のプロセッサ使用率を測定するカウンターの監視**のプロセッサ使用率を測定するための目的で、ホスト オペレーティング システムが論理的として表示される単なる別のゲスト オペレーティング システム. したがって、"\Processor(*)\\% Processor Time"カウンターの監視が、ホストのオペレーティング システムに対してのみのプロセッサ使用率を測定します。 ホスト オペレーティング システムとすべてのゲスト オペレーティング システムの物理プロセッサの合計使用率を測定するを使用して、"\Hyper-V ハイパーバイザー論理 processor (_total)\\% の合計実行時間"パフォーマンス モニター カウンターです。 このカウンタは、両方のホスト オペレーティング システムを実行しているプロセッサで費やされた時間の合計割合を測定し、すべてのゲスト オペレーティング システムです。  
  
     次のしきい値を使用して、HYPER-V を使用して環境の全体的なのプロセッサ使用率を評価、"\Hyper-V ハイパーバイザー論理 processor (_total)\\% の合計実行時間"パフォーマンス カウンターの監視。  
  
    -   60% 未満が消費される健全を =  
  
    -   60%-89% 消費されるモニターまたは注意を =  
  
    -   90 ~ 100% 消費 ="重大"、パフォーマンスが悪影響を受ける  
  
     プロセッサ使用率の詳細については、次のリソースを確認します。  
  
    -   "する方法: 運用環境でのサーバー アプリケーションの高いユーザー モード CPU のボトルネックの発生した関数を識別する"で[ http://go.microsoft.com/fwlink/?LinkID=107047](http://go.microsoft.com/fwlink/?LinkID=107047)です。  
  
    -   「章 15 - .NET アプリケーション パフォーマンスを測定」 [ http://go.microsoft.com/fwlink/?LinkId=121073](http://go.microsoft.com/fwlink/?LinkId=121073)です。