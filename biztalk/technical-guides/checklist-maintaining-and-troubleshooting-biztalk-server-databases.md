---
title: "チェックリスト: を維持し、BizTalk Server データベースのトラブルシューティング |Microsoft ドキュメント"
ms.custom: 
ms.date: 06/29/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 58931faf-fc84-46fe-8359-506da94c3756
caps.latest.revision: "4"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 3e5ef7cdc4fb136a9fc80b04a04cdbe4f1e064e3
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/20/2017
---
# <a name="checklist-maintaining-and-troubleshooting-biztalk-server-databases"></a>チェックリスト: を維持し、BizTalk Server データベースのトラブルシューティング
[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]データベースとその正常性は、適切な非常に重要な[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]メッセージング環境のデータベースです。 このトピックには、メンテナンスとトラブルシューティングを行う必要があります手順が示されて、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]データベース。  
  
-   [BizTalk Server データベースの保守](../technical-guides/checklist-maintaining-and-troubleshooting-biztalk-server-databases.md#BKMK_MaintainDB)  
  
-   [BizTalk Server データベースのトラブルシューティング](../technical-guides/checklist-maintaining-and-troubleshooting-biztalk-server-databases.md#BKMK_Troubleshoot)  
  
<a name="BKMK_MaintainDB"></a>   
## <a name="maintaining-biztalk-server-databases"></a>BizTalk Server データベースの保守  
  
|手順|リファレンス|  
|-----------|---------------|  
|無効にする、**統計の自動更新**と**統計の自動作成**オプション (のみに適用できる[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]メッセージ ボックス データベース)。|**注:**の一部として既定ではこれらの設定が完了したら、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]構成します。 これらの設定に変更を加えないでください。 <br /><br /> 無効にする必要があります、**統計の自動作成**と**統計の自動更新**オプション。 これらの設定が無効になっているかどうかを判断するのには、SQL Server で次のストアド プロシージャを実行します。<br /><br /> exec sp_dboption 'BizTalkMsgBoxDB'、'統計の自動作成' exec sp_dboption 'BizTalkMsgBoxDB'、'自動 update statistics'<br /><br /> 返される値**CurrentSetting** OFF にする必要があります。 この値が返される場合は**CurrentSetting** on、SQL Server の次のストアド プロシージャを実行して、OFF に変更します。<br /><br /> exec sp_dboption 'BizTalkMsgBoxDB'、'統計の自動作成'、'off' exec sp_dboption 'BizTalkMsgBoxDB'、'統計の自動更新'、'off'<br /><br /> これらの設定の詳細については、次の Microsoft サポート技術情報記事を参照してください。<br /><br /> -   **917845**—[「するブロックが発生する、BizTalk Server で、BizTalkMsgBoxDb データベースに接続しようとすると、条件、またはその他の SQL Server の問題をデッドロック」](http://go.microsoft.com/fwlink/?LinkId=153429) (http://go.microsoft.com/fwlink/?LinkId=153429)。<br />-   **912262**—[「、自動統計更新オプション、自動統計の作成オプション、および並列処理の設定が、BizTalk Server BizTalkMsgBoxDB データベースをホストする SQL Server データベース インスタンスでになっている」](http://go.microsoft.com/fwlink/?LinkId=153430)(http://go.microsoft.com/fwlink/?LinkId=153430)。|  
|プロパティの並列処理の最大限度を設定します。|**注:**の一部として既定ではこれらの設定が完了したら、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]構成します。 これらの設定に変更を加えないでください。 <br /><br /> Max Degree of Parallelism 設定**run_value**と**config_value**プロパティに 1 つ (1) の値を[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]をホストするインスタンス、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]メッセージ ボックス データベースです。 並列処理の最大限度を確認して、次を実行するストアド プロシージャ、マスター _ に対してデータベース[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]:<br /><br /> exec sp_configure 'max degree of parallelism'<br /><br /> 場合、 **run_value**と**config_value**はありません (1) 1 つの値に設定は、SQL Server で次のストアド プロシージャを実行します。<br /><br /> exec sp_configure 'max degree of parallelism'、'1' の再構成の上書き<br /><br /> 並列処理の最大限度の影響の詳細については[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]、次の Microsoft サポート技術情報記事を参照してください。<br /><br /> -   **899000**—[「BizTalk Server を構成するときに、SQL Server のインスタンスの並列処理の設定」](http://go.microsoft.com/fwlink/?LinkId=153432) (http://go.microsoft.com/fwlink/?LinkId=153432)。<br />-   **917845**—[「するブロックが発生する、BizTalk Server で、BizTalkMsgBoxDb データベースに接続しようとすると、条件、またはその他の SQL Server の問題をデッドロック」](http://go.microsoft.com/fwlink/?LinkId=153429) (http://go.microsoft.com/fwlink/?LinkId=153429)。|  
|再構築するときに決定[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]インデックス|内のインデックスのほとんど[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]データベースはクラスター化 (インデックス ID: 1)。 DBCC SHOWCONTIG コマンドは、内のテーブルの断片化情報の表示を使用することができます、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]データベース。 これらのインデックスは、GUID ベースは、通常の断片化が発生するようにします。 DBCC SHOWCONTIG のスキャン密度の値が 30% 未満の場合に、ダウンタイム中にインデックスが再構築できます。 多数のテーブルの[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]データベースには、オンライン インデックス作成を実行できませんデータ型の定義を使用する列が含まれています。 そのため、内のテーブルのインデックス、 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] BizTalk がデータを処理中に、データベースをリビルドしない必要があります。 BizTalk のインデックスを再構築する方法の詳細については、次の Microsoft サポート技術情報記事を参照してください。<br /><br /> -   **917845**—[「するブロックが発生する、BizTalk Server で、BizTalkMsgBoxDb データベースに接続しようとすると、条件、またはその他の SQL Server の問題をデッドロック」](http://go.microsoft.com/fwlink/?LinkId=153429) (http://go.microsoft.com/fwlink/?LinkId=153429)。<br /><br /> インデックスの断片化とワークロードの種類の詳細については、ホワイト ペーパーを参照してください。 [Microsoft SQL Server 2000 インデックスの最適化に関するベスト プラクティス](http://go.microsoft.com/fwlink/?LinkId=101580)(http://go.microsoft.com/fwlink/?LinkId=101580)。 **注:**で断片化情報を探す sys.dm_db_index_physical_stats 関数を使用することもできます[!INCLUDE[btsSQLServer2005](../includes/btssqlserver2005-md.md)]と[!INCLUDE[btsSQLServer2008](../includes/btssqlserver2008-md.md)]です。 詳細については、次を参照してください。 [sys.dm_db_index_physical_stats (TRANSACT-SQL)](http://go.microsoft.com/fwlink/?LinkId=158493) (http://go.microsoft.com/fwlink/?LinkId=158493)。|  
|データベースのロック、ブロック、またはデッドロックの監視します。|予期される動作のロックおよびブロックで実行するのには、[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]によって使用されるデータベース[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]です。 ただし、これらのロックやブロックが長時間にわたってを続行するには必要ありません。 拡張をブロックおよびのデッドロック、[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]によって使用されるデータベース[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]潜在的な問題の指標であります。 デッドロックとでのブロックの原因は、現在の既知の[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]によって使用されるデータベース[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]、次の Microsoft サポート技術情報記事を確認します。<br /><br /> -   **917845**—[「するブロックが発生する、BizTalk Server で、BizTalkMsgBoxDb データベースに接続しようとすると、条件、またはその他の SQL Server の問題をデッドロック」](http://go.microsoft.com/fwlink/?LinkId=153429) (http://go.microsoft.com/fwlink/?LinkId=153429)。|  
|データベースとテーブルのサイズを監視します。|サイズ、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]メッセージ ボックス データベースは、主に超えるおよそ 5 GB です。  BizTalkMsgBoxDb データベースは、任意のデータを保持することはできませんし、データが処理または BizTalkDTADb データベースに移動するまでバッファーを考慮する必要があります。 強力な SQL Server のバックエンドと多数の長時間実行オーケストレーションを含む環境では、5 GB を超える BizTalkMsgBoxDb データベースがあります。 ありません長時間のオーケストレーションと頻度の高い環境が必要な[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]5 GB よりはるかに小さいメッセージ ボックス データベースです。 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]サイズを大幅に変更できる追跡データベースが、クエリのパフォーマンスが大幅に低下する場合、追跡データベースがおそらくが大きすぎます。 原則として、として、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]追跡データベースを超える 15 ~ 20 GB が大きすぎると見なされ、パフォーマンスに悪影響を及ぼす可能性があります。 次の問題に起因する場合があります[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]が大きすぎるデータベース。<br /><br /> -[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]メッセージ ボックス データベースがアプリケーションを大規模な状態に維持したまま、データのサイズ (ログ ファイルだけでなく) に増加し続けます。 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]単純なメッセージ フローのシナリオでも処理に通常よりも長い時間がかかります。<br />グループ ハブ クエリでは、通常よりも長い時間がかかるし、偶数のタイムアウトの可能性があります。<br />-データベースのログ ファイルは決して切り捨てられます。<br />-BizTalk SQL エージェント ジョブが通常よりも低速に実行します。<br />-一部のテーブルがかなり大きくまたは normal あまり多くの行を比較します。<br /><br /> [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]いくつかの理由を含むデータベースが大きくなることができます。<br /><br /> BizTalk SQL エージェント ジョブが実行されていません<br />-過度の保留メッセージやサービス インスタンス<br />ディスクの障害<br />-高レベルの追跡<br />-   [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]調整<br />-低下[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]パフォーマンス<br />ネットワーク待機時間に関する問題<br /><br /> 同様に、テーブルの行が多すぎることができます。 セットの数が多すぎて行はありません。 さらに、この行の数は、どのような種類のデータがテーブルに格納されているによって異なります。 たとえば、 *dta_DebugTrace*おそらく 100万を超える行を持つテーブルに行が多すぎます。 A *HostNameQ_Suspended*おそらく 200,000 台を超える行を持つテーブルに行が多すぎます。<br /><br /> 期待される環境でデータの問題が発生しているかどうかを決定するを理解していることを確認してください。|  
|追跡を有効にする[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]ホスト|既定では、既定のホストの追跡が有効にします。 BizTalk が必要です、**ホストの追跡を許可する**1 つのホストでオプションを確認します。 Tracking Data Decode Service (TDDS) が、追跡を移動の追跡を有効にするからのイベント データ、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]をメッセージ ボックス データベース、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]データベースを追跡します。 ない場合は[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]をオプションでホストが構成されている**ホストの追跡を許可する**や追跡ホストを停止すると、TDDS は実行されず TrackingData_x_x テーブル、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]メッセージ ボックス データベースがチェックされていない拡張. そのため、専用[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]をオプションでホストを構成する必要があります**ホストの追跡を許可する**です。 専用の追跡ホストの構成の詳細については、次を参照してください。[専用追跡ホストの構成](~/technical-guides/configuring-a-dedicated-tracking-host.md)です。 **注:**頻度の高いシナリオで新しい追跡イベントを維持するために TDDS を許可するのには、1 つの追跡ホストの複数のインスタンスを作成できますが、2 つ以上のホストは、追跡を構成してください。|  
|適切な BizTalk SQL Server エージェント ジョブを使用します。|実行、 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] SQL エージェント ジョブが管理するために重要な[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]データベースおよび最適なパフォーマンスを維持するためです。<br /><br /> -**バックアップ[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]**をバックアップする唯一のサポートされているメソッドは、SQL Server エージェント ジョブ、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]データベース。 このジョブでは、すべてを設定する必要があります[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]完全復旧モデルを使用するデータベース。 正常なは、このジョブを構成する必要があります[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]環境。 バックアップする SQL Server メソッドを使用することができます、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]データベースおよび SQL Server サービスが停止している場合にのみ、すべて[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]プロセスが停止します。 **注:** SQL エージェントのバックアップを構成するときに、SQL Server の完全復旧モデルを使用しての詳細については[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]ジョブを参照してください[ログ配布](http://go.microsoft.com/fwlink/?LinkId=153450)(http://go.microsoft.com/fwlink/?LinkId = 153450) または[完全復旧モデルでバックアップ](http://go.microsoft.com/fwlink/?LinkId=156509)(http://go.microsoft.com/fwlink/?LinkId = 156509)。<br />- **MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb** SQL Server エージェント ジョブが無期限に実行するように設計されています。 その結果、SQL エージェント ジョブ履歴ことは必ずしもこの SQL エージェント ジョブが正常に完了したことです。この動作は仕様です。 エラーがある場合、ジョブが 1 分以内に再起動し、低下の実行を継続します。 そのため、このジョブの障害の発生の通知は通常無視できます。 MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb SQL Server エージェント ジョブのジョブ履歴には、このジョブは常に失敗しました、再起動することが示されている場合、失敗/再起動サイクルの原因の詳細な調査必要があります。<br />- **MessageBox_Message_Cleanup_BizTalkMsgBoxDb** SQL Server エージェント ジョブはのみジョブを手動で有効にできません MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb ジョブによって開始されたためです。<br />- **DTA Purge and Archive** SQL Server エージェント ジョブを維持、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]消去および追跡メッセージをアーカイブして、データベースを追跡します。 このジョブは、テーブル内のすべての行を読み取るし、かどうか、レコードを削除するかを決定する各行のタイムスタンプを比較します。 **注:**トラブルシューティングを行うとき、 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] SQL Server エージェント ジョブでは、エラーなし、MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb を除くすべての SQL エージェント ジョブが完了することを確認してください。 <br /><br /> 詳細については、[!INCLUDE[btsBizTalkServer2006r3](../includes/btsbiztalkserver2006r3-md.md)]に使用される SQL エージェント ジョブ[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]:<br /><br /> -参照[データベース構造とジョブ](http://go.microsoft.com/fwlink/?LinkId=153451)(http://go.microsoft.com/fwlink/?LinkId=153451)。<br />-参照[BizTalk Server のジョブの SQL Server エージェントの説明](http://go.microsoft.com/fwlink/?LinkId=153452)(http://go.microsoft.com/fwlink/?LinkId=153452)。|  
|監視して中断されたインスタンスを終了します。|サービス インスタンスの中断 (再開可能) または中断 (再開不可) ことができます。 これらのサービス インスタンスには、メッセージング、オーケストレーション、またはポートがあります。 [!INCLUDE[btsBizTalkServer2006r3](../includes/btsbiztalkserver2006r3-md.md)][グループ ハブ] ページを使用して終了し、これらのインスタンスの削除に対応、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理コンソールまたは Terminate.vbs スクリプトを使用しています。 Terminate.vbs スクリプトの詳細については、次を参照してください。[中断サービス インスタンスを削除する](http://go.microsoft.com/fwlink/?LinkId=153453)(http://go.microsoft.com/fwlink/?LinkId=153453)。 **ヒント:**中断されたインスタンスを削除する、ターミネータ ツールを使用することもできます。 [ターミネータ ツール](http://go.microsoft.com/fwlink/?LinkId=151931)は、「 [http://go.microsoft.com/fwlink/?LinkId=151931](http://go.microsoft.com/fwlink/?LinkId=151931)です。 、Microsoft では、このツールの使用はサポートされていないと、Microsoft はこのプログラムの適合性に関して保証を行いません。 このプログラムは、ユーザー自身の責任で使用してください。 <br /><br /> 用語「孤立アイテム」と「ゾンビ」は、同じ意味で使用されます。 またはゾンビの孤立したメッセージは、メッセージがない関連付けられているサービス インスタンス、通常、メッセージを受け取る前に、サービス インスタンスが終了したためです。 孤立したやゾンビ サービスは、サービス、関連するメッセージがないです。 ゾンビ メッセージおよびサービス インスタンスの詳細については[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]を参照してください[BizTalk Server のゾンビ](http://go.microsoft.com/fwlink/?LinkId=153454)(http://go.microsoft.com/fwlink/?LinkId=153454)。|  
|パフォーマンス カウンターを監視、 **PhysicalDisk**パフォーマンス オブジェクト|[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]1 分以内で SQL Server への多数の非常に高速、短いトランザクションを作成します。 発生する可能性が場合は、SQL Server は、このアクティビティに耐えることはできません、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]パフォーマンスの問題です。 モニター、 **avg.Disk Sec/read**、 **avg.Disk Sec/transfer**、および**avg.ディスク書き込み秒数**パフォーマンス モニター カウンター、 **PhysicalDisk**パフォーマンス オブジェクトです。 最適な値は、10 ミリ秒未満 (ミリ秒) です。 以上 20 ミリ秒の値は、パフォーマンスの低下と見なされます。<br /><br /> -SQL Server 2005 のパフォーマンスに関する詳細についてを参照してください[SQL Server 2005 でのパフォーマンス問題のトラブルシューティング](http://go.microsoft.com/fwlink/?LinkID=153585)(http://go.microsoft.com/fwlink/?LinkID=153585)。<br />-SQL Server 2008 のパフォーマンスに関する詳細についてを参照してください[SQL Server 2008 でのパフォーマンス問題のトラブルシューティング](http://go.microsoft.com/fwlink/?LinkID=153586)(http://go.microsoft.com/fwlink/?LinkID=153586)。<br />、詳細については[!INCLUDE[btsBizTalkServer2006r3](../includes/btsbiztalkserver2006r3-md.md)]データベースの高可用性を参照してください[BizTalk Server データベースの高可用性の実現](http://go.microsoft.com/fwlink/?LinkId=153587)(http://go.microsoft.com/fwlink/?LinkId=153587)。<br /><br /> SQL Server のパフォーマンスの詳細については、次の Microsoft サポート技術情報記事を参照することもできます。<br /><br /> -   **298475** – [「SQL Server のパフォーマンスの問題をトラブルシューティングする方法」](http://go.microsoft.com/fwlink/?LinkId=153588) (http://go.microsoft.com/fwlink/?LinkId=153588)。<br />-   **271509** – [「SQL Server 2005 でのブロックを監視する方法」](http://go.microsoft.com/fwlink/?LinkId=153589) (http://go.microsoft.com/fwlink/?LinkId=153589)。|  
|ベスト プラクティスに従う[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]データベース。|参照してください[BizTalk Server データベースを維持するためのベスト プラクティス](~/technical-guides/best-practices-for-maintaining-biztalk-server-databases.md)です。|  
  
<a name="BKMK_Troubleshoot"></a>   
## <a name="troubleshooting-biztalk-server-databases"></a>BizTalk Server データベースのトラブルシューティング  
 に関する問題のトラブルシューティングを行うには、次のタスク実行[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]データベース。  
  
|手順|リファレンス|  
|-----------|---------------|  
|必要なすべての BizTalk SQL Server エージェント ジョブを有効にして実行されていることを確認します。|すべての BizTalk SQL Server エージェントのジョブを除く、 **MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb**ジョブ必要がありますで実行されていて正常にします。 その他の任意のジョブを無効にしないでください。<br /><br /> 障害が発生する場合を使用して、**履歴を表示する**SQL Server のエラー情報を表示し、それに応じて、失敗のトラブルシューティングのオプションです。 注意して、 **MessageBox _Message_ManageRefCountLog_BizTalkMsgBoxDb** SQL Server エージェント ジョブが無限に実行されます。 したがって、おく必要がありますのみジョブ ヒストリをレポート ジョブが常に失敗し、再起動するときは注意します。|  
|MsgBoxViewer ツールを使用して、BizTalk メッセージ ボックス データベースとその他のデータベースの分析|**重要:** Microsoft では、このツールの使用はサポートされていないと、Microsoft はこのプログラムの適合性に関して保証を行いません。 このプログラムは、ユーザー自身の責任で使用してください。 <br /><br /> MsgBoxViewer ツールはから利用可能な[http://go.microsoft.com/fwlink/?LinkId=151930](http://go.microsoft.com/fwlink/?LinkId=151930) (http://go.microsoft.com/fwlink/?LinkId=151930)。 MsgBoxViewer ツールは、テーブルのサイズと、行の数の詳細については、html 形式のレポートを提供するためのトラブルシューティングに役立ちます。 レポートにも役立ちますを決定するかどうか[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]調整です。 さらに、ツールは、のスナップショット、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]データベースおよび[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]構成します。<br /><br /> ときに[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]は MsgBoxViewer ツールを実行して、通常より時間がかかります実行上のすべてのクエリを選択する をクリックして、**省略可能なクエリ**タブをクリックし、問題に生成された HTML レポートを確認します。 **概要レポート**セクションには、黄色、および潜在的な問題は赤色で警告が一覧表示します。<br /><br /> さらに、テーブルは、最大規模およびほとんどのレコードがある判別を MsgBoxViewer ツールを使用することができます。 通常、larges を拡大テーブルの一覧とそれらのテーブルを管理する方法の手順を参照してください。 [BizTalk Server データベース テーブルの大きな増加](~/technical-guides/large-growing-biztalk-server-database-tables.md)です。|  
|ツールを使用して、終端記号の問題を解決 MsgBoxViewer ツールによって、識別された場合|**重要:** Microsoft では、このツールの使用はサポートされていないと、Microsoft はこのプログラムの適合性に関して保証を行いません。 このプログラムは、ユーザー自身の責任で使用してください。 <br /><br /> 使用可能なターミネータ ツールを実行して[ターミネータ](http://go.microsoft.com/fwlink/?LinkId=151931)(http://go.microsoft.com/fwlink/?LinkId=151931)。 このツールでは、簡単に BizTalk MsgBoxViewer ツールによって識別される問題を解決することができます。 ターミネータ ツールが、BizTalk MsgBoxViewer ツールと統合する方法の詳細については、次を参照してください。 [BizTalk MsgBoxViewer によって特定された問題を解決するには BizTalk のターミネータを使用して](http://go.microsoft.com/fwlink/?LinkId=151932)(http://go.microsoft.com/fwlink/?LinkId=151932)。|  
|デッドロックのシナリオを調査します。|シナリオでは、デッドロック、デッドロック情報が、SQLERROR ログに書き込まれるように、SQL Server 上で DBCC の追跡を有効にします。<br /><br /> SQL Server 2008 または SQL Server 2005 では、デッドロックのシナリオの DBCC トレースを有効にするのには、次のステートメントを実行します。<br /><br /> DBCC TRACEON (1222、-1)<br /><br /> PSSDIAG ユーティリティを使用してデータを収集する、 **Lock:deadlock**イベントおよび**Lock:deadlock Chain**イベント。 PSSDIAG ユーティリティの詳細については、次を参照してください。 [PSSDIAG データ収集ユーティリティ](http://go.microsoft.com/fwlink/?LinkId=153627)(http://go.microsoft.com/fwlink/?LinkId=153627)。<br /><br /> BizTalkMsgBoxDB データベースは、大量の高いトランザクション オンライン トランザクション処理 (OLTP) データベースです。 そのようなデータベースのデッドロックの一部が予想され、によって内部的に処理は、このデッドロック、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]エンジンです。 この現象が発生したときに、エラー ログでエラーは表示されません。 デッドロックのシナリオを調査するときに、出力で調査している場合、デッドロックする必要がありますと相関しているイベント ログでデッドロック エラーです。|  
|ブロックされたプロセスを探します|SQL Server の利用状況モニターを使用すると、ロックのシステム プロセスのサーバー プロセス識別子 (SPID) を取得します。 ロックの SPID で実行されている SQL ステートメントに SQL Profiler を実行することができます。 PSSDIAG ユーティリティを使用すると、SQL Server のロックおよびブロックしている問題をトラブルシューティングします。 ユーティリティは、有効になっているスクリプトのブロックを持つすべての TRANSACT-SQL イベントをキャプチャします。 PSSDIAG ユーティリティの詳細については、次を参照してください。 [PSSDIAG データ収集ユーティリティ](http://go.microsoft.com/fwlink/?LinkId=153627)(http://go.microsoft.com/fwlink/?LinkId=153627)。<br /><br /> SQL Server 2005 およびそれ以降のバージョンで指定できます、**プロセスのしきい値をブロック**SPID または Spid を指定したしきい値よりも長くブロックしているを確認する設定。 Blocked process threshold オプションの詳細については、次を参照してください。 [blocked process threshold オプション](http://go.microsoft.com/fwlink/?LinkId=153628)(http://go.microsoft.com/fwlink/?LinkId=153628)。 **注:**マイクロソフト カスタマー サポート サービスにお問い合わせくださいを SQL Server でのロックまたはブロックしている問題が発生した場合にお勧めします。 Microsoft カスタマー サポート サービスには、正しい PSSDiag ユーティリティのオプションを構成するのに役立ちます。|  
|すべての不要なデータを削除します。|データベースが大きくなりすぎたために拡大している場合、データベースに含まれるデータは必要ありませんできなくなった場合は、データを削除することをお勧めします。 **注意:**使用しないでくださいこのメソッドすべての環境でデータがビジネス上重要またはデータが必要なかどうかを格納します。 <br /><br /> **BizTalkMsgBox データベースを消去するには**<br /> 1.ダウンロードしてインストールでは、ターミネータ ツール[Biztalk 終端記号](http://go.microsoft.com/fwlink/?LinkId=220869)(http://go.microsoft.com/fwlink/?LinkId=220869)。<br />2.トピックの手順に従って[テスト環境でメッセージ ボックス データベースからデータを手動で消去する方法](http://go.microsoft.com/fwlink/?LinkID=158064)(http://go.microsoft.com/fwlink/?LinkID=158064) を作成、bts_CleanupMsgbox ストアド プロシージャを BizTalk メッセージ ボックス データベースです。<br />3.ターミネータ ツールを使用して、bts_CleanupMsgbox ストアド プロシージャを実行して、BizTalk メッセージ ボックス データベースを削除します。 **警告:** BizTalk Server を実行している実稼働サーバーで、bts_CleanupMsgbox ストアド プロシージャを実行しないでください。 bts_CleanupMsgbox ストアド プロシージャは、テスト環境でのみ実行してください。 運用環境での bts_CleanupMsgbox ストアド プロシージャの実行はサポートされていません。<br />4.すべてのホストを再起動し、 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] services です。<br /><br /> **BizTalkDTADb データベースを消去するには**<br /> <ul><li>**方法 1**<br /><br /> <ol><li>すべてをバックアップ[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]データベース。</li><li>実行、 **[dtasp_purgeallcompletedtrackingdata]**ストアド プロシージャです。 ストアド プロシージャの詳細については、次を参照してください。 [BizTalk 追跡データベースからデータを手動で消去する方法](http://go.microsoft.com/fwlink/?LinkId=153635)(http://go.microsoft.com/fwlink/?LinkId=153635)。</li></ol></li><li>**方法 2**です。 BizTalkDTADb データベースには、削除する必要がある多くの不完全なインスタンスが含まれている場合にのみ、このオプションを使用します。<br /><br /> <ol><li>すべてをバックアップ[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]データベース。</li><li>すべての BizTalk ホスト、サービス、およびカスタム分離アダプターを停止します。 HTTP アダプタまたは SOAP アダプタを使用する場合は、IIS サービスを再起動します。</li><li>実行、 **dtasp_CleanHMData** BizTalkDTADb データベースでストアド プロシージャです。</li><li>すべてのホストを再起動し、 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] services です。</li></ol></li></ul> **注:**場合は、追跡データを BizTalkDTADb データベースをバックアップする必要がありますを別の SQL サーバー データベースを復元し、元の BizTalkDTADb データベースを削除します。|  
  
 ヘルプ MsgBoxViewer データまたは PSSDIAG 出力を分析する場合は、マイクロソフト カスタマー サポート サービスにお問い合わせください。 カスタマー サポート サービスに問い合わせる前に、MsgBoxViewer データ、PSSDIAG 出力、および更新後のイベント ログ (.evt ファイル) を圧縮します。 これらのファイルを送信する必要があります、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]サポート エンジニア  
  
## <a name="in-this-section"></a>このセクションの内容  
  
-   [BizTalk Server データベースを維持するためのベスト プラクティス](~/technical-guides/best-practices-for-maintaining-biztalk-server-databases.md)  
  
-   [BizTalk Server データベース テーブルの大規模な成長](~/technical-guides/large-growing-biztalk-server-database-tables.md)  
  
-   [ツールとユーティリティのトラブルシューティング](../technical-guides/tools-and-utilities-for-troubleshooting.md)  
  
## <a name="see-also"></a>参照  
 [SQL Server の設定を変更しないでください。](~/technical-guides/sql-server-settings-that-should-not-be-changed.md)