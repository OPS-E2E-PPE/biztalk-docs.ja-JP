---
title: システム レベルのボトルネック |Microsoft ドキュメント
ms.custom: ''
ms.date: 06/29/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 0bdff435-76eb-495f-9fb6-1f1acef3921e
caps.latest.revision: 11
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 058fd60e1c38a3045197b4a36bdcc81250ab5be5
ms.sourcegitcommit: 8418b1a8f38b7f56979cd6e203f0b591e2f40fe1
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/23/2018
ms.locfileid: "22302986"
---
# <a name="system-level-bottlenecks"></a>システム レベルのボトルネック
このトピックでは、BizTalk Server ソリューションのパフォーマンスに影響する一般的なシステム レベルのボトルネックに対処する方法について説明します。  
  
## <a name="creating-a-snapshot-of-the-baseline-configuration"></a>ベースライン構成のスナップショットを作成します。  
 次の情報の収集を修正するシステム レベルのボトルネックに支援するために使用できるベースライン構成のスナップショットを提供できます。  
  
### <a name="gather-documentation"></a>ドキュメントを収集します。  
 アーキテクチャおよびシナリオのインフラストラクチャのドキュメントを確認します。  
  
### <a name="run-the-baseline-security-analyzer"></a>Baseline Security Analyzer を実行します。  
 Baseline Security Analyzer を実行する手順に従います。  
  
1.  ダウンロード、 [Microsoft Baseline Security Analyzer 2.2](http://go.microsoft.com/fwlink/?LinKID=204006) (http://go.microsoft.com/fwlink/?LinkId=204006)です。  
  
2.  ドメイン管理者アカウントを使用して、BizTalk Server と SQL Server コンピューターをホストしていると同じネットワーク上のコンピューターにログオンします。  
  
3.  (たとえば、BizTalk Server コンピューターまたは別のコンピューターの 1 つ)、現在のコンピューターに Microsoft Baseline Security Analyzer をインストールします。  
  
4.  別のスキャンを実行 (**スキャンの開始**)、または BizTalk Server と SQL Server の各コンピューターの IP アドレスをパラメーターとして指定します。  
  
5.  %Userprofile%\SecurityScans ディレクトリから各セキュリティ レポート (.mbsa ファイル) をコピーします。  
  
### <a name="run-the-biztalk-server-best-practices-analyzer"></a>BizTalk Server のベスト プラクティス アナライザーを実行します。  
 BizTalk Server のベスト プラクティス アナライザーを実行する手順に従います。  
  
1.  ダウンロード、 [BizTalk Server のベスト プラクティス アナライザー v1.2](http://go.microsoft.com/fwlink/?LinkID=83317) (http://go.microsoft.com/fwlink/?LinkID=83317)です。  
  
2.  BizTalk Server 管理者セキュリティ グループの一部であるユーザー アカウントを使用して、BizTalk Server のノードにログオンします。  
  
3.  現在のコンピューターに BizTalk Server のベスト プラクティス アナライザーをインストールします。  
  
4.  ツールを実行し、レポートを保存します。  
  
### <a name="run-msinfo32-and-save-the-results"></a>MSInfo32 を実行し、結果の保存  
 MSInfo32 を実行する手順に従います。  
  
1.  ドメインまたはローカルの管理者アカウントを使用して、各 BizTalk Server および SQL Server コンピューターにログオンします。  
  
2.  コマンド プロンプトを起動し、コンピューターの %windir%\system32 ディレクトリにディレクトリを変更します。  
  
3.  コマンド プロンプトから、MSinfo32.exe を実行します。  
  
4.  クリックして、**ファイル**メニューを選択、**エクスポート**エクスポートをコンピューターの構成を保存するメニュー項目。  
  
### <a name="export-the-biztalk-server-and-sql-server-computer-tcpip-registry-setting-"></a>BizTalk Server と SQL Server コンピューターで TCP/IP レジストリ設定のエクスポートします。  
 BizTalk Server と SQL Server の TCP/IP レジストリ設定を保存する次の手順に従います。  
  
1.  コマンド プロンプトを起動し、コンピューターの %windir%\system32 ディレクトリにディレクトリを変更します。  
  
2.  コマンド プロンプトから、Regedit.exe を実行します。  
  
3.  次のレジストリ キーに移動します。  
  
    ```  
    [HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters] (network settings)  
    ```  
  
4.  このキーを右クリックし **エクスポート**レジストリ キーをファイルにエクスポートします。  
  
### <a name="collect-the-biztalk-configuration-files"></a>BizTalk 構成ファイルを収集します。  
 各 BizTalk サーバー ノードで、BizTalk Server 構成ファイル、BTSNTSvc.exe.config ファイル (または BTSNTSvc64.exe.config の 64 ビット ホスト)、BizTalk Server のインストール フォルダー (例: C:\Program files \microsoft BizTalk Server 2010) を収集します。  
  
### <a name="collect-the-net-configuration-files"></a>.NET 構成ファイルを収集します。  
 各 BizTalk サーバー ノードで、machine.config ファイルと web.config .NET Framework 4.0 の構成ファイルを収集します。 次の場所では、構成ファイルを見つけることができます。  
  
-   32 ビットの: %windir%\Microsoft.NET\Framework\v4.0.30319\CONFIG フォルダー  
  
-   64 ビットの: %windir%\Microsoft.NET\Framework64\v4.0.30319\CONFIG フォルダー  
  
### <a name="use-the-biztalk-msgboxviewer-tool-to-collect-information-about-the-messagebox-database"></a>BizTalk MsgBoxViewer ツールを使用して、メッセージ ボックス データベースに関する情報を収集  
 BizTalk MsgBoxViewer ツールを使用してメッセージ ボックス データベースについての情報を収集するこれらの手順に従います。  
  
1.  ダウンロード、 [BizTalk MsgBoxViewer ツール](http://go.microsoft.com/fwlink/?LinkID=117289)(http://go.microsoft.com/fwlink/?LinkID=117289)です。  
  
2.  BizTalk Server 管理者セキュリティ グループの一部であるユーザー アカウントを使用して、BizTalk Server コンピューターにログオンします。  
  
3.  BizTalk Server コンピューターに、MsgBoxViewer.exe をコピーします。  
  
4.  このツールを起動します。  
  
5.  クリックして、**省略可能な情報を収集する** タブをクリックして**すべての情報を選択**です。  
  
6.  をクリックして**収集を開始**です。  
  
7.  状態ラベルの表示と、**終了コレクション**メッセージ、MsgBoxViewer.exe 実行可能ファイルを含むフォルダーに切り替えて、結果として得られるレポート (.htm) をコピーしてログ ファイルです。  
  
### <a name="collect-and-store-the-source-code-for-all-components-used-in-the-solution"></a>収集し、ソリューションで使用されるすべてのコンポーネントのソース コードを保存  
 個別のファイル共有ですべてのコンポーネント (たとえばオーケストレーション、カスタム パイプライン コンポーネント、およびヘルパー コンポーネントのコード) のソース コードを格納します。  
  
## <a name="initial-troubleshooting"></a>初期のトラブルシューティング  
 有効でない場合は問題が発生するパフォーマンス全体のサイズに関係なく、BizTalk Server ソリューションの特定のコンポーネントや、BizTalk ソリューションの設計は。 BizTalk ソリューションの排他的なボトルネックの分析に関与する前に、「通常疑います」の一部を除外するには、次の暫定版トラブルシューティング タスクを完了する必要があります。  
  
-   **追跡ホスト インスタンスが実行されている -** 追跡ホスト インスタンスがメッセージ ボックス データベースの TrackingData テーブルから BizTalkDTADb や BAMPrimaryImport データベースのテーブルに BAM と HAT の両方のデータを移動を担当します。 場合は、追跡ホスト インスタンスが実行されていない、追跡データが、メッセージ ボックス データベースに蓄積され、BizTalk Server ソリューションのパフォーマンスが低下します。  
  
-   **すべての BizTalk Server コンピューター - でエンタープライズ シングル サインオン (ENTSSO) サービスが実行されていることを確認**BizTalk ホスト インスタンスがローカルで実行中、ENTSSO サービスのインスタンスへの依存関係を維持します。 ENTSSO サービスが実行されていない場合、BizTalk Server サーバー上のホスト インスタンスはいずれかを実行できません。  
  
-   **すべての SQL Server コンピューター - で、SQL Server エージェント サービスが実行されていることを確認**BizTalk SQL Server エージェント ジョブを実行するために、SQL Server エージェント サービスを実行する必要があります。 これらのジョブでは、動作状況と状態、サーバーを保つために重要な機能を実行します。  
  
-   **BizTalk SQL Server エージェント ジョブが有効になっていることを確認し、[例外] - せずに実行する**SQL Server エージェント サービスが実行されている場合でもはすべての既定の BizTalk SQL Server エージェント ジョブが有効になっている強制セキュリティ チェックと実行が正常にします。  
  
-   **BizTalk Server および SQL Server イベント ログで -** BizTalk Server または SQL Server のイベント ログの大まかな検査がかなりの診断し、解決に時間がかかる場合がありますそれ以外の場合、問題を明らか可能性があります。  
  
-   **BizTalk Server ベスト プラクティス アナライザーの実行**BizTalk Server ベスト プラクティス アナライザーは、BizTalk Server 展開を調査し、ベスト プラクティスの標準に関連する問題の一覧が生成されます。 このツールは、Windows Management Instrumentation (WMI) クラス、SQL Server データベース、およびレジストリ エントリなど、さまざまな情報のソースからデータを収集することによって構成レベルの検証を実行します。 データは展開構成の評価に使用されます。 ツールを読み取りますをレポートのみ、そのシステム設定を変更しませんし、自己調整ツールではありません。 BizTalk Server のダウンロードのベスト プラクティス アナライザー v1.2 から[BizTalk Server のベスト プラクティス アナライザー v1.2](http://go.microsoft.com/fwlink/?LinkID=83317) (http://go.microsoft.com/fwlink/?LinkID=83317)です。  
  
## <a name="high-level-system-bottlenecks"></a>高度なシステムのボトルネック  
 このセクションでは、可能な緩和方法、BizTalk Server ソリューション内にある可能性があるシステム レベルのボトルネックについて説明します。  
  
### <a name="disk-io-bottlenecks"></a>ディスク I/O のボトルネック  
 ディスク I/O は、読み取りと物理ディスク上のアプリケーションによって実行された書き込み操作、または、サーバーにインストールされている複数のディスクの数を示します。 ディスク I/O と関連するボトルネックを引き起こす可能性のある共通の活動には、実行時間の長いファイル I/O 操作、データの暗号化と復号化、データベース テーブル、および、十分な物理メモリ、過剰なページングの基になるから不要なデータの読み取りが含まれます。アクティビティ。 ディスク速度は、ディスク I/O のボトルネックを評価するときに考慮すべきもう 1 つの要因高速なディスクは、パフォーマンスを向上させるし、ディスク I/O のボトルネックを低減します。  
  
 次の表は、BizTalk Server ソリューションのディスク サブシステムを計画する際に考慮すべき要因を提供します。  
  
|ディスク サブシステムの要素|詳細|  
|---------------------------|-------------|  
|ディスクのメモリ キャッシュと使用可能な物理メモリ|ディスクの物理メモリが少なくなるよう、ことを確認するメモリがキャッシュされているため使用可能なメモリの十分な容量があります。 メモリが不足しているより多くのページが書き込まれます。 より大きなディスク アクティビティの結果として得られる、ディスクにします。 また、ページング ファイルを適切なサイズに設定することを確認してください。 メモリ キャッシュの追加のディスクには、ディスク I/O 要求のピーク オフセットはのに役立ちます。 ただしにその現象は、大容量ディスク メモリ キャッシュが頻度の低いに十分なスピンドルをれていない場合の問題を解決し、十分なスピンドルを持つことが役に立たない大容量ディスク メモリ キャッシュのことに注意してください。 最適なパフォーマンスは Windows ページング ファイルの構成方法の詳細についてを参照してください「Windows ページファイル パフォーマンスを最適に構成する」のトピックで[オペレーティング システムのパフォーマンスの最適化](~/technical-guides/optimizing-operating-system-performance.md)です。|  
|記憶域コント ローラーの種類|キャッシュのバッテリ バックアップがあれば、トランザクション ログ ファイルのボリュームとデータベース ボリュームのディスク書き込みのパフォーマンスを向上させるために書き込みキャッシュが有効にします。 書き込みキャッシュなし書き込みキャッシュが有効な 10 ~ 20 ミリ秒の応答時間ではなく、書き込み I/O 要求の 2 ミリ秒の応答時間を提供します。 有効にすると記述が大幅にキャッシュ クライアントの書き込み要求の応答性が向上します。 読み取りキャッシュでは、便利なのでのみのトランザクション ログ ファイルでのみ発生する順次ディスク読み取り、BizTalk Server シナリオでパフォーマンスは向上しません。<br /><br /> トランザクション ログ ファイルの読み取り元が再生される場合にのみ、このようなデータベースの復元後に、またはサーバーは正しくシャット ダウンします。 大きなキャッシュを許可するより多くのデータをバッファーさせる彩度の長期間を確保できることを意味します。 コント ローラーでは、キャッシュのページ サイズを構成することができます、4 KB に設定する必要があります。 8 KB 単位での結果より大きなサイズは、4 KB の I/O 要求が 8 KB のページ キャッシュ全体を半分に、使用可能なキャッシュの削減になるために、キャッシュを浪費します。|  
|スピンドル|スピンドルは容量よりも重要とスピンドル多数のランダム I/O 要求がサポートする場合、BizTalk Server のパフォーマンスが向上します。 プランいいえ以上 80% 合計使用率をするための十分な I/O がスピンドル障害の場合でも、使用できることを確認します。|  
|Raid|コストとパフォーマンスのトレードオフ、環境に適したに基づいて、RAID ソリューションを使用する必要があります。 したがって、RAID ソリューションの 1 つ以上の型は、特定のデータ記憶域の要件の推奨可能性があります。 一般的な推奨事項は次のとおりです。<br /><br /> -Raid を使用して、1 + (ミラー化されたセットにストライプ セット) の場合は 0、BizTalk Server データベース。<br />-トランザクション ログ ファイルのボリュームの raid-1 (ミラー化されたセット パリティなし) を使用します。<br />-一般に、Raid 5 (分散パリティ付きストライプ セット) は Raid 5 を最高レベルの信頼性、可用性、およびその他の Raid 構成比べるとパフォーマンスが指定しないために推奨されません。<br />ために永続的なデータ損失の可能性、Raid 0 (ストライプ セット パリティなし) の構成が決して BizTalk Server の実稼働環境で使用してください。|  
|バスの種類|高いスループットでは、パフォーマンス向上を提供します。 一般に、SCSI バスは、スループットと IDE または ATA バスよりもスケーラビリティの向上を提供します。 次の式を使用すると、バスの種類の理論上のスループットの上限を決定します。<br /><br /> (バス速度 (bits)/バイトごとに 8 ビット)動作速度 (MHz) x = スループット (MB/秒)<br /><br /> 複数のドライブを別の I/O バスに配置することで、ディスク I/O パフォーマンスを改善できます。|  
  
#### <a name="performance-counters-for-measuring-disk-io-bottlenecks"></a>ディスク I/O のボトルネックを測定するためのパフォーマンス カウンター  
  
> [!NOTE]
>  ディスク パフォーマンスのボトルネックを分析しようとすると、常に、物理ディスク カウンターを使用する必要があります。 ただし、ソフトウェアの RAID を使用する場合は、論理ディスク カウンターを使用する必要があります。 論理ディスク、物理ディスク カウンターでは、同じカウンターではこれらの各カウンター オブジェクトです。 ボリューム マネージャー (または管理者) の論理ディスクのデータが追跡され、物理ディスクのデータがパーティション マネージャーによって追跡されます。  
  
 次のパフォーマンス カウンターは、システムにディスク I/O 関連のボトルネックが発生しているかどうかを決定するために使用する必要があります。  
  
-   **PhysicalDisk\Avg.ディスク キューの長さ**  
  
    -   しきい値: を 2 を加えたスピンドルの数よりも大きくすることはできません。  
  
    -   重要: このカウンターは読み書きの両方の平均数を示すし、サンプリング間隔中に、選択したディスクのキューに置かれた要求を書き込みます。 このカウンターは、データのバーストをなど、同時実行データを収集するために役立ちますし、負荷がピークします。 これらの値は、下、ドライバーの統計情報の取得、処理中の要求の数を表します。 つまり、要求は必ずしもキュー登録されませんが、サービス可能性があります。 実際にまたは完了および方法は、上でバックアップのパスです。 インフライトの可能な場所を以下に示します。  
  
        -   SCSIport または Storport キュー  
  
        -   OEM ドライバー キュー  
  
        -   ディスク コント ローラーのキュー  
  
        -   ハード ディスクのキュー  
  
        -   ハード ディスクからの受信積極的に  
  
-   **PhysicalDisk\Avg.Disk Read Queue Length**  
  
    -   しきい値: を 2 未満にする必要があります。  
  
    -   重要: このカウンターは、サンプリング間隔中に、選択したディスクのキューに入った読み取り要求の平均数を示します。  
  
-   **PhysicalDisk\Avg.ディスクの書き込みキューの長さ**  
  
    -   しきい値: を 2 未満にする必要があります。  
  
    -   重要: このカウンターは、サンプリング間隔中に、選択したディスクのキューに入った書き込み要求の平均数を示します。  
  
-   **PhysicalDisk\Avg.ディスク読み取り秒数**  
  
    -   しきい値: 固有値はありません。  
  
        -   10 ミリ秒未満 (ミリ秒) 良い =  
  
        -   15、25 のミリ秒の間で公平 =  
  
        -   25 ms を超える立たなかった  
  
    -   重要: このカウンターは、平均時間を秒数を読み取り、ディスクから操作データを示します。 数が 25 時間 (ミリ秒) よりも大きい場合は、ディスクのシステムでの待機時間が発生した場合、ディスクから読み取るときにこのためです。 BizTalk Server をホストしているミッション クリティカルなサーバーでは、許容されるしきい値は非常に低く、約 10 ミリ秒です。  
  
-   **PhysicalDisk\Avg.ディスク書き込み秒数**  
  
    -   しきい値: 固有値はありません。  
  
        -   10 ミリ秒未満 (ミリ秒) 良い =  
  
        -   15、25 のミリ秒の間で公平 =  
  
        -   25 ms を超える立たなかった  
  
    -   重要: このカウンターは、平均時間 (秒) を示します、データの操作をディスクに書き込みます。 数が 25 ミリ秒よりも大きい場合は、ディスク システムにディスクに書き込む際に待ち時間が発生します。 BizTalk Server をホストしているミッション クリティカルなサーバーでは、許容されるしきい値は非常に低く、約 10 ミリ秒です。  
  
-   **PhysicalDisk\Avg.ディスク転送秒数**  
  
    -   しきい値: は 18 個までのミリ秒をすることはできません。  
  
    -   重要: このカウンターは、時間、ディスクの平均転送秒数を示します。 大量のディスクの断片化、ディスクが遅い場合、またはディスクの障害がある可能性があります。 値を乗算します**Physical disk \avg. です。ディスク転送秒数**と**\pages/sec**カウンターです。 これらのカウンターの製品が 0.1 を超える場合ページングが発生してディスク アクセス時間の 10% を超えるため、使用可能な物理メモリが必要です。  
  
-   **PhysicalDisk\Disk Writes/sec**  
  
    -   しきい値: は、製造元の仕様によって異なります。  
  
    -   重要: このカウンターは、ディスク上の書き込み操作の速度を示します。  
  
-   **プロセッサ\\% DPC Time、% Interrupt Time と % Privileged Time -** 割り込み時間の場合と遅延プロシージャ呼び出し (DPC) の時間が特権モード時間の大部分は、カーネルが大量の I/O 要求の処理時間を費やしています。 場合によっては、マルチプロセッサ システムで割り込みおよび DPC アフィニティの Cpu の数が少ないを構成することによってパフォーマンスが向上することができます、キャッシュの局所性が向上します。 それ以外の場合に最も適切に動作、割り込みと dpc の処理がボトルネックになるから割り込みと DPC アクティビティを保持するために、多くの Cpu 間で配布します。 ネットワーク アダプターの割り込みをマルチプロセッサ コンピューターで特定のプロセッサにバインドする中断フィルターの構成ツールの使用方法についてを参照してください"ツールを使用して、割り込みフィルターの構成を特定するネットワーク アダプターの割り込みをバインドするには内のプロセッサ マルチプロセッサ コンピューターで"[オペレーティング システムのパフォーマンスの最適化](~/technical-guides/optimizing-operating-system-performance.md)です。  
  
-   **Processor\DPCs キュー数/秒の**dpc の処理に CPU 時間とカーネルのリソースを消費している方法を測定します。  
  
-   **Processor\Interrupts 数/秒の**割り込みに CPU 時間とカーネルのリソースを消費している方法のもう 1 つの測定値です。 最近のディスク コント ローラーは多くの場合、結合または 1 つの割り込みにより複数の I/O 完了の処理できるように、割り込みを結合します。 もちろん、割り込み (と完了) を遅らせることと、CPU 処理時間を economizing 間のトレードオフがあります。  
  
#### <a name="disk-io-tuning-options"></a>ディスク I/O のチューニング オプション  
 ディスク I/O が環境内のボトルネックであると判断した場合は、ボトルネックを軽減するため、次の手法は使用できます。  
  
-   **ディスクの断片化を解消**で利用可能なを使用して[PageDefrag ユーティリティ](http://go.microsoft.com/fwlink/?LinkId=108976)(http://go.microsoft.com/fwlink/?LinkId=108976) Windows ページング ファイルの断片化を解消し、マスター ファイル テーブルを事前に割り当てをします。  
  
-   **使用してストライプ セットを複数のディスクの I/O 要求を同時に処理**ミラー ボリュームを使用してフォールト トレランスを提供し、I/O パフォーマンスが向上します。 フォールト トレランスが必要でない場合実装ストライプ セットの読み取りや書き込みを高速リンクと記憶域の容量が向上します。 ストライプ セットを使用している場合ディスクごとの使用率ためにが減り、ボリューム全体で作業を分散し、全体的なスループットが増加します。 設定ストライプに追加のディスクを追加する場合は、システムは、ディスク コント ローラーによってディスク間の競合のため、ボトルネックになっている可能性がありますし、スループットを増加しません。 ここでは、追加する、追加のディスク コント ローラーが役立ちます負荷を分散し、パフォーマンスが向上します。  
  
-   **-複数のドライブ間で負荷を分散**Windows クラスタ リングおよび分散ファイル システムは、複数のディスク ドライブで負荷分散のソリューションを提供します。  
  
-   **ファイルの圧縮または暗号化の使用を制限**ファイルの圧縮と暗号化は O 多い操作します。 どうしても必要な場合にのみ、それらを使用しました。  
  
-   **短い名前の作成を無効にする**MS-DOS for Windows 3.x クライアントをサポートしていない場合は、パフォーマンスを向上させるために短い名前を無効にします。 短い名前の作成を無効にする方法の詳細についてを参照してください「短いファイル名 (8.3) の生成を無効にする」で[オペレーティング システムのパフォーマンスの最適化](~/technical-guides/optimizing-operating-system-performance.md)です。  
  
-   **アクセスの前回の更新を無効にする**ディレクトリを通過するたびに既定では、NTFS がディレクトリに最後にアクセスした日付と時刻スタンプを更新します。 大規模な NTFS ボリュームでは、この更新処理はパフォーマンスを妨げる場合があります。 更新プログラムの最終アクセスを無効にする方法の詳細については、セクションを参照してください。 [無効] にアクセスの更新プログラムの最終 NTFS で[オペレーティング システムのパフォーマンスの最適化](~/technical-guides/optimizing-operating-system-performance.md)です。  
  
    > [!CAUTION]
    >  増分バックアップ ユーティリティなどの一部のアプリケーションを使用して、NTFS の更新情報に依存して、指定されていない場合、正しく機能しません。  
  
-   **マスター ファイル テーブルでの適切な領域を予約**追加、 **NtfsMftZoneReservation** NTFS ボリュームに通常格納されているファイルの数に応じてレジストリへのエントリ。 このエントリをレジストリに追加すると、システムには、マスター ファイル テーブル用のボリュームに領域が確保されます。 マスター ファイル テーブルを最適に拡張をこの方法での領域を予約できます。 NTFS ボリュームは、一般に比較的いくつかのファイルを保存する場合、は、このレジストリ エントリの値を既定値は 1 に設定します。 通常、NTFS ボリュームが適度な数のファイルを保存し、NTFS ボリュームは、比較的多数のファイルを格納する傾向がある場合、4 (最大) の値を使用する場合は、2 または 3 の値を使用できます。 ただし、確認 2 より大きいすべての設定をテストするこれらのより大きな値は、システムでマスター ファイル テーブルのディスクの容量より大きな部分を予約するを発生します。 追加の詳細については、 **NtfsMftZoneReservation**をレジストリに領域を確認、セクション"増加マスター ファイル テーブルの使用可能な"で[オペレーティング システムのパフォーマンスの最適化](~/technical-guides/optimizing-operating-system-performance.md)です。  
  
-   **システムを使用して、最も効率的なディスクの使用可能な**のために使用される、物理ディスクに加えて使用されるディスク コント ローラーとのケーブル接続の種類を検討してください。 効率的なディスク サブシステムでは、割り込み節度またはディスク I/O によるプロセッサの割り込み処理状況を軽減するために割り込み回避をサポートするドライバーも提供する必要があります。  
  
-   **適切な RAID 構成は、- を使用していることを確認してください。** 最適なパフォーマンスとフォールト トレランスのための使用 RAID 10 (ストライピングとミラーリング)。 その代わりには、RAID 10 を使用して高価です。 広範な書き込み操作がある場合は、RAID 5 を使用しないでください。 BizTalk Server 環境での RAID の実装の詳細についてを参照してください「ディスク インフラストラクチャ」で、 [BizTalk Server データベースの最適化のホワイト ペーパー](http://go.microsoft.com/fwlink/?LinkID=101578) (http://go.microsoft.com/fwlink/?LinkID=101578)です。  
  
-   **検討してください - データベースのパーティションを使用して**データベース パーティションを使用して、特定のテーブルとトランザクション ログのディスクにマップした場合、データベースのボトルネックを検討してください。 パーティションの主な目的は、大きなテーブルのディスクのボトルネックを解決するのには。 大量の行を含むテーブルがあり、ボトルネックの原因であることを決定する場合は、パーティションを使用することを検討します。 SQL Server の I/O パフォーマンスを向上させるためにファイル グループを使用できます。 ファイル グループにテーブルを関連付けるし、特定のハード_ディスクにファイル グループを関連付けることができます。 詳細については、BizTalk Server データベースの最適化ファイル グループを使用して、次を参照してください。[のデータベースのファイル グループを最適化する](~/technical-guides/optimizing-filegroups-for-the-databases2.md)です。  
  
-   **物理メモリを追加することを検討してください - の過度のページ フォールトがある場合**の値が大きい、**メモリ: pages/sec**過剰なページングのディスクが増加する可能性がパフォーマンス カウンター I/0 です。 このような場合は、ディスク I/O を削減し、パフォーマンスが向上する物理メモリを追加することを検討してください。  
  
-   **評価または記憶域エリア ネットワーク (SAN) を使用して、高 RPM のディスクの使用を検討デバイス -** RPM の評価が高いでディスクは RPM の評価が低いでディスクに比べてパフォーマンスの向上を提供します。 SAN デバイスは、通常、パフォーマンスが最上位の層を高く代価でします。  
  
-   推奨事項に従い[データベースのパフォーマンスの最適化](~/technical-guides/optimizing-database-performance.md)です。 このトピックでは前に、と後、BizTalk Server の構成データベースのパフォーマンスを最適化するためのいくつかの推奨事項を説明します。  
  
### <a name="cpu-bottlenecks"></a>CPU のボトルネック  
 サーバーで実行されている各アプリケーションでは、CPU のタイム スライスを取得します。 CPU がすべてのコンピューターで実行されているプロセスを効率的に処理できる場合があります。 またはオーバー ロードすることがあります。 プロセッサのアクティビティと個々 のプロセス スレッドの作成、スレッドの切り替えとコンテキストを含むアクティビティを調べることでプロセッサの負荷やパフォーマンスに関する洞察が得られます。  
  
#### <a name="you-may-have-a-cpu-bottleneck-if"></a>場合、CPU のボトルネックが存在することがあります.  
  
-   値、**プロセッサ\\% Processor Time**パフォーマンス カウンターは多くの場合、75% を超えています。  
  
-   値、**システム プロセッサ キューの長さ**パフォーマンス カウンターは、しばらくの間の 2 つ以上です。  
  
-   値、**プロセッサ\\% Privileged Time**または**system \context switches/sec**パフォーマンス カウンターが異常に高いです。  
  
     場合の値**processor \ % Processor Time**パフォーマンス カウンターが高い場合、キューが行われます、およびほとんどのシナリオでの値**システム プロセッサ キューの長さ**も高くなります。  
  
#### <a name="performance-counters-for-measuring-cpu-bottlenecks"></a>CPU のボトルネックを測定するためのパフォーマンス カウンター  
 次のパフォーマンス カウンターは、システムに関連する CPU のボトルネックが発生しているかどうかを決定するために使用する必要があります。  
  
-   **プロセッサ\\プロセッサ時間の割合**  
  
    -   しきい値: は、85% 未満にする必要があります。  
  
    -   重要: このカウンターは、プロセッサ アクティビティのプライマリ インジケーターです。 高い値の多くは必ずしも不適切であります。 ただし、他のプロセッサに関連するカウンターが次のように直線的に増加しているかどうか**プロセッサ\\% Privileged Time**または**system \processor Queue Length**、CPU 使用率が高い価値があること調査中です。  
  
-   **プロセッサ\\特権モード時間の割合**  
  
    -   しきい値: 75% が一貫している図では、ボトルネックを示します。  
  
    -   重要: このカウンターは、スレッドが特権モードで実行時間の割合を示します。 アプリケーションが (たとえば、ファイルまたはネットワーク I/O を実行するか、メモリを割り当てるなど) のオペレーティング システム関数を呼び出すと、これらのオペレーティング システム関数が特権モードで実行されます。  
  
-   **プロセッサ\\割り込み時間の割合**  
  
    -   しきい値: は、プロセッサに依存します。  
  
    -   重要: このカウンターは、プロセッサがハードウェア割り込みの受信やサービスに費やした時間の割合を示します。 この値は、ネットワーク アダプターなど、割り込みを生成するデバイスの処理状況を間接的に示します。 このカウンターに、大幅に向上では、潜在的なハードウェアの問題を示します。  
  
-   **System\Processor Queue Length**  
  
    -   しきい値: 2 よりも高い一貫して平均値では、ボトルネックを示します。  
  
    -   重要: よりも多いプロセッサを実行する準備がより多くのタスクがある場合は、スレッド キューに登録します。 プロセッサのキューは、準備が別のスレッドが現在実行中のために、プロセッサによって実行されることができない、あるスレッドのコレクションです。 複数の 2 つのスレッドのキューが持続的なまたは定期的なことは、プロセッサのボトルネックのクリア表示です。 このような場合に並列処理を減らすことによって、スループットを取得可能性があります。  
  
         と共にこのカウンターを使用することができます、**プロセッサ\\% Processor Time**カウンターをアプリケーションの Cpu できます恩恵を確認します。 1 つのキュー プロセッサ時間をマルチプロセッサ コンピューター上であってもします。 したがって、マルチプロセッサのコンピューターには、ワークロードを処理するプロセッサの数でプロセッサ キューの長さ (PQL) 値を除算します。  
  
         CPU の非常に時間 (90% または使用率の向上) および PQL 平均は一貫して、プロセッサごとに 2 より大きい場合、利点がもたらされる Cpu の追加プロセッサのボトルネックがあります。 または、アプリケーション レベルで複数のスレッドとキューの数を減らすことができます。 コンテキスト切り替えが少なくなり、これにより、およびコンテキスト切り替えが少なくなり、CPU 負荷を減らすに適しています。 CPU 使用率が低い 2 以上の PQL 値の一般的な理由は、プロセッサ時間の要求がランダムに到着し、スレッド、プロセッサからの時間の不規則な金額を要求することです。 つまり、プロセッサがボトルネックではないことが、アプリケーションのスレッドのロジックが向上することです。  
  
-   **System\Context Switches/sec**  
  
    -   しきい値: 一般的な規則としてコンテキストの切り替え率、プロセッサごとの 1 秒あたり 5,000 は報わよりも少ない心配です。 コンテキスト切り替えレートは、プロセッサごとの 1 秒あたりの 15,000 を超えている場合、コンテキストの切り替えボトルネックになります。  
  
    -   高い優先順位のスレッドが現在実行されている、または優先度の高いスレッドが他のスレッドをブロックするときに低い優先順位のスレッドのプリエンプションを行います有意性: コンテキストの切り替えが行われます。 高レベルのコンテキストの切り替えは、多くのスレッドが同じ優先順位を共有する場合に発生します。 これは、多くの場合、システムのプロセッサを競合するスレッドが多すぎるがあることを示します。 プロセッサ使用率とコンテキストの切り替えをレベルの両方が低い場合は、これは、多くの場合、スレッドがブロックされていることを示します。  
  
#### <a name="resolving-cpu-bottlenecks"></a>CPU のボトルネックを解決します。  
 最初の手順では、どのプロセスが過度のプロセッサ時間を消費しているかを特定します。 Windows を使用して**タスク マネージャー**を識別するプロセスが調べることで高レベルの CPU を消費している、 **CPU**  列、**プロセス**ページ。 監視することによっても判断できます**プロセス\\% Processor Time**パフォーマンス モニターとを監視するプロセスを選択します。  
  
 過剰な CPU 時間を消費しているプロセスを決定するための別の強力なツールは、Visual Studio チーム システムのプロファイラーは、Visual Studio Team System (VSTS) スイートで使用可能です。 詳細については、Visual Studio チーム システム プロファイラーを使用して、Visual Studio Team System のドキュメントを参照してください。  
  
 CPU がボトルネックであると決定した後、次のよう、いくつかのオプションがあります。  
  
-   マルチ スレッド アプリケーションがある場合は、複数のプロセッサを追加します。 アプリケーションがシングル スレッドの場合より強力なプロセッサにアップグレードすることを検討してください。  
  
-   コンテキストの切り替えの率が高いを確認する場合は、プロセッサの数を増やす前に、プロセスのスレッド数を減らすことを検討します。  
  
-   分析し、CPU 使用率が高い原因となっているアプリケーションをチューニングします。 Adplus を使用したユーティリティを使用して実行中のプロセスをダンプし、Windbg を使用して、原因を分析できます。 これらのユーティリティは、Windows のツールキットのデバッグの一部です。 これらのツールをダウンロードする[Debugging Tools for Windows](http://go.microsoft.com/fwlink/?LinkID=106624) (http://go.microsoft.com/fwlink/?LinkID=106624)です。  
  
-   最長実行時間がかかっているサブシステムを分離する、アプリケーションによって生成されるインストルメンテーション ログを分析します。 コード レビューは、BizTalk Server 環境のチューニングだけよりも役に立つするかどうかを決定します。  
  
> [!NOTE]
>  使用して、アプリケーションのプロセス優先度レベルを変更できますが、**タスク マネージャー**またはコマンド プロンプトから、する必要があります一般的にこれを回避します。  
  
### <a name="memory-bottlenecks"></a>メモリのボトルネック  
 メモリ関連のボトルネックを評価するときに、不要な割り当て、クリーンアップ、非効率的で不適切なキャッシュおよび状態管理メカニズムを検討してください。 メモリ関連のボトルネックを解決するには、これらの問題を排除し、アプリケーションに割り当てられたメモリの量を調整するようにコードを最適化します。 チューニング中を決定するかどうかは、メモリの競合や過度なページングが発生した、サーバーに物理メモリを追加する必要があります。 メモリ不足は、アプリケーションの仮想アドレス空間としてディスクのページングの増加につながります。 ページングが過剰になると、ディスク I/O が増加し、システム全体のパフォーマンスに悪影響を与えます。  
  
#### <a name="you-might-have-a-memory-bottleneck-if"></a>場合は、メモリのボトルネックがあります.  
  
-   値、 **memory \available MBytes**パフォーマンス カウンターが少ない場合、システム メモリの制限またはメモリを解放しないアプリケーションのためです。 値を監視、 **process \working Set**が実行されている各プロセスのパフォーマンス カウンター。 場合の値、 **process \working Set**高プロセスがアクティブでない場合でもこの可能性がある、プロセスが解放していないメモリは残ります。  
  
-   値、 **\pages/sec**パフォーマンス カウンターが高いです。 平均**memory \pages input/sec**の平均で割った値**memory \page reads/sec**のディスク読み取りあたりのページの数を提供します。 一般に、この値では、1 秒あたりの 5 つのページを超える必要がありますされません。 1 秒あたりの 5 つのページ数よりも大きい値は、システムが多すぎるときのページングが費やしている (アプリケーションが最適化されていると仮定) より多くのメモリが必要だことを示します。  
  
#### <a name="performance-counters-for-measuring-memory-bottlenecks"></a>メモリのボトルネックを測定するためのパフォーマンス カウンター  
 次のパフォーマンス カウンターは、システムにメモリ関連のボトルネックが発生しているかどうかを決定するために使用する必要があります。  
  
-   **Memory \available Mbytes**  
  
    -   しきい値: インストールされている RAM の 20 ~ 25% 未満の一貫性のある値では、メモリ不足を示す値です。  
  
    -   有意性: このコンピューターで実行されているプロセスに使用できる物理メモリの量を示します。 このカウンターは最後に計測された値のみを表示することに注意してください。 平均値ではありません。  
  
-   **Memory\Page Reads/sec**  
  
    -   しきい値: 6 つ以上の値が継続的には、読み取り要求のページ フォールトの数が多いを示します。  
  
    -   重要: このカウンターは、プロセスのワーキング セットがディスクにページにメモリが原因となっている使用可能な物理メモリは大きすぎることを示します。 各操作で取得されたページの数に関係なく、読み取り操作の数が表示されます。 高い値は、メモリのボトルネックを示します。  
  
         ページの読み取り操作の頻度が低いがの値が大きいと一致するかどうかは**物理ディスク\\% Disk Time**と**Physical disk \avg. です。Disk Queue Length**、ディスク I/O のボトルネックになっている条件が存在する可能性があります。 キューの長さの増加は、ページの読み取り率の低下が付属しない、メモリのボトルネックが存在する場合物理メモリの不足が原因です。  
  
-   **Memory\Pages/sec**  
  
    -   しきい値: 6 つ以上の継続的な値は、ボトルネックを示します。  
  
    -   重要: このカウンターをページの読み取りまたはハード ページ フォールトを解決するのにはディスクに書き込まれる速度を示します。 値を乗算します**Physical disk \avg. です。ディスク転送秒数**と**\pages/sec**パフォーマンス カウンター。 これらの値の積を超えた場合**0.1**ページングが十分な物理メモリが使用可能なであることを示すディスク アクセス時間の 10% 以上を使用します。  
  
-   **Memory\Pool Nonpaged Bytes**  
  
    -   しきい値: の値に注意して**memory \pool Nonpaged Bytes**のシステムの起動時に値を 10% 以上増加します。  
  
    -   重要: の開始時の値から 10% 以上増加には、メモリ リークを示す可能性があります。  
  
-   **Server\Pool Nonpaged エラー**  
  
    -   しきい値: 通常 0 以外の値では、ボトルネックが生じてです。  
  
    -   重要: このカウンターは、非ページ プールから割り当てが失敗した回数を示します。 非ページ プールには、カーネル オブジェクト テーブルの処理などのディスク上のページファイルにスワップ アウトするのには、プロセスの仮想アドレス空間からのページが含まれています。 非ページ プールの可用性は、このようなオブジェクトを作成できます数のプロセス、スレッド、およびその他を決定します。 非ページ プールからの割り当てが失敗した場合は、プロセッサ使用率がそれに応じて増加いない場合に特にプロセスでは、メモリ リークが発生原因としてこのられます。  
  
-   **Server\Pool ページの障害**  
  
    -   しきい値: 固有値はありません。  
  
    -   重要: このカウンターは、ページ プールから割り当てが失敗した回数を示します。 このカウンターの正の値は、コンピューターの十分な物理メモリがあるか、Windows ページング ファイルが小さすぎることを示します。  
  
-   **Server\Pool 非ピーク時**  
  
    -   しきい値: 固有値はありません。  
  
    -   重要: これは、任意の時点で使用するため、サーバーが予約されている非ページ プール内のバイトの最大数です。 コンピューターに搭載する物理メモリの量を示します。 非ページ プールは、物理メモリ内である必要があり、あるために残された、他の操作、経験則として、コンピューター メモリの一部が 4 回このカウンターに示される値は、物理メモリをインストールが必要があります。  
  
-   **Memory\Cache Bytes**  
  
    -   しきい値: 固有値はありません。  
  
    -   重要: は、別のロード条件下でキャッシュのサイズを監視します。 このパフォーマンス カウンターの値は、静的ファイルのキャッシュのサイズを示します。 既定では、このカウンターを使用して利用可能なメモリが減少の約 50% 使用可能なメモリを圧縮する場合、システムのパフォーマンスに影響します。  
  
-   **Memory\Cache Faults/sec**  
  
    -   しきい値: 固有値はありません。  
  
    -   重要: このカウンターは、オペレーティング システムがファイル システム キャッシュ内のデータを検索する頻度を示しますを見つけるため失敗します。 値はできるだけ低くします。  
  
-   **Cache\MDL 読み取りヒット率**  
  
    -   しきい値: 高く値のファイル システム キャッシュのパフォーマンスは向上します。 値は、できるだけ 100% に近くする必要があります。  
  
    -   重要: このカウンターは、割合のメモリ記述子一覧 (MDL)、ハード_ディスクからの読み取りを必要とするのではなく、読み取り、キャッシュ オブジェクトを返します、直接、ファイル システム キャッシュを要求を提供します。  
  
-   **Process\Working Set**  
  
    -   しきい値: 固有値はありません。  
  
    -   重要: ワーキング セットは、メモリ (物理 + 仮想) に読み込まれた現在のメモリ ページのセットです。 システムに十分なメモリがある場合、できるように、ディスク ページ メモリへのディスク操作を実行する必要はありません、ワーキング セットに十分な領域を維持できます。 ただし、十分なメモリがある場合、システムはワーキング セットのページ フォールトの増加につながること、プロセスのメモリを取り除きますを削減しようとします。 ページ フォールト数が増え、システムは、プロセスのワーキング セットの増加しようとします。 ワーキング セットの幅の変動を確認する場合、メモリが不足していることを示す場合します。 ワーキング セットの値が大きいほどは、アプリケーションの複数のアセンブリにより場合もあります。 アセンブリがグローバル アセンブリ キャッシュ内の共有を使用して設定作業を向上できます。  
  
#### <a name="resolving-memory-bottlenecks"></a>メモリのボトルネックを解決します。  
 そのメモリと判断した場合は、ボトルネックを解決するのには、次の方法の 1 つ以上を使用して、BizTalk Server 環境でのボトルネックを示します。  
  
-   割り当てを制御する場合に割り当てられたメモリの量を調整します。 たとえば、BizTalk Server、ASP.NET および SQL Server のこのをチューニングできます。  
  
-   Windows ページング ファイルのサイズを増やすし、「最適なパフォーマンスを Windows ページファイルの使用を構成する」のセクションの手順に従います[オペレーティング システムのパフォーマンスの最適化](~/technical-guides/optimizing-operating-system-performance.md)です。  
  
-   使用されていないサービスをオフにします。 定期的に使用しないサービスを停止すると、メモリが節約され、システム パフォーマンスが向上します。 詳細についてを参照してください「不要なサービスを無効にする」の[オペレーティング システムのパフォーマンスの最適化](~/technical-guides/optimizing-operating-system-performance.md)です。  
  
-   不要なプロトコルとドライバーを削除します。 アイドル状態のプロトコルは、ページングと非ページ メモリ プールの領域を使用します。 不要なものを削除する必要がありますので、ドライバーも、メモリを消費します。 詳細についてを参照してください「不要なネットワーク プロトコルを削除する」の[オペレーティング システムのパフォーマンスの最適化](~/technical-guides/optimizing-operating-system-performance.md)です。  
  
-   BizTalk Server 環境内のコンピューターに追加の物理メモリをインストールします。  
  
> [!NOTE]
>  32 ビット システムで BizTalk が 2 GB のメモリの最大値を使用できる、3 GB スイッチが使用されている場合に、制限が BizTalk Server 2010 以降のバージョンと 3 GB に増加します。 メモリ使用量の詳細については、次を参照してください。[メモリ制限の Windows リリース](http://go.microsoft.com/fwlink/?LinkId=118349)(http://go.microsoft.com/fwlink/?LinkId=118349)です。  
  
### <a name="network-io-bottlenecks"></a>ネットワーク I/O のボトルネック  
  
#### <a name="you-might-have-a-network-io-bottleneck-if"></a>場合は、ネットワーク I/O のボトルネックがあります.  
  
-   値、 **Network interface \bytes total/sec**パフォーマンス カウンタは、使用可能なネットワーク帯域幅の 80% を超えています。  
  
-   値、 **server \bytes total/sec**パフォーマンス カウンターが使用可能なネットワーク帯域幅の 50% より大きい。  
  
#### <a name="performance-counters-for-measuring-network-io-bottlenecks"></a>ネットワーク I/O のボトルネックを測定するためのパフォーマンス カウンター  
 次のパフォーマンス カウンターは、ネットワーク I/O を測定し、システムにネットワーク I/O 関連のボトルネックが発生しているかどうかを判断するために使用する必要があります。  
  
-   **Network interface \bytes total/sec**  
  
    -   ネットワーク容量の 80 パーセント以上のしきい値: 持続的な値です。  
  
    -   重要: このカウンターは、各ネットワーク アダプターで送受信はバイトの率を示します。 このカウンターにより、ネットワーク アダプターが飽和状態になり、および使用可能なネットワーク帯域幅を増大する 1 つまたは複数のネットワーク アダプターを追加する必要があるかどうかを判別します。  
  
-   **ネットワーク interface \bytes received/sec**  
  
    -   しきい値: 固有値はありません。  
  
    -   重要: このカウンターは、各ネットワーク アダプタ上で受信されるバイトの率を示します。 このカウンターの値を使用すると、使用可能な帯域幅の合計に対する割合としての受信データの比率を計算できます。 BizTalk Server または BizTalk Server コンピューター自体にネットワーク帯域幅を増やす必要があるかどうかにデータを送信しているクライアントのネットワーク帯域幅を増やす必要がありますかを確認ができます。  
  
-   **Network Interface\Bytes Sent/sec**  
  
    -   しきい値: 固有値はありません。  
  
    -   重要: このカウンターは、各ネットワーク アダプター上で送信されるバイトの率を示します。 このカウンターの値を使用すると、使用可能な帯域幅の合計に対する割合で送信したデータの比率を計算できます。 これにより、クライアントの送信データを BizTalk Server でネットワーク帯域幅を増やす必要がありますか場合は、クライアント コンピューター データの受信 BizTalk Server からのネットワーク帯域幅を増やす必要がありますかを確認できます。  
  
-   **Server\Bytes Total/sec**  
  
    -   ネットワーク容量の 50% 以上のしきい値: 持続的な値です。  
  
    -   重要: このカウンターは、ネットワーク経由で送受信されたバイト数を示します。 高い値は、ネットワーク I/O のボトルネックを示します。 場合の合計**bytes total/sec**すべてのサーバーがネットワークの最大転送速度とほぼ等しい値では、パフォーマンスを向上させるために、ネットワークのサブネットを検討してください。 パフォーマンスを向上させるためにネットワークのサブネットの詳細については、次を参照してください。、**サブネット**のセクションで、 [BizTalk Server データベースの最適化のホワイト ペーパー](http://go.microsoft.com/fwlink/?LinkID=101578) (http://go.microsoft.com/fwlink/?LinkID=101578)です。  
  
#### <a name="resolving-network-io-bottlenecks"></a>ネットワーク I/O のボトルネックを解決します。  
 ネットワーク I/O が環境内のボトルネックであると判断した場合は、ボトルネックを解決するのには、次の方法の 1 つ以上を使用します。  
  
-   「ネットワークのパフォーマンスを向上させるための一般的なガイドライン」」の推奨事項に従って[ネットワークのパフォーマンスの最適化](~/technical-guides/optimizing-network-performance.md)です。  
  
-   トピックで説明されている Windows Powershell のネットワーク最適化スクリプト実行[ネットワークのパフォーマンスの最適化](~/technical-guides/optimizing-network-performance.md)BizTalk Server 環境内の各コンピューターにします。  
  
## <a name="see-also"></a>参照  
 [ボトルネックの検索と解消](~/technical-guides/finding-and-eliminating-bottlenecks.md)