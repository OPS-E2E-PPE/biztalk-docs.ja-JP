---
title: システム レベルのボトルネック |Microsoft Docs
ms.custom: ''
ms.date: 06/29/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 0bdff435-76eb-495f-9fb6-1f1acef3921e
caps.latest.revision: 11
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 1c736cb7de384edadac1c7b4c0fd840e8d4e7cac
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/07/2019
ms.locfileid: "65400678"
---
# <a name="system-level-bottlenecks"></a>システム レベルのボトルネック
このトピックでは、BizTalk Server ソリューションのパフォーマンスに影響する一般的なシステム レベルのボトルネックに対処する方法について説明します。  
  
## <a name="creating-a-snapshot-of-the-baseline-configuration"></a>ベースライン構成のスナップショットを作成します。  
 次の情報の収集を修正するシステム レベルのボトルネックで支援するために使用できるベースライン構成のスナップショットを提供できます。  
  
### <a name="gather-documentation"></a>ドキュメントを収集します。  
 アーキテクチャとシナリオのインフラストラクチャのドキュメントを確認します。  
  
### <a name="run-the-baseline-security-analyzer"></a>Baseline Security Analyzer を実行します。  
 Baseline Security Analyzer を実行するこれらの手順に従います。  
  
1.  ダウンロード、 [Microsoft Baseline Security Analyzer 2.2](http://go.microsoft.com/fwlink/?LinKID=204006) (http://go.microsoft.com/fwlink/?LinkId=204006) します。  
  
2.  ドメイン管理者アカウントを使用して、BizTalk Server と SQL Server コンピューターをホストしているのと同じネットワーク上のコンピューターにログオンします。  
  
3.  現在のコンピューター (たとえば、BizTalk Server コンピューターまたは別のコンピューターの 1 つ)、Microsoft Baseline Security Analyzer をインストールします。  
  
4.  別のスキャンを実行 (**スキャンの開始**)、または BizTalk Server と SQL Server の各コンピューターの IP アドレスをパラメーターとして指定します。  
  
5.  %Userprofile%\SecurityScans ディレクトリから、各セキュリティ レポート (.mbsa ファイル) をコピーします。  
  
### <a name="run-the-biztalk-server-best-practices-analyzer"></a>BizTalk Server のベスト プラクティス アナライザーを実行します。  
 BizTalk Server のベスト プラクティス アナライザーを実行するこれらの手順に従います。  
  
1.  ダウンロード、 [BizTalk Server のベスト プラクティス アナライザー v1.2](http://go.microsoft.com/fwlink/?LinkID=83317) (http://go.microsoft.com/fwlink/?LinkID=83317) します。  
  
2.  BizTalk Server 管理者セキュリティ グループの一部であるユーザー アカウントを使用して、BizTalk Server のノードにログオンします。  
  
3.  現在のコンピューターで BizTalk Server のベスト プラクティス アナライザーをインストールします。  
  
4.  ツールを実行し、レポートを保存します。  
  
### <a name="run-msinfo32-and-save-the-results"></a>MSInfo32 を実行し、結果の保存  
 MSInfo32 を実行するこれらの手順に従います。  
  
1.  ドメインまたはローカル管理者アカウントを使用して、各 BizTalk Server および SQL Server コンピューターにログオンします。  
  
2.  コマンド プロンプトを起動し、コンピューターの %windir%\system32 ディレクトリにディレクトリを変更します。  
  
3.  コマンド プロンプトから、MSinfo32.exe を実行します。  
  
4.  をクリックして、**ファイル**メニュー選択し、**エクスポート**メニュー項目をエクスポートしてコンピューターの構成を保存します。  
  
### <a name="export-the-biztalk-server-and-sql-server-computer-tcpip-registry-setting-"></a>BizTalk Server と SQL Server コンピューターで TCP/IP レジストリ設定のエクスポートします。  
 BizTalk Server と SQL Server の TCP/IP レジストリ設定を保存する次の手順に従います。  
  
1.  コマンド プロンプトを起動し、コンピューターの %windir%\system32 ディレクトリにディレクトリを変更します。  
  
2.  コマンド プロンプトから、Regedit.exe を実行します。  
  
3.  次のレジストリ キーに移動します。  
  
    ```  
    [HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters] (network settings)  
    ```  
  
4.  このキーを右クリックして**エクスポート**レジストリ キーをファイルにエクスポートします。  
  
### <a name="collect-the-biztalk-configuration-files"></a>BizTalk 構成ファイルを収集します。  
 各 BizTalk サーバー ノードで、BizTalk Server 構成ファイル、BTSNTSvc.exe.config ファイル (または BTSNTSvc64.exe.config 64 ビットのホスト用)、BizTalk Server のインストール フォルダー (例: C:\Program files \microsoft BizTalk Server 2010) を収集します。  
  
### <a name="collect-the-net-configuration-files"></a>.NET 構成ファイルを収集します。  
 各 BizTalk サーバー ノードでは、machine.config と web.config の .NET Framework 4.0 の構成ファイルを収集します。 構成ファイルに次の場所にあります。  
  
-   32 ビットの: %windir%\Microsoft.NET\Framework\v4.0.30319\CONFIG フォルダー  
  
-   64 ビットの: %windir%\Microsoft.NET\Framework64\v4.0.30319\CONFIG フォルダー  
  
### <a name="use-the-biztalk-msgboxviewer-tool-to-collect-information-about-the-messagebox-database"></a>BizTalk MsgBoxViewer ツールを使用して、メッセージ ボックス データベースに関する情報を収集  
 BizTalk MsgBoxViewer ツールを使用して、メッセージ ボックス データベースについての情報を収集するこれらの手順に従います。  
  
1.  ダウンロード、 [BizTalk MsgBoxViewer ツール](http://go.microsoft.com/fwlink/?LinkID=117289)(http://go.microsoft.com/fwlink/?LinkID=117289) します。  
  
2.  BizTalk Server 管理者セキュリティ グループの一部であるユーザー アカウントで BizTalk Server コンピューターにログオンします。  
  
3.  BizTalk Server コンピューターに、MsgBoxViewer.exe をコピーします。  
  
4.  このツールを起動します。  
  
5.  をクリックして、**省略可能な情報を収集する** タブをクリックして**すべての情報を選択**します。  
  
6.  クリックして**収集開始**します。  
  
7.  状態ラベルが表示されたら、**エンド コレクション**メッセージ、MsgBoxViewer.exe 実行可能ファイルを含むフォルダーに切り替えます、結果として得られるレポート (.htm) をコピーしてログ ファイル。  
  
### <a name="collect-and-store-the-source-code-for-all-components-used-in-the-solution"></a>収集し、ソリューションで使用されるすべてのコンポーネントのソース コードの格納  
 個別のファイル共有ですべてのコンポーネント (たとえば、オーケストレーション、カスタム パイプライン コンポーネント、およびヘルパー コンポーネントのコード) のソース コードを格納します。  
  
## <a name="initial-troubleshooting"></a>初期のトラブルシューティング  
 全体的なサイズに関係なくパフォーマンスの問題が発生するが有効でない場合は、BizTalk Server ソリューションの特定のコンポーネントや、BizTalk ソリューションの設計は。 BizTalk ソリューションの徹底的なボトルネックの分析を行う前に「しくみ」の一部を除外する次の事前のトラブルシューティング タスクを完了する必要があります。  
  
-   **追跡ホスト インスタンスが実行されている - 確認**BAM と HAT の両方のデータをメッセージ ボックス データベースの TrackingData テーブルから BizTalkDTADb や BAMPrimaryImport データベースのテーブルに移動するため、追跡ホスト インスタンスが担当します。 場合は、追跡ホスト インスタンスが実行されていない、追跡データは、メッセージ ボックス データベースに蓄積され、BizTalk Server ソリューションのパフォーマンスに悪影響を与えます。  
  
-   **すべての BizTalk Server コンピューター - で、エンタープライズ シングル サインオン (ENTSSO) サービスが実行されていることを確認**BizTalk ホスト インスタンスは、ENTSSO サービスのローカルで実行中のインスタンスへの依存関係を維持します。 場合は、サーバー上のホスト インスタンスでは、いずれかを実行できませんし、ENTSSO サービスは、BizTalk Server で実行されていません。  
  
-   **すべての SQL Server コンピューター - で、SQL Server エージェント サービスが実行されていることを確認**BizTalk SQL Server エージェント ジョブを実行するために、SQL Server エージェント サービスを実行する必要があります。 これらのジョブでは、動作状況と状態、サーバーを保持する重要な機能を実行します。  
  
-   **BizTalk SQL Server エージェント ジョブが有効になっていることを確認し、例外 - せずに実行して**命令型のすべての既定の BizTalk SQL Server エージェント ジョブが有効であると、実行中を正常には、SQL Server エージェント サービスが実行されている場合でもです。  
  
-   **BizTalk Server と SQL Server のイベント ログ -** の BizTalk Server または SQL Server イベント ログの簡単な調査によってかなりの診断し、解決に時間がかかる場合がありますそれ以外の場合の問題を特定します。  
  
-   **BizTalk Server ベスト プラクティス アナライザーの実行**BizTalk Server ベスト プラクティス アナライザーが BizTalk Server の展開に調べベスト プラクティス基準に関連する問題の一覧が生成されます。 ツールは、Windows Management Instrumentation (WMI) クラス、SQL Server データベース、およびレジストリ エントリなど、さまざまな情報のソースからデータを収集することにより構成レベルの検証を実行します。 データは、展開構成を評価するが使用されます。 ツールとレポートのみ、任意のシステム設定は変更されませんを読み取って自己調整ツールではありません。 BizTalk Server のダウンロードのベスト プラクティス アナライザー v1.2 から[BizTalk Server のベスト プラクティス アナライザー v1.2](http://go.microsoft.com/fwlink/?LinkID=83317) (http://go.microsoft.com/fwlink/?LinkID=83317) します。  
  
## <a name="high-level-system-bottlenecks"></a>高度なシステムのボトルネック  
 このセクションでは、BizTalk Server ソリューションと軽減策の戦略に存在する可能性のあるシステム レベルのボトルネックについて説明します。  
  
### <a name="disk-io-bottlenecks"></a>ディスク I/O のボトルネック  
 ディスク I/O は、読み取りと物理ディスク上のアプリケーションによって実行された書き込み操作またはサーバーにインストールされている複数のディスクの数を示します。 ディスク I/O、および関連するボトルネックを引き起こす可能性のある一般的なアクティビティには、実行時間の長いファイル I/O 操作、データの暗号化と復号化、データベース テーブル、およびページングが過剰につながる可能性が不足している、物理メモリから不要なデータの読み取りが含まれます。アクティビティ。 ディスク速度は、ディスク I/O のボトルネックを評価するときに考慮すべきもう 1 つの要素高速なディスクでは、パフォーマンスが向上し、ディスク I/O のボトルネックを低減します。  
  
 次の表では、ディスク サブシステムの BizTalk Server ソリューションを計画する際に考慮すべき要因を示します。  
  
|ディスク サブシステム要素|詳細|  
|---------------------------|-------------|  
|ディスクのメモリ キャッシュと使用可能な物理メモリ|ディスクの物理メモリが少なくなるように、必ずにキャッシュされるため、使用可能なメモリのための十分な量があります。 複数のページが書き込まれたメモリが不足するより大きなディスク アクティビティの結果としてディスクにします。 また、ページング ファイルを適切なサイズに設定することを確認してください。 メモリ キャッシュの追加のディスクはディスク I/O 要求のピーク オフセットに役立ちます。 ただし、に現象は、大容量ディスクのキャッシュがめったにありませんに、十分なスピンドルがなくなるの問題を解決し、大容量ディスクのメモリ キャッシュの必要性を負数化できる十分なスピンドルを持つことに注意してください。 最適なパフォーマンスの Windows ページング ファイルの構成方法の詳細については、」の [Windows の最適なパフォーマンスのページファイルの構成] セクションを参照してください。[オペレーティング システムのパフォーマンスの最適化](~/technical-guides/optimizing-operating-system-performance.md)します。|  
|記憶域コント ローラーの種類|キャッシュのバッテリ バックアップがある場合は、書き込みがトランザクション ログ ファイルのボリュームとデータベース ボリュームのディスク書き込みのパフォーマンスを向上させるためにキャッシュを有効にします。 書き込みキャッシュの書き込み I/O 要求、書き込みキャッシュが有効にすることがなく、10 ~ 20 ミリ秒の応答時間ではなく 2 ミリ秒以内の応答時間を提供します。 有効にする記述が大幅にキャッシュをクライアントの書き込み要求の応答性が向上します。 読み取りキャッシュでは、便利なのでのみ順次ディスク読み取りのトランザクション ログ ファイルでのみ発生する場合は、BizTalk Server シナリオでパフォーマンスは向上しません。<br /><br /> トランザクション ログ ファイルの読み取り元が再生されている場合にのみ、このようなデータベースの復元後に、またはサーバーは正しくシャット ダウンします。 サイズの大きいキャッシュより多くのデータはバッファーに格納彩度の長期間を確保できることを意味します。 コント ローラーは、キャッシュのページ サイズを構成することを許可している場合は、4 KB に設定する必要があります。 8 KB の結果より大きなサイズを無駄にキャッシュ 4 KB の I/O 要求は 8 KB のキャッシュ全体のページを半分に、使用可能なキャッシュの削減します。|  
|スピンドル|スピンドルが容量よりもより重要で、スピンドルがサポートする多数のランダムの I/O 要求と BizTalk Server のパフォーマンスが向上します。 プランのない複数の 80% のための十分な I/O がスピンドルの障害の場合でも、使用する使用率を合計します。|  
|Raid|コストとパフォーマンスのトレードオフは、環境に適したに基づいて、RAID ソリューションを使用する必要があります。 そのため、RAID ソリューションの 1 つ以上の型の場合は、特定のデータ ストレージ要件をお勧めします可能性があります。 一般的な推奨事項は次のとおりです。<br /><br /> -Raid の使用-1 + 0 (ミラー化された一連のストライプ セット) の BizTalk Server データベース。<br />-トランザクション ログ ファイルのボリュームの Raid 1 (ミラー化されたセット パリティなし) を使用します。<br />-一般に、Raid 5 は、最適な信頼性、可用性、およびその他の Raid 構成と比べるとパフォーマンスを指定しないために、Raid 5 (分散パリティ付きストライプ セット) は推奨されません。<br />-永続的なデータ損失の可能性をするため、Raid 0 (ストライプ セット パリティなし) の構成を BizTalk Server の運用環境で使用しないください。|  
|バスの種類|高いスループットでは、パフォーマンスが優れています。 一般に、SCSI バスでは、スループットとバスの IDE または ATA よりもスケーラビリティの向上を提供します。 次の式を使用して、バスの種類の理論的なスループットの上限を決定できます。<br /><br /> (Bits) の「バス速度/バイトあたり 8 ビット)動作速度 (MHz) x (MB/秒) でスループットを =<br /><br /> 複数のドライブを別の I/O バスに配置することで、ディスク I/O パフォーマンスを改善できます。|  
  
#### <a name="performance-counters-for-measuring-disk-io-bottlenecks"></a>ディスク I/O のボトルネックを測定するためのパフォーマンス カウンター  
  
> [!NOTE]
>  ディスク パフォーマンスのボトルネックを分析しようとすると、常に物理ディスク カウンターを使用する必要があります。 ただし、ソフトウェア RAID を使用する場合は、論理ディスク カウンターを使用する必要があります。 論理ディスクと物理ディスク カウンターでは、同じカウンターはの各カウンターのオブジェクトで使用できます。 ボリューム マネージャー (または管理者) の論理ディスクのデータが追跡され、物理ディスクのデータは、パーティション マネージャーによって追跡されます。  
  
 システムにディスク I/O 関連のボトルネックが発生しているかどうかを判断するには、次のパフォーマンス カウンターを使用してください。  
  
-   **Physicaldisk \avg.Disk Queue Length**  
  
    -   しきい値:2 を加えたスピンドルの数よりも大きくできないする必要があります。  
  
    -   重要:このカウンターは、両方の読み取りの平均数を示すし、サンプリング間隔中に、選択したディスクのキューに置かれた要求を書き込みます。 このカウンターは、データの急激な増加を含む、同時実行データを収集するために役立ちますし、ピークを読み込みます。 これらの値は、以下の統計情報の取得、ドライバーの処理中の要求の数を表します。 つまり、要求は必ずしもキュー登録されませんが、サービスに実際にある可能性がありますまたは完了し、方法でバックアップのパス。 使用可能な実行中の場所を以下に示します。  
  
        -   SCSIport または Storport のキュー  
  
        -   OEM ドライバー キュー  
  
        -   ディスク コント ローラーのキュー  
  
        -   ハード ディスクのキュー  
  
        -   アクティブにハード ディスクからの受信  
  
-   **Physicaldisk \avg.Disk Read Queue Length**  
  
    -   しきい値:2 より小さい必要があります。  
  
    -   重要:このカウンターは、サンプリング間隔中に、選択したディスクのキューに入っていた読み取り要求の平均数を示します。  
  
-   **Physicaldisk \avg.Disk Write Queue Length**  
  
    -   しきい値:2 より小さい必要があります。  
  
    -   重要:このカウンターは、サンプリング間隔中に、選択したディスクのキューに入っていた書き込み要求の平均数を示します。  
  
-   **Physicaldisk \avg.ディスク読み取り秒数**  
  
    -   しきい値:特定の値はありません。  
  
        -   未満の 10 ミリ秒 (ms) 良い =  
  
        -   15、25 ミリ秒の間で公平 =  
  
        -   25 ミリ秒を超える役に立たなかったを =  
  
    -   重要:このカウンターは、平均時間を秒単位の読み取り操作をディスクからデータを示します。 つまり、数が 25 ミリ秒 (ms) よりも大きい場合は、ディスクから読み取るときに、ディスク システムの待機時間が発生します。 BizTalk Server をホストするミッション クリティカルなサーバーでは、許容可能なしきい値は非常に低く、約 10 ミリ秒です。  
  
-   **Physicaldisk \avg.Disk Sec/write**  
  
    -   しきい値:特定の値はありません。  
  
        -   未満の 10 ミリ秒 (ms) 良い =  
  
        -   15、25 ミリ秒の間で公平 =  
  
        -   25 ミリ秒を超える役に立たなかったを =  
  
    -   重要:このカウンターは、平均時間 (秒) を示す、データの操作をディスクに書き込みます。 数が 25 ミリ秒よりも大きい場合は、ディスク システムにディスクに書き込むときに待ち時間が発生します。 BizTalk Server をホストするミッション クリティカルなサーバーでは、許容可能なしきい値は非常に低く、約 10 ミリ秒です。  
  
-   **Physicaldisk \avg.Disk sec/Transfer**  
  
    -   しきい値:18 以上 (ミリ秒) することはできません。  
  
    -   重要:このカウンターは、時間、ディスクの平均転送秒数を示します。 大量のディスクの断片化、ディスクが遅い場合、またはディスクの障害がある可能性があります。 値を乗算、 **Physical disk \avg. します。ディスク転送秒数**と **\pages/sec**カウンター。 使用可能な物理メモリを必要があるためこれらのカウンターの製品が 0.1 を超える場合に、ページングでのディスク アクセス時間、10% 以上がかかっています。  
  
-   **PhysicalDisk\Disk Writes/sec**  
  
    -   しきい値:製造元の仕様に依存します。  
  
    -   重要:このカウンターは、ディスクの書き込み操作の速度を示します。  
  
-   **プロセッサ\\% DPC Time、% Interrupt Time および % Privileged Time -** 割り込み時間の場合、遅延プロシージャ呼び出し (DPC) の時間が特権モード時間の大部分、カーネルが大量の I/O 要求の処理時間を費やしています。 マルチプロセッサ システムで割り込みおよび DPC アフィニティの Cpu の数が少ないを構成することによってパフォーマンスが向上することができる場合によっては、キャッシュの局所性が向上します。 それ以外の場合に最適の割り込みと Dpc がボトルネックになってから、割り込みと DPC アクティビティを保持するため、多くの Cpu 間で配布します。 割り込みフィルターの構成ツールを使用して、ネットワーク アダプターの割り込みをマルチプロセッサ コンピューターで特定のプロセッサにバインドする方法の詳細については、"ツールを使用して、割り込みフィルターの構成にネットワーク アダプターの割り込みを特定の場所にバインドする」セクションを参照してください。内のプロセッサ マルチプロセッサ コンピューターで"[オペレーティング システムのパフォーマンスの最適化](~/technical-guides/optimizing-operating-system-performance.md)します。  
  
-   **Processor\DPCs のキューに置かれた/秒 -** Dpc に CPU 時間とカーネルのリソースを消費している方法を測定します。  
  
-   **Processor\Interrupts/秒 -** 割り込みに CPU 時間とカーネルのリソースを消費している方法のもう 1 つの測定値。 最近のディスク コント ローラーは多くの場合、結合または割り込みを 1 つの割り込みは、複数の I/O 完了の処理で結果を結合します。 もちろん、割り込み (および入力候補) を遅らせることと、CPU 処理時間を economizing 間にトレードオフがあります。  
  
#### <a name="disk-io-tuning-options"></a>ディスク I/O のチューニング オプション  
 ディスク I/O が環境内のボトルネックであると判断した場合は、ボトルネックを軽減するため、次の手法を使用できます。  
  
-   **ディスクの断片化を解消**で使用可能な使用[PageDefrag ユーティリティ](http://go.microsoft.com/fwlink/?LinkId=108976)(http://go.microsoft.com/fwlink/?LinkId=108976) Windows ページング ファイルの断片化を解消し、マスター ファイル テーブルを事前に割り当てます。  
  
-   **使用してストライプ セットを複数のディスクの I/O 要求を同時に処理する**ミラー化されたボリュームを使用してフォールト トレランスを提供し、I/O パフォーマンスが向上します。 フォールト トレランスを必要としない場合の実装のストライプ セットが読み取りと書き込みを高速し、記憶域の容量を向上します。 ストライプ セットを使用している場合 1 つのディスク使用率が減少ため作業は、ボリューム間で配布され、全体的なスループットが向上します。 設定ストライプ ディスクを追加する場合は、システムにより、ディスク コント ローラーによってディスク間の競合によってボトルネックが発生する可能性があり、スループットを増加しません。 この場合、追加のディスク コント ローラーを追加することに役立つ負荷を分散し、パフォーマンスを向上させます。  
  
-   **-複数のドライブ間でワークロードを分散する**Windows クラスタ リングと分散ファイル システムは、複数のディスク ドライブで負荷分散のソリューションを提供します。  
  
-   **ファイル圧縮や暗号化の使用を制限**O 集約型の操作をファイルの圧縮と暗号化されます。 どうしても必要な場合にのみ、それらを使用しました。  
  
-   **短い名前 - の作成を無効にする**MS-DOS の Windows 3.x のクライアントをサポートしない場合は、パフォーマンスを向上させるために短い名前を無効にします。 短い名前の作成を無効にする方法の詳細についてを参照してください「短いファイル名 (8.3) の生成を無効にする」で[オペレーティング システムのパフォーマンスの最適化](~/technical-guides/optimizing-operating-system-performance.md)します。  
  
-   **アクセスの前回の更新を無効にする**ディレクトリを通過するたびに既定では、NTFS がディレクトリに最後にアクセスした日付と時刻のスタンプを更新します。 大規模な NTFS ボリュームの場合、この更新プロセスはパフォーマンスを妨げる場合があります。 最後のアクセスの更新プログラムを無効にする方法の詳細については、セクションをご覧ください。"で"NTFS 最後のアクセスの更新プログラムを無効に[オペレーティング システムのパフォーマンスの最適化](~/technical-guides/optimizing-operating-system-performance.md)します。  
  
    > [!CAUTION]
    >  、増分バックアップ ユーティリティなど、一部のアプリケーションでは、NTFS の更新プログラムの情報に依存し、なしで適切に機能しません。  
  
-   **マスター ファイル テーブルに適切な領域を予約**追加、 **NtfsMftZoneReservation**には、通常、NTFS ボリュームに格納されるファイルの数に応じて、レジストリ エントリ。 このエントリをレジストリに追加すると、システムは、マスター ファイル テーブルのボリュームの領域を予約します。 この方法での領域を予約すると、最適に拡大するマスター ファイル テーブルが使用できます。 一般に、NTFS ボリュームは比較的いくつかのファイルを保存する場合、は、既定値の 1 にこのレジストリ エントリの値を設定します。 通常、NTFS ボリューム、ファイルの中程度の数値を格納し、NTFS ボリュームは、比較的多数のファイルを格納する傾向がある場合は、4 (最大) の値を使用する場合は、2 または 3 の値を使用できます。 ただし、必ず 2 より大きいすべての設定をテストするため、これらのより大きな値により、マスター ファイル テーブルのディスクの量に大きな部分を予約するシステムです。 追加の詳細については、 **NtfsMftZoneReservation**をレジストリに、セクション「増加 space マスター ファイル テーブルに」を参照してください。[オペレーティング システム パフォーマンスの最適化](~/technical-guides/optimizing-operating-system-performance.md)します。  
  
-   **-使用可能な最も効率的なディスク システムを使用して**のために使用される、物理ディスクに加えて使用されるディスク コント ローラー、ケーブル接続の種類を検討してください。 効率的なディスク サブシステムには、割り込み節度またはディスク I/O によるプロセッサの割り込み処理状況を軽減するために中断を回避することをサポートするドライバーも提供する必要があります。  
  
-   **適切な RAID 構成 - を使用していることを確認**最適なパフォーマンスとフォールト トレランスのための使用 RAID 10 (ストライピングとミラーリング)。 トレードオフは、RAID 10 を使用して高価です。 広範な書き込み操作がある場合は、RAID 5 を使用しないでください。 BizTalk Server 環境での RAID の実装に関する詳細については、「ディスク インフラストラクチャ」セクションを参照してください、 [BizTalk Server データベースの最適化に関するホワイト ペーパー](http://go.microsoft.com/fwlink/?LinkID=101578) (http://go.microsoft.com/fwlink/?LinkID=101578) します。  
  
-   **検討してください - データベースのパーティションを使用して**データベース パーティションを使用して、特定のテーブルとトランザクション ログへのディスクのマッピングをデータベースのボトルネックがある場合を検討してください。 パーティションの主な目的は、大きなテーブルのディスクのボトルネックを克服するためにです。 多くの行を含むテーブルがあり、ボトルネックの原因があると判断した場合は、パーティションの使用を検討してください。 SQL server の I/O パフォーマンスを向上させるためにファイル グループを使用できます。 ファイル グループにテーブルを関連付けるし、特定のハード ディスク ファイル グループを関連付けることができます。 詳細については、BizTalk Server データベースの最適化ファイル グループを使用して、次を参照してください。[データベースのファイル グループを最適化する](~/technical-guides/optimizing-filegroups-for-the-databases2.md)します。  
  
-   **物理メモリの追加を検討していれば、過度のページ フォールト -** の値が大きい、**メモリ。ページ/秒**過度なページング ディスクが増加する可能性がパフォーマンス カウンターは 0。 このような場合は、ディスク I/O を削減し、パフォーマンスが向上する物理メモリを追加することを検討してください。  
  
-   **評価またはストレージ エリア ネットワーク (SAN) を使用して、高い RPM ディスクを使用するデバイス -** RPM の評価の向上を使用したディスクは、RPM の評価が低いでディスクと比較してパフォーマンスの向上を提供します。 SAN デバイスは、通常、最上位層のパフォーマンスを提供が価格重視します。  
  
-   推奨事項に従い[データベースのパフォーマンスの最適化](~/technical-guides/optimizing-database-performance.md)します。 このトピックでは前に、と後に BizTalk Server 構成データベースのパフォーマンスを最適化するためのいくつかの推奨事項を提供します。  
  
### <a name="cpu-bottlenecks"></a>CPU のボトルネック  
 サーバーで実行されている各アプリケーションは、CPU のタイム スライスを取得します。 CPU は、すべてのコンピューターで実行されているプロセスを効率的に処理できる場合があります。 またはオーバー ロードがあります。 プロセッサ アクティビティとスレッドの作成、スレッドの切り替えとコンテキストの切り替えを含む個々 のプロセスのアクティビティを確認するには、プロセッサの負荷やパフォーマンスに関する洞察を得ることができます。  
  
#### <a name="you-may-have-a-cpu-bottleneck-if"></a>場合は、CPU のボトルネックがあります.  
  
-   値、**プロセッサ\\% Processor Time**パフォーマンス カウンターは多くの場合、75% を超えています。  
  
-   値、**システムの Processor Queue Length**パフォーマンス カウンターは、しばらくの間の 2 つ以上。  
  
-   値、**プロセッサ\\% Privileged Time**または**system \context switches/sec**パフォーマンス カウンターが異常に高いです。  
  
     場合の値**processor \ % Processor Time**パフォーマンス カウンターが高い、し、キューに配置、およびほとんどのシナリオでの値**システムの Processor Queue Length**も大きくなります。  
  
#### <a name="performance-counters-for-measuring-cpu-bottlenecks"></a>CPU のボトルネックを測定するためのパフォーマンス カウンター  
 システムに関連する CPU のボトルネックが発生しているかどうかを判断するには、次のパフォーマンス カウンターを使用してください。  
  
-   **プロセッサ\\プロセッサ時間の割合**  
  
    -   しきい値:85% 未満である必要があります。  
  
    -   重要:このカウンターは、プロセッサ アクティビティのプライマリ インジケーターです。 値が高い多く必ずしもとは限らない。 ただし、プロセッサに関連するカウンターが次のように直線的に増加しているかどうかは**プロセッサ\\% Privileged Time**または**system \processor Queue Length**、価値の高い CPU 使用率があります調査中です。  
  
-   **プロセッサ\\特権モード時間の割合**  
  
    -   しきい値:一貫した方法が 75% を超えるを図では、ボトルネックを示します。  
  
    -   重要:このカウンターは、スレッドが特権モードで実行時間の割合を示します。 アプリケーション (たとえば、ファイルまたはネットワーク I/O を実行する、またはメモリを割り当てるなど) のオペレーティング システム関数を呼び出すときに、これらのオペレーティング システム関数が特権モードで実行されます。  
  
-   **プロセッサ\\割り込み時間の割合**  
  
    -   しきい値:プロセッサによって異なります。  
  
    -   重要:このカウンターは、プロセッサがハードウェア割り込みを受け取ってに費やした時間の割合を示します。 この値は、ネットワーク アダプターなど、割り込みを発生するデバイスの処理状況を間接的に示します。 このカウンターが大幅に向上では、潜在的なハードウェアの問題を示します。  
  
-   **System\Processor Queue Length**  
  
    -   しきい値:2 よりも一貫して高い平均値では、ボトルネックになっていることを示します。  
  
    -   重要:プロセッサがより多くを実行する準備がより多くのタスクがある場合は、スレッドがキューです。 プロセッサのキューは、準備しますですが、別のスレッドが現在実行しているため、プロセッサによって実行されることができないのスレッドのコレクションです。 複数の 2 つのスレッドの継続的または定期的なキューは、プロセッサのボトルネックを明確に示しています。 そのような場合に並列処理を減らすことより多くのスループットを取得可能性があります。  
  
         と共にこのカウンターを使用することができます、**プロセッサ\\% Processor Time**カウンター Cpu からかどうか、アプリケーションを利用できます。 1 つのキュー、プロセッサ時間のマルチプロセッサ コンピューターでも。 そのため、マルチプロセッサ コンピューターでは、ワークロードを処理するプロセッサの数でプロセッサ キューの長さ (PQL) 値で除算します。  
  
         CPU が非常にビジー状態の (90% または高い使用率) と PQL 平均が 1 プロセッサあたり 2 より一貫して高い場合、Cpu の追加の恩恵プロセッサのボトルネックがあります。 または、アプリケーション レベルで複数のスレッドとキューの数を減らすことができます。 これにより、少ないコンテキストの切り替えと CPU 負荷を削減するための適切な少なくコンテキストの切り替えが。 CPU 使用率が低い 2 以上の PQL 値の一般的な理由は、プロセッサ時間の要求がランダムに到着し、スレッド、プロセッサ時間の不規則な金額を要求することです。 これは、ため、プロセッサがボトルネックではないことが、アプリケーションのスレッドのロジックを改善する必要があります。  
  
-   **System\Context Switches/sec**  
  
    -   しきい値:一般的な規則として、コンテキストの切り替え率は心配には 1 プロセッサあたり 1 秒あたり 5,000 未満。 コンテキスト切り替えの率が 1 プロセッサあたり 1 秒あたり 15,000 を超える場合、コンテキストの切り替えがボトルネックとなります。  
  
    -   重要:コンテキストの切り替えには、優先度の高いスレッドが現在実行されている、または優先度の高いスレッドが他のスレッドをブロックする場合は、低い優先順位のスレッドを横取りときに発生します。 高レベルのコンテキストの切り替えは、多数のスレッドが同じ優先度レベルを共有する場合に発生します。 これは、多くの場合、システムのプロセッサを競合するスレッドが多すぎますがあることを示します。 プロセッサ使用率とコンテキストの切り替えのレベルが低い場合は、これは、多くの場合、スレッドがブロックされていることを示す値です。  
  
#### <a name="resolving-cpu-bottlenecks"></a>CPU のボトルネックを解決します。  
 最初の手順は、どのプロセスが使用して過度なプロセッサ時間を識別するためにです。 Windows を使用して、**タスク マネージャー**どのプロセスが調べることで高レベルの CPU を消費しているかを識別するために、 **CPU**列に、**プロセス**ページ。 監視することによっても判断できます**プロセス\\% Processor Time**にパフォーマンス モニター、監視するプロセスを選択します。  
  
 過剰な CPU 時間を消費しているプロセスを決定するための別の強力なツールでは、Visual Studio Team System (VSTS) スイートで使用できるは Visual Studio チームのシステム Profiler です。 Visual Studio Team System の Profiler の使用に関する詳細については、Visual Studio Team System のドキュメントを参照してください。  
  
 CPU がボトルネックであると決定した後、次のいくつかのオプションがあります。  
  
-   マルチ スレッド アプリケーションがある場合は、複数のプロセッサを追加します。 アプリケーションがシングル スレッドの場合より強力なプロセッサにアップグレードすることを検討してください。  
  
-   コンテキストの切り替えの率が高いを確認する場合は、プロセッサの数を増やす前に、プロセスのスレッド数を減らすことを検討してください。  
  
-   分析し、高い CPU 使用率が原因となっているアプリケーションを調整します。 ADPLUS ユーティリティを使用して、実行中のプロセスをダンプし、Windbg を使用して原因を分析することができます。 これらのユーティリティは、Windows のツールキットのデバッグの一部です。 これらのツールをダウンロードする[ツールを Windows のデバッグ](http://go.microsoft.com/fwlink/?LinkID=106624)(http://go.microsoft.com/fwlink/?LinkID=106624) します。  
  
-   最長実行時間がかかっているサブシステムを分離するアプリケーションによって生成されるインストルメンテーション ログを分析します。 コード レビューを BizTalk Server 環境のチューニングだけよりは有益になるかどうかを決定します。  
  
> [!NOTE]
>  使用して、アプリケーションのプロセス優先度レベルを変更できますが、**タスク マネージャー**からコマンド プロンプトで、一般に避けるべきこと、または。  
  
### <a name="memory-bottlenecks"></a>メモリのボトルネック  
 メモリ関連のボトルネックを評価するときに、不要な割り当て、クリーンアップする非効率的で不適切なキャッシュ、および状態管理メカニズムを検討してください。 メモリ関連のボトルネックを解決するには、これらの問題を排除し、アプリケーションに割り当てられたメモリの量を調整し、コードを最適化します。 メモリの競合と過剰なページングが発生しているサーバーに物理メモリを追加する必要がありますをチューニング中に決定します。 メモリ不足は、アプリケーションの仮想アドレス空間やディスクからのページングの増加につながります。 ページングが過剰になると、ディスク I/O が増加し、システム全体のパフォーマンスに悪影響を与えます。  
  
#### <a name="you-might-have-a-memory-bottleneck-if"></a>場合は、メモリのボトルネックがあります.  
  
-   値、 **memory \available MBytes**パフォーマンス カウンターは、いずれかのシステム メモリの制限事項またはアプリケーションがメモリを解放していない理由は低いです。 値を監視、 **process \working Set**を実行している各プロセスのパフォーマンス カウンター。 場合の値、 **process \working Set**が、プロセスがメモリを解放しないことを示す値があります、プロセスがアクティブでない場合でも高のままです。  
  
-   値、 **\pages/sec**パフォーマンス カウンターが高い。 平均**memory \pages input/sec**の平均で割った値**memory \page reads/sec**ディスクあたりの読み取りページ数を示します。 この値は、1 秒あたり 5 つのページを通常以下する必要があります。 1 秒あたり 5 つのページ数よりも大きい値は、システムがあまり時間のページングが取られて、(アプリケーションを最適化することを想定) より多くのメモリが必要だことを示します。  
  
#### <a name="performance-counters-for-measuring-memory-bottlenecks"></a>メモリのボトルネックを測定するためのパフォーマンス カウンター  
 システムにメモリ関連のボトルネックが発生しているかどうかを判断するには、次のパフォーマンス カウンターを使用してください。  
  
-   **Memory \available Mbytes**  
  
    -   しきい値:インストールされている RAM の 20 ~ 25% 未満の一貫性のある値は、メモリ不足を示す値です。  
  
    -   重要:これは、コンピューターで実行されているプロセスに使用できる物理メモリの量を示します。 このカウンターが最後に計測された値のみを表示することに注意してください。 平均ではありません。  
  
-   **Memory\Page Reads/sec**  
  
    -   しきい値:5 つ以上の持続的な値では、読み取り要求のページ フォールトの数が多いを示します。  
  
    -   重要:このカウンターは、プロセスのワーキング セットがメモリをディスクにページを原因となっている使用可能な物理メモリに対して大きすぎることを示します。 これには、各操作で取得されたページ数に関係なく、読み取り操作数が表示されます。 高い値は、メモリのボトルネックを示します。  
  
         値が大きいと一致するページの読み取り操作の率が低い、かどうか**物理ディスク\\% Disk Time**と**Physical disk \avg. します。Disk Queue Length**、ディスク I/O のボトルネックの条件が存在する可能性があります。 キューの長さの増加が付属ページ読み取り速度が低下していない、いる場合は、物理メモリの不足が原因メモリのボトルネックが存在します。  
  
-   **Memory\Pages/sec**  
  
    -   しきい値:6 つ以上の持続的な値には、ボトルネックになっていることを示します。  
  
    -   重要:このカウンターは、ページの読み取り、ハード ページ フォールトを解決するのにはディスクに書き込まれる位置の速度を示します。 値を乗算、 **Physical disk \avg. します。ディスク転送秒数**と **\pages/sec**パフォーマンス カウンター。 これらの値の積を超えた場合**0.1**ページングが使用している 10% を超えるディスク アクセス時間は、十分な物理メモリが使用できることを示します。  
  
-   **Memory\Pool Nonpaged Bytes**  
  
    -   しきい値:値を観察**memory \pool Nonpaged Bytes**のシステムの起動時にその値から 10% 以上増加します。  
  
    -   重要:起動時に値から 10% 以上増加には、メモリ リークを示す可能性があります。  
  
-   **Server\Pool Nonpaged エラー**  
  
    -   しきい値:正規表現のゼロ以外の値は、ボトルネックを示します。  
  
    -   重要:このカウンターは、非ページ プールから割り当てが失敗した回数を示します。 非ページ プールには、カーネル オブジェクト テーブルの処理などのディスク上のページファイルにスワップ アウトをプロセスの仮想アドレス空間からのページが含まれています。 このようなオブジェクトを作成できます数のプロセス、スレッド、およびその他の非ページ プールの可用性を決定します。 非ページ プールからの割り当てが失敗したときに、プロセッサ使用率がそれに応じて増加しない場合に特にプロセスでは、メモリ リークが原因するこのことができます。  
  
-   **Server\Pool ページ エラー**  
  
    -   しきい値:特定の値はありません。  
  
    -   重要:このカウンターは、ページ プールから割り当てが失敗した回数を示します。 このカウンターの正の値は、コンピューターの十分な物理メモリがあるか、Windows ページング ファイルが小さすぎることを示します。  
  
-   **Server\Pool 非ページのピーク**  
  
    -   しきい値:特定の値はありません。  
  
    -   重要:これは、任意の時点で使用するため、サーバーが予約されている非ページ プール内のバイトの最大数です。 コンピューターに搭載する物理メモリの量を示します。 あるため、非ページ プールの物理メモリに常駐している必要があるので、残された、他の操作を経験則として、コンピューターのメモリが 4 回このカウンターに対して指定された値である物理メモリをインストールが必要があります。  
  
-   **Memory\Cache Bytes**  
  
    -   しきい値:特定の値はありません。  
  
    -   重要:さまざまな負荷条件下でキャッシュのサイズを監視します。 このパフォーマンス カウンターの値では、静的ファイルのキャッシュのサイズを示します。 使用可能なメモリが圧縮する場合既定では、このカウンターが使用可能なメモリが減少の約 50% を使用するシステムのパフォーマンスに影響を与えます。  
  
-   **Memory\Cache Faults/sec**  
  
    -   しきい値:特定の値はありません。  
  
    -   重要:このカウンターは、オペレーティング システムがどのくらいの頻度は、ファイル システム キャッシュ内のデータ検索は、方が失敗した場合を示します。 この値は、できるだけ低い値にする必要があります。  
  
-   **Cache\MDL 読み取りヒット率**  
  
    -   しきい値:高く値のファイル システム キャッシュのパフォーマンスは向上します。 できる限り 100% に近い値になります。  
  
    -   重要:このカウンターは、パーセントのメモリ記述子一覧 (MDL) ハード ディスクからの読み取りを必要とするのではなく、読み取り要求が、オブジェクトを返すキャッシュ直接、ファイル システム キャッシュを提供します。  
  
-   **Process \working Set**  
  
    -   しきい値:特定の値はありません。  
  
    -   重要:ワーキング セットは、メモリ (物理 + 仮想) で現在読み込まれているメモリ ページのセットです。 システムに十分なメモリがある場合、ページのメモリをディスクにディスクの操作を実行する必要はありませんように、ワーキング セットに十分な領域を維持できます。 ただし、十分なメモリがある場合、システムは作業を行うページ フォールトの増加につながりますプロセスのメモリ設定を削減しようとします。 ページ フォールト数が増え、システムはプロセスのワーキング セットの増加しようとします。 ワーキング セットの幅の変動を確認する場合、メモリが不足していることを示す場合します。 ワーキング セットの値が大きいほどは、アプリケーションの複数のアセンブリにより場合もあります。 アセンブリをグローバル アセンブリ キャッシュ内の共有を使用して設定する作業を向上できます。  
  
#### <a name="resolving-memory-bottlenecks"></a>メモリのボトルネックを解決します。  
 そのメモリと判断した場合は、ボトルネックを解決するのには、次の方法の 1 つ以上を使用して、BizTalk Server 環境のボトルネックを示します。  
  
-   割り当てを制御する場合に割り当てられたメモリの量を調整します。 たとえば、BizTalk Server、ASP.NET および SQL Server のこのを調整できます。  
  
-   Windows ページング ファイルのサイズを増やすし、「Windows ページファイルの最適なパフォーマンスの構成」のセクションの手順に従って[オペレーティング システムのパフォーマンスの最適化](~/technical-guides/optimizing-operating-system-performance.md)します。  
  
-   使用されていないサービスをオフにします。 定期的に使用しないサービスを停止すると、メモリを節約し、システム パフォーマンスが向上します。 詳細については、「不要なサービスを無効にする」セクションを参照してください。[オペレーティング システムのパフォーマンスの最適化](~/technical-guides/optimizing-operating-system-performance.md)します。  
  
-   不要なプロトコルとドライバーを削除します。 アイドル状態のプロトコルでは、ページおよび非ページ メモリ プールの領域を使用します。 ドライバーは、不要なものを削除する必要がありますようにも、メモリを消費します。 詳細については、「不要なネットワーク プロトコルを削除する」セクションを参照してください。[オペレーティング システムのパフォーマンスの最適化](~/technical-guides/optimizing-operating-system-performance.md)します。  
  
-   BizTalk Server 環境内のコンピューターでは、追加の物理メモリをインストールします。  
  
> [!NOTE]
>  32 ビット システムでには、3 GB スイッチを使用する場合に BizTalk Server 2010 以降のバージョンと 3 GB、limit も増え、BizTalk が 2 GB のメモリの最大値を使用できます。 メモリ使用量の詳細については、次を参照してください。[メモリ制限の Windows リリース](http://go.microsoft.com/fwlink/?LinkId=118349)(http://go.microsoft.com/fwlink/?LinkId=118349) します。  
  
### <a name="network-io-bottlenecks"></a>ネットワーク I/O のボトルネック  
  
#### <a name="you-might-have-a-network-io-bottleneck-if"></a>場合は、ネットワーク I/O のボトルネックがあります.  
  
-   値、 **Network interface \bytes total/sec**パフォーマンス カウンターが使用可能なネットワーク帯域幅の 80% を超えています。  
  
-   値、 **server \bytes total/sec**パフォーマンス カウンターが使用可能なネットワーク帯域幅の 50% より大きい。  
  
#### <a name="performance-counters-for-measuring-network-io-bottlenecks"></a>ネットワーク I/O のボトルネックを測定するためのパフォーマンス カウンター  
 次のパフォーマンス カウンターは、ネットワーク I/O を測定し、システムにネットワーク I/O 関連のボトルネックが発生しているかどうかを判断するために使用する必要があります。  
  
-   **Network interface \bytes total/sec**  
  
    -   しきい値:ネットワーク容量の 80% 以上の持続的な値です。  
  
    -   重要:このカウンターは、各ネットワーク アダプタ上で送受信されるバイトの率を示します。 このカウンターは、ネットワーク アダプターが飽和状態にし、使用可能なネットワーク帯域幅を増やす 1 つまたは複数のネットワーク アダプターを追加する必要があるかどうかを判断するのに役立ちます。  
  
-   **Network interface \bytes received/sec**  
  
    -   しきい値:特定の値はありません。  
  
    -   重要:このカウンターは、各ネットワーク アダプタ上でデータ バイトが受信される速度を示します。 使用可能な帯域幅の合計の割合としての受信データの割合を計算するのにには、このカウンターの値を使用します。 BizTalk Server または BizTalk Server コンピューター自体にネットワーク帯域幅を増やす必要があるかどうかにデータを送信しているクライアントのネットワーク帯域幅を増やす必要があるかどうかができます。  
  
-   **Network interface \bytes sent/sec**  
  
    -   しきい値:特定の値はありません。  
  
    -   重要:このカウンターは、各ネットワーク アダプタ上でバイトが送信される速度を示します。 使用可能な帯域幅の合計の割合として送信されるデータの割合を計算するのにには、このカウンターの値を使用します。 これにより、クライアントにデータを送信している BizTalk Server でネットワーク帯域幅を増やす必要がありますか場合は、BizTalk Server からクライアント コンピューターの受信データのネットワーク帯域幅を増やす必要がありますかを判断できます。  
  
-   **Server \bytes total/sec**  
  
    -   しきい値:ネットワーク容量の 50% 以上の持続的な値です。  
  
    -   重要:このカウンターは、ネットワーク経由で送受信されたバイト数を示します。 高い値は、ネットワーク I/O のボトルネックを示します。 場合の合計**Bytes total/sec**すべてのサーバーがネットワークの最大転送速度をほぼ等しくなければならないのは、パフォーマンスを向上させるために、ネットワークのサブネットを検討してください。 パフォーマンスを向上させるために、ネットワークのサブネットの詳細については、次を参照してください。、**サブネット**のセクション、 [BizTalk Server データベースの最適化に関するホワイト ペーパー](http://go.microsoft.com/fwlink/?LinkID=101578) (http://go.microsoft.com/fwlink/?LinkID=101578) します。  
  
#### <a name="resolving-network-io-bottlenecks"></a>ネットワーク I/O のボトルネックを解決します。  
 ネットワーク I/O が環境内のボトルネックであると判断した場合は、ボトルネックを解決するのには、次の方法の 1 つ以上を使用します。  
  
-   「ネットワークのパフォーマンスを向上させるための一般的なガイドライン」のセクションで推奨事項に従って[ネットワークのパフォーマンスの最適化](~/technical-guides/optimizing-network-performance.md)します。  
  
-   トピックで説明されている Windows Powershell のネットワーク最適化スクリプトを実行[ネットワークのパフォーマンスの最適化](~/technical-guides/optimizing-network-performance.md)BizTalk Server 環境内の各コンピューターにします。  
  
## <a name="see-also"></a>参照  
 [ボトルネックの検索と解消](~/technical-guides/finding-and-eliminating-bottlenecks.md)