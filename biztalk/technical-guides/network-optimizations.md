---
title: ネットワーク最適化 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 9ff0392f-37ae-4ca6-8cc6-d53065de64c5
caps.latest.revision: 6
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 66419a1c864b4c22d4fb28a70c85cabf2eceb1a8
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/27/2018
ms.locfileid: "36994795"
---
# <a name="network-optimizations"></a>ネットワークの最適化
BizTalk Server コンピューターが SQL Server コンピューターから独立した BizTalk Server 環境で BizTalk Server によって処理される各メッセージには、ネットワーク経由で通信が必要です。 この通信には、BizTalk Server コンピューターと BizTalk メッセージ ボックス データベース、BizTalk 管理データベース、BAM データベース、および他のデータベース間のかなりのトラフィックが含まれています。 高負荷のシナリオでこの通信により、かなりのネットワーク トラフィックとネットワークの設定が最適化されていない、十分なネットワーク インターフェイス カードがインストールされている場合、または十分なネットワーク帯域幅が場合は特に、ボトルネックになることができます。ご利用いただけます。  
  
 このトピックでは、同じ HYPER-V ホスト コンピューターで実行されている HYPER-V 仮想マシン間のネットワークのパフォーマンスを向上させるための手順を提供し、ネットワークのパフォーマンスを向上させるための一般的な推奨事項を提供します。  
  
> [!NOTE]  
>  ネットワーク IO がボトルネックである最も一般的なインジケーター カウンターは、「SQL Server: Wait Statistics\Network IO 待機します」。 ときの値は、**平均待機時間**このカウンターの値がより大きい 0 個の 1 つ以上、SQL Server コンピューターのネットワークの IO がボトルネックになっています。  
  
## <a name="improving-network-performance-of-biztalk-server-on-hyper-v"></a>Hyper V 上の BizTalk Server のネットワーク パフォーマンスを向上させる  
  
### <a name="configure-hyper-v-virtual-machines-that-are-running-on-the-same-hyper-v-host-computer-to-use-a-private-virtual-network"></a>プライベート仮想ネットワークを使用する同じ HYPER-V ホスト コンピューターで実行されている HYPER-V 仮想マシンの構成します。  
 実行されている HYPER-V 仮想マシン間のネットワークのパフォーマンスを向上させるために、同じ HYPER-V ホスト コンピューターは、プライベート仮想ネットワークとルート間のネットワーク トラフィックのプライベート仮想ネットワーク経由で仮想マシンを作成します。  
  
##### <a name="create-a-private-virtual-network"></a>プライベート仮想ネットワークを作成します。  
  
1.  クリックして**開始**、 をクリックして**すべてのプログラム**します。 をクリックして**管理ツール**、 をクリックし、 **、HYPER-V マネージャー**します。  
  
2.  HYPER-V マネージャーの左側のウィンドウで右クリック **、HYPER-V マネージャー**、 をクリックし、**サーバーへの接続**します。  
  
3.  **コンピューターの選択** ダイアログ ボックスで、HYPER-V ホスト コンピューターの名前を入力し、順にクリックします**OK**します。  
  
4.  HYPER-V マネージャーの左側のウィンドウで、HYPER-V ホストを右クリックし、**仮想ネットワーク マネージャー**します。  
  
5.  仮想ネットワーク マネージャーで **を作成する仮想ネットワークの種類ですか?**、 をクリックして**プライベート**、 をクリックし、**追加**。  
  
6.  新しい仮想ネットワークでの名前を入力し、クリックして**OK**します。 仮想ネットワークは、この HYPER-V ホスト上で実行される各 HYPER-V 仮想マシンにご利用いただけます。  
  
##### <a name="add-the-private-virtual-network-to-hyper-v-virtual-machines-running-on-the-hyper-v-host"></a>プライベート仮想ネットワークに HYPER-V 仮想マシンを追加、HYPER-V ホストで実行されています。  
  
1.  クリックして**開始**、 をクリックして**すべてのプログラム**します。 をクリックして**管理ツール**、 をクリックし、 **、HYPER-V マネージャー**します。  
  
2.  HYPER-V マネージャーの左側のウィンドウで右クリック **、HYPER-V マネージャー**、 をクリックし、**サーバーへの接続**します。  
  
3.  **コンピューターの選択** ダイアログ ボックスで、HYPER-V ホスト コンピューターの名前を入力し、順にクリックします**OK**します。  
  
4.  仮想マシンを右クリックし、をクリックして、プライベート仮想ネットワークを追加するなど、実行中の仮想マシンをシャット ダウン**シャット ダウン**します。  
  
5.  仮想マシンをシャット ダウン後、仮想マシンを右クリックし、**設定**仮想マシンの設定を変更します。  
  
6.  **< コンピューター名 > の設定**ダイアログ ボックスで、**ハードウェアの追加**をクリックして選択**ネットワーク アダプター**、 をクリックし、**追加**.  
  
7.  **ネットワーク アダプター**構成ページの**ネットワーク:**、先ほど作成したプライベート仮想ネットワークを選択し、クリックして**OK**します。 ここで行ったプライベート仮想ネットワークがアクセスできる、次回の仮想マシンを起動する HYPER-V 仮想マシンで使用可能。  
  
8.  各仮想マシンのプライベート仮想ネットワークを経由のネットワーク トラフィックをルーティングするには、上記の手順を繰り返します。  
  
9. プライベート仮想ネットワークを追加した仮想マシンを起動します。 各仮想マシンを右クリックし、をクリックして**開始**します。  
  
##### <a name="configure-each-virtual-machine-to-use-the-private-virtual-network"></a>プライベート仮想ネットワークを使用するには、各仮想マシンの構成します。  
  
1.  各仮想マシンが開始されると、プライベート仮想ネットワークは仮想マシンにアクセスできるネットワーク接続として。 Tcp/ipv4 を使用するには、各仮想マシンにネットワーク接続を構成し、TCP または IPv4 プロトコルの設定を指定します。  
  
    1.  ネットワーク接続のプロパティ ページにアクセスを選択します**インターネット プロトコル バージョン 4(TCP/IPv4)**、 をクリックし、**プロパティ**します。  
  
    2.  横にあるラジオ ボタンをクリックして**次の IP アドレスを使用して、** します。  
  
2.  値を入力、 **IP アドレス**プライベート IP の範囲からのフィールドに内で識別された"RFC 1918 プライベート IP アドレスのアドレスの割り当て"のアドレス[ http://go.microsoft.com/fwlink/?LinkID=31904](http://go.microsoft.com/fwlink/?LinkID=31904)します。  
  
3.  指定した IP アドレスをメモしてをおきますこの値を後で、ホスト ファイル エントリには、このコンピューターの NetBIOS 名に関連付ける必要があります。  
  
4.  適切な値を入力して、**サブネット マスク**フィールド。  
  
    > [!NOTE]  
    >  Windows を設定する必要があります、**サブネット マスク**に入力した値に基づいて、適切な値フィールド、 **IP アドレス**フィールド。  
  
5.  ままに、**デフォルト ゲートウェイ**フィールドの空白、 をクリック**OK**、順にクリックします**閉じる**します。  
  
6.  一意のプライベート IP アドレスを各仮想マシンを構成した後、HYPER-V ホスト コンピューターで実行されている他の仮想マシンの NetBIOS 名と IP アドレスと各仮想マシン上の HOSTS ファイルを更新します。 更新されたホスト ファイルは、各仮想マシンに %systemroot%\drivers\etc\ フォルダーに保存する必要があります。  
  
    > [!NOTE]  
    >  既定では、Windows は、他の仮想マシンの一意のプライベート IP アドレスと各仮想マシン上の HOSTS ファイルを更新することで NetBIOS 名を解決するのには、ローカルの HOSTS ファイルを確認しますので、これらのマシン間のネットワーク トラフィックは経由でルーティングようになりましたプライベート仮想ネットワーク。  
  
### <a name="disable-tcp-offloading-for-the-virtual-machine-network-cards"></a>TCP オフロード、仮想マシンのネットワーク カードを無効にします。  
 「を使用してタスク オフロード (NDIS 5.1) を無効にするレジストリ値」MSDN のトピックの説明に従ってレジストリを編集[ http://go.microsoft.com/fwlink/?LinkId=147619 ](http://go.microsoft.com/fwlink/?LinkId=147619) TCP オフロード、各仮想マシンのネットワーク カードを無効にします。  
  
> [!IMPORTANT]  
>  レジストリ エディターの不適切な使用により問題が発生し、オペレーティング システムの再インストールが必要となることがあります。 レジストリ エディターは、ご自身の責任で使用してください。 バックアップ、復元、およびレジストリを変更する方法の詳細についてで、マイクロソフト サポート技術情報記事「Microsoft Windows レジストリの説明」を参照して[ http://go.microsoft.com/fwlink/?LinkId=62729](http://go.microsoft.com/fwlink/?LinkId=62729)します。  
  
## <a name="general-guidelines-for-improving-network-performance"></a>ネットワーク パフォーマンスを向上させるための一般的なガイドライン  
 ネットワーク パフォーマンスを向上させるのには、次の推奨事項を使用できます。  
  
### <a name="add-additional-network-cards-to-computers-in-the-biztalk-server-environment"></a>BizTalk Server 環境内のコンピューターに追加のネットワーク カードを追加します。  
 だけに追加する追加のハード ドライブは、ディスクのパフォーマンスを向上させることができます、追加のネットワーク カードを追加するには、ネットワーク パフォーマンスが向上します。 BizTalk Server 環境内のコンピューター上のネットワーク カードが飽和状態し、カードは、ボトルネック、パフォーマンスを向上させるために 1 つまたは複数のネットワーク カードを追加することを検討してください。  
  
### <a name="implement-network-segmentation"></a>ネットワークのセグメント化を実装します。  
 推奨事項に従い、**サブネット**「BizTalk Server データベースの最適化」ホワイト ペーパーの「 [ http://go.microsoft.com/fwlink/?LinkID=101578](http://go.microsoft.com/fwlink/?LinkID=101578)します。  
  
### <a name="where-possible-replace-hubs-with-switches"></a>可能であれば、スイッチを使用してハブを置き換えます  
 スイッチには、直接ハブを使用して、トラフィックをルーティングするブロードキャスト モデルは、ソースと宛先の間のトラフィックをルーティングするためのロジックが含まれています。 そのためスイッチは効率的で、パフォーマンスが向上します。  
  
### <a name="remove-unnecessary-network-protocols"></a>不要なネットワーク プロトコルを削除します。  
 Windows Server コンピューターでは、多くのネットワーク サービスと実際に必要とされる以上がインストールされているプロトコルがある場合があります。 各追加ネットワーク クライアント、サービスまたはプロトコルを配置追加オーバーヘッドのシステム リソース。  
  
 さらに、インストールされている各プロトコルは、ネットワーク トラフィックを生成します。 不要なネットワーク クライアント、サービス、およびプロトコルを削除すると、他のプロセスの使用可能なシステム リソース、過剰なネットワーク トラフィックを避け、ネゴシエートする必要がありますネットワーク バインドの数が最小限に減らします。  
  
 プロトコルとサービスを現在インストールされているネットワーク クライアントを表示するには、これらの手順に従います。  
  
1. をクリックして**開始**、] をポイント**設定**、順にクリックします**コントロール パネルの [** します。  
  
2. ダブルクリック**ネットワーク接続**コンピューターのネットワーク接続を表示します。  
  
3. 右クリック**Local Area Connection** (または、ネットワーク接続のエントリ) をクリックして**プロパティ**ネットワーク接続のプロパティ ダイアログ ボックスを表示します。  
  
4. 不要な項目を削除するを選択し、クリックして**アンインストール**します。 項目を無効にするには、単に、アイテムに関連付けられているチェック ボックスをオフにします。  
  
   接続の項目のアンインストールの影響について確信できない場合はアンインストールするのではなく、項目を無効にします。 項目を無効にすると、どのサービス、プロトコル、およびクライアントがシステムで必要な実際に決定できます。 項目を無効にしていない影響を及ぼす場合、サーバー上と特定されて、ときに、項目をアンインストールし、できます。  
  
   多くの場合は、次の 3 つのコンポーネントのみが、標準の TCP/IP ベース ネットワーク上の操作必要です。  
  
-   Microsoft ネットワーク用クライアント  
  
-   ファイル サービスおよび Microsoft ネットワーク用のプリンターの共有  
  
-   インターネット プロトコル (TCP/IP)  
  
### <a name="network-adapter-drivers-on-all-computers-in-the-biztalk-server-environment-should-be-tuned-for-performance"></a>BizTalk Server 環境のすべてのコンピューター上のネットワーク アダプター ドライバーがパフォーマンスに合わせて調整する必要があります。  
  
> [!IMPORTANT]  
>  ネットワーク アダプターのドライバーにチューニングを適用する前に常に、環境内のネットワーク カードの最新のネットワーク アダプター デバイス ドライバーをインストールします。  
  
 受信と送信の両方のパケットは、バッファリングの使用可能なメモリの量を最大化するには、ネットワーク アダプター デバイス ドライバーを調整します。 バッファー数を最大化、特に転送バッファーおよびバッファーを結合します。 既定では、これらのパラメーターの値され、製造元とバージョンのドライバーの間、でも提供されるかどうかが変化します。 目標は、ネットワーク アダプターのハードウェアによって実行された作業を最大化して、ネットワーク トラフィックの急激な増加と関連付けられている輻輳を軽減するためにネットワーク操作の最大の可能なバッファー領域を確保します。  
  
> [!NOTE]  
>  ネットワーク アダプターのドライバーをチューニングする手順は、製造元によって異なります。  
  
 ネットワーク アダプターの設定にアクセスする次の手順に従って[!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)]:  
  
1. クリックして**開始**、および順にクリックします**コントロール パネルの **します。  
  
2. クリックして**ネットワークとインターネット**、 をクリックし、**ネットワークと共有センター**します。  
  
3. をクリックして**アダプター設定を変更する**を右クリックして**ローカル エリア接続**(または、ネットワーク接続の名前)、順にクリックします**プロパティ**します。  
  
4. **全般**] タブで [**構成**します。  
  
5. をクリックして、**詳細**ネットワーク アダプターに対して構成できるプロパティにアクセスするには、タブ。  
  
   次のプロパティは、BizTalk Server 環境でのネットワーク アダプターごとに構成する必要があります。  
  
> [!NOTE]  
>  集計、負荷分散、またはフォールト トレランス用に構成されたネットワーク アダプターのチーミングされたセット内の個々 のネットワーク アダプターを含む、物理ネットワーク アダプターごとにこれらの設定が適用されます。 チーミング ソフトウェアをチームにもこれらの設定を適用する必要があります。 一部のネットワーク アダプターが自動調整し、パラメーターを手動で構成するオプションがない可能性がありますに注意してください。  
  
- **電源オプション**– 電源管理機能が電力を節約するネットワーク アダプターをオフにすることを防ぐためにネットワーク アダプター ドライバーを構成します。 この機能はクライアント コンピューターに役立つことはめったにありません必要がありますが、BizTalk Server または SQL Server コンピューターで使用します。  
  
- **速度、双方向の固定 (自動を使用しない)** -は非常に重要なは、スイッチの設定に対応する、ネットワーク速度、二重モード、およびフロー制御パラメーターが設定されている接続先にします。 これは、定期的な「自動同期」オフライン接続を一時的にかかる場合があります出現で軽減されます。  
  
- **Coalesce バッファーの最大**-マップのレジスタがシステム リソースの仮想アドレス バス マスターをサポートするネットワーク アダプターを物理アドレスに変換するために使用します。 Coalesce バッファーが既にドライバー マップ レジスタが不足した場合、ネットワーク ドライバーを使用します。 この値が最高のパフォーマンスをできるだけ高く設定します。 物理メモリの制限付きのサーバーで、負の値があります coalesce バッファーと影響がシステム メモリを消費します。 ほとんどのシステムでただし、最大設定適用できますせず、使用可能なメモリが大幅に削減します。  
  
- **最大送信/送信記述子および送信バッファー** -この設定を指定数の転送コントロール バッファーのネットワーク インターフェイスで使用するドライバーを割り当てます。 これにより、「送信」キューに持つことができます、ドライバー、未処理のパケットの数が直接反映されます。 この値が最高のパフォーマンスをできるだけ高く設定します。 物理メモリの制限付きのサーバーでは、システム メモリを消費する送信バッファーとして悪影響を及ぼすこの可能性があります。 ほとんどのシステムでただし、最大設定適用できますせず、使用可能なメモリが大幅に削減します。  
  
- **受信バッファーの最大**-この設定は、プロトコルのメモリにデータをコピーするときに、ネットワーク インターフェイスのドライバーで使用されるメモリ バッファーの量を指定します。 通常、既定では、比較的低い値に設定されます。 この値が最高のパフォーマンスをできるだけ高く設定します。 物理メモリの制限付きのサーバーで、負の値がありますと受信バッファーへの影響は、システム メモリを消費します。 ほとんどのシステムでただし、最大設定適用できますせず、使用可能なメモリが大幅に削減します。  
  
- **オプションをオフロードすべて**- ほとんどの場合のネットワーク インターフェイス オフロード機能を有効にする場合のパフォーマンスが向上します。 一部のネットワーク アダプターを有効にするまたは送信のオフロードを無効にして、トラフィックを受信する別のパラメーターを提供します。 ネットワーク アダプターに、CPU からタスクをオフロードすると、システム全体のパフォーマンスを改善するサーバーの CPU 使用量を削減できます。 Microsoft TCP/IP トランスポートは、適切な機能を備えたネットワーク アダプターに次のタスクの 1 つ以上オフロードできます。  
  
  -   **チェックサム タスク**TCP/IP トランスポートは、計算をオフロードできます - との ip アドレスと TCP チェックサムの検証で送受信するネットワーク アダプターが、ネットワーク アダプター ドライバーがこの機能を提供する場合、このオプションを有効にします。  
  
  -   **IP セキュリティ タスク**-TCP/IP トランスポートは、計算との認証ヘッダー (AH) およびネットワーク アダプターにセキュリティ ペイロード (ESP) をカプセル化する暗号化チェックサムの検証をオフロードできます。 TCP/IP トランスポートは、暗号化と復号化、ネットワーク アダプターに ESP ペイロードのもオフロードできます。 ネットワーク アダプター ドライバーがこの機能を提供する場合は、これらのオプションを有効にします。  
  
  -   **大きな TCP パケットのセグメント化**-TCP/IP トランスポートは、大量送信オフロード (LSO) をサポートしています。 Lso により、TCP/IP トランスポートは大きな TCP パケットのセグメント化をオフロードできます。  
  
  -   **スタック オフロード**– ネットワーク スタック全体を適切な機能を備えたネットワーク アダプターにオフロードできます。 ネットワーク アダプター ドライバーがこの機能を提供する場合は、このオプションを有効にします。  
  
- **Wake On LAN (使用されている) 場合を除き、無効になっている**– lan でウェイク アップの機能を無効にするネットワーク アダプター ドライバーを構成します。 この機能がクライアント コンピューターの便利ですが、必要がありますほとんどもしコンピューターで使用する、BizTalk Server または SQL Server。  
  
  ネットワーク アダプターのパフォーマンスのチューニングの詳細については、次を参照してください。、**ネットワーク デバイスの設定**"BizTalk Server データベースの最適化"ホワイト ペーパーの「 [ http://go.microsoft.com/fwlink/?LinkID=101578](http://go.microsoft.com/fwlink/?LinkID=101578)します。