---
title: ネットワーク最適化 |Microsoft ドキュメント
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 9ff0392f-37ae-4ca6-8cc6-d53065de64c5
caps.latest.revision: 6
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: bbf4b0e8df9d8baa81a91576dc37fd89413714f9
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/20/2017
ms.locfileid: "22298762"
---
# <a name="network-optimizations"></a>ネットワークの最適化
BizTalk Server コンピューターは、SQL Server コンピューターから独立、BizTalk Server 環境で BizTalk Server によって処理される各メッセージには、ネットワーク経由で通信が必要です。 この通信には、BizTalk Server コンピューターと BizTalk メッセージ ボックス データベース、BizTalk 管理データベース、BAM データベースおよびその他のデータベース間のかなりのトラフィックが含まれています。 高負荷のシナリオで、この通信は大量のネットワーク トラフィックにより、ネットワーク設定が最適化されていない、十分なネットワーク インターフェイス カードがインストールされている、または十分なネットワーク帯域幅が場合は特に、ボトルネックになることができます。使用できます。  
  
 このトピックでは、同じ HYPER-V ホスト コンピューターで実行されている HYPER-V 仮想マシン間のネットワークのパフォーマンスを向上させるための手順を提供し、ネットワークのパフォーマンスを向上させるための一般的な推奨事項を示します。  
  
> [!NOTE]  
>  ネットワーク IO がボトルネックである最も一般的なインジケーター カウンターは、「SQL Server: Wait Statistics\Network IO 待機します」。 ときの値は、**平均待機時間**でこのカウンターはゼロに 1 つ以上の SQL Server コンピューターよりも大きい順ネットワーク IO がボトルネックです。  
  
## <a name="improving-network-performance-of-biztalk-server-on-hyper-v"></a>HYPER-V の BizTalk Server のネットワーク パフォーマンスの向上  
  
### <a name="configure-hyper-v-virtual-machines-that-are-running-on-the-same-hyper-v-host-computer-to-use-a-private-virtual-network"></a>プライベート仮想ネットワークを使用して、同じ HYPER-V ホスト コンピューターで実行されている HYPER-V 仮想マシンの構成します。  
 実行されている HYPER-V 仮想マシン間のネットワークのパフォーマンスを向上させるために、同じ HYPER-V ホスト コンピューターは、プライベート仮想ネットワークおよびルート間のネットワーク トラフィック、プライベート仮想ネットワークを介したバーチャル マシンを作成します。  
  
##### <a name="create-a-private-virtual-network"></a>プライベート仮想ネットワークを作成します。  
  
1.  をクリックして**開始**をクリックして**すべてのプログラム**です。 をクリックして**管理ツール**、クリックして**HYPER-V マネージャーで**です。  
  
2.  HYPER-V マネージャーの左側のペインで右クリック**HYPER-V マネージャーで**、クリックして**サーバーへの接続**です。  
  
3.  **コンピューターの選択**ダイアログ ボックスでは、HYPER-V ホスト コンピューターの名前を入力し、をクリックして**OK**です。  
  
4.  HYPER-V マネージャーの左側のペインで、HYPER-V ホストを右クリックし、をクリックして**仮想ネットワーク マネージャー**です。  
  
5.  仮想ネットワーク マネージャーで、[**を作成する仮想ネットワークの種類しますか?**、] をクリックして**プライベート**をクリックし、**追加**です。  
  
6.  新しい仮想ネットワークの名前を入力し、クリックして**OK**です。 この HYPER-V ホスト上で実行される各 HYPER-V 仮想マシンに、仮想ネットワークを適用することが追加されました。  
  
##### <a name="add-the-private-virtual-network-to-hyper-v-virtual-machines-running-on-the-hyper-v-host"></a>プライベート仮想ネットワークを追加して HYPER-V 仮想マシンに HYPER-V ホストで実行されています。  
  
1.  をクリックして**開始**をクリックして**すべてのプログラム**です。 をクリックして**管理ツール**、クリックして**HYPER-V マネージャーで**です。  
  
2.  HYPER-V マネージャーの左側のペインで右クリック**HYPER-V マネージャーで**、クリックして**サーバーへの接続**です。  
  
3.  **コンピューターの選択**ダイアログ ボックスでは、HYPER-V ホスト コンピューターの名前を入力し、をクリックして**OK**です。  
  
4.  するには、仮想マシンを右クリックし、をクリックしてプライベート仮想ネットワークを追加実行中の仮想マシンをシャット ダウン**シャット ダウン**です。  
  
5.  仮想マシンをシャット ダウン後、仮想マシンを右クリックし、をクリックして**設定**仮想マシンの設定を変更します。  
  
6.  **< Machine_name > の設定を**ダイアログ ボックスで、**ハードウェアの追加**をクリックして選択**ネットワーク アダプター**、クリックして**追加**.  
  
7.  **ネットワーク アダプター**構成ページで、**ネットワーク:**、先ほど作成したプライベート仮想ネットワークを選択して、をクリックして**OK**です。 今すぐ行ったプライベート仮想ネットワークが表示されます、仮想マシンが開始される次回 HYPER-V 仮想マシンで使用可能です。  
  
8.  各仮想マシンをプライベート仮想ネットワークを通過するネットワーク トラフィックをルーティングするための上記の手順を繰り返します。  
  
9. プライベート仮想ネットワークを追加した仮想マシンを起動します。 各仮想マシンを右クリックし、をクリックして**開始**です。  
  
##### <a name="configure-each-virtual-machine-to-use-the-private-virtual-network"></a>プライベート仮想ネットワークを使用するには、各仮想マシンを構成します。  
  
1.  各仮想マシンが開始されると、プライベート仮想ネットワークは仮想マシンにアクセス可能なネットワーク接続としてです。 TCP/IPv4 を使用するには、各仮想マシンにネットワーク接続を構成し、Tcp/ipv4 プロトコルの設定を指定します。  
  
    1.  ネットワーク接続のプロパティ ページにアクセスで、選択**インターネット プロトコル バージョン 4(TCP/IPv4)**、クリックして**プロパティ**です。  
  
    2.  次にラジオ ボタンをクリックして**次の IP アドレスを使用して**です。  
  
2.  値を入力して、 **IP アドレス**プライベート IP の範囲からのフィールドで識別された"RFC 1918 のプライベート IP アドレスのアドレス割り当て"に対応[http://go.microsoft.com/fwlink/?LinkID=31904](http://go.microsoft.com/fwlink/?LinkID=31904)です。  
  
3.  指定した IP アドレスのメモします。この値を後で、ホスト ファイル エントリには、このコンピューターの NetBIOS 名に関連付ける必要があります。  
  
4.  適切な値を入力、**サブネット マスク**フィールドです。  
  
    > [!NOTE]  
    >  Windows を設定する必要があります、**サブネット マスク**に入力した値に基づいて、適切な値を持つフィールド、 **IP アドレス**フィールドです。  
  
5.  ままにして、**デフォルト ゲートウェイ**フィールドの空白をクリックして **[ok]**、順にクリック**閉じる**です。  
  
6.  一意のプライベート IP アドレスを各仮想マシンを構成した後に、HYPER-V ホスト コンピューターで実行されている他の仮想マシンの NetBIOS 名と IP アドレスと各仮想マシン上の HOSTS ファイルを更新します。 更新されたホスト ファイルは、各仮想マシンに %systemroot%\drivers\etc\ フォルダーに保存する必要があります。  
  
    > [!NOTE]  
    >  既定で Windows が NetBIOS 名を解決するには、他の仮想マシンの一意のプライベート IP アドレスと各仮想マシン上の HOSTS ファイルを更新することによって最初にローカルの HOSTS ファイルを確認するため、これらのマシン間のネットワーク トラフィックは経由でルーティングされます。プライベート仮想ネットワークです。  
  
### <a name="disable-tcp-offloading-for-the-virtual-machine-network-cards"></a>TCP オフロード、仮想マシンのネットワーク カードを無効にします。  
 「を有効にし、タスク Offloading (NDIS 5.1) を無効にするを使用するレジストリ値」MSDN トピックの説明に従ってレジストリを編集[http://go.microsoft.com/fwlink/?LinkId=147619](http://go.microsoft.com/fwlink/?LinkId=147619) TCP オフロード各仮想マシン上のネットワーク カードを無効にします。  
  
> [!IMPORTANT]  
>  レジストリ エディターの不適切な使用により問題が発生し、オペレーティング システムの再インストールが必要となることがあります。 レジストリ エディターは、ご自身の責任で使用してください。 バックアップ、復元、およびレジストリを変更する方法の詳細についてで Microsoft サポート技術情報の資料「Microsoft Windows レジストリの説明」を参照してください。 [http://go.microsoft.com/fwlink/?LinkId=62729](http://go.microsoft.com/fwlink/?LinkId=62729)です。  
  
## <a name="general-guidelines-for-improving-network-performance"></a>ネットワークのパフォーマンスを向上させるための一般的なガイドライン  
 ネットワーク パフォーマンスを向上させるのには、次の推奨事項を使用できます。  
  
### <a name="add-additional-network-cards-to-computers-in-the-biztalk-server-environment"></a>BizTalk Server 環境内のコンピューターに追加のネットワーク カードを追加します。  
 追加する追加のハード ドライブは、ディスクのパフォーマンスを向上させることができます、追加のネットワーク カードがネットワーク パフォーマンスを向上させることができます。 BizTalk Server 環境内のコンピューター上のネットワーク カードが飽和状態になり、カードがボトルネックになっている場合は、パフォーマンスを向上させるために 1 つまたは複数のネットワーク カードを追加することを検討してください。  
  
### <a name="implement-network-segmentation"></a>ネットワークのセグメント化を実装します。  
 推奨事項に従い、**サブネット**「BizTalk Server データベースの最適化」のホワイト ペーパーの「 [http://go.microsoft.com/fwlink/?LinkID=101578](http://go.microsoft.com/fwlink/?LinkID=101578)です。  
  
### <a name="where-possible-replace-hubs-with-switches"></a>可能であれば、スイッチを使用してハブを置き換えます  
 スイッチには、直接はハブ ブロードキャスト トラフィックをルーティングするモデルを使用して、ソースと移行先の間のトラフィックをルーティングするロジックが含まれます。 したがってスイッチは効率的で、パフォーマンスが向上します。  
  
### <a name="remove-unnecessary-network-protocols"></a>不要なネットワーク プロトコルを削除します。  
 Windows Server コンピューターでは、ネットワーク サービスと実際に必要とされる以上がインストールされているプロトコルの詳細がある場合があります。 各追加ネットワーク クライアント、サービスまたはプロトコル、追加オーバーヘッドがシステム リソースにします。  
  
 さらに、各インストールされているプロトコルは、ネットワーク トラフィックを生成します。 不要なネットワーク クライアント、サービス、およびプロトコルを削除すると、他のプロセスの使用可能なシステム リソース、過剰なネットワーク トラフィックを回避でき、ネゴシエートする必要がありますネットワーク バインドの数が最小限に減らします。  
  
 プロトコルおよびサービスを現在インストールされているネットワーク クライアントを表示するには、これらの手順に従います。  
  
1.  をクリックして**開始**、] をポイント**設定**、順にクリック**コントロール パネルの [** です。  
  
2.  ダブルクリックして**ネットワーク接続**コンピューターのネットワーク接続を表示します。  
  
3.  右クリック**ローカル エリア接続**(または、ネットワーク接続のエントリ) をクリックし、**プロパティ**ネットワーク接続のプロパティ ダイアログ ボックスを表示します。  
  
4.  不要な項目を削除するには、選択してをクリックして**アンインストール**です。 項目を無効にするには、単に、アイテムに関連付けられているチェック ボックスをオフにします。  
  
 この接続の項目をアンインストールする場合の影響がわからないをアンインストールするのではなく、項目を無効にするとします。 場合、 項目を無効にするには、サービス、プロトコルおよびクライアントがシステムで実際に必要か決定することができます。 これが特定されたら、項目を無効にしていない影響を及ぼす場合、サーバーで、ときに、項目をアンインストールし、できます。  
  
 多くの場合は、次の 3 つのコンポーネントのみが、標準の TCP/IP ベース ネットワーク上の操作の必要です。  
  
-   Microsoft ネットワーク用クライアント  
  
-   ファイル サービスおよび Microsoft ネットワーク用のプリンターの共有  
  
-   インターネット プロトコル (TCP/IP)  
  
### <a name="network-adapter-drivers-on-all-computers-in-the-biztalk-server-environment-should-be-tuned-for-performance"></a>BizTalk Server 環境のすべてのコンピューター上のネットワーク アダプター ドライバーがパフォーマンスに合わせて調整する必要があります。  
  
> [!IMPORTANT]  
>  ネットワーク アダプターのドライバーにチューニングを適用するには、前に常に、環境内のネットワーク カードの最新のネットワーク アダプター デバイス ドライバーをインストールします。  
  
 受信および送信の両方、パケットがバッファリングの使用可能なメモリの量を最大化するネットワーク アダプター デバイス ドライバーを調整します。 バッファー カウントを最大化、特に転送バッファーおよびバッファーを結合します。 既定値は、これらのパラメーターの値しにも用意されているかどうかは、製造元およびドライバーのバージョン間で異なる場合します。 目標は、ネットワーク アダプターのハードウェアで実行された作業を最大化して、ネットワーク トラフィックの増加および関連付けられている輻輳を軽減するためにネットワーク操作の最大の可能なバッファー領域が確保されます。  
  
> [!NOTE]  
>  ネットワーク アダプターのドライバーを調整する手順は、製造元によって異なります。  
  
 ネットワーク アダプターの設定にアクセスする次の手順に従って[!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)]:  
  
1.  をクリックして**開始**、およびをクリックし、**コントロール パネルの** です。  
  
2.  をクリックして**ネットワークとインターネット**、クリックして**ネットワークと共有センター**です。  
  
3.  をクリックして**アダプターの設定を変更**を右クリックして**ローカル エリア接続**(または、ネットワーク接続の名前)、をクリックし、**プロパティ**です。  
  
4.  **全般** タブで、をクリックして**構成**です。  
  
5.  クリックして、 **[詳細設定]** タブ プロパティにアクセスするネットワーク アダプターに構成することができます。  
  
 次のプロパティは、BizTalk Server 環境の各ネットワーク アダプターを構成してください。  
  
> [!NOTE]  
>  集約、負荷分散、またはフォールト トレランスが構成されているネットワーク アダプターのチーミングされたセット内の個々 のネットワーク アダプターを含む、物理ネットワーク アダプターごとにこれらの設定が適用されます。 一部のチーミング ソフトウェアも、チームにこれらの設定を適用する必要があります。 一部のネットワーク アダプターが自己調整は、パラメーターを手動で構成するオプションがありますいないことに注意してください。  
  
-   **オプションの電源を**– を電源管理機能の電力を節約するネットワーク アダプターを無効にすることを防ぐために、ネットワーク アダプター ドライバーを構成します。 この機能は、クライアント コンピューターに適している可能性がありますが、ことはほとんど必要があります、BizTalk Server または SQL Server コンピューターで使用できます。  
  
-   **速度または二重の固定 (自動を使用しない)** -ネットワーク速度、二重モード、およびフロー制御パラメーターが設定をスイッチの設定に対応することが非常に重要である接続先。 これにより、定期的な「自動同期」かかる場合があります一時的にオフラインの接続の発生が軽減されます。  
  
-   **合体バッファーの最大**-マップ レジスタは、システム リソースの物理アドレスをバス マスターをサポートするネットワーク アダプターの仮想アドレスに変換するために使用します。 合体ドライバー マップ レジスタ不足した場合、バッファーは、ネットワーク ドライバーを使用できます。 この値が最大のパフォーマンスをできるだけ高く設定します。 サーバーで物理メモリの制限と、このあります、負の値のバッファーをまとめるようへの影響がシステム メモリを消費します。 ほとんどのシステムでただし、設定されている最大適用できますせず、使用可能なメモリを大幅に削減します。  
  
-   **最大転送/送信記述子および送信バッファー** -この設定を指定数の転送コントロール バッファーのネットワーク インターフェイスで使用するドライバーを割り当てます。 これにより、ドライバーは、"send"キューに持つことができます未処理のパケットの数が直接反映されます。 この値が最大のパフォーマンスをできるだけ高く設定します。 物理メモリの制限、サーバーでは、システム メモリを消費するマイナスの影響の送信バッファーとしてこのがあります。 ほとんどのシステムでただし、設定されている最大適用できますせず、使用可能なメモリを大幅に削減します。  
  
-   **受信バッファーの最大**-この設定は、プロトコルのメモリにデータをコピーするときに、ネットワーク インターフェイスのドライバーで使用されるメモリ バッファーの量を指定します。 これは通常、既定では、比較的小さい値に設定されます。 この値が最大のパフォーマンスをできるだけ高く設定します。 サーバーで物理メモリの制限と、このあります、負の値のバッファーを受信したときの影響は、システム メモリを消費します。 ほとんどのシステムでただし、設定されている最大適用できますせず、使用可能なメモリを大幅に削減します。  
  
-   **オプションをオフロードすべて**- ネットワーク インターフェイス オフロード機能を有効にすると、パフォーマンスが向上はほとんどの場合。 一部のネットワーク アダプターを有効にする、オフロード送信を無効にするにまたはトラフィックを受信して個別のパラメーターを提供します。 CPU からネットワーク アダプターにタスクをオフロードすることと、システム全体のパフォーマンスが向上しているサーバーの CPU 使用量を削減できます。 Microsoft TCP/IP トランスポートには、1 つ以上の適切な機能を備えているネットワーク アダプターに次のタスクをオフロードできます。  
  
    -   **チェックサム タスク**- TCP/IP トランスポートが、計算の負荷を軽減との ip アドレスと TCP チェックサムの検証を送信および受信ネットワーク アダプターに、ネットワーク アダプター ドライバーは、この機能を提供する場合は、このオプションを有効にします。  
  
    -   **IP セキュリティ タスク**-TCP/IP トランスポートは、計算と認証ヘッダー (AH) およびカプセル化セキュリティ ペイロード (ESP) ネットワーク アダプターへの暗号化チェックサムの検証をオフロードできます。 TCP/IP トランスポートは、暗号化と復号化、ネットワーク アダプターに ESP ペイロードのオフロードもできます。 ネットワーク アダプター ドライバーは、この機能を提供する場合は、これらのオプションを有効にします。  
  
    -   **大量の TCP パケットのセグメント化**-TCP/IP トランスポートは、多数の送信オフロード (LSO) をサポートしています。 Lso により、TCP/IP トランスポートは、大量の TCP パケットのセグメント化をオフロードできます。  
  
    -   **スタックのオフロード**– ネットワーク スタック全体は、適切な機能を備えているネットワーク アダプターにオフロードできます。 ネットワーク アダプター ドライバーは、この機能を提供する場合は、このオプションを有効にします。  
  
-   **Wake On LAN (使用されている) 場合を除き、無効になっている**– wake on lan 機能を無効にするネットワーク アダプター ドライバーを構成します。 この機能がクライアント コンピューターに便利ですが、ほとんどありませんもしに対して使用するか、BizTalk Server または SQL Server コンピューター。  
  
 ネットワーク アダプターのパフォーマンスをチューニングの詳細については、次を参照してください。、**ネットワーク デバイスの設定**"BizTalk Server データベースの最適化」のホワイト ペーパーの「 [http://go.microsoft.com/fwlink/?LinkID=101578](http://go.microsoft.com/fwlink/?LinkID=101578)です。