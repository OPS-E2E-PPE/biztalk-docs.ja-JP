---
title: 受信アダプターのバッチ サポート用のインターフェイス |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: fa6ee780-189c-41e3-9ab0-6b869e791c0a
caps.latest.revision: 12
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 360a7b4fb3f6842795358ebe40cace7531cd2b6c
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/07/2019
ms.locfileid: "65331670"
---
# <a name="interfaces-for-a-batch-supported-receive-adapter"></a><span data-ttu-id="3f56c-102">バッチ処理に対応した受信アダプター用のインターフェイス</span><span class="sxs-lookup"><span data-stu-id="3f56c-102">Interfaces for a Batch-Supported Receive Adapter</span></span>
<span data-ttu-id="3f56c-103">受信アダプターは、常にバッチ内のメッセージを送信します。</span><span class="sxs-lookup"><span data-stu-id="3f56c-103">A receive adapter always submits messages in a batch.</span></span> <span data-ttu-id="3f56c-104">バッチは、送信以外のアクションに使用できるデータベース操作の単位です。</span><span class="sxs-lookup"><span data-stu-id="3f56c-104">A batch is a unit of database operations that you can use for actions other than submission.</span></span> <span data-ttu-id="3f56c-105">たとえば、受信アダプターことができます 1 つの一連のメッセージを送信、メッセージのさまざまなセットを中断および削除同じバッチ内のメッセージの別のセット。</span><span class="sxs-lookup"><span data-stu-id="3f56c-105">For example, a receive adapter can submit one set of messages, suspend a different set of messages, and delete another set of messages in the same batch.</span></span> <span data-ttu-id="3f56c-106">同じバッチ内でこれらの個別の操作をグループ化の数を最小限に抑えることによってパフォーマンスが最適化データベースのために必要なラウンド トリップと強くお勧めします。</span><span class="sxs-lookup"><span data-stu-id="3f56c-106">Grouping these separate operations in the same batch optimizes performance by minimizing the number of database round trips required and is strongly encouraged.</span></span>  
  
 <span data-ttu-id="3f56c-107">インプロセスおよび分離には、サーバーにメッセージのバッチを送信する次のインターフェイスを実装するアダプターの必要性が表示されます。</span><span class="sxs-lookup"><span data-stu-id="3f56c-107">In-process and isolated receive adapters need to implement the following interfaces to submit batches of messages into the server:</span></span>  
  
- <span data-ttu-id="3f56c-108">**IBTTransport**</span><span class="sxs-lookup"><span data-stu-id="3f56c-108">**IBTTransport**</span></span>  
  
- <span data-ttu-id="3f56c-109">**IBTTransportControl** (インプロセス アダプターのみ)</span><span class="sxs-lookup"><span data-stu-id="3f56c-109">**IBTTransportControl** (in-process adapters only)</span></span>  
  
- <span data-ttu-id="3f56c-110">**IBTTransportConfig**</span><span class="sxs-lookup"><span data-stu-id="3f56c-110">**IBTTransportConfig**</span></span>  
  
- <span data-ttu-id="3f56c-111">**IBaseComponent**</span><span class="sxs-lookup"><span data-stu-id="3f56c-111">**IBaseComponent**</span></span>  
  
- <span data-ttu-id="3f56c-112">**IPersistPropertyBag**</span><span class="sxs-lookup"><span data-stu-id="3f56c-112">**IPersistPropertyBag**</span></span>  
  
- <span data-ttu-id="3f56c-113">**IBTBatchCallBack**</span><span class="sxs-lookup"><span data-stu-id="3f56c-113">**IBTBatchCallBack**</span></span>  
  
  <span data-ttu-id="3f56c-114">次の手順では、一連のサーバーにメッセージを送信する受信アダプターを実行するアクションについて説明します。</span><span class="sxs-lookup"><span data-stu-id="3f56c-114">The following steps describe the sequence of actions that a receive adapter performs to submit messages into the server.</span></span>  
  
1. <span data-ttu-id="3f56c-115">受信アダプターを呼び出すことによって、トランスポート プロキシからバッチを取得します、 **GetBatch**のメソッド、 **IBTTransportProxy**インターフェイス。</span><span class="sxs-lookup"><span data-stu-id="3f56c-115">A receive adapter obtains the batch from the transport proxy by calling the **GetBatch** method of the **IBTTransportProxy** interface.</span></span> <span data-ttu-id="3f56c-116">呼び出しで**GetBatch**へのポインターを渡しますその**IBTBatchCallback**インターフェイスの実装。</span><span class="sxs-lookup"><span data-stu-id="3f56c-116">In its call to **GetBatch** the adapter passes in a pointer to its **IBTBatchCallback** interface implementation.</span></span>  
  
2. <span data-ttu-id="3f56c-117">アダプターを追加しますメッセージを 1 つずつバッチに呼び出すことによって、 **SubmitMessage**のメソッド、 **IBTTransportBatch**インターフェイス。</span><span class="sxs-lookup"><span data-stu-id="3f56c-117">An adapter adds the messages one at a time into the batch by calling the **SubmitMessage** method of the **IBTTransportBatch** interface.</span></span> <span data-ttu-id="3f56c-118">これは、送信請求-応答のメッセージなどの双方向の操作の場合、 **SubmitResponseMessage**応答メッセージを送信するこの同じインターフェイスのメソッドが呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="3f56c-118">If this is a two-way operation such as solicit-response messaging, the **SubmitResponseMessage** method of this same interface is called to submit the response message.</span></span>  
  
3. <span data-ttu-id="3f56c-119">アダプターが呼び出すすべてのメッセージがバッチに追加されていますが、ときに、**完了**のメソッド、 **IBTTransportBatch**インターフェイスをトランスポート プロキシにバッチを送信します。</span><span class="sxs-lookup"><span data-stu-id="3f56c-119">When all the messages have been added to the batch, the adapter calls the **Done** method of the **IBTTransportBatch** interface to submit the batch to the transport proxy.</span></span> <span data-ttu-id="3f56c-120">ため、受信アダプターは本質的に非同期で、アダプターがすぐに新しいバッチを取得し、呼び出した後、他のメッセージを送信を開始**完了**します。</span><span class="sxs-lookup"><span data-stu-id="3f56c-120">Because receive adapters are asynchronous in nature, the adapter can immediately obtain a new batch and start submitting other messages after it calls **Done**.</span></span>  
  
4. <span data-ttu-id="3f56c-121">メッセージング エンジンがアダプターを呼び出すバッチが処理された後**BatchComplete**トランスポート プロキシを使用して、実際の呼び出しにコールバック メソッド。</span><span class="sxs-lookup"><span data-stu-id="3f56c-121">After the batch has been processed, the Messaging Engine invokes the adapter's **BatchComplete** callback method using the transport proxy to make the actual call.</span></span> <span data-ttu-id="3f56c-122">配列の**BTBatchOperationStatus**アダプターに渡される送信の状態を格納しているオブジェクトします。</span><span class="sxs-lookup"><span data-stu-id="3f56c-122">An array of **BTBatchOperationStatus** objects containing the status of the submission is passed to the adapter.</span></span> <span data-ttu-id="3f56c-123">各オブジェクトは、操作の種類に対応し、操作の全体的な状態と操作が実行された各メッセージの状態が含まれています。</span><span class="sxs-lookup"><span data-stu-id="3f56c-123">Each object corresponds to an operation type and contains the overall status of the operation as well as the status for each message for which the operation was performed.</span></span> <span data-ttu-id="3f56c-124">次のシーケンスには、アダプターがバッチ処理の状態を分析するために実行する必要がある操作について説明します。</span><span class="sxs-lookup"><span data-stu-id="3f56c-124">The following sequence describes the actions the adapter needs to perform to analyze the status of batch processing:</span></span>  
  
   1.  <span data-ttu-id="3f56c-125">バッチの全体的な状態 HRESULT 値がパラメーターとして渡されるチェック、 **BatchComplete**メソッド。</span><span class="sxs-lookup"><span data-stu-id="3f56c-125">Check the overall batch status HRESULT value passed as a parameter to the **BatchComplete** method.</span></span> <span data-ttu-id="3f56c-126">エラーがある場合は、少なくとも 1 つのバッチ内の操作が失敗したことを意味します。</span><span class="sxs-lookup"><span data-stu-id="3f56c-126">If it is a failure, it means that at least one of the operations in the batch was unsuccessful.</span></span> <span data-ttu-id="3f56c-127">そのため 1 つのエンティティとしてバッチ全体の送信に失敗しました。</span><span class="sxs-lookup"><span data-stu-id="3f56c-127">Therefore the submission of the entire batch as one entity failed.</span></span> <span data-ttu-id="3f56c-128">問題のあるメッセージを検出し、最初にエラーが発生していないもののみをバッチとして再送信アダプターを再試行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3f56c-128">The adapter should then try to discover the offending message(s) and resubmit as a batch only the ones that did not initially cause a failure.</span></span>  
  
        <span data-ttu-id="3f56c-129">バッチの全体的な状態が成功した場合は意味をトランスポート プロキシに付与されたすべてのメッセージが永続化されたことをディスクにします。</span><span class="sxs-lookup"><span data-stu-id="3f56c-129">If the overall batch status succeeded, it means that all the messages that were given to the transport proxy were persisted to disk.</span></span> <span data-ttu-id="3f56c-130">ただし、必ずしも、パイプラインは、すべてのメッセージを正常に処理します。</span><span class="sxs-lookup"><span data-stu-id="3f56c-130">However, it does not mean that the pipeline successfully processed all the messages.</span></span> <span data-ttu-id="3f56c-131">パイプラインでエラー メッセージが中断された可能性があります。</span><span class="sxs-lookup"><span data-stu-id="3f56c-131">It is possible that messages that failed in the pipeline were suspended.</span></span> <span data-ttu-id="3f56c-132">パイプラインで失敗したメッセージで返されるバッチの全体的な状態が成功した、データが書き込まれたため、ディスクにします。</span><span class="sxs-lookup"><span data-stu-id="3f56c-132">For messages that fail in the pipeline, the overall batch status returned is successful because the data was written to disk.</span></span>  
  
   2.  <span data-ttu-id="3f56c-133">各操作の種類の状態を確認、`operationStatus`パラメーター。</span><span class="sxs-lookup"><span data-stu-id="3f56c-133">Check the status for each operation type in the `operationStatus` parameter.</span></span> <span data-ttu-id="3f56c-134">状態の場合**S_OK**、この操作の送信が成功したおよびさらに、状態を確認する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="3f56c-134">If the status is **S_OK**, the submission for this operation succeeded and you do not need to check the status any further.</span></span> <span data-ttu-id="3f56c-135">状態が 設定されている場合**BTS_S_EPM_MESSAGE_SUSPENDED**中断されたメッセージの一部です。</span><span class="sxs-lookup"><span data-stu-id="3f56c-135">If the status is set to **BTS_S_EPM_MESSAGE_SUSPENDED** some of the messages were suspended.</span></span> <span data-ttu-id="3f56c-136">**BTS_S_EPM_SECURITY_CHECK_FAILED**いくつかのメッセージで認証が失敗したことを示す受信ポートの認証-必須します。</span><span class="sxs-lookup"><span data-stu-id="3f56c-136">**BTS_S_EPM_SECURITY_CHECK_FAILED** signifies that some messages failed authentication in an authentication-required receive port.</span></span> <span data-ttu-id="3f56c-137">場合**E_FAIL**が返されます、または HRESULT の値は、この操作に失敗しましたのメッセージ送信を 0 未満です。</span><span class="sxs-lookup"><span data-stu-id="3f56c-137">If **E_FAIL** is returned, or any HRESULT with a value that is less than zero, the message submission for this operation failed.</span></span>  
  
   3.  <span data-ttu-id="3f56c-138">操作の種類に対して個別のメッセージの状態を確認します。</span><span class="sxs-lookup"><span data-stu-id="3f56c-138">Check the status of individual messages for the operation type.</span></span> <span data-ttu-id="3f56c-139">送信操作の種類の各メッセージの状態に設定**S_OK**送信が成功した場合。</span><span class="sxs-lookup"><span data-stu-id="3f56c-139">For the submit operation type, the status of each message is set to **S_OK** if the submission succeeded.</span></span> <span data-ttu-id="3f56c-140">**BTS_S_EPM_MESSAGE_SUSPENDED**メッセージが中断されたかどうかに返されます。</span><span class="sxs-lookup"><span data-stu-id="3f56c-140">**BTS_S_EPM_MESSAGE_SUSPENDED** is returned if the message was suspended.</span></span> <span data-ttu-id="3f56c-141">**BTS_S_EPM_SECURITY_CHECK_FAILED**メッセージが認証を必要とする受信ポートでの認証に失敗したかどうかに返されます。</span><span class="sxs-lookup"><span data-stu-id="3f56c-141">**BTS_S_EPM_SECURITY_CHECK_FAILED** is returned if the message failed authentication on a receive port that requires authentication.</span></span> <span data-ttu-id="3f56c-142">**E_BTS_NO_SUBSCRIPTION**場合は、パブリッシュされたメッセージに対するサブスクライバーがないです。</span><span class="sxs-lookup"><span data-stu-id="3f56c-142">**E_BTS_NO_SUBSCRIPTION** comes back if there were no subscribers for the published message.</span></span> <span data-ttu-id="3f56c-143">場合**E_FAIL**が返されます、または HRESULT の値は、失敗、メッセージの送信を 0 未満です。</span><span class="sxs-lookup"><span data-stu-id="3f56c-143">If **E_FAIL** is returned, or any HRESULT with a value that is less than zero, the message submission failed.</span></span>  
  
   4.  <span data-ttu-id="3f56c-144">返すメッセージを保留する可能性があります、アダプターによって**E_FAIL**または HRESULT が失敗しています。</span><span class="sxs-lookup"><span data-stu-id="3f56c-144">Depending on your adapter, you may want to suspend messages that return **E_FAIL** or any failing HRESULT.</span></span>  
  
5. <span data-ttu-id="3f56c-145">**BatchComplete**メソッドは、いずれかを返す必要があります**S_OK**または**E_FAIL**実行の結果を示します。</span><span class="sxs-lookup"><span data-stu-id="3f56c-145">The **BatchComplete** method needs to return either **S_OK** or **E_FAIL** to indicate the result of execution.</span></span> <span data-ttu-id="3f56c-146">場合、 **BatchComplete**メソッドを返します。 **E_FAIL**または任意の負の値の HRESULT トランスポート プロキシは、エラーを記録します。</span><span class="sxs-lookup"><span data-stu-id="3f56c-146">If the **BatchComplete** method returns **E_FAIL** or any negative HRESULT, the transport proxy logs an error.</span></span>  
  
   <span data-ttu-id="3f56c-147">次の図は、受信アダプターのバッチ処理に対応の作成に関連するオブジェクトの相互作用を示しています。</span><span class="sxs-lookup"><span data-stu-id="3f56c-147">The following figure shows the object interactions involved in creating a batch-supported receive adapter.</span></span>  
  
   <span data-ttu-id="3f56c-148">![](../core/media/ebiz-sdk-devadapter1.gif "ebiz_sdk_devadapter1")</span><span class="sxs-lookup"><span data-stu-id="3f56c-148">![](../core/media/ebiz-sdk-devadapter1.gif "ebiz_sdk_devadapter1")</span></span>  
   <span data-ttu-id="3f56c-149">メッセージのバッチを送信する受信アダプターのワークフロー</span><span class="sxs-lookup"><span data-stu-id="3f56c-149">Workflow for a receive adapter submitting a batch of messages</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="3f56c-150">参照</span><span class="sxs-lookup"><span data-stu-id="3f56c-150">See Also</span></span>  
 <span data-ttu-id="3f56c-151">[アダプター変数](../core/adapter-variables.md) </span><span class="sxs-lookup"><span data-stu-id="3f56c-151">[Adapter Variables](../core/adapter-variables.md) </span></span>  
 <span data-ttu-id="3f56c-152">[開発、受信アダプター](../core/developing-a-receive-adapter.md) </span><span class="sxs-lookup"><span data-stu-id="3f56c-152">[Developing a Receive Adapter](../core/developing-a-receive-adapter.md) </span></span>  
 <span data-ttu-id="3f56c-153">[インスタンス化と初期化、アダプターの受信](../core/instantiating-and-initializing-a-receive-adapter.md) </span><span class="sxs-lookup"><span data-stu-id="3f56c-153">[Instantiating and Initializing a Receive Adapter](../core/instantiating-and-initializing-a-receive-adapter.md) </span></span>  
 <span data-ttu-id="3f56c-154">[受信アダプターをインプロセスで用のインターフェイス](../core/interfaces-for-an-in-process-receive-adapter.md) </span><span class="sxs-lookup"><span data-stu-id="3f56c-154">[Interfaces for an In-Process Receive Adapter](../core/interfaces-for-an-in-process-receive-adapter.md) </span></span>  
 <span data-ttu-id="3f56c-155">[インターフェイスの分離受信アダプター](../core/interfaces-for-an-isolated-receive-adapter.md) </span><span class="sxs-lookup"><span data-stu-id="3f56c-155">[Interfaces for an Isolated Receive Adapter](../core/interfaces-for-an-isolated-receive-adapter.md) </span></span>  
 <span data-ttu-id="3f56c-156">[受信アダプターのバッチでサポートされているトランザクション パブリケーション用のインターフェイス](../core/interfaces-for-a-transactional-batch-supported-receive-adapter.md) </span><span class="sxs-lookup"><span data-stu-id="3f56c-156">[Interfaces for a Transactional Batch-Supported Receive Adapter](../core/interfaces-for-a-transactional-batch-supported-receive-adapter.md) </span></span>  
 [<span data-ttu-id="3f56c-157">要求 - 応答の同期受信アダプター用のインターフェイス</span><span class="sxs-lookup"><span data-stu-id="3f56c-157">Interfaces for a Synchronous Request-Response Receive Adapter</span></span>](../core/interfaces-for-a-synchronous-request-response-receive-adapter.md)