---
title: エンジンの永続性と耐久性 |Microsoft ドキュメント
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 9bd209e9-75d2-422f-b3b2-377986f41f2f
caps.latest.revision: 7
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 13f9f3f1a02ddfe84a963704476e867783f31042
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/20/2017
ms.locfileid: "22242594"
---
# <a name="engine-persistence-and-durability"></a><span data-ttu-id="60f56-102">エンジンの永続性と耐久性</span><span class="sxs-lookup"><span data-stu-id="60f56-102">Engine Persistence and Durability</span></span>
<span data-ttu-id="60f56-103">このセクションでは、SQL Server を介してプロセスの状態をディスクに永続化することによって、疎結合されたビジネス プロセスを BizTalk Server が確実に統合する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="60f56-103">This section explains how BizTalk Server reliably integrates loosely coupled business processes by persisting process state to disk via SQL Server.</span></span> <span data-ttu-id="60f56-104">トランザクションを活用し、状態の永続化を適切なタイミングで行うことによって、ハードウェアまたはソフトウェアに障害が発生しても、プロセスの状態が失われることのないシステム環境を保証できます。</span><span class="sxs-lookup"><span data-stu-id="60f56-104">By persisting state at appropriate times, leveraging transactions, the system guarantees that no process state is lost even in the event of a hardware or software outage.</span></span> <span data-ttu-id="60f56-105">これはシステムの耐久性とも呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="60f56-105">This is referred to as system durability.</span></span>  
  
## <a name="loosely-coupled-business-process-management"></a><span data-ttu-id="60f56-106">疎結合されたビジネス プロセスの管理</span><span class="sxs-lookup"><span data-stu-id="60f56-106">Loosely Coupled Business Process Management</span></span>  
 <span data-ttu-id="60f56-107">既存の複数システムを統合して 1 つの論理ビジネス プロセスを実行するには、これらの既存システムの外側でプロセスの状態を管理することが必要です。</span><span class="sxs-lookup"><span data-stu-id="60f56-107">Integrating existing systems to perform a single logical business process requires management of process state outside of the existing systems.</span></span> <span data-ttu-id="60f56-108">ビジネス プロセスが長時間にわたるものか、短時間で終了するものかにかかわらず、システムどうしを密結合したことによるカスタム通信経路の急増を回避するために、プロセスの状態は個別に管理する必要があります。</span><span class="sxs-lookup"><span data-stu-id="60f56-108">Whether the business process is long running or short lived, process state must be maintained independently in order to avoid the explosion of custom communications paths that result from tightly coupling systems together.</span></span>  
  
 <span data-ttu-id="60f56-109">ビジネス プロセスがミッション クリティカルである場合、実行中のビジネス プロセス インスタンスの状態に高い信頼性が求められることは明白です。</span><span class="sxs-lookup"><span data-stu-id="60f56-109">Clearly, the state of a running business process instance must be reliable if the business process is mission critical.</span></span> <span data-ttu-id="60f56-110">ビジネス プロセスの信頼性および持続性を高くするために、BizTalk では SQL Server のトランザクションを活用し、プロセスの状態およびビジネス データをメッセージ ボックス データベースと呼ばれるデータベース内のディスクに保存します。</span><span class="sxs-lookup"><span data-stu-id="60f56-110">To assure that business processes are reliable and durable, BizTalk leverages SQL Server transactions to persist process state and business data to disk in a database known as the MessageBox database.</span></span> <span data-ttu-id="60f56-111">メッセージ ボックス データベースの詳細については、次を参照してください。 [、メッセージ ボックス データベース](../core/the-messagebox-database.md)です。</span><span class="sxs-lookup"><span data-stu-id="60f56-111">For more information about the MessageBox database, see [The MessageBox Database](../core/the-messagebox-database.md).</span></span>  
  
 <span data-ttu-id="60f56-112">[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] では、メッセージとビジネス プロセス インスタンスはすべて (オーケストレーション インスタンスなど、ごくささいなものを除いて)、処理中に 一回以上メッセージ ボックス データベースに保存されます。</span><span class="sxs-lookup"><span data-stu-id="60f56-112">Every message and all but the most trivial business process instances (for example, orchestration instances) in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] are persisted in the MessageBox database at least once during processing.</span></span>  
  
## <a name="persistence-and-sustainability"></a><span data-ttu-id="60f56-113">永続性と持続性</span><span class="sxs-lookup"><span data-stu-id="60f56-113">Persistence and Sustainability</span></span>  
 <span data-ttu-id="60f56-114">BizTalk Server がすべてのメッセージおよび大部分のオーケストレーションが保持されるという事実は、持続性で説明したとおりに直接影響を及ぼします[維持可能なパフォーマンスは何ですか。](../core/what-is-sustainable-performance.md)</span><span class="sxs-lookup"><span data-stu-id="60f56-114">The fact that BizTalk Server persists all messages and most orchestrations has a direct affect on sustainability as noted in [What Is Sustainable Performance?](../core/what-is-sustainable-performance.md)</span></span> <span data-ttu-id="60f56-115">メッセージ ボックス データベースにメッセージが到着した、それらは (たとえば、オーケストレーションと送信ポート) を待機しているサブスクライバーにルーティングと入れまたは公開されて、サブスクライバーとプロセスの取得を待機するメッセージ ボックス SQL テーブルです。</span><span class="sxs-lookup"><span data-stu-id="60f56-115">As messages arrive in the MessageBox database, they are routed to waiting subscribers (for example, orchestrations and send ports) and en-queued, or published, into messagebox SQL tables to wait for subscribers to pick them up and process them.</span></span> <span data-ttu-id="60f56-116">到着した一部のメッセージは、新しいサブスクライバー インスタンスをアクティブ化します。</span><span class="sxs-lookup"><span data-stu-id="60f56-116">Some of the arriving messages activate new subscriber instances.</span></span> <span data-ttu-id="60f56-117">それ以外のメッセージは、到着すると、既に実行中のサブスクライバー (関連付けられたオーケストレーションなど) の待機中のインスタンスに、関連付けを介して回送されます。</span><span class="sxs-lookup"><span data-stu-id="60f56-117">Other messages arrive and are routed, via correlation, to a waiting instance of an already running subscriber such as a correlated orchestration.</span></span>  
  
 <span data-ttu-id="60f56-118">関連付けられたオーケストレーションが処理を続行するには、関連付けられた到着メッセージがブロックされない状態を維持する必要があります。</span><span class="sxs-lookup"><span data-stu-id="60f56-118">In order for correlated orchestrations to continue processing, arriving correlated messages must remain un-blocked.</span></span> <span data-ttu-id="60f56-119">そのために BizTalk では、関連付けられたメッセージを待っているサブスクライバーが処理を完了して他のプロセスに実行領域を開放することができるように、高負荷な状態であってもメッセージ (アクティブ化を行うメッセージおよび関連付けられたメッセージの両方) の受信を可能な限り継続します。</span><span class="sxs-lookup"><span data-stu-id="60f56-119">To facilitate this, BizTalk does its best to make sure messages (both activating and correlated) continue to be received, even under high load, so that subscribers waiting for correlated messages can finish and make room for more processes to run.</span></span> <span data-ttu-id="60f56-120">つまり、メッセージを処理してメッセージ ボックス データベースから削除するよりも速くメッセージを受信することが可能になり、バックログとしてメッセージが蓄積される状況を生じます。</span><span class="sxs-lookup"><span data-stu-id="60f56-120">This means it is possible to receive messages faster than they can be processed and removed from the MessageBox database, thus building up a message backlog.</span></span> <span data-ttu-id="60f56-121">ストア アンド フォワード テクノロジでは、通常、BizTalk がこのようなバッファリングを行いますが、常に受信レートが処理レートを上回る状態がいつまでも続いてバックログが大きくなると、問題につながります。</span><span class="sxs-lookup"><span data-stu-id="60f56-121">Being a store-and-forward technology, it is natural for BizTalk to provide this type of buffering, however, it can result in problems if the receive rate is consistently faster than the process rate indefinitely, resulting in a large backlog.</span></span>  
  
 <span data-ttu-id="60f56-122">BizTalk Server によって受信されたメッセージまたは BizTalk Server 内で作成されたメッセージは変更できません。</span><span class="sxs-lookup"><span data-stu-id="60f56-122">Every message that is received by, or created within, BizTalk Server is immutable.</span></span> <span data-ttu-id="60f56-123">つまり、メッセージがいったん受信または作成されると、その内容は変更できません。</span><span class="sxs-lookup"><span data-stu-id="60f56-123">That is, once it has been received or created, its content cannot be changed.</span></span> <span data-ttu-id="60f56-124">また、受信したメッセージに複数のサブスクライバーが存在することもあります。</span><span class="sxs-lookup"><span data-stu-id="60f56-124">In addition, received messages may have multiple subscribers.</span></span> <span data-ttu-id="60f56-125">その場合、同じメッセージの単一コピーが、複数のサブスクライバーによって参照されます。</span><span class="sxs-lookup"><span data-stu-id="60f56-125">Each subscriber of a particular message references the same, single copy of that message.</span></span> <span data-ttu-id="60f56-126">この方法では記憶域は最小化されますが、各メッセージについて参照カウントを保存する必要が生じます。また、参照カウントが 0 のメッセージは、定期保守で除去する必要があります。</span><span class="sxs-lookup"><span data-stu-id="60f56-126">While this approach minimizes storage, a ref-count must be kept for each message and maintenance must be performed periodically to get rid of those messages that have a ref count of 0.</span></span>  
  
 <span data-ttu-id="60f56-127">メッセージ ボックス データベース内で大きなバックログの蓄積が許容される場合、各メッセージ ボックス データベースの SQL ジョブのセットとして実装されているデータベースのメンテナンス処理が遅れることになり、その遅れを取り戻す機会がなければ、最終的にディスク領域が不足するなどの事態を招くことがあります。</span><span class="sxs-lookup"><span data-stu-id="60f56-127">If a large enough backlog is allowed to build up in the MessageBox database, the maintenance processes for the database (implemented as a set of SQL Jobs for each MessageBox database) will fall behind and, if not given an opportunity to catch up, will eventually cause issues such as running out of disk space.</span></span> <span data-ttu-id="60f56-128">この状況を回避するために、BizTalk Server には制限メカニズムがあり、メッセージ ボックス データベースのバックログがユーザーの設定したレベルに達したときにメッセージの受信レートを下げます。</span><span class="sxs-lookup"><span data-stu-id="60f56-128">To avoid this situation, BizTalk Server provides a throttling mechanism that slows down the message receive rate when the MessageBox database backlog gets to some user-configurable level.</span></span> <span data-ttu-id="60f56-129">調整の詳細については、次を参照してください。[を最適化するリソース使用状況を通じてホスト制限](../core/optimizing-resource-usage-through-host-throttling.md)です。</span><span class="sxs-lookup"><span data-stu-id="60f56-129">For more information about throttling, see [Optimizing Resource Usage Through Host Throttling](../core/optimizing-resource-usage-through-host-throttling.md).</span></span>  
  
 <span data-ttu-id="60f56-130">持続性にかかわるすべてのアクティビティおよびプロセスを考慮すると、長時間の持続性を維持するには、バックログが無制限に蓄積されないようにすることが重要です。</span><span class="sxs-lookup"><span data-stu-id="60f56-130">Given all of the activities and processes that contribute to sustainability, the primary measure of sustainability over time is that a backlog is not allowed to grow indefinitely.</span></span> <span data-ttu-id="60f56-131">つまり、メッセージ ボックス データベースのバックログを処理可能な平均サイズに維持できるように、長期にわたってスループット レベルの高いピークと低いピークの間のバランスをとる必要があります。</span><span class="sxs-lookup"><span data-stu-id="60f56-131">In other words, over time, there must be a balance between the high and low peak throughput levels so that the MessageBox database is able to maintain a constant and manageable average backlog.</span></span> <span data-ttu-id="60f56-132">バックログの重要な目安として、スプール テーブルの大きさがあります。この値は、BizTalk:Message Box:General Counters:Spool Size という [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] パフォーマンス カウンターとして表されます。</span><span class="sxs-lookup"><span data-stu-id="60f56-132">The primary measure of backlog is the depth of the spool table, which is exposed as a [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] performance counter called BizTalk:Message Box:General Counters:Spool Size.</span></span> <span data-ttu-id="60f56-133">このパフォーマンス カウンターの詳細については、次を参照してください。[メッセージ ボックス パフォーマンス カウンター](../core/message-box-performance-counters.md)です。</span><span class="sxs-lookup"><span data-stu-id="60f56-133">For more information about this performance counter, see [Message Box Performance Counters](../core/message-box-performance-counters.md).</span></span>  
  
 <span data-ttu-id="60f56-134">スプール サイズおよびその他のカウンターを使用して、システムが維持できる最大スループットを判断する方法の詳細については、次を参照してください。[測定最大エンジン スループット](../core/measuring-maximum-sustainable-engine-throughput.md)です。</span><span class="sxs-lookup"><span data-stu-id="60f56-134">For more information on how to use the spool size and other counters to determine the maximum throughput a system can sustain, see [Measuring Maximum Sustainable Engine Throughput](../core/measuring-maximum-sustainable-engine-throughput.md).</span></span>  
  
## <a name="recommendations"></a><span data-ttu-id="60f56-135">推奨事項</span><span class="sxs-lookup"><span data-stu-id="60f56-135">Recommendations</span></span>  
 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="60f56-136"> ではすべてのメッセージおよび大部分のオーケストレーションを永続化するので、注意しないとメッセージのバックログが増加し、ディスク領域が不足する事態を招くことがあります。</span><span class="sxs-lookup"><span data-stu-id="60f56-136"> persists all messages and most orchestrations and can, left un-checked, develop a backlog of messages that can result in issues such as running out of disk space.</span></span> <span data-ttu-id="60f56-137">バックログの重要な目安は、というパフォーマンス カウンターとして公開される、メッセージ ボックス スプール テーブルの深さ: BizTalk:Message ボックス: 一般的なカウンター: Spool のサイズ。</span><span class="sxs-lookup"><span data-stu-id="60f56-137">The primary measure of backlog is the depth of the messagebox spool table, which is exposed as a performance counter called: BizTalk:Message Box:General Counters:Spool Size.</span></span>  
  
 <span data-ttu-id="60f56-138">持続性の高いスループットを得るには、長期間にわたり安定した平均的なスプール サイズを維持する必要があります。</span><span class="sxs-lookup"><span data-stu-id="60f56-138">When thinking about sustainable throughput, the spool size must sustain a stable average over time.</span></span> <span data-ttu-id="60f56-139">つまり、スプール サイズを抑制せずに無限に増大させるわけにはいきません。</span><span class="sxs-lookup"><span data-stu-id="60f56-139">That is, the spool cannot continue to grow un-checked indefinitely.</span></span> <span data-ttu-id="60f56-140">[測定最大エンジン スループット](../core/measuring-maximum-sustainable-engine-throughput.md)スプール サイズおよびその他のパフォーマンスを活用して、システムが維持できる最大スループットを特定する方法を提供、この動作の詳細について説明していますインジケーター。</span><span class="sxs-lookup"><span data-stu-id="60f56-140">In [Measuring Maximum Sustainable Engine Throughput](../core/measuring-maximum-sustainable-engine-throughput.md), this behavior is discussed in more detail and a method of determining the maximum throughput a system can sustain is provided which leverages the spool size and other performance indicators.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="60f56-141">参照</span><span class="sxs-lookup"><span data-stu-id="60f56-141">See Also</span></span>  
 <span data-ttu-id="60f56-142">[維持可能な最大のエンジン スループットの測定](../core/measuring-maximum-sustainable-engine-throughput.md) </span><span class="sxs-lookup"><span data-stu-id="60f56-142">[Measuring Maximum Sustainable Engine Throughput](../core/measuring-maximum-sustainable-engine-throughput.md) </span></span>  
 <span data-ttu-id="60f56-143">[維持可能なパフォーマンスとは何ですか。](../core/what-is-sustainable-performance.md) </span><span class="sxs-lookup"><span data-stu-id="60f56-143">[What Is Sustainable Performance?](../core/what-is-sustainable-performance.md) </span></span>  
 <span data-ttu-id="60f56-144">[パフォーマンスのヒントとテクニック](../core/performance-tips-and-tricks.md) </span><span class="sxs-lookup"><span data-stu-id="60f56-144">[Performance Tips and Tricks](../core/performance-tips-and-tricks.md) </span></span>  
 [<span data-ttu-id="60f56-145">メッセージ ボックス パフォーマンス カウンター</span><span class="sxs-lookup"><span data-stu-id="60f56-145">Message Box Performance Counters</span></span>](../core/message-box-performance-counters.md)