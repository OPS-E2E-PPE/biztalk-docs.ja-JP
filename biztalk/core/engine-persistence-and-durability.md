---
title: エンジンの永続性と耐久性 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 9bd209e9-75d2-422f-b3b2-377986f41f2f
caps.latest.revision: 7
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 929047264eb395636ee7d2a5793642f12ac7e5e4
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/07/2019
ms.locfileid: "65349398"
---
# <a name="engine-persistence-and-durability"></a><span data-ttu-id="ae331-102">エンジンの永続性と耐久性</span><span class="sxs-lookup"><span data-stu-id="ae331-102">Engine Persistence and Durability</span></span>
<span data-ttu-id="ae331-103">このセクションでは、BizTalk Server が確実に SQL Server を使用してディスクに永続化するプロセスの状態で疎結合されたビジネス プロセスを統合する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="ae331-103">This section explains how BizTalk Server reliably integrates loosely coupled business processes by persisting process state to disk via SQL Server.</span></span> <span data-ttu-id="ae331-104">トランザクションを活用し、適切なタイミングで状態を保持するでは、システムは、プロセスの状態は、ハードウェアまたはソフトウェアに障害が発生しても失われないことを保証します。</span><span class="sxs-lookup"><span data-stu-id="ae331-104">By persisting state at appropriate times, leveraging transactions, the system guarantees that no process state is lost even in the event of a hardware or software outage.</span></span> <span data-ttu-id="ae331-105">これは、システムの耐久性と呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="ae331-105">This is referred to as system durability.</span></span>  
  
## <a name="loosely-coupled-business-process-management"></a><span data-ttu-id="ae331-106">ビジネス プロセス管理を疎結合</span><span class="sxs-lookup"><span data-stu-id="ae331-106">Loosely Coupled Business Process Management</span></span>  
 <span data-ttu-id="ae331-107">1 つの論理ビジネス プロセスを実行する既存のシステムを統合するには、既存のシステムの外部プロセスの状態の管理が必要です。</span><span class="sxs-lookup"><span data-stu-id="ae331-107">Integrating existing systems to perform a single logical business process requires management of process state outside of the existing systems.</span></span> <span data-ttu-id="ae331-108">ビジネス プロセスが実行中の時間の長いまたは短い有効期間、かどうかプロセスの状態する必要があるは別に保持密結合システムを一緒に起因するカスタム通信経路の急増を回避するためにします。</span><span class="sxs-lookup"><span data-stu-id="ae331-108">Whether the business process is long running or short lived, process state must be maintained independently in order to avoid the explosion of custom communications paths that result from tightly coupling systems together.</span></span>  
  
 <span data-ttu-id="ae331-109">実行中の状態に明らかに、ビジネス プロセス インスタンスは、ビジネス プロセスがミッション クリティカルな場合、信頼する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ae331-109">Clearly, the state of a running business process instance must be reliable if the business process is mission critical.</span></span> <span data-ttu-id="ae331-110">BizTalk が保持する SQL Server のトランザクションを活用してビジネス プロセスは、信頼性が高く、持続性のあることを保証するには、メッセージ ボックス データベースと呼ばれるデータベース内のディスクの状態およびビジネス データを処理します。</span><span class="sxs-lookup"><span data-stu-id="ae331-110">To assure that business processes are reliable and durable, BizTalk leverages SQL Server transactions to persist process state and business data to disk in a database known as the MessageBox database.</span></span> <span data-ttu-id="ae331-111">メッセージ ボックス データベースの詳細については、次を参照してください。 [、メッセージ ボックス データベース](../core/the-messagebox-database.md)します。</span><span class="sxs-lookup"><span data-stu-id="ae331-111">For more information about the MessageBox database, see [The MessageBox Database](../core/the-messagebox-database.md).</span></span>  
  
 <span data-ttu-id="ae331-112">すべてのメッセージとそのすべてが最も単純なビジネス プロセスのインスタンス (たとえば、オーケストレーション インスタンス)[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]処理中に 1 回以上メッセージ ボックス データベースに保存されます。</span><span class="sxs-lookup"><span data-stu-id="ae331-112">Every message and all but the most trivial business process instances (for example, orchestration instances) in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] are persisted in the MessageBox database at least once during processing.</span></span>  
  
## <a name="persistence-and-sustainability"></a><span data-ttu-id="ae331-113">永続性と持続性</span><span class="sxs-lookup"><span data-stu-id="ae331-113">Persistence and Sustainability</span></span>  
 <span data-ttu-id="ae331-114">BizTalk Server がすべてのメッセージおよび大部分のオーケストレーションが保持されるという事実、持続性で説明したようには直接影響[維持可能なパフォーマンスとは何ですか?](../core/what-is-sustainable-performance.md)</span><span class="sxs-lookup"><span data-stu-id="ae331-114">The fact that BizTalk Server persists all messages and most orchestrations has a direct affect on sustainability as noted in [What Is Sustainable Performance?](../core/what-is-sustainable-performance.md)</span></span> <span data-ttu-id="ae331-115">メッセージ ボックス データベースにメッセージの着信時、これらは (たとえば、オーケストレーションと送信ポート) を待機しているサブスクライバーにルーティングと入れまたはをピックアップして、それらを処理するサブスクライバーを待機するメッセージ ボックス SQL テーブルに、パブリッシュされました。</span><span class="sxs-lookup"><span data-stu-id="ae331-115">As messages arrive in the MessageBox database, they are routed to waiting subscribers (for example, orchestrations and send ports) and en-queued, or published, into messagebox SQL tables to wait for subscribers to pick them up and process them.</span></span> <span data-ttu-id="ae331-116">到着したメッセージの一部には、新しいサブスクライバー インスタンスがアクティブにします。</span><span class="sxs-lookup"><span data-stu-id="ae331-116">Some of the arriving messages activate new subscriber instances.</span></span> <span data-ttu-id="ae331-117">その他のメッセージが到着し、関連付けられたオーケストレーションなどの既に実行中のサブスクライバーの待機中のインスタンスに、関連付けを介して回送されます。</span><span class="sxs-lookup"><span data-stu-id="ae331-117">Other messages arrive and are routed, via correlation, to a waiting instance of an already running subscriber such as a correlated orchestration.</span></span>  
  
 <span data-ttu-id="ae331-118">関連付けられたオーケストレーション処理を続行するためには、関連付けられた到着メッセージがブロック解除する必要があります残ります。</span><span class="sxs-lookup"><span data-stu-id="ae331-118">In order for correlated orchestrations to continue processing, arriving correlated messages must remain un-blocked.</span></span> <span data-ttu-id="ae331-119">そのため、BizTalk はメッセージ (アクティブ化と相関関係の両方)、受信する、高負荷であっても関連するメッセージを待っているサブスクライバーは完了して、他のプロセスを実行に領域が確保されるように残り続けるかどうかを確認することをお勧めが。</span><span class="sxs-lookup"><span data-stu-id="ae331-119">To facilitate this, BizTalk does its best to make sure messages (both activating and correlated) continue to be received, even under high load, so that subscribers waiting for correlated messages can finish and make room for more processes to run.</span></span> <span data-ttu-id="ae331-120">つまり、処理し、メッセージのバックログを蓄積ため、メッセージ ボックス データベースから削除するよりも速くメッセージを受信することができます。</span><span class="sxs-lookup"><span data-stu-id="ae331-120">This means it is possible to receive messages faster than they can be processed and removed from the MessageBox database, thus building up a message backlog.</span></span> <span data-ttu-id="ae331-121">ストア アンド フォワード テクノロジである、この種類のバッファリングを提供する BizTalk の自然では、受信レートが一貫して大量のバックログに無期限に、プロセス速度よりも高速な場合、問題の発生できますただし。</span><span class="sxs-lookup"><span data-stu-id="ae331-121">Being a store-and-forward technology, it is natural for BizTalk to provide this type of buffering, however, it can result in problems if the receive rate is consistently faster than the process rate indefinitely, resulting in a large backlog.</span></span>  
  
 <span data-ttu-id="ae331-122">受信した、または内に作成されているすべてのメッセージを BizTalk Server は不変です。</span><span class="sxs-lookup"><span data-stu-id="ae331-122">Every message that is received by, or created within, BizTalk Server is immutable.</span></span> <span data-ttu-id="ae331-123">つまり、受信または作成されたが後の内容は変更できません。</span><span class="sxs-lookup"><span data-stu-id="ae331-123">That is, once it has been received or created, its content cannot be changed.</span></span> <span data-ttu-id="ae331-124">さらに、受信したメッセージには、複数のサブスクライバーがあります。</span><span class="sxs-lookup"><span data-stu-id="ae331-124">In addition, received messages may have multiple subscribers.</span></span> <span data-ttu-id="ae331-125">特定のメッセージの各サブスクライバーでは、そのメッセージの同じ 1 つのコピーを参照します。</span><span class="sxs-lookup"><span data-stu-id="ae331-125">Each subscriber of a particular message references the same, single copy of that message.</span></span> <span data-ttu-id="ae331-126">この方法は、記憶域を最小化、各メッセージの参照カウントを保持する必要があり、0 の参照カウントがそれらのメッセージを削除するメンテナンスを定期的に実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ae331-126">While this approach minimizes storage, a ref-count must be kept for each message and maintenance must be performed periodically to get rid of those messages that have a ref count of 0.</span></span>  
  
 <span data-ttu-id="ae331-127">メッセージ ボックス データベースを構築するのに十分な大きさのバックログが許可されている場合、(各メッセージ ボックス データベースの SQL ジョブのセットとして実装された) データベースのメンテナンス処理が遅れるし、遅れを取り戻す機会が与えられていない場合は最終的が発生ディスク領域の不足などの問題。</span><span class="sxs-lookup"><span data-stu-id="ae331-127">If a large enough backlog is allowed to build up in the MessageBox database, the maintenance processes for the database (implemented as a set of SQL Jobs for each MessageBox database) will fall behind and, if not given an opportunity to catch up, will eventually cause issues such as running out of disk space.</span></span> <span data-ttu-id="ae331-128">このような状況を避けるためには、BizTalk Server には制限をいくつかのユーザー構成可能なレベルに、メッセージ ボックス データベース バックログを取得すると、メッセージを低下させるメカニズム受信率。</span><span class="sxs-lookup"><span data-stu-id="ae331-128">To avoid this situation, BizTalk Server provides a throttling mechanism that slows down the message receive rate when the MessageBox database backlog gets to some user-configurable level.</span></span> <span data-ttu-id="ae331-129">スロットルの詳細については、次を参照してください。[を最適化するリソースをホストの調整](../core/optimizing-resource-usage-through-host-throttling.md)します。</span><span class="sxs-lookup"><span data-stu-id="ae331-129">For more information about throttling, see [Optimizing Resource Usage Through Host Throttling](../core/optimizing-resource-usage-through-host-throttling.md).</span></span>  
  
 <span data-ttu-id="ae331-130">すべてのアクティビティおよびプロセスを考慮の持続性を時間の経過と共に、持続性の尺度がバックログを無制限に拡大できません。</span><span class="sxs-lookup"><span data-stu-id="ae331-130">Given all of the activities and processes that contribute to sustainability, the primary measure of sustainability over time is that a backlog is not allowed to grow indefinitely.</span></span> <span data-ttu-id="ae331-131">つまり、時間の経過と共に必要がありますのバランスを取る、高値と安値のピーク スループット レベルの間、メッセージ ボックス データベースが定数で管理しやすい平均バックログを管理できるように。</span><span class="sxs-lookup"><span data-stu-id="ae331-131">In other words, over time, there must be a balance between the high and low peak throughput levels so that the MessageBox database is able to maintain a constant and manageable average backlog.</span></span> <span data-ttu-id="ae331-132">バックログの主要な基準として公開される、スプール テーブルの深さを[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]パフォーマンス カウンターには、BizTalk:Message ボックス: 一般的なカウンター: Spool のサイズと呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="ae331-132">The primary measure of backlog is the depth of the spool table, which is exposed as a [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] performance counter called BizTalk:Message Box:General Counters:Spool Size.</span></span> <span data-ttu-id="ae331-133">このパフォーマンス カウンターの詳細については、次を参照してください。[メッセージ ボックス パフォーマンス カウンター](../core/message-box-performance-counters.md)します。</span><span class="sxs-lookup"><span data-stu-id="ae331-133">For more information about this performance counter, see [Message Box Performance Counters](../core/message-box-performance-counters.md).</span></span>  
  
 <span data-ttu-id="ae331-134">スプール サイズおよびその他のカウンターを使用して、システムが維持できる最大スループットを判断する方法の詳細については、次を参照してください。[最大持続可能なエンジン スループットの測定](../core/measuring-maximum-sustainable-engine-throughput.md)します。</span><span class="sxs-lookup"><span data-stu-id="ae331-134">For more information on how to use the spool size and other counters to determine the maximum throughput a system can sustain, see [Measuring Maximum Sustainable Engine Throughput](../core/measuring-maximum-sustainable-engine-throughput.md).</span></span>  
  
## <a name="recommendations"></a><span data-ttu-id="ae331-135">推奨事項</span><span class="sxs-lookup"><span data-stu-id="ae331-135">Recommendations</span></span>  
 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] <span data-ttu-id="ae331-136">すべてのメッセージおよび大部分のオーケストレーションを永続化し、ディスク領域の不足などの問題につながるメッセージのバックログを作成できます、事態を。</span><span class="sxs-lookup"><span data-stu-id="ae331-136">persists all messages and most orchestrations and can, left un-checked, develop a backlog of messages that can result in issues such as running out of disk space.</span></span> <span data-ttu-id="ae331-137">バックログの主要な基準では、というパフォーマンス カウンタとして公開されるメッセージ ボックス スプール テーブルの深さを示します。BizTalk:Message ボックス: 一般的なカウンター: Spool のサイズ。</span><span class="sxs-lookup"><span data-stu-id="ae331-137">The primary measure of backlog is the depth of the messagebox spool table, which is exposed as a performance counter called: BizTalk:Message Box:General Counters:Spool Size.</span></span>  
  
 <span data-ttu-id="ae331-138">維持可能なスループットを検討する場合、スプール サイズは、時間の経過と共に安定した平均的を維持する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ae331-138">When thinking about sustainable throughput, the spool size must sustain a stable average over time.</span></span> <span data-ttu-id="ae331-139">Spool のサイズは、無期限にでオフ増大し続けることはできません。</span><span class="sxs-lookup"><span data-stu-id="ae331-139">That is, the spool cannot continue to grow un-checked indefinitely.</span></span> <span data-ttu-id="ae331-140">[最大持続可能なエンジン スループットの測定](../core/measuring-maximum-sustainable-engine-throughput.md)、この動作がさらに詳しく説明されているし、スプール サイズおよびその他のパフォーマンスを活用するシステムが維持できる最大スループットを特定する方法を提供インジケーター。</span><span class="sxs-lookup"><span data-stu-id="ae331-140">In [Measuring Maximum Sustainable Engine Throughput](../core/measuring-maximum-sustainable-engine-throughput.md), this behavior is discussed in more detail and a method of determining the maximum throughput a system can sustain is provided which leverages the spool size and other performance indicators.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="ae331-141">参照</span><span class="sxs-lookup"><span data-stu-id="ae331-141">See Also</span></span>  
 <span data-ttu-id="ae331-142">[維持可能な最大のエンジン スループットの測定](../core/measuring-maximum-sustainable-engine-throughput.md) </span><span class="sxs-lookup"><span data-stu-id="ae331-142">[Measuring Maximum Sustainable Engine Throughput](../core/measuring-maximum-sustainable-engine-throughput.md) </span></span>  
 <span data-ttu-id="ae331-143">[維持可能なパフォーマンスとは何ですか。](../core/what-is-sustainable-performance.md) </span><span class="sxs-lookup"><span data-stu-id="ae331-143">[What Is Sustainable Performance?](../core/what-is-sustainable-performance.md) </span></span>  
 <span data-ttu-id="ae331-144">[パフォーマンスのヒントとテクニック](../core/performance-tips-and-tricks.md) </span><span class="sxs-lookup"><span data-stu-id="ae331-144">[Performance Tips and Tricks](../core/performance-tips-and-tricks.md) </span></span>  
 [<span data-ttu-id="ae331-145">メッセージ ボックスのパフォーマンス カウンター</span><span class="sxs-lookup"><span data-stu-id="ae331-145">Message Box Performance Counters</span></span>](../core/message-box-performance-counters.md)