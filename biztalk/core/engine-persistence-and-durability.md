---
title: エンジンの永続性と耐久性 |Microsoft ドキュメント
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 9bd209e9-75d2-422f-b3b2-377986f41f2f
caps.latest.revision: 7
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 13f9f3f1a02ddfe84a963704476e867783f31042
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/20/2017
ms.locfileid: "22242594"
---
# <a name="engine-persistence-and-durability"></a>エンジンの永続性と耐久性
このセクションでは、SQL Server を介してプロセスの状態をディスクに永続化することによって、疎結合されたビジネス プロセスを BizTalk Server が確実に統合する方法について説明します。 トランザクションを活用し、状態の永続化を適切なタイミングで行うことによって、ハードウェアまたはソフトウェアに障害が発生しても、プロセスの状態が失われることのないシステム環境を保証できます。 これはシステムの耐久性とも呼ばれます。  
  
## <a name="loosely-coupled-business-process-management"></a>疎結合されたビジネス プロセスの管理  
 既存の複数システムを統合して 1 つの論理ビジネス プロセスを実行するには、これらの既存システムの外側でプロセスの状態を管理することが必要です。 ビジネス プロセスが長時間にわたるものか、短時間で終了するものかにかかわらず、システムどうしを密結合したことによるカスタム通信経路の急増を回避するために、プロセスの状態は個別に管理する必要があります。  
  
 ビジネス プロセスがミッション クリティカルである場合、実行中のビジネス プロセス インスタンスの状態に高い信頼性が求められることは明白です。 ビジネス プロセスの信頼性および持続性を高くするために、BizTalk では SQL Server のトランザクションを活用し、プロセスの状態およびビジネス データをメッセージ ボックス データベースと呼ばれるデータベース内のディスクに保存します。 メッセージ ボックス データベースの詳細については、次を参照してください。 [、メッセージ ボックス データベース](../core/the-messagebox-database.md)です。  
  
 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] では、メッセージとビジネス プロセス インスタンスはすべて (オーケストレーション インスタンスなど、ごくささいなものを除いて)、処理中に 一回以上メッセージ ボックス データベースに保存されます。  
  
## <a name="persistence-and-sustainability"></a>永続性と持続性  
 BizTalk Server がすべてのメッセージおよび大部分のオーケストレーションが保持されるという事実は、持続性で説明したとおりに直接影響を及ぼします[維持可能なパフォーマンスは何ですか。](../core/what-is-sustainable-performance.md) メッセージ ボックス データベースにメッセージが到着した、それらは (たとえば、オーケストレーションと送信ポート) を待機しているサブスクライバーにルーティングと入れまたは公開されて、サブスクライバーとプロセスの取得を待機するメッセージ ボックス SQL テーブルです。 到着した一部のメッセージは、新しいサブスクライバー インスタンスをアクティブ化します。 それ以外のメッセージは、到着すると、既に実行中のサブスクライバー (関連付けられたオーケストレーションなど) の待機中のインスタンスに、関連付けを介して回送されます。  
  
 関連付けられたオーケストレーションが処理を続行するには、関連付けられた到着メッセージがブロックされない状態を維持する必要があります。 そのために BizTalk では、関連付けられたメッセージを待っているサブスクライバーが処理を完了して他のプロセスに実行領域を開放することができるように、高負荷な状態であってもメッセージ (アクティブ化を行うメッセージおよび関連付けられたメッセージの両方) の受信を可能な限り継続します。 つまり、メッセージを処理してメッセージ ボックス データベースから削除するよりも速くメッセージを受信することが可能になり、バックログとしてメッセージが蓄積される状況を生じます。 ストア アンド フォワード テクノロジでは、通常、BizTalk がこのようなバッファリングを行いますが、常に受信レートが処理レートを上回る状態がいつまでも続いてバックログが大きくなると、問題につながります。  
  
 BizTalk Server によって受信されたメッセージまたは BizTalk Server 内で作成されたメッセージは変更できません。 つまり、メッセージがいったん受信または作成されると、その内容は変更できません。 また、受信したメッセージに複数のサブスクライバーが存在することもあります。 その場合、同じメッセージの単一コピーが、複数のサブスクライバーによって参照されます。 この方法では記憶域は最小化されますが、各メッセージについて参照カウントを保存する必要が生じます。また、参照カウントが 0 のメッセージは、定期保守で除去する必要があります。  
  
 メッセージ ボックス データベース内で大きなバックログの蓄積が許容される場合、各メッセージ ボックス データベースの SQL ジョブのセットとして実装されているデータベースのメンテナンス処理が遅れることになり、その遅れを取り戻す機会がなければ、最終的にディスク領域が不足するなどの事態を招くことがあります。 この状況を回避するために、BizTalk Server には制限メカニズムがあり、メッセージ ボックス データベースのバックログがユーザーの設定したレベルに達したときにメッセージの受信レートを下げます。 調整の詳細については、次を参照してください。[を最適化するリソース使用状況を通じてホスト制限](../core/optimizing-resource-usage-through-host-throttling.md)です。  
  
 持続性にかかわるすべてのアクティビティおよびプロセスを考慮すると、長時間の持続性を維持するには、バックログが無制限に蓄積されないようにすることが重要です。 つまり、メッセージ ボックス データベースのバックログを処理可能な平均サイズに維持できるように、長期にわたってスループット レベルの高いピークと低いピークの間のバランスをとる必要があります。 バックログの重要な目安として、スプール テーブルの大きさがあります。この値は、BizTalk:Message Box:General Counters:Spool Size という [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] パフォーマンス カウンターとして表されます。 このパフォーマンス カウンターの詳細については、次を参照してください。[メッセージ ボックス パフォーマンス カウンター](../core/message-box-performance-counters.md)です。  
  
 スプール サイズおよびその他のカウンターを使用して、システムが維持できる最大スループットを判断する方法の詳細については、次を参照してください。[測定最大エンジン スループット](../core/measuring-maximum-sustainable-engine-throughput.md)です。  
  
## <a name="recommendations"></a>推奨事項  
 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] ではすべてのメッセージおよび大部分のオーケストレーションを永続化するので、注意しないとメッセージのバックログが増加し、ディスク領域が不足する事態を招くことがあります。 バックログの重要な目安は、というパフォーマンス カウンターとして公開される、メッセージ ボックス スプール テーブルの深さ: BizTalk:Message ボックス: 一般的なカウンター: Spool のサイズ。  
  
 持続性の高いスループットを得るには、長期間にわたり安定した平均的なスプール サイズを維持する必要があります。 つまり、スプール サイズを抑制せずに無限に増大させるわけにはいきません。 [測定最大エンジン スループット](../core/measuring-maximum-sustainable-engine-throughput.md)スプール サイズおよびその他のパフォーマンスを活用して、システムが維持できる最大スループットを特定する方法を提供、この動作の詳細について説明していますインジケーター。  
  
## <a name="see-also"></a>参照  
 [維持可能な最大のエンジン スループットの測定](../core/measuring-maximum-sustainable-engine-throughput.md)   
 [維持可能なパフォーマンスとは何ですか。](../core/what-is-sustainable-performance.md)   
 [パフォーマンスのヒントとテクニック](../core/performance-tips-and-tricks.md)   
 [メッセージ ボックス パフォーマンス カウンター](../core/message-box-performance-counters.md)