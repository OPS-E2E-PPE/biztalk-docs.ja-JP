---
title: "関連付けられたメッセージの制限を回避する方法 |Microsoft ドキュメント"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: bfe47747-01e7-4e2f-bbd5-d5055cea001a
caps.latest.revision: "7"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 10cfcf0009cac5a72d71190c1b974ca6d01a2e1e
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/20/2017
---
# <a name="how-to-avoid-throttling-correlated-messages"></a><span data-ttu-id="2546c-102">関連付けられたメッセージの制限を回避する方法</span><span class="sxs-lookup"><span data-stu-id="2546c-102">How to Avoid Throttling Correlated Messages</span></span>
<span data-ttu-id="2546c-103">受信場所やオーケストレーションなどを介して BizTalk Server のキューに入れられたメッセージは、次のいずれかの方法で処理されます。</span><span class="sxs-lookup"><span data-stu-id="2546c-103">Messages that are en-queued into BizTalk Server, for example through a receive location or by orchestrations, can be processed in one of the following ways:</span></span>  
  
-   <span data-ttu-id="2546c-104">サブスクライバー (オーケストレーションまたは送信ポート) の新しいインスタンスがアクティブ化されます。</span><span class="sxs-lookup"><span data-stu-id="2546c-104">They can activate new instances of subscribers (that is, orchestrations or send ports)</span></span>  
  
-   <span data-ttu-id="2546c-105">関連付けによって、既存のサブスクライバー インスタンスにルーティングされます。</span><span class="sxs-lookup"><span data-stu-id="2546c-105">They can be routed to an existing subscriber instance via correlation.</span></span> <span data-ttu-id="2546c-106">相関関係の詳細については、次を参照してください。[オーケストレーションでの相関関係を使用して](../core/using-correlations-in-orchestrations.md)です。</span><span class="sxs-lookup"><span data-stu-id="2546c-106">For more information about correlation, see [Using Correlations in Orchestrations](../core/using-correlations-in-orchestrations.md).</span></span>  
  
 <span data-ttu-id="2546c-107">開発者の多くは、ソリューションの受信場所で、ソリューションのアクティベーション メッセージと関連付けられたメッセージの両方が同じポートを通じて受信されると考えています。</span><span class="sxs-lookup"><span data-stu-id="2546c-107">A lot of developers think about the receive locations for a solution as receiving both activation and correlated messages for the solution through the same port.</span></span> <span data-ttu-id="2546c-108">メッセージ送信者が追跡する必要のあるアドレスの数が最小限に抑えられるため、このように考えるのが自然です。</span><span class="sxs-lookup"><span data-stu-id="2546c-108">This is natural as it minimizes the number of addresses that message senders need to keep track of.</span></span> <span data-ttu-id="2546c-109">しかし、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] では制限を使用できるようになったため、制限に関しては、アクティベーション メッセージのストリームと関連付けられたメッセージのストリームを分けて考えた方がよい場合があります。</span><span class="sxs-lookup"><span data-stu-id="2546c-109">However, with throttling in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)], there can be advantages to thinking about the stream of activation messages and the stream of correlated messages separately when it comes to throttling.</span></span>  
  
 <span data-ttu-id="2546c-110">アクティベーション メッセージと関連付けられたメッセージの両方を同一の受信場所で受信すると、制限の状態も同じになります。これは、制限がホスト レベルで適用されるためです。</span><span class="sxs-lookup"><span data-stu-id="2546c-110">When both activation and correlation messages arrive through the same receive location, they are subject to the same throttling state because throttling is applied at the host level.</span></span> <span data-ttu-id="2546c-111">その結果、そのホスト内の受信場所で受信するすべてのメッセージは、1 つの単位として制限を適用されます。</span><span class="sxs-lookup"><span data-stu-id="2546c-111">As a result, all messages arriving at receive locations in the host will be throttled as a unit.</span></span> <span data-ttu-id="2546c-112">多くの場合は問題となりませんが、関連付けとアクティベーションに制限を適用すると一種のシステム デッドロックが発生する場合もあります。</span><span class="sxs-lookup"><span data-stu-id="2546c-112">This is not an issue for many scenarios, but there are cases where throttling correlations with activations can result in a type of system deadlock.</span></span>  
  
## <a name="example"></a><span data-ttu-id="2546c-113">例</span><span class="sxs-lookup"><span data-stu-id="2546c-113">Example</span></span>  
 <span data-ttu-id="2546c-114">たとえば、オーケストレーションで 1 つのアクティベーションを受信し、これを使用して関連付けセットを初期化した後、引き続き 10 個の追加メッセージのコンボイを受信するとします。</span><span class="sxs-lookup"><span data-stu-id="2546c-114">For example, let's assume you have a scenario containing an orchestration that receives one activation, uses it to initialize a correlation set, then receives a convoy of 10 additional messages that follow the correlation set.</span></span> <span data-ttu-id="2546c-115">さらに、負荷状況下で、アクティベーション メッセージと関連付けられたメッセージの両方を受信するにつれてバックログがスプールに蓄積され、その結果、受信可能なメッセージ容量に制限が適用されたとします。</span><span class="sxs-lookup"><span data-stu-id="2546c-115">In addition, assume that, under load, a backlog builds up in the spool as the mix of activation and correlation messages arrive that results in throttling the amount of messages that can be received.</span></span> <span data-ttu-id="2546c-116">あいにく、関連付けられたメッセージがアクティベーションと共に制限されるため、オーケストレーションの実行速度が低下し、さらなるバックログの増加と制限の追加を招きます。</span><span class="sxs-lookup"><span data-stu-id="2546c-116">Unfortunately, the correlation messages are throttled along with the activations, which slows down the completion of orchestrations, causing further backlog and additional throttling.</span></span> <span data-ttu-id="2546c-117">このまま続行すると、システムのスループットがゼロに近づくまで制限が適用されます。</span><span class="sxs-lookup"><span data-stu-id="2546c-117">Allowed to continue, this would result in throttling the system down to near zero throughput.</span></span>  
  
 <span data-ttu-id="2546c-118">1 つの受信場所をアクティベーション用と関連付け用の 2 つに分割し、それぞれを別のホスト内に構成することによって、アクティベーション用のデータベース サイズの制限しきい値を、関連付け用のしきい値よりも低くできます。その結果、バックログの全体量が減少し、メッセージが正常に流れるようになります。</span><span class="sxs-lookup"><span data-stu-id="2546c-118">By splitting the single receive location into two -- one for activations and one for correlations -- and configuring the locations in separate hosts, the database size throttling threshold for the activations can be kept lower than that for correlations, which will result in reduced backlog overall, and keep the messages flowing.</span></span>  
  
 <span data-ttu-id="2546c-119">そのため、たぶんこんな:「理由上げることができないすればだけデータベース サイズのしきい値 1 つの受信場所、問題を解決するのですか?」</span><span class="sxs-lookup"><span data-stu-id="2546c-119">So, you might be asking: "why can’t I just raise the database size threshold for my single receive location to fix the problem?"</span></span> <span data-ttu-id="2546c-120">解決する場合もありますが、必ずしも目的の動作が実現するとは限りません。</span><span class="sxs-lookup"><span data-stu-id="2546c-120">The answer is, you can, but it won’t always result in the desired behavior.</span></span> <span data-ttu-id="2546c-121">制限の主な役割は、システムの負荷が限界を超えないよう保護することです。</span><span class="sxs-lookup"><span data-stu-id="2546c-121">Throttling is there primarily to protect the system from becoming overloaded.</span></span> <span data-ttu-id="2546c-122">しきい値を上げすぎたり、完全にオフにした場合、システムを保護できなくなります。</span><span class="sxs-lookup"><span data-stu-id="2546c-122">If you raise the thresholds high enough, or turn them off altogether, you will eliminate this protection.</span></span>  
  
## <a name="recommendation"></a><span data-ttu-id="2546c-123">推奨</span><span class="sxs-lookup"><span data-stu-id="2546c-123">Recommendation</span></span>  
 <span data-ttu-id="2546c-124">上記のような、関連付けられたメッセージの制限が影響するシナリオでは、受信場所を個別のホストに分離し、それぞれ独自の制限を適用できるようにすることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="2546c-124">The best practice for scenarios such as the one described above that are sensitive to throttling correlation messages, is to separate the receive locations into separate hosts which can be throttled independently.</span></span>  
  
 <span data-ttu-id="2546c-125">受信場所を個別のホストに構成したら、受信場所によって使用されるホストのデータベース サイズの制限しきい値を、オーケストレーションまたは関連付けによって使用されるホストのデータベース サイズの制限しきい値よりも低く設定します。</span><span class="sxs-lookup"><span data-stu-id="2546c-125">When separate hosts are configured for receive locations, set the database size throttling threshold for the host used by the receive locations to a lower value than the database size throttling threshold for hosts used by orchestrations or correlations.</span></span>  
  
 <span data-ttu-id="2546c-126">システムの負荷が、維持可能な最大スループット (MST) を超えることがないとわかっている場合や、スループットのピークがピーク イベントの合間に回復可能であるとわかっている場合は、制限のしきい値を上げる方法も効果があります。しかし、アクティベーションと関連付けに個別のホストを使用する方法ほど、高いスループットが維持されるとは限りません。</span><span class="sxs-lookup"><span data-stu-id="2546c-126">If you know that your load will never be higher than the maximum sustainable throughput (MST) for the system, or that throughput peaks are recoverable between peak events, then raising the throttling thresholds will also work, but may not sustain as high a throughput as using separate hosts for activations and correlations.</span></span>