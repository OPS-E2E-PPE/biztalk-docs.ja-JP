---
title: "サンプル TMA: BizTalk メッセージ キュー アダプタ |Microsoft ドキュメント"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- security examples [TMA], MSMQ adapters
- architecture, examples
- MSMQ adapters, TMA
- DFD, MSMQ adapters
- MSMQ adapters, data flow
ms.assetid: 15b4a540-2fcd-4668-b4b4-757f23ebd83e
caps.latest.revision: "23"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 91f37c57c24bdd37c0f2cc0399a797050228aa54
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/20/2017
---
# <a name="sample-tma-biztalk-message-queuing-adapter"></a>サンプル TMA: BizTalk メッセージ キュー アダプタ
このトピックでは、サンプル アーキテクチャの BizTalk メッセージ キュー アダプター シナリオ向けの脅威モデル分析 (TMA) について説明します。  
  
## <a name="step-1-collect-background-information-biztalk-message-queuing-adapter-scenario"></a>手順 1. 背景情報 (BizTalk メッセージ キュー アダプタ シナリオ) の収集します。  
 このセクションでは、サンプル アーキテクチャの BizTalk メッセージ キュー アダプタ シナリオ向けのデータ フロー ダイアグラム (DFD) について説明します。 次の図は、HTTP アダプタと SOAP アダプタ シナリオのサンプル アーキテクチャを示しています。  
  
 **図 1. BizTalk メッセージ キュー アダプタ シナリオのサンプル アーキテクチャ**  
  
 ![サンプル アーキテクチャの BizTalk メッセージ キューの](../core/media/tdi-sec-refarch-msmq.gif "TDI_Sec_RefArch_MSMQ")  
  
 その他のすべての背景情報の使用シナリオ、すべて同じでありで既に説明した[サンプル シナリオの背景情報](../core/background-information-for-sample-scenarios.md)です。  
  
### <a name="data-flow-diagram"></a>データ フロー ダイアグラム  
 次の図は、BizTalk メッセージ キュー アダプタを使用する際の、サンプル アーキテクチャの DFD を示しています。  
  
 **BizTalk メッセージ キュー アダプタ シナリオのサンプル アーキテクチャの図 2 の DFD**  
  
 ![サンプル アーキテクチャの BizTalk メッセージ キューの](../core/media/tdi-sec-refarch-dfd-msmq.gif "TDI_Sec_RefArch_DFD_MSMQ")  
  
 データ フローは次のとおりです。  
  
1.  パートナーがメッセージ キューまたは BizTalk メッセージ キューを使用してメッセージを送信します。 メッセージは適切な形式に変換され、ネットワーク上に送信されます。 Active Directory を使用する場合、メッセージは適切な送信先 (BizTalk メッセージ キュー受信アダプタのホスト インスタンスが実行されている BizTalk Server) に到達するまで、一連のメッセージ キュー ルーターを介して移動します。  
  
2.  BizTalk メッセージ キュー受信アダプタのインプロセス ホストのインスタンスは、メッセージ キュー ルーターから (ファイアウォール 2 を介して) メッセージを定期的に受信し、内部処理を行います。次に、ネットワーク プロトコルによって定義された適切なネットワーク応答を送信し、メッセージ ボックス データベースにメッセージを配置します。  
  
3.  メッセージへのサブスクリプションが含まれた処理ホストのインスタンスが、メッセージ ボックス データベースからそのメッセージを取得し、追加処理を行い、メッセージ ボックス データベースにメッセージを戻します。  
  
4.  BizTalk メッセージ キュー送信アダプターは、インプロセス ホストのインスタンスは、メッセージ ボックス データベースからメッセージを取得します。 メッセージは、送信パイプラインでの最終処理を完了してから、ファイアウォール 2 を介してパートナーまたはアプリケーションにネットワーク経由で送信されます。  
  
## <a name="step-2-create-and-analyze-the-threat-model-biztalk-message-queuing-adapter-scenario"></a>手順 2. 作成し、分析、脅威モデル (BizTalk メッセージ キュー アダプタ シナリオ)  
 このセクションでは、サンプル アーキテクチャの BizTalk メッセージ キュー アダプタ シナリオに対して実行した TMA の結果を示します。  
  
-   **エントリ ポイント、信頼の境界、データ フローの - 特定**背景情報および手順 1. で前の説明を参照してください[サンプル シナリオの背景情報](../core/background-information-for-sample-scenarios.md)です。  
  
-   **特定された脅威の一覧を作成**を使用して、次の分類、DFD のすべてのエントリのシナリオに潜在的な脅威を特定する: **S**poofing を識別、 **T**データを ampering **R**、これが否認**すれば**漏洩、 **D**ービス拒否、および**E**の levation権限です。 次の表は、BizTalk メッセージ キュー アダプタを使用して BizTalk Server との間でメッセージを送受信したときに特定された脅威を示しています。  
  
 **表 1 の脅威リスト**  
  
|脅威|Description|[Asset]|影響|  
|------------|-----------------|-----------|------------|  
|受信場所に大量のメッセージが送信される|悪意のあるユーザーが、メッセージが有効であるか無効であるかに関係なくアプリケーションで受け取れないほど大量のメッセージを送信することがあります。|BizTalk Server 環境|サービス拒否が起こる|  
|有線ネットワーク上でメッセージ ヘッダーがクリア テキストで送信される|メッセージがキューから BizTalk メッセージ キュー受信アダプタに送信されるとき、メッセージ ヘッダーがクリア テキスト形式なので、悪意のあるユーザーがヘッダーを読み取って改ざんすることがあります。|メッセージ ヘッダー|データの改ざん<br /><br /> 情報の漏えい|  
|未認証のユーザーが、BizTalk メッセージ キュー ホストが実行されている BizTalk Server へのネットワーク接続を確立できる|随意アクセス制御リスト (DACL) を使用して、BizTalk メッセージ キューの受信場所へのアクセスを制限することはできません。 そのため、BizTalk メッセージ キュー受信アダプタのホスト インスタンスが実行されている BizTalk Server とポート 1801 に対してネットワーク接続を確立できるユーザーであれば、BizTalk メッセージ キューの受信場所にメッセージを送信できます。|BizTalk Server 環境|否認<br /><br /> データの改ざん<br /><br /> 情報の漏えい<br /><br /> サービス拒否が起こる<br /><br /> 特権の昇格|  
|BizTalk Server でメッセージを受信する前に、悪意のあるユーザーがそのメッセージを改ざんできる|悪意のあるユーザーが、メッセージの送信中にメッセージを傍受し、改ざんすることがあります。|メッセージ本文|データの改ざん<br /><br /> 情報の漏えい|  
  
## <a name="step-3-review-threats-biztalk-message-queuing-adapter-scenario"></a>手順 3. 脅威の確認 (BizTalk メッセージ キュー アダプター シナリオ)  
 このセクションでは、サンプル アーキテクチャの BizTalk メッセージ キュー アダプタ シナリオで特定された脅威に対して実行したリスク分析の結果を示します。 主な脅威モデルについてのミーティングは後、脅威を確認し、次の影響カテゴリ各脅威のリスクを識別するために使用します**D**amage 潜在的な、 **R**eproducibility、 **E。**xploitability、 **A**影響を受けるユーザー、および**D**iscoverability です。  
  
 次の表は、BizTalk メッセージ キュー アダプタを使用して BizTalk Server との間でメッセージを送受信したときに特定された脅威のリスクの度合いを示しています。  
  
 **特定された脅威のリスクの度合いを 2 つのテーブルにします。**  
  
|脅威|影響|潜在的な損害|再現性|悪用性|影響を受けるユーザー|検出可能性|リスクの度合い|  
|------------|------------|----------------------|---------------------|--------------------|--------------------|---------------------|-------------------|  
|受信場所に大量のメッセージが送信される|サービス拒否が起こる|8|7|7|7|5|6.8|  
|有線ネットワーク上でメッセージ ヘッダーがクリア テキストで送信される|データの改ざん<br /><br /> 情報の漏えい|8|10|8|3|5|6.8|  
|未認証のユーザーが、BizTalk メッセージ キュー ホストが実行されている BizTalk Server へのネットワーク接続を確立できる|否認<br /><br /> データの改ざん<br /><br /> 情報の漏えい<br /><br /> サービス拒否が起こる<br /><br /> 特権の昇格|8|10|9|9|9|9|  
|BizTalk Server でメッセージを受信する前に、悪意のあるユーザーがそのメッセージを改ざんできる|データの改ざん<br /><br /> 情報の漏えい|5|7|6|5|7|6|  
  
## <a name="step-4-identify-mitigation-techniques-biztalk-message-queuing-adapter-scenario"></a>手順 4. 緩和方法 (BizTalk メッセージ キュー アダプタ シナリオ) の特定します。  
 このセクションでは、サンプル アーキテクチャの BizTalk メッセージ キュー アダプタ シナリオで特定された脅威を緩和する方法について説明します。  
  
 次の表は、BizTalk メッセージ キュー アダプタを使用して BizTalk Server との間でメッセージを送受信したときに特定された脅威の緩和方法とテクノロジを示しています。  
  
 **表 3 の緩和方法とテクノロジ**  
  
|脅威|影響|リスクの度合い|緩和方法とテクノロジ|  
|------------|------------|-------------------|--------------------------------------------|  
|受信場所に大量のメッセージが送信される|サービス拒否が起こる|6.8|BizTalk メッセージ キュー アダプタを認証必須モードで使用します。 設定、**が必要です MSMQ 認証**受信場所のフラグと**認証が必要 (メッセージの削除)**受信ポートにします。<br /><br /> 証明書ベースの認証を要求するように BizTalk メッセージ キューを構成します。 この状況はアダプタ レベルで発生します。BizTalk パイプラインのパーティの解決コンポーネントとは異なります。 このように構成した場合、受信メッセージにはパブリック証明書が含まれます。 これは、BizTalk メッセージ キューに使用できる唯一のクライアント認証モードです。 このクライアント認証モードを使用するには、BizTalk メッセージ キューを Active Directory 統合モードでインストールする必要があります。 この機能を使用するときに必ず選択して、**認証が必要**受信場所のチェック ボックスを BizTalk メッセージ キューのプロパティ ダイアログ ボックスをオンします。|  
|有線ネットワーク上でメッセージ ヘッダーがクリア テキストで送信される|データの改ざん<br /><br /> 情報の漏えい|6.8|インターネット プロトコル セキュリティ (IPsec) を使用すると、あるサーバーから別のサーバーにメッセージを送信するときに、メッセージ本文とメッセージ ヘッダーを保護できます。|  
|未認証のユーザーが、BizTalk メッセージ キュー ホストが実行されている BizTalk Server へのネットワーク接続を確立できる|否認<br /><br /> データの改ざん<br /><br /> 情報の漏えい<br /><br /> サービス拒否が起こる<br /><br /> 特権の昇格|9|パーティの解決パイプライン コンポーネントを含むカスタム パイプラインを作成し、送信者 ID (SID) を使用してパーティを解決するようにパーティの解決コンポーネントを構成します。 設定、**証明書によるパーティを解決するには**プロパティを**False**、および**SID によるパーティの解決**プロパティを**True**です。 詳細については、次を参照してください。[パーティの解決パイプライン コンポーネント](../core/party-resolution-pipeline-component.md)です。<br /><br /> 受信ポートの設定、**認証**プロパティを**必要 (メッセージの削除)**です。|  
|BizTalk Server でメッセージを受信する前に、悪意のあるユーザーがそのメッセージを改ざんできる|データの改ざん<br /><br /> 情報の漏えい|6|プロトコルレベルの認証を使用して、メッセージが送信中に改ざんされないようにします。 プロトコルレベルの認証を使用するには、E ビジネス ドメインにメッセージ キュー ルーターが必要です。 BizTalk Server を次のように構成します。<br /><br /> -、 **BizTalk メッセージング**ページ Configuration Manager は、ルーターの名前を指定します。<br />-受信ポートの設定、**認証**プロパティを**必要 (メッセージの削除)**または**必要 (メッセージの保持)**です。<br />-の送信ハンドラーで、**全般**] タブの [、 **MSMQ ルーター**名前ボックスに、メッセージ キュー ルーターの名前を入力します。<br />-送信ポートの選択**MSMQ 認証を使用する**です。|  
  
## <a name="see-also"></a>参照  
 [脅威モデル分析](../core/threat-model-analysis.md)   
 [脅威モデル分析のサンプル シナリオ](../core/sample-scenarios-for-threat-model-analysis.md)   
 [小規模および中規模企業向けのサンプル アーキテクチャ](../core/sample-architectures-for-small-medium-sized-companies.md)