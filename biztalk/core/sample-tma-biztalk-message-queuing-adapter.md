---
title: サンプル TMA:BizTalk メッセージ キュー アダプタ |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- security examples [TMA], MSMQ adapters
- architecture, examples
- MSMQ adapters, TMA
- DFD, MSMQ adapters
- MSMQ adapters, data flow
ms.assetid: 15b4a540-2fcd-4668-b4b4-757f23ebd83e
caps.latest.revision: 23
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 27187bcb688ed50d6935fb7dd386cdaad6f59ede
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/07/2019
ms.locfileid: "65393879"
---
# <a name="sample-tma-biztalk-message-queuing-adapter"></a>サンプル TMA:BizTalk メッセージ キュー アダプタ
このトピックでは、サンプル アーキテクチャの BizTalk メッセージ キュー アダプター シナリオ向けの脅威モデル分析 (TMA) について説明します。  
  
## <a name="step-1-collect-background-information-biztalk-message-queuing-adapter-scenario"></a>手順 1. 背景情報 (BizTalk メッセージ キュー アダプタ シナリオ) の収集します。  
 このセクションでは、サンプル アーキテクチャの BizTalk メッセージ キュー アダプタ シナリオ向けのデータ フロー ダイアグラム (DFD) について説明します。 次の図は、HTTP アダプタと SOAP アダプタ シナリオのサンプル アーキテクチャを示しています。  
  
 **BizTalk メッセージ キュー アダプタ シナリオのサンプル アーキテクチャを図 1**  
  
 ![BizTalk メッセージ キューのアーキテクチャのサンプル](../core/media/tdi-sec-refarch-msmq.gif "TDI_Sec_RefArch_MSMQ")  
  
 その他のすべての背景情報の使用シナリオ、すべて同じで既に説明した[サンプル シナリオの背景情報](../core/background-information-for-sample-scenarios.md)します。  
  
### <a name="data-flow-diagram"></a>データ フロー ダイアグラム  
 次の図は、BizTalk メッセージ キュー アダプタを使用する際の、サンプル アーキテクチャの DFD を示しています。  
  
 **BizTalk メッセージ キュー アダプタ シナリオのサンプル アーキテクチャの図 2 の DFD**  
  
 ![BizTalk メッセージ キューのアーキテクチャのサンプル](../core/media/tdi-sec-refarch-dfd-msmq.gif "TDI_Sec_RefArch_DFD_MSMQ")  
  
 データ フローは次のとおりです。  
  
1.  パートナーがメッセージ キューまたは BizTalk メッセージ キューを使用してメッセージを送信します。 メッセージは適切な形式に変換され、ネットワーク上に送信されます。 Active Directory を使用する場合、メッセージは適切な送信先 (BizTalk メッセージ キュー受信アダプタのホスト インスタンスが実行されている BizTalk Server) に到達するまで、一連のメッセージ キュー ルーターを介して移動します。  
  
2.  BizTalk メッセージ キュー受信アダプタのインプロセス ホストのインスタンスは、メッセージ キュー ルーターから (ファイアウォール 2 を介して) メッセージを定期的に受信し、内部処理を行います。次に、ネットワーク プロトコルによって定義された適切なネットワーク応答を送信し、メッセージ ボックス データベースにメッセージを配置します。  
  
3.  メッセージへのサブスクリプションが含まれた処理ホストのインスタンスが、メッセージ ボックス データベースからそのメッセージを取得し、追加処理を行い、メッセージ ボックス データベースにメッセージを戻します。  
  
4.  メッセージ ボックス データベースからメッセージを BizTalk メッセージ キュー送信アダプターを持つ、インプロセス ホストのインスタンスを取得します。 メッセージは、送信パイプラインでの最終処理を完了してから、ファイアウォール 2 を介してパートナーまたはアプリケーションにネットワーク経由で送信されます。  
  
## <a name="step-2-create-and-analyze-the-threat-model-biztalk-message-queuing-adapter-scenario"></a>手順 2. 作成し、分析、脅威モデル (BizTalk メッセージ キュー アダプタ シナリオ)  
 このセクションでは、サンプル アーキテクチャの BizTalk メッセージ キュー アダプタ シナリオに対して実行した TMA の結果を示します。  
  
- **特定のエントリ ポイント、信頼の境界、およびデータのフロー -** および手順 1 で前に説明されている背景情報を参照してください[サンプル シナリオの背景情報](../core/background-information-for-sample-scenarios.md)します。  
  
- **-特定された脅威の一覧を作成**シナリオに潜在的な脅威を識別するために、DFD のすべてのエントリのカテゴリに分類を使いました。**S**poofing を識別、 **T**データ、ampering **R**、これが否認**は**漏洩、 **D**ービス拒否、**E**levation 特権。 次の表は、BizTalk メッセージ キュー アダプタを使用して BizTalk Server との間でメッセージを送受信したときに特定された脅威を示しています。  
  
  **特定された脅威の一覧を表 1**  
  
|脅威|説明|[Asset]|影響|  
|------------|-----------------|-----------|------------|  
|受信場所に大量のメッセージが送信される|悪意のあるユーザーが、メッセージが有効であるか無効であるかに関係なくアプリケーションで受け取れないほど大量のメッセージを送信することがあります。|BizTalk Server 環境|サービス拒否が起こる|  
|有線ネットワーク上でメッセージ ヘッダーがクリア テキストで送信される|メッセージがキューから BizTalk メッセージ キュー受信アダプタに送信されるとき、メッセージ ヘッダーがクリア テキスト形式なので、悪意のあるユーザーがヘッダーを読み取って改ざんすることがあります。|メッセージ ヘッダー|データの改ざん<br /><br /> 情報の漏えい|  
|未認証のユーザーが、BizTalk メッセージ キュー ホストが実行されている BizTalk Server へのネットワーク接続を確立できる|随意アクセス制御リスト (DACL) を使用して、BizTalk メッセージ キューの受信場所へのアクセスを制限することはできません。 そのため、BizTalk メッセージ キュー受信アダプタのホスト インスタンスが実行されている BizTalk Server とポート 1801 に対してネットワーク接続を確立できるユーザーであれば、BizTalk メッセージ キューの受信場所にメッセージを送信できます。|BizTalk Server 環境|否認<br /><br /> データの改ざん<br /><br /> 情報の漏えい<br /><br /> サービス拒否が起こる<br /><br /> 特権の昇格|  
|BizTalk Server でメッセージを受信する前に、悪意のあるユーザーがそのメッセージを改ざんできる|悪意のあるユーザーが、メッセージの送信中にメッセージを傍受し、改ざんすることがあります。|メッセージ本文|データの改ざん<br /><br /> 情報の漏えい|  
  
## <a name="step-3-review-threats-biztalk-message-queuing-adapter-scenario"></a>手順 3. (BizTalk メッセージ キュー アダプタ シナリオ) の脅威を確認します。  
 このセクションでは、サンプル アーキテクチャの BizTalk メッセージ キュー アダプタ シナリオで特定された脅威に対して実行したリスク分析の結果を示します。 主要な脅威モデルは、会議後脅威を確認し、各脅威のリスクを識別するために、次の影響カテゴリを使用します。**D**amage、潜在的な**R**可能性、 **E**xploitability、 **A**影響を受けるユーザー、および**D**iscoverability します。  
  
 次の表は、BizTalk メッセージ キュー アダプタを使用して BizTalk Server との間でメッセージを送受信したときに特定された脅威のリスクの度合いを示しています。  
  
 **表 2. 特定された脅威のリスクの度合い**  
  
|脅威|影響|潜在的な損害|再現性|悪用性|影響を受けるユーザー|検出可能性|リスクの度合い|  
|------------|------------|----------------------|---------------------|--------------------|--------------------|---------------------|-------------------|  
|受信場所に大量のメッセージが送信される|サービス拒否が起こる|8|7|7|7|5|6.8|  
|有線ネットワーク上でメッセージ ヘッダーがクリア テキストで送信される|データの改ざん<br /><br /> 情報の漏えい|8|10|8|3|5|6.8|  
|未認証のユーザーが、BizTalk メッセージ キュー ホストが実行されている BizTalk Server へのネットワーク接続を確立できる|否認<br /><br /> データの改ざん<br /><br /> 情報の漏えい<br /><br /> サービス拒否が起こる<br /><br /> 特権の昇格|8|10|9|9|9|9|  
|BizTalk Server でメッセージを受信する前に、悪意のあるユーザーがそのメッセージを改ざんできる|データの改ざん<br /><br /> 情報の漏えい|5|7|6|5|7|6|  
  
## <a name="step-4-identify-mitigation-techniques-biztalk-message-queuing-adapter-scenario"></a>手順 4. 緩和方法 (BizTalk メッセージ キュー アダプタ シナリオ) の特定します。  
 このセクションでは、サンプル アーキテクチャの BizTalk メッセージ キュー アダプタ シナリオで特定された脅威を緩和する方法について説明します。  
  
 次の表は、BizTalk メッセージ キュー アダプタを使用して BizTalk Server との間でメッセージを送受信したときに特定された脅威の緩和方法とテクノロジを示しています。  
  
 **表 3. 緩和方法とテクノロジ**  
  
|脅威|影響|リスクの度合い|緩和方法とテクノロジ|  
|------------|------------|-------------------|--------------------------------------------|  
|受信場所に大量のメッセージが送信される|サービス拒否が起こる|6.8|BizTalk メッセージ キュー アダプタを認証必須モードで使用します。 設定、 **MSMQ 認証を要求**、受信場所でフラグと**認証が必要 (メッセージの削除)** 受信ポート。<br /><br /> 証明書ベースの認証を要求するように BizTalk メッセージ キューを構成します。 この状況はアダプタ レベルで発生します。BizTalk パイプラインのパーティの解決コンポーネントとは異なります。 このように構成した場合、受信メッセージにはパブリック証明書が含まれます。 これは、BizTalk メッセージ キューに使用できる唯一のクライアント認証モードです。 このクライアント認証モードを使用するには、BizTalk メッセージ キューを Active Directory 統合モードでインストールする必要があります。 この機能を使用するときに必ず選択して、**認証が必要**受信場所のチェック ボックスを BizTalk メッセージ キューのプロパティ ダイアログ ボックスをオンします。|  
|有線ネットワーク上でメッセージ ヘッダーがクリア テキストで送信される|データの改ざん<br /><br /> 情報の漏えい|6.8|インターネット プロトコル セキュリティ (IPsec) を使用すると、あるサーバーから別のサーバーにメッセージを送信するときに、メッセージ本文とメッセージ ヘッダーを保護できます。|  
|未認証のユーザーが、BizTalk メッセージ キュー ホストが実行されている BizTalk Server へのネットワーク接続を確立できる|否認<br /><br /> データの改ざん<br /><br /> 情報の漏えい<br /><br /> サービス拒否が起こる<br /><br /> 特権の昇格|9|パーティの解決パイプライン コンポーネントを含むカスタム パイプラインを作成し、送信者 ID (SID) を使用してパーティを解決するようにパーティの解決コンポーネントを構成します。 設定、**証明書によるパーティを解決するには**プロパティを**False**、および**SID によるパーティの解決**プロパティを**True**します。 詳細については、次を参照してください。[パーティの解決パイプライン コンポーネント](../core/party-resolution-pipeline-component.md)します。<br /><br /> 受信ポートで、設定、**認証**プロパティを**必要 (メッセージの削除)** します。|  
|BizTalk Server でメッセージを受信する前に、悪意のあるユーザーがそのメッセージを改ざんできる|データの改ざん<br /><br /> 情報の漏えい|6|プロトコルレベルの認証を使用して、メッセージが送信中に改ざんされないようにします。 プロトコルレベルの認証を使用するには、E ビジネス ドメインにメッセージ キュー ルーターが必要です。 BizTalk Server を次のように構成します。<br /><br /> -で、 **BizTalk メッセージング**ページ Configuration Manager は、ルーターの名前を指定します。<br />-受信ポートの設定、**認証**プロパティを**必要 (メッセージの削除)** または**必要 (メッセージの保持)** します。<br />-については、送信ハンドラーで、**全般** タブで、 **MSMQ ルーター**名前ボックスに、メッセージ キュー ルーターの名前を入力します。<br />-送信ポートの選択**MSMQ 認証を使用**します。|  
  
## <a name="see-also"></a>参照  
 [脅威モデル分析](../core/threat-model-analysis.md)   
 [脅威モデル分析のサンプル シナリオ](../core/sample-scenarios-for-threat-model-analysis.md)   
 [中小企業向けのサンプル アーキテクチャ](../core/sample-architectures-for-small-medium-sized-companies.md)