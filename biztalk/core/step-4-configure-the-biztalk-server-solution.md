---
title: '手順 4: BizTalk Server ソリューションの構成 |Microsoft Docs'
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: d60e6a82-51af-41e5-a755-5f337492ba2f
caps.latest.revision: 4
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 4e65c3cf64045378b0f69b6980b98cdec88f175d
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/27/2018
ms.locfileid: "37013883"
---
# <a name="step-4-configure-the-biztalk-server-solution"></a><span data-ttu-id="74c76-102">手順 4: BizTalk Server ソリューションを構成します。</span><span class="sxs-lookup"><span data-stu-id="74c76-102">Step 4: Configure the BizTalk Server Solution</span></span>
<span data-ttu-id="74c76-103">前の手順では、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] アプリケーションを作成、展開して Salesforce の通知を [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] で受信し、詳細を内部設置型の SQL Server データベースに挿入できるようになりました。</span><span class="sxs-lookup"><span data-stu-id="74c76-103">In the previous step, you created and deployed a [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] application to receive Salesforce notification into [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] and insert the details into an on-premise SQL Server database.</span></span> <span data-ttu-id="74c76-104">この手順では、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 管理コンソールでアプリケーションを構成します。</span><span class="sxs-lookup"><span data-stu-id="74c76-104">In this step, we’ll configure the application in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console.</span></span> <span data-ttu-id="74c76-105">アプリケーションの構成は、主にオーケストレーションで作成した論理ポートに対応する物理ポートの作成です。</span><span class="sxs-lookup"><span data-stu-id="74c76-105">Configuring the application primarily involves creating physical ports corresponding to the logical ports we created in the orchestration.</span></span> <span data-ttu-id="74c76-106">また、物理ポートの論理ポートへのバインドも関係します。</span><span class="sxs-lookup"><span data-stu-id="74c76-106">It also involves binding the physical port to the logical ports.</span></span> <span data-ttu-id="74c76-107">以下の手順に従って [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] アプリケーションを構成します。</span><span class="sxs-lookup"><span data-stu-id="74c76-107">We’ll perform the following steps to configure the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] application:</span></span>  
  
- <span data-ttu-id="74c76-108">Salesforce から営業案件通知を受信する、要求 - 応答 WCF-BasicHttpRelay 受信場所を構成します。</span><span class="sxs-lookup"><span data-stu-id="74c76-108">Configure a request-response WCF-BasicHttpRelay receive location to receive opportunity notifications from Salesforce.</span></span>  
  
- <span data-ttu-id="74c76-109">Salesforce にクエリを送信して受信した営業案件通知に関連する商品の詳細を取得するための、要求 - 応答 WCF-WebHttp 送信ポートを構成します。</span><span class="sxs-lookup"><span data-stu-id="74c76-109">Configure a request-response WCF-WebHttp send port to send query to Salesforce for retrieving product details related to the received opportunity notification.</span></span> <span data-ttu-id="74c76-110">この送信ポートでは、Salesforce からのクエリの応答も受信します。</span><span class="sxs-lookup"><span data-stu-id="74c76-110">This send port also receives the query response from Salesforce.</span></span>  
  
- <span data-ttu-id="74c76-111">Salesforce からのクエリの応答を内部設置型の SQL Server データベースに挿入するための一方向の WCF-SQL 送信ポートを構成します。</span><span class="sxs-lookup"><span data-stu-id="74c76-111">Configure a one-way WCF-SQL send port to insert the query response from Salesforce into an on-premise SQL Server database.</span></span>  
  
- <span data-ttu-id="74c76-112">オーケストレーションの論理ポートと [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 管理コンソールで作成した物理ポートを関連付けて、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] アプリケーションを構成します。</span><span class="sxs-lookup"><span data-stu-id="74c76-112">Configure the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] application by associating the logical port in the orchestration with the physical ports created in the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console.</span></span>  
  
### <a name="to-configure-the-wcf-basichttprelay-receive-location"></a><span data-ttu-id="74c76-113">Wcf-basichttprelay 受信場所を構成するには</span><span class="sxs-lookup"><span data-stu-id="74c76-113">To configure the WCF-BasicHttpRelay receive location</span></span>  
  
1. <span data-ttu-id="74c76-114">開く、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理コンソール。</span><span class="sxs-lookup"><span data-stu-id="74c76-114">Open the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console.</span></span> <span data-ttu-id="74c76-115">[アプリケーション] ノードを展開し、検索、 **SalesforceIntegration**アプリケーション。</span><span class="sxs-lookup"><span data-stu-id="74c76-115">Expand the Applications node and look for the **SalesforceIntegration** application.</span></span> <span data-ttu-id="74c76-116">このアプリケーションは、Visual Studio から [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] プロジェクトを展開した時に作成されます。</span><span class="sxs-lookup"><span data-stu-id="74c76-116">This application is created when you deployed the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] project from Visual Studio.</span></span>  
  
2. <span data-ttu-id="74c76-117">展開、 **SalesforceIntegration**アプリケーションを右クリックして**受信ポート**、 をポイント**新規**、順にクリックします**要求-応答受信ポート**.</span><span class="sxs-lookup"><span data-stu-id="74c76-117">Expand the **SalesforceIntegration** application, right-click **Receive Ports**, point to **New**, and then click **Request-Response Receive Port**.</span></span> <span data-ttu-id="74c76-118">ポート名を指定`ReceiveOppNotification`左側のウィンドウから次のようにクリックします。**受信場所**します。</span><span class="sxs-lookup"><span data-stu-id="74c76-118">Specify the port name as `ReceiveOppNotification` and from the left-pane, click **Receive Locations**.</span></span>  
  
3. <span data-ttu-id="74c76-119">[受信場所のプロパティ] ダイアログ ボックスで、次の値を指定します。</span><span class="sxs-lookup"><span data-stu-id="74c76-119">In the Receive Location Properties dialog box, specify the following values:</span></span>  
  
   |||  
   |-|-|  
   |<span data-ttu-id="74c76-120">名前</span><span class="sxs-lookup"><span data-stu-id="74c76-120">Name</span></span>|<span data-ttu-id="74c76-121">入力`ReceiveOppNotification`します。</span><span class="sxs-lookup"><span data-stu-id="74c76-121">Enter `ReceiveOppNotification`.</span></span>|  
   |<span data-ttu-id="74c76-122">型</span><span class="sxs-lookup"><span data-stu-id="74c76-122">Type</span></span>|<span data-ttu-id="74c76-123">選択**Wcf-basichttprelay**</span><span class="sxs-lookup"><span data-stu-id="74c76-123">Select **WCF-BasicHttpRelay**</span></span>|  
   |<span data-ttu-id="74c76-124">受信ハンドラー</span><span class="sxs-lookup"><span data-stu-id="74c76-124">Receive Handler</span></span>|<span data-ttu-id="74c76-125">選択 **[biztalkserverapplication]**</span><span class="sxs-lookup"><span data-stu-id="74c76-125">Select **BizTalkServerApplication**</span></span>|  
   |<span data-ttu-id="74c76-126">[受信パイプライン]</span><span class="sxs-lookup"><span data-stu-id="74c76-126">Receive Pipeline</span></span>|<span data-ttu-id="74c76-127">選択**XMLReceive**</span><span class="sxs-lookup"><span data-stu-id="74c76-127">Select **XMLReceive**</span></span>|  
   |<span data-ttu-id="74c76-128">送信パイプライン</span><span class="sxs-lookup"><span data-stu-id="74c76-128">Send Pipeline</span></span>|<span data-ttu-id="74c76-129">選択**PassThruTransmit**</span><span class="sxs-lookup"><span data-stu-id="74c76-129">Select **PassThruTransmit**</span></span>|  
  
    <span data-ttu-id="74c76-130">クリックして**構成**に対して、ポートの種類。</span><span class="sxs-lookup"><span data-stu-id="74c76-130">Click **Configure** against the port type.</span></span>  
  
4. <span data-ttu-id="74c76-131">[WCF-BasicHttpRelay トランスポートのプロパティ] ダイアログ ボックスで、次の値を指定します。</span><span class="sxs-lookup"><span data-stu-id="74c76-131">In the WCF-BasicHttpRelay Transport Properties dialog box, specify the following values:</span></span>  
  
   1. <span data-ttu-id="74c76-132">**全般** タブの**アドレス (URI)**、入力`https://btssalesforce.servicebus.windows.net/notifications/opportunity`します。</span><span class="sxs-lookup"><span data-stu-id="74c76-132">On the **General** tab, for **Address (URI)**, enter `https://btssalesforce.servicebus.windows.net/notifications/opportunity`.</span></span> <span data-ttu-id="74c76-133">ここでは、 **btssalesforce**で作成した名前空間は、[手順 1: Service Bus の Namespace を作成する](../core/step-1-create-a-service-bus-namespace.md)します。</span><span class="sxs-lookup"><span data-stu-id="74c76-133">Here, **btssalesforce** is namespace you created in [Step 1: Create a Service Bus Namespace](../core/step-1-create-a-service-bus-namespace.md).</span></span> <span data-ttu-id="74c76-134">Salesforce でのワークフローの作成時に指定した同じ URL をここでは、指定した URL[手順 2: Salesforce システムを設定する](../core/step-2-set-up-the-salesforce-system.md)します。</span><span class="sxs-lookup"><span data-stu-id="74c76-134">The URL you specify here is the same URL you specified while creating a workflow in Salesforce in [Step 2: Set up the Salesforce System](../core/step-2-set-up-the-salesforce-system.md).</span></span> <span data-ttu-id="74c76-135">営業案件のステージが Closed Won に設定するたびに Salesforce を送信する通知を URL にワークフローを設定する *<https://btssalesforce.servicebus.windows.net/notifications/opportunity>* します。</span><span class="sxs-lookup"><span data-stu-id="74c76-135">You set up a workflow in which every time the stage of an opportunity is set to Closed Won, Salesforce sends a notification to the URL *<https://btssalesforce.servicebus.windows.net/notifications/opportunity>*.</span></span> <span data-ttu-id="74c76-136">ここでは、受信場所の構成の一部として同じ URL を指定します。</span><span class="sxs-lookup"><span data-stu-id="74c76-136">We specify the same URL here as part of this receive location configuration.</span></span> <span data-ttu-id="74c76-137">受信場所が有効になると、URL で指定されたリレー エンドポイントが [!INCLUDE[winazure](../includes/winazure-md.md)] に作成されます。</span><span class="sxs-lookup"><span data-stu-id="74c76-137">When the receive location is enabled, the relay endpoint specified by the URL is created in [!INCLUDE[winazure](../includes/winazure-md.md)].</span></span>  
  
   2. <span data-ttu-id="74c76-138">**セキュリティ** タブで、次を指定します。</span><span class="sxs-lookup"><span data-stu-id="74c76-138">On the **Security** tab, specify the following:</span></span>  
  
      -   <span data-ttu-id="74c76-139">**セキュリティ モード**を選択します**トランスポート**および**クライアント認証の種類をリレー**を選択します**None**します。</span><span class="sxs-lookup"><span data-stu-id="74c76-139">For **Security mode**, select **Transport** and for **Relay client authentication type**, select **None**.</span></span>  
  
      -   <span data-ttu-id="74c76-140">選択、**サービスの検出を有効にする**でサービスの動作を公開する チェック ボックス、[サービス レジストリ](http://msdn.microsoft.com/library/windowsazure/dd582704.aspx)します。</span><span class="sxs-lookup"><span data-stu-id="74c76-140">Select the **Enable service discovery** check box to publish the service behavior in the [Service Registry](http://msdn.microsoft.com/library/windowsazure/dd582704.aspx).</span></span> <span data-ttu-id="74c76-141">指定、**表示名**をレジストリにサービスを発行するの名前を示します。</span><span class="sxs-lookup"><span data-stu-id="74c76-141">Specify the **Display name** which denotes the name with which the service is published to the registry.</span></span> <span data-ttu-id="74c76-142">設定することができます、**検出モード**パブリックまたはプライベートにします。</span><span class="sxs-lookup"><span data-stu-id="74c76-142">You can set the **Discovery mode** to public or private.</span></span> <span data-ttu-id="74c76-143">このチュートリアルでは、次のように設定します。**表示名**に`SF Outbound Notification`と**検出モード**に**パブリック**します。</span><span class="sxs-lookup"><span data-stu-id="74c76-143">For this tutorial, set **Display name** to `SF Outbound Notification` and **Discovery mode** to **Public**.</span></span>  
  
      -   <span data-ttu-id="74c76-144">アクセス制御サービス ボックスで、をクリックして**編集**します。</span><span class="sxs-lookup"><span data-stu-id="74c76-144">Under Access control service box, click **Edit**.</span></span> <span data-ttu-id="74c76-145">**アクセス制御サービス STS Uri**、入力`https://btssalesforce-sb.accesscontrol.windows.net/`します。</span><span class="sxs-lookup"><span data-stu-id="74c76-145">For **Access Control Service STS Uri**, enter `https://btssalesforce-sb.accesscontrol.windows.net/`.</span></span> <span data-ttu-id="74c76-146">**発行者名**と**発行者キー**で保存した値を入力して[手順 1: Service Bus の Namespace を作成](../core/step-1-create-a-service-bus-namespace.md)の**既定のユーザー**と**既定のキー**フィールド。</span><span class="sxs-lookup"><span data-stu-id="74c76-146">For **Issuer Name** and **Issuer Key**, enter the values that you saved in [Step 1: Create a Service Bus Namespace](../core/step-1-create-a-service-bus-namespace.md) for **Default User** and **Default Key** fields.</span></span>  
  
   3. <span data-ttu-id="74c76-147">クリックして**OK**すべての開いているダイアログ ボックスを終了するまでです。</span><span class="sxs-lookup"><span data-stu-id="74c76-147">Click **OK** until you exit all open dialog boxes.</span></span>  
  
### <a name="to-configure-the-wcf-webhttp-send-port"></a><span data-ttu-id="74c76-148">Wcf-webhttp 送信ポートを構成するには</span><span class="sxs-lookup"><span data-stu-id="74c76-148">To configure the WCF-WebHttp send port</span></span>  
  
1. <span data-ttu-id="74c76-149">展開、 **SalesforceIntegration**アプリケーションを右クリックして**送信ポート**、 をポイント**新規**、順にクリックします**静的な送信請求-応答送信ポート**.</span><span class="sxs-lookup"><span data-stu-id="74c76-149">Expand the **SalesforceIntegration** application, right-click **Send Ports**, point to **New**, and then click **Static Solicit-Response Send Port**.</span></span>  
  
2. <span data-ttu-id="74c76-150">[送信ポートのプロパティ] ダイアログ ボックスで、次の値を指定します。</span><span class="sxs-lookup"><span data-stu-id="74c76-150">In the Send Port Properties dialog box, specify the following values:</span></span>  
  
   |||  
   |-|-|  
   |<span data-ttu-id="74c76-151">名前</span><span class="sxs-lookup"><span data-stu-id="74c76-151">Name</span></span>|<span data-ttu-id="74c76-152">入力`SalesforceREST`します。</span><span class="sxs-lookup"><span data-stu-id="74c76-152">Enter `SalesforceREST`.</span></span>|  
   |<span data-ttu-id="74c76-153">型</span><span class="sxs-lookup"><span data-stu-id="74c76-153">Type</span></span>|<span data-ttu-id="74c76-154">選択**Wcf-webhttp**</span><span class="sxs-lookup"><span data-stu-id="74c76-154">Select **WCF-WebHttp**</span></span>|  
   |<span data-ttu-id="74c76-155">[送信ハンドラー]</span><span class="sxs-lookup"><span data-stu-id="74c76-155">Send Handler</span></span>|<span data-ttu-id="74c76-156">選択 **[biztalkserverapplication]**</span><span class="sxs-lookup"><span data-stu-id="74c76-156">Select **BizTalkServerApplication**</span></span>|  
   |<span data-ttu-id="74c76-157">送信パイプライン</span><span class="sxs-lookup"><span data-stu-id="74c76-157">Send Pipeline</span></span>|<span data-ttu-id="74c76-158">選択**PassThruTransmit**</span><span class="sxs-lookup"><span data-stu-id="74c76-158">Select **PassThruTransmit**</span></span>|  
   |<span data-ttu-id="74c76-159">[受信パイプライン]</span><span class="sxs-lookup"><span data-stu-id="74c76-159">Receive Pipeline</span></span>|<span data-ttu-id="74c76-160">選択**AddNamespace**パイプラインを構成するパイプラインに対して省略記号ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="74c76-160">Select **AddNamespace** and click the ellipsis button against the pipeline to configure the pipeline.</span></span><br /><br /> <span data-ttu-id="74c76-161">-**段階 1: デコード**の**NamespaceBase**、入力`http://BtsSalesforceIntegration.QueryResult`します。</span><span class="sxs-lookup"><span data-stu-id="74c76-161">-   Under **Stage 1: Decode**, for **NamespaceBase**, enter `http://BtsSalesforceIntegration.QueryResult`.</span></span> <span data-ttu-id="74c76-162">これで作成した QueryResult.xsd スキーマの名前空間は、[手順 3 b: Wcf-webhttp アダプターを使用して Salesforce から営業案件の詳細を取得](../core/step-3b-retrieve-opportunities-from-salesforce-using-the-wcf-webhttp-adapter.md)します。</span><span class="sxs-lookup"><span data-stu-id="74c76-162">This is the namespace of the QueryResult.xsd schema that you created in [Step 3b: Retrieve Opportunity Details from Salesforce using the WCF-WebHttp Adapter](../core/step-3b-retrieve-opportunities-from-salesforce-using-the-wcf-webhttp-adapter.md).</span></span> <span data-ttu-id="74c76-163">ときに、 **AddNamespace**受信パイプラインは、Salesforce から応答を受信、応答メッセージにこの名前空間を追加します。</span><span class="sxs-lookup"><span data-stu-id="74c76-163">When the **AddNamespace** receive pipeline receives the response from Salesforce, it adds this namespace to the response message.</span></span> <span data-ttu-id="74c76-164">既定では、Salesforce からの応答メッセージには名前空間は含まれません。</span><span class="sxs-lookup"><span data-stu-id="74c76-164">By default, the response message from Salesforce does not include any namespace.</span></span><br />     <span data-ttu-id="74c76-165">**NamespacePrefix**、入力`sf`します。</span><span class="sxs-lookup"><span data-stu-id="74c76-165">For **NamespacePrefix**, enter `sf`.</span></span><br /><span data-ttu-id="74c76-166">-**ステージ 2: 逆アセンブル**既定値をそのまま使用し、クリックして**OK**。</span><span class="sxs-lookup"><span data-stu-id="74c76-166">-   Under **Stage 2: Disassemble**, accept the default values and then click **OK**.</span></span>|  
  
    <span data-ttu-id="74c76-167">[送信ポートのプロパティ] ダイアログ ボックスで、次のようにクリックします。**構成**に対して、ポートの種類。</span><span class="sxs-lookup"><span data-stu-id="74c76-167">On the Send Port Properties dialog box, click **Configure** against the port type.</span></span>  
  
3. <span data-ttu-id="74c76-168">[WCF-WebHttp トランスポートのプロパティ] ダイアログ ボックスで、次の値を指定します。</span><span class="sxs-lookup"><span data-stu-id="74c76-168">In the WCF-WebHttp Transport Properties dialog box, specify the following values:</span></span>  
  
   1. <span data-ttu-id="74c76-169">**[全般]** タブで、次の操作を行います。</span><span class="sxs-lookup"><span data-stu-id="74c76-169">On the **General** tab, do the following:</span></span>  
  
      - <span data-ttu-id="74c76-170">**アドレス (URI)**、入力`https://<Salesforce_instance_name>.salesforce.com/services/data/v24.0`します。</span><span class="sxs-lookup"><span data-stu-id="74c76-170">for **Address (URI)**, enter `https://<Salesforce_instance_name>.salesforce.com/services/data/v24.0`.</span></span> <span data-ttu-id="74c76-171">Salesforce のインスタンス名は、Salesforce.com ポータルを開いている場所のアドレス バーの https:// と Salesforce.com の間のテキストをコピーして取得できます。</span><span class="sxs-lookup"><span data-stu-id="74c76-171">You can retrieve the Salesforce instance name by copying the text between https:// and Salesforce.com in the address bar where you have the Salesforce.com portal open.</span></span> <span data-ttu-id="74c76-172">たとえば、Salesforce ポータルの URL が*https://*<em>na15</em>*.salesforce.com/home/home.jsp*、Salesforce のインスタンス名は**na15**.</span><span class="sxs-lookup"><span data-stu-id="74c76-172">For example, if the URL in the Salesforce portal is *https://*<em>na15</em>*.salesforce.com/home/home.jsp*, the Salesforce instance name is **na15**.</span></span>  
  
      - <span data-ttu-id="74c76-173">**HTTP メソッドと URL マッピング**ボックスで、次を指定します。</span><span class="sxs-lookup"><span data-stu-id="74c76-173">Under **HTTP Method and URL Mapping** box, specify the following:</span></span>  
  
        ```  
        <BtsHttpUrlMapping>  
        <Operation Method="GET" Url="/query?q={VAR}" />  
        </BtsHttpUrlMapping>  
        ```  
  
         <span data-ttu-id="74c76-174">この設定を使用する方法を次に示します: 営業案件通知の詳細を取得するために、Salesforce に照会する、Salesforce REST エンドポイントに対して GET 操作を実行する必要があります (で指定されている、**アドレス**フィールド) を追加し、営業案件の詳細を取得するクエリ。</span><span class="sxs-lookup"><span data-stu-id="74c76-174">Here’s how this setting is used— To query Salesforce for retrieving more information about the opportunity notification, we must perform a GET operation on the Salesforce REST endpoint (specified in the **Address** field) and append the query to retrieve the opportunity details.</span></span> <span data-ttu-id="74c76-175">つまり、URL は次のようになります。</span><span class="sxs-lookup"><span data-stu-id="74c76-175">So, the URL should look like:</span></span>  
  
        ```  
        https://na15.salesforce.com/services/data/v24.0/query?q=<query_string>  
        ```  
  
         <span data-ttu-id="74c76-176">一部として、Salesforce REST エンドポイントが既にあること、**アドレス (URI)** フィールド。</span><span class="sxs-lookup"><span data-stu-id="74c76-176">We already have the Salesforce REST endpoint as part of the **Address (URI)** field.</span></span> <span data-ttu-id="74c76-177">そのための一部として**HTTP メソッドと URL マッピング**して GET メソッドを追加することに指定します、プロパティ、 **{VAR}** 変数として。</span><span class="sxs-lookup"><span data-stu-id="74c76-177">So, as part of **HTTP Method and URL Mapping** property, we specify using the GET method and appending the **{VAR}** as a variable.</span></span>  
  
      - <span data-ttu-id="74c76-178">**変数マッピング**ボックスで、**編集**します。</span><span class="sxs-lookup"><span data-stu-id="74c76-178">In the **Variable Mapping** box, click **Edit**.</span></span> <span data-ttu-id="74c76-179">このボックスで指定する方法の値、 **{VAR}** 変数は、実行時に推測されます。</span><span class="sxs-lookup"><span data-stu-id="74c76-179">In this box you specify how the value for the **{VAR}** variable is deduced at runtime.</span></span>  
  
         <span data-ttu-id="74c76-180">[手順 3 b: Wcf-webhttp アダプターを使用して Salesforce から営業案件の詳細を取得](../core/step-3b-retrieve-opportunities-from-salesforce-using-the-wcf-webhttp-adapter.md)、結果としてクエリのプロパティを昇格したこと、 **PropertySchema.xsd**します。</span><span class="sxs-lookup"><span data-stu-id="74c76-180">In [Step 3b: Retrieve Opportunity Details from Salesforce using the WCF-WebHttp Adapter](../core/step-3b-retrieve-opportunities-from-salesforce-using-the-wcf-webhttp-adapter.md), we had promoted the Query property, which resulted in creating a **PropertySchema.xsd**.</span></span> <span data-ttu-id="74c76-181">使用して、**クエリ**URL の {VAR} 変数にその要素をマップすることによって、クエリ文字列を渡すには、そのスキーマ内の要素。</span><span class="sxs-lookup"><span data-stu-id="74c76-181">We’ll use the **Query** element in that schema to pass the query string by mapping that element to the {VAR} variable in the URL.</span></span>  
  
         <span data-ttu-id="74c76-182">変数のマッピング ダイアログ ボックスで、**変数**列は、前に指定した、たとえば、変数の名前を一覧表示**VAR**します。</span><span class="sxs-lookup"><span data-stu-id="74c76-182">In the Variable Mapping dialog box, the **Variable** column lists the name of the variable you specified earlier, for example, **VAR**.</span></span> <span data-ttu-id="74c76-183">**プロパティ名**列、変数に渡されるクエリ文字列のある、昇格させたプロパティの名前を指定します。</span><span class="sxs-lookup"><span data-stu-id="74c76-183">In the **Property Name** column, specify the name of the promoted property that has the query string to be passed to the variable.</span></span> <span data-ttu-id="74c76-184">このチュートリアルではそのプロパティ名は**クエリ**します。</span><span class="sxs-lookup"><span data-stu-id="74c76-184">In this tutorial, that property name is **Query**.</span></span> <span data-ttu-id="74c76-185">最後に、**プロパティ Namespace**、名前空間を指定、 **PropertySchema.xsd**、これは`https://BtsSalesforceIntegration.PropertySchema`します。</span><span class="sxs-lookup"><span data-stu-id="74c76-185">Finally, for **Property Namespace**, specify the namespace for the **PropertySchema.xsd**, which is `https://BtsSalesforceIntegration.PropertySchema`.</span></span> <span data-ttu-id="74c76-186">**[OK]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="74c76-186">Click **OK**.</span></span>  
  
         <span data-ttu-id="74c76-187">![WCF の [全般] タブ&#45;WebHttp アダプター](../core/media/bts-sf-webhttp-general.jpg "BTS_SF_WebHttp_General")</span><span class="sxs-lookup"><span data-stu-id="74c76-187">![General tab of WCF&#45;WebHttp Adapter](../core/media/bts-sf-webhttp-general.jpg "BTS_SF_WebHttp_General")</span></span>  
  
   2. <span data-ttu-id="74c76-188">**セキュリティ** タブの**セキュリティ モード**を選択します**トランスポート**します。</span><span class="sxs-lookup"><span data-stu-id="74c76-188">On the **Security** tab, for **Security mode**, select **Transport**.</span></span>  
  
   3. <span data-ttu-id="74c76-189">**動作** タブで作成したカスタム動作を使用して[手順 3 d: を有効にする BizTalk Server 送信し、Salesforce からメッセージを受信する](../core/step-3d-enabling-biztalk-server-to-send-and-receive-messages-from-salesforce.md)Salesforce で認証します。</span><span class="sxs-lookup"><span data-stu-id="74c76-189">On the **Behavior** tab, use the custom behavior that you created in [Step 3d: Enabling BizTalk Server to Send and Receive Messages from Salesforce](../core/step-3d-enabling-biztalk-server-to-send-and-receive-messages-from-salesforce.md) to authenticate with Salesforce.</span></span> <span data-ttu-id="74c76-190">この動作を使用するには、次の操作を行います。</span><span class="sxs-lookup"><span data-stu-id="74c76-190">To use the behavior, do the following:</span></span>  
  
      -   <span data-ttu-id="74c76-191">右クリック **[endpointbehavior]** 選び**拡張機能の追加**します。</span><span class="sxs-lookup"><span data-stu-id="74c76-191">Right-click **EndpointBehavior** and then select **Add extension**.</span></span>  
  
      -   <span data-ttu-id="74c76-192">**動作拡張機能の選択**ダイアログ ボックスで、 **Microsoft.BizTalk.Adapter.Behaviors.Demo.Salesforce**します。</span><span class="sxs-lookup"><span data-stu-id="74c76-192">In the **Select Behavior Extension** dialog box, select **Microsoft.BizTalk.Adapter.Behaviors.Demo.Salesforce**.</span></span> <span data-ttu-id="74c76-193">この動作名は、machine.config に動作を追加する際に使用しました。</span><span class="sxs-lookup"><span data-stu-id="74c76-193">We had used this behavior name while adding the behavior to the machine.config.</span></span>  
  
      -   <span data-ttu-id="74c76-194">新しく追加した動作を選択して、次の値を指定します。</span><span class="sxs-lookup"><span data-stu-id="74c76-194">Select the newly added behavior and then specify the following values:</span></span>  
  
          |||  
          |-|-|  
          |<span data-ttu-id="74c76-195">consumerKey (必須)</span><span class="sxs-lookup"><span data-stu-id="74c76-195">consumerKey (Required)</span></span>|<span data-ttu-id="74c76-196">Salesforce アカウントのコンシューマー キーを指定します。</span><span class="sxs-lookup"><span data-stu-id="74c76-196">Specify the consumer key for your Salesforce account.</span></span> <span data-ttu-id="74c76-197">コンシューマー キーを取得するで作成した、Salesforce の接続型アプリケーションに移動して[手順 2: Salesforce システムを設定する](../core/step-2-set-up-the-salesforce-system.md)します。</span><span class="sxs-lookup"><span data-stu-id="74c76-197">You can retrieve the consumer key by going to the Salesforce connected application you created in [Step 2: Set up the Salesforce System](../core/step-2-set-up-the-salesforce-system.md).</span></span>|  
          |<span data-ttu-id="74c76-198">consumerSecret (必須)</span><span class="sxs-lookup"><span data-stu-id="74c76-198">consumerSecret (Required)</span></span>|<span data-ttu-id="74c76-199">Salesforce からシークレットのコンシューマーにで作成したアプリケーションが接続されている取得[手順 2: Salesforce システムを設定する](../core/step-2-set-up-the-salesforce-system.md)します。</span><span class="sxs-lookup"><span data-stu-id="74c76-199">Retrieve the consumer secret from the Salesforce connected application you created in [Step 2: Set up the Salesforce System](../core/step-2-set-up-the-salesforce-system.md).</span></span>|  
          |<span data-ttu-id="74c76-200">パスワード (必須)</span><span class="sxs-lookup"><span data-stu-id="74c76-200">Password (Required)</span></span>|<span data-ttu-id="74c76-201">Salesforce アカウントのパスワードを指定します。</span><span class="sxs-lookup"><span data-stu-id="74c76-201">Specify the password for the Salesforce account.</span></span> <span data-ttu-id="74c76-202">サード パーティのアプリケーションから Salesforce に接続するには、パスワードの後にセキュリティ トークンが続く形式のパスワードを指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="74c76-202">To connect to Salesforce from a third party application, you must specify the password in the format password followed by the security token.</span></span> <span data-ttu-id="74c76-203">たとえば、パスワードが**パスワード**トークンと**XXXXXX**、入力する必要があります`passwordXXXXXX`します。</span><span class="sxs-lookup"><span data-stu-id="74c76-203">For example, if the password is **password** and the token is **XXXXXX**, you must enter `passwordXXXXXX`.</span></span>|  
          |<span data-ttu-id="74c76-204">sessionTimeout</span><span class="sxs-lookup"><span data-stu-id="74c76-204">sessionTimeout</span></span>|<span data-ttu-id="74c76-205">既定の値は「300」になっています。</span><span class="sxs-lookup"><span data-stu-id="74c76-205">This has a default value of 300.</span></span>|  
          |<span data-ttu-id="74c76-206">Username (必須)</span><span class="sxs-lookup"><span data-stu-id="74c76-206">Username (Required)</span></span>|<span data-ttu-id="74c76-207">Salesforce デベロッパーのログイン アカウントを指定します。</span><span class="sxs-lookup"><span data-stu-id="74c76-207">Specify the Salesforce developer login account.</span></span>|  
  
           <span data-ttu-id="74c76-208">![WCF の動作 タブ&#45;WebHttp アダプター](../core/media/bts-sf-webhttp-behavior.jpg "BTS_SF_WebHttp_Behavior")</span><span class="sxs-lookup"><span data-stu-id="74c76-208">![Behavior tab for WCF&#45;WebHttp adapter](../core/media/bts-sf-webhttp-behavior.jpg "BTS_SF_WebHttp_Behavior")</span></span>  
  
   4. <span data-ttu-id="74c76-209">**メッセージ**] タブの [**送信メッセージ**ボックスの**動詞の本文を抑制**、入力`GET`します。</span><span class="sxs-lookup"><span data-stu-id="74c76-209">On the **Messages** tab, under **Outbound Message** box, for **Suppress Body for Verbs**, enter `GET`.</span></span> <span data-ttu-id="74c76-210">こうすることで、GET メソッドで Salesforce に送信されるリクエストにメッセージ ペイロードがないことを確認できます。</span><span class="sxs-lookup"><span data-stu-id="74c76-210">This ensures for the GET method, there is no message payload in the request being sent to Salesforce.</span></span>  
  
   5. <span data-ttu-id="74c76-211">クリックして**OK**すべての開いているダイアログ ボックスを終了するまでです。</span><span class="sxs-lookup"><span data-stu-id="74c76-211">Click **OK** until you exit all open dialog boxes.</span></span>  
  
### <a name="to-configure-the-wcf-sql-send-port"></a><span data-ttu-id="74c76-212">WCF-SQL 送信ポートを構成するには</span><span class="sxs-lookup"><span data-stu-id="74c76-212">To configure the WCF-SQL send port</span></span>  
  
1.  <span data-ttu-id="74c76-213">展開、 **SalesforceIntegration**アプリケーションを右クリックして**送信ポート**、 をポイント**新規**、順にクリックします**静的の一方向送信ポート**.</span><span class="sxs-lookup"><span data-stu-id="74c76-213">Expand the **SalesforceIntegration** application, right-click **Send Ports**, point to **New**, and then click **Static One-way Send Port**.</span></span>  
  
2.  <span data-ttu-id="74c76-214">[送信ポートのプロパティ] ダイアログ ボックスで、次の値を指定します。</span><span class="sxs-lookup"><span data-stu-id="74c76-214">In the Send Port Properties dialog box, specify the following values:</span></span>  
  
    |||  
    |-|-|  
    |<span data-ttu-id="74c76-215">名前</span><span class="sxs-lookup"><span data-stu-id="74c76-215">Name</span></span>|<span data-ttu-id="74c76-216">入力`SendToSQL`します。</span><span class="sxs-lookup"><span data-stu-id="74c76-216">Enter `SendToSQL`.</span></span>|  
    |<span data-ttu-id="74c76-217">型</span><span class="sxs-lookup"><span data-stu-id="74c76-217">Type</span></span>|<span data-ttu-id="74c76-218">選択**WCF-SQL**</span><span class="sxs-lookup"><span data-stu-id="74c76-218">Select **WCF-SQL**</span></span>|  
    |<span data-ttu-id="74c76-219">[送信ハンドラー]</span><span class="sxs-lookup"><span data-stu-id="74c76-219">Send Handler</span></span>|<span data-ttu-id="74c76-220">選択 **[biztalkserverapplication]**</span><span class="sxs-lookup"><span data-stu-id="74c76-220">Select **BizTalkServerApplication**</span></span>|  
    |<span data-ttu-id="74c76-221">送信パイプライン</span><span class="sxs-lookup"><span data-stu-id="74c76-221">Send Pipeline</span></span>|<span data-ttu-id="74c76-222">選択**XMLTransmit**</span><span class="sxs-lookup"><span data-stu-id="74c76-222">Select **XMLTransmit**</span></span>|  
  
     <span data-ttu-id="74c76-223">[送信ポートのプロパティ] ダイアログ ボックスで、次のようにクリックします。**構成**に対して、ポートの種類。</span><span class="sxs-lookup"><span data-stu-id="74c76-223">On the Send Port Properties dialog box, click **Configure** against the port type.</span></span>  
  
3.  <span data-ttu-id="74c76-224">[WCF-SQL トランスポートのプロパティ ] ダイアログ ボックスで、次の値を指定します。</span><span class="sxs-lookup"><span data-stu-id="74c76-224">In the WCF-SQL Transport Properties dialog box, specify the following values:</span></span>  
  
    1.  <span data-ttu-id="74c76-225">**[全般]** タブで、次の操作を行います。</span><span class="sxs-lookup"><span data-stu-id="74c76-225">On the **General** tab, do the following:</span></span>  
  
        -   <span data-ttu-id="74c76-226">[ `Endpoint Address`、] をクリックして**構成**します。</span><span class="sxs-lookup"><span data-stu-id="74c76-226">Under `Endpoint Address`, click **Configure**.</span></span> <span data-ttu-id="74c76-227">**InitialCatalog**プロパティ、Salesforce 応答からデータを入力する必要がありますテーブルを含むデータベース名を指定します。</span><span class="sxs-lookup"><span data-stu-id="74c76-227">For the **InitialCatalog** property, specify the database name that contains the table where the data from Salesforce response must be entered.</span></span> <span data-ttu-id="74c76-228">このチュートリアルとしては、この値を入力します。`Orders`します。</span><span class="sxs-lookup"><span data-stu-id="74c76-228">For this tutorial enter this value as `Orders`.</span></span> <span data-ttu-id="74c76-229">**Server**プロパティ、SQL Server データベースがインストールされているサーバー名を入力します。</span><span class="sxs-lookup"><span data-stu-id="74c76-229">For **Server** property, enter the server name where SQL Server database is installed.</span></span>  
  
        -   <span data-ttu-id="74c76-230">**SOAP アクション ヘッダー**に挿入するために使用するアクションの指定、 **OrderDetails**テーブル。</span><span class="sxs-lookup"><span data-stu-id="74c76-230">Under **SOAP Action header**, specify the action to be used for inserting into the **OrderDetails** table.</span></span> <span data-ttu-id="74c76-231">入力する必要があります`TableOp/Insert/dbo/OrderDetails`します。</span><span class="sxs-lookup"><span data-stu-id="74c76-231">You must enter `TableOp/Insert/dbo/OrderDetails`.</span></span>  
  
    2.  <span data-ttu-id="74c76-232">[資格情報] タブで、内容をすべて空白のままにすると、アダプターは Windows 認証を使用して SQL Server データベースに接続します。</span><span class="sxs-lookup"><span data-stu-id="74c76-232">On the Credentials tab, if you leave everything blank the adapter uses Windows Authentication to connect to the SQL Server database.</span></span> <span data-ttu-id="74c76-233">他の認証形式を使用したい場合は、関連する値を指定することもできます。</span><span class="sxs-lookup"><span data-stu-id="74c76-233">If you want to use any other form of authentication, you can specify the relevant values.</span></span>  
  
    3.  <span data-ttu-id="74c76-234">クリックして**OK**すべての開いているダイアログ ボックスを終了するまでです。</span><span class="sxs-lookup"><span data-stu-id="74c76-234">Click **OK** until you exit all open dialog boxes.</span></span>  
  
### <a name="to-configure-the-biztalk-server-application"></a><span data-ttu-id="74c76-235">BizTalk Server アプリケーションを構成するには</span><span class="sxs-lookup"><span data-stu-id="74c76-235">To configure the BizTalk Server application</span></span>  
  
1. <span data-ttu-id="74c76-236">[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理コンソールで、右クリックし、 **SalesforceIntegration**アプリケーション、およびクリック**構成**します。</span><span class="sxs-lookup"><span data-stu-id="74c76-236">In the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console, right-click the **SalesforceIntegration** application, and then click **Configure**.</span></span>  
  
2. <span data-ttu-id="74c76-237">アプリケーションの構成 ダイアログ ボックスで、選択、 **NotificationServiceClient**オーケストレーション、右側のウィンドウから、次の操作を行います。</span><span class="sxs-lookup"><span data-stu-id="74c76-237">In the Configure Application dialog box, select the **NotificationServiceClient** orchestration, and from the right pane do the following:</span></span>  
  
   1. <span data-ttu-id="74c76-238">ホストで、次のように選択します。 **BizTalkServerApplication**します。</span><span class="sxs-lookup"><span data-stu-id="74c76-238">For Host, select **BizTalkServerApplication**.</span></span>  
  
   2. <span data-ttu-id="74c76-239">マップの論理受信ポート**SalesforceNotificationPort**を物理受信ポート、 **ReceiveOppNotification**します。</span><span class="sxs-lookup"><span data-stu-id="74c76-239">Map the logical receive port **SalesforceNotificationPort** to the physical receive port, **ReceiveOppNotification**.</span></span>  
  
   3. <span data-ttu-id="74c76-240">論理送信ポートのマップ**SalesforceRESTInterface**を物理送信ポート、 **SalesforceREST**します。</span><span class="sxs-lookup"><span data-stu-id="74c76-240">Map the logical send port **SalesforceRESTInterface** to the physical send port, **SalesforceREST**.</span></span>  
  
   4. <span data-ttu-id="74c76-241">論理送信ポートのマップ**SendToSQL**を物理送信ポート、 **SendToSQL**します。</span><span class="sxs-lookup"><span data-stu-id="74c76-241">Map the logical send port **SendToSQL** to the physical send port, **SendToSQL**.</span></span>  
  
      <span data-ttu-id="74c76-242">**[OK]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="74c76-242">Click **OK**.</span></span>  
  
3. <span data-ttu-id="74c76-243">右クリックし、 **SalesforceIntegration**アプリケーションとクリック**開始**します。</span><span class="sxs-lookup"><span data-stu-id="74c76-243">Right-click the **SalesforceIntegration** application and then click **Start**.</span></span> <span data-ttu-id="74c76-244">起動、 **NotificationServiceClient**オーケストレーション、受信場所を有効にし、送信ポートを開始します。</span><span class="sxs-lookup"><span data-stu-id="74c76-244">This starts the **NotificationServiceClient** orchestration, enables the receive location, and starts the send port.</span></span>  
  
   <span data-ttu-id="74c76-245">このトピックでは、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 管理コンソールでオーケストレーションの論理ポートを物理ポートと関連付けて、ソリューションの構成を完了しました。</span><span class="sxs-lookup"><span data-stu-id="74c76-245">In this topic, we finished configuring the solution in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console by associating the logical ports in the orchestration with the physical ports.</span></span>