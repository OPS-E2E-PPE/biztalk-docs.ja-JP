---
title: オーケストレーション |Microsoft ドキュメント
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- orchestrations
- correlations, orchestrations
- orchestrations, correlations
- orchestrations, deploying
- deploying, orchestrations
- orchestrations, about orchestrations
ms.assetid: fb01f78a-b805-46be-a7d9-2b7597daab96
caps.latest.revision: 8
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 73fb7a4af3a8ef7da8e9da97047006470eb8cc18
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/20/2017
ms.locfileid: "22266674"
---
# <a name="orchestrations"></a><span data-ttu-id="2b89c-102">オーケストレーション</span><span class="sxs-lookup"><span data-stu-id="2b89c-102">Orchestrations</span></span>
<span data-ttu-id="2b89c-103">*オーケストレーション*実行可能なビジネス プロセス (受信) にサブスクライブできるは、メッセージ ボックス データベースを介して (送信) メッセージを公開するとします。</span><span class="sxs-lookup"><span data-stu-id="2b89c-103">*Orchestrations* are executable business processes that can subscribe to (receive) and publish (send) messages through the MessageBox database.</span></span> <span data-ttu-id="2b89c-104">また、オーケストレーションは新しいメッセージを構築することもできます。</span><span class="sxs-lookup"><span data-stu-id="2b89c-104">In addition, orchestrations can construct new messages.</span></span> <span data-ttu-id="2b89c-105">サブスクリプションを使用してメッセージを受信し、ルーティング インフラストラクチャは、後ほど[メッセージのライフ サイクル](../core/lifecycle-of-a-message.md)です。</span><span class="sxs-lookup"><span data-stu-id="2b89c-105">Messages are received using the subscription and routing infrastructure discussed in [Lifecycle of a Message](../core/lifecycle-of-a-message.md).</span></span> <span data-ttu-id="2b89c-106">オーケストレーションに対応するサブスクリプションが到着すると、新しいインスタンスがアクティブ化され、メッセージが配信されます。インスタンス サブスクリプションの場合は、必要に応じてインスタンスが復元されてメッセージが配信されます。</span><span class="sxs-lookup"><span data-stu-id="2b89c-106">When subscriptions are filled for orchestrations, a new instance is activated and the message is delivered, or in the case of instance subscriptions, the instance is rehydrated if necessary and the message is then delivered.</span></span> <span data-ttu-id="2b89c-107">オーケストレーションから送信されたメッセージは、受信場所に到着したメッセージと同じようにメッセージ ボックスに公開され、ルーティングで使用するための適切なプロパティがデータベースに挿入されます。</span><span class="sxs-lookup"><span data-stu-id="2b89c-107">When messages are sent from an orchestration, they are published to the MessageBox in the same manner as a message arriving on a receive location with the appropriate properties getting inserted into the database for use in routing.</span></span>  
  
 <span data-ttu-id="2b89c-108">オーケストレーション内で構築されたメッセージは、メッセージ ボックス データベースに配置して、オーケストレーション インスタンスが参照できるようにする必要がありますが、まだ送信されていないので公開はしません。</span><span class="sxs-lookup"><span data-stu-id="2b89c-108">Messages that are constructed in an orchestration must be placed in the MessageBox database and referenced by the orchestration instance, but they should not be published because they have not yet been sent.</span></span> <span data-ttu-id="2b89c-109">XLANG/s サブサービスは、メッセージ エージェント API を呼び出してメッセージを直接挿入します。</span><span class="sxs-lookup"><span data-stu-id="2b89c-109">The XLANG/s subservice makes calls to the Message Agent API to insert messages directly.</span></span> <span data-ttu-id="2b89c-110">これによって、オーケストレーション エンジンはメッセージ本文をメッセージ ボックスに挿入し、実行中のオーケストレーション インスタンスに直接関連付けることができます。</span><span class="sxs-lookup"><span data-stu-id="2b89c-110">This allows the orchestration engine to insert the message body into the MessageBox and have it directly associated with the running orchestration instance.</span></span> <span data-ttu-id="2b89c-111">データベース操作の向上のために、オーケストレーション内の永続化ポイントによって、メッセージ ボックス データベース内の構築されたメッセージの永続性が確保されています。</span><span class="sxs-lookup"><span data-stu-id="2b89c-111">The persistence of the constructed message in the MessageBox database is coordinated with persistence points in the orchestration as an additional optimization of database operations.</span></span>  
  
 <span data-ttu-id="2b89c-112">公開の動作とサブスクライブの動作を区別して見せているのが、オーケストレーションに含まれているバインドという概念です。</span><span class="sxs-lookup"><span data-stu-id="2b89c-112">The concept in orchestrations that makes the publish and subscribe seem to act differently is binding.</span></span> <span data-ttu-id="2b89c-113">オーケストレーションのポートは、対話処理を表す論理ポートです。</span><span class="sxs-lookup"><span data-stu-id="2b89c-113">Orchestration ports are logical ports that describe an interaction.</span></span> <span data-ttu-id="2b89c-114">メッセージを配信するにはこれらの論理ポートを物理ポートにバインドする必要がありますが、このバインド プロセスで行うことは、メッセージのルーティング用にサブスクリプションを構成する操作のみです。</span><span class="sxs-lookup"><span data-stu-id="2b89c-114">You must bind these logical ports to a physical port so that messages are delivered, but this binding process is nothing more than configuring subscriptions for message routing.</span></span>  
  
 <span data-ttu-id="2b89c-115">これらのポートをバインドするための基本オプションは次の 4 つです。</span><span class="sxs-lookup"><span data-stu-id="2b89c-115">There are four basic options for binding these ports:</span></span>  
  
-   <span data-ttu-id="2b89c-116">今指定する (オーケストレーション内でポートを直接指定します)。</span><span class="sxs-lookup"><span data-stu-id="2b89c-116">Specify Now (specifying ports directly in the orchestration)</span></span>  
  
-   <span data-ttu-id="2b89c-117">後で指定する (展開時にポートを指定します)。</span><span class="sxs-lookup"><span data-stu-id="2b89c-117">Specify Later (specifying ports at deployment time)</span></span>  
  
-   <span data-ttu-id="2b89c-118">オーケストレーション コードでアドレスが設定されている動的送信ポートを使用する。</span><span class="sxs-lookup"><span data-stu-id="2b89c-118">Using a dynamic send port where the address is set in the orchestration code</span></span>  
  
-   <span data-ttu-id="2b89c-119">オーケストレーションからメッセージ ボックス データベースまたは他のオーケストレーションへの直接バインドを作成する。</span><span class="sxs-lookup"><span data-stu-id="2b89c-119">Creating a direct binding from the orchestration to either the MessageBox database or to another orchestration</span></span>  
  
## <a name="deploying-orchestrations"></a><span data-ttu-id="2b89c-120">オーケストレーションの展開</span><span class="sxs-lookup"><span data-stu-id="2b89c-120">Deploying Orchestrations</span></span>  
 <span data-ttu-id="2b89c-121">デザイン時にバインドが指定されると、オーケストレーション内で設定されたパラメーターに一致する物理ポートがオーケストレーションの展開時に作成されます。</span><span class="sxs-lookup"><span data-stu-id="2b89c-121">When a binding is specified at design time, the physical port that matches the parameters configured in the orchestration is created when the orchestration is deployed.</span></span> <span data-ttu-id="2b89c-122">展開時にバインドを構成した場合は、論理ポートの要件に一致するポートをオーケストレーション ポートにバインドできます。</span><span class="sxs-lookup"><span data-stu-id="2b89c-122">When the binding is configured at deployment time, any port that matches the requirements of the logical port can be bound to the orchestration port.</span></span> <span data-ttu-id="2b89c-123">動的バインドの場合は、[今指定する] オプションを指定した場合のように物理ポートが作成されますが、そのポートはアドレス情報が設定されていない動的送信ポートです。</span><span class="sxs-lookup"><span data-stu-id="2b89c-123">For dynamic binding, a physical port is created just as with the Specify Now option, but the port is a dynamic send port that has no address information configured.</span></span>  
  
 <span data-ttu-id="2b89c-124">混同されやすいのは、オーケストレーションの送信ポートを物理送信ポートにバインドしても、メッセージが他のサブスクライバーに配信されるのを防ぐことができないという概念です。</span><span class="sxs-lookup"><span data-stu-id="2b89c-124">A confusing concept is that while a send port in an orchestration is bound to a physical send port, this does not preclude that message from getting delivered to other subscribers.</span></span> <span data-ttu-id="2b89c-125">つまり、バインドしたポートに送信されるメッセージに対して、フィルターをとおしたサブスクリプションが別の送信ポートにもあれば、両方の送信ポートがこのメッセージを受信することになります。</span><span class="sxs-lookup"><span data-stu-id="2b89c-125">That is, if another send port happens to have a subscription, through its filters, for the message being sent to the bound port, both send ports receive the message.</span></span> <span data-ttu-id="2b89c-126">バインドを行うと、オーケストレーションから送信されるメッセージが、バインドされている送信ポートの条件に常に一致するようなサブスクリプションが作成されます。</span><span class="sxs-lookup"><span data-stu-id="2b89c-126">Binding simply creates the subscription such that the message sent from the orchestration always matches the criteria for the bound send port.</span></span> <span data-ttu-id="2b89c-127">同様に、受信ポートにバインドされたオーケストレーション ポートがメッセージの種類と受信ポートの ID に基づいて、適切なサブスクリプションが作成されます。</span><span class="sxs-lookup"><span data-stu-id="2b89c-127">Likewise, the orchestration port bound to a receive port creates the appropriate subscription based on message type and receive port ID.</span></span> <span data-ttu-id="2b89c-128">サブスクリプションは、バインドのポートに配信される、オーケストレーションとの間で送信されたメッセージが、メッセージはまだ同じの発行を通過し、前に説明したメカニズムをサブスクライブを保証します。</span><span class="sxs-lookup"><span data-stu-id="2b89c-128">The subscriptions guarantee that the messages going in and out of the orchestration get delivered to the bound ports, but the messages still go through the same publish and subscribe mechanism described earlier.</span></span>  
  
 <span data-ttu-id="2b89c-129">誤解されやすく、誤って使用される場合や十分に利用されない場合のあるオプションは、直接バインド オプションです。</span><span class="sxs-lookup"><span data-stu-id="2b89c-129">Probably the most misunderstood, and misused or underused binding option is the Direct binding option.</span></span> <span data-ttu-id="2b89c-130">直接バインドを使用すると、受信場所がメッセージを公開する場合のように、さまざまなルーティング プロパティを使用してオーケストレーションがメッセージ ボックス データベースにメッセージを公開できます。</span><span class="sxs-lookup"><span data-stu-id="2b89c-130">Direct binding allows an orchestration to publish messages to the MessageBox database with varying routing properties much like messages are published by receive locations.</span></span> <span data-ttu-id="2b89c-131">簡単な直接メッセージングでは、他のメッセージを公開して BizTalk Server で受信する場合と同様に、ルーティング用に昇格させたプロパティを使用してメッセージをメッセージ ボックスに公開します。</span><span class="sxs-lookup"><span data-stu-id="2b89c-131">In simple direct messaging, the message is published to the MessageBox with its promoted properties to be routed like any other published message received into BizTalk Server.</span></span> <span data-ttu-id="2b89c-132">これによって、サブスクライバーがこのメッセージを受信できるようになります。ただし、少なくとも 1 つのサブスクライバーが存在する必要があり、存在しない場合はオーケストレーションはルーティング障害のエラーを受信します。</span><span class="sxs-lookup"><span data-stu-id="2b89c-132">This enables any subscriber to receive this message, but requires that at least one subscriber exist or the orchestration will receive a routing failure error.</span></span>  
  
 <span data-ttu-id="2b89c-133">直接バインドには、自己関連付けを行うポートを使用する方法もあります。</span><span class="sxs-lookup"><span data-stu-id="2b89c-133">Another option for direct binding is to use self-correlating ports.</span></span> <span data-ttu-id="2b89c-134">自己関連付けを行うポートとは、一意の関連付けトークンを作成し、インスタンス間でメッセージを関連付けるときにそのトークンを単独で使用するポートです。</span><span class="sxs-lookup"><span data-stu-id="2b89c-134">Self-correlating ports are ports that create a unique correlation token and use that token alone in correlating messages between instances.</span></span> <span data-ttu-id="2b89c-135">自己関連付けを行うポートの最も一般的な使用方法は、オーケストレーションを呼び出すか起動して、ポート パラメーターを渡すことです。</span><span class="sxs-lookup"><span data-stu-id="2b89c-135">The most common use of a self-correlating port is to call or start an orchestration passing in a port parameter.</span></span> <span data-ttu-id="2b89c-136">呼び出されたオーケストレーションでは、そのポートを使用してメッセージを送信できます。一方、呼び出し元のオーケストレーションでは、同じポートを使用してメッセージを受信できます。</span><span class="sxs-lookup"><span data-stu-id="2b89c-136">In the called orchestration, the port can be used to send a message, while in the calling orchestration the same port can be used to receive a message.</span></span> <span data-ttu-id="2b89c-137">ポートに一意の関連付けトークンがあるので、メッセージは呼び出し元のオーケストレーションにルーティングされます。</span><span class="sxs-lookup"><span data-stu-id="2b89c-137">Because the port has a unique correlation token, the message is routed back to the calling orchestration.</span></span> <span data-ttu-id="2b89c-138">自己関連付けを行うポートは、オーケストレーション インスタンス間のプライベートな通信チャネルとして機能します。</span><span class="sxs-lookup"><span data-stu-id="2b89c-138">Self-correlation ports act as private communication channels between orchestration instances.</span></span>  
  
 <span data-ttu-id="2b89c-139">最後の方法は、パートナー オーケストレーションを使用する方法です。この方法では、呼び出し元のオーケストレーションと呼び出されたオーケストレーションで、共有している同じポートの種類を使用してポートを構成します。ポート構成では同じポートを選択します。</span><span class="sxs-lookup"><span data-stu-id="2b89c-139">The final option is to use a partner orchestration in which, in both the calling orchestration and the called orchestration, the port is configured using the same shared port type and in the port configuration, the same port is selected.</span></span> <span data-ttu-id="2b89c-140">たとえば、Orch1 および Orch2 で Orch2.MyDirectPort を選択します。</span><span class="sxs-lookup"><span data-stu-id="2b89c-140">For example, in both Orch1 and Orch2, Orch2.MyDirectPort is selected.</span></span> <span data-ttu-id="2b89c-141">この種類のバインドでは、送信オーケストレーションの種類、ポート名、および操作名に基づいて受信オーケストレーションのサブスクリプションが設定されます。</span><span class="sxs-lookup"><span data-stu-id="2b89c-141">This type of binding sets up a subscription for the receiving orchestration based on the sending orchestration type, the port name, and the operation name.</span></span> <span data-ttu-id="2b89c-142">この方法でも、メッセージが正しいインスタンスに配信されることが保証されます。</span><span class="sxs-lookup"><span data-stu-id="2b89c-142">This again ensures that the messages get routed to the correct instance.</span></span>  
  
 <span data-ttu-id="2b89c-143">直接メッセージングのオプションはすべて、公開およびサブスクライブ モデルが基になっています。</span><span class="sxs-lookup"><span data-stu-id="2b89c-143">All of the direct messaging options use the underlying publish and subscribe model.</span></span> <span data-ttu-id="2b89c-144">これらのオプションの相違点は、サブスクリプションの作成およびルーティングに使用されるプロパティとその用途です。</span><span class="sxs-lookup"><span data-stu-id="2b89c-144">The difference between these options is in the properties that are used for creating subscriptions and routing, and in the use cases they help solve.</span></span>  
  
 <span data-ttu-id="2b89c-145">オーケストレーション内で直接バインドされたポートを使用した場合に発生する一般的な問題の 1 つは、オーケストレーションが公開するメッセージに対してサブスクリプションが存在する可能性もあることです。</span><span class="sxs-lookup"><span data-stu-id="2b89c-145">One common problem encountered when using direct bound ports in orchestrations is that an orchestration may publish a message that it is also subscribed to.</span></span> <span data-ttu-id="2b89c-146">たとえば、オーケストレーションを PurchaseOrder メッセージによってアクティブ化されるように構成したとします。</span><span class="sxs-lookup"><span data-stu-id="2b89c-146">For example, an orchestration is configured to be activated by a PurchaseOrder message.</span></span> <span data-ttu-id="2b89c-147">このオーケストレーションは、直接ポートを使用して PurchaseOrder メッセージをメッセージ ボックスに公開します。</span><span class="sxs-lookup"><span data-stu-id="2b89c-147">This orchestration uses a direct port to publish the PurchaseOrder message to the MessageBox.</span></span> <span data-ttu-id="2b89c-148">メッセージは予想どおりに受信されますが、オーケストレーションの別のインスタンスにも PurchaseOrder メッセージに対するサブスクリプションがあり、そのインスタンスが起動します。</span><span class="sxs-lookup"><span data-stu-id="2b89c-148">However, in addition to receiving the message as expected, another instance of an orchestration is started because it too had a subscription for PurchaseOrder messages.</span></span> <span data-ttu-id="2b89c-149">この処理によって無限ループが生じ、開発者が事態を把握できるまでに時間がかかることがあります。</span><span class="sxs-lookup"><span data-stu-id="2b89c-149">The processing gets into an endless loop and it may take some time for a developer to figure out what has happened.</span></span>  
  
## <a name="correlation"></a><span data-ttu-id="2b89c-150">Correlation</span><span class="sxs-lookup"><span data-stu-id="2b89c-150">Correlation</span></span>  
 <span data-ttu-id="2b89c-151">*相関関係*オーケストレーションでは、同じ実行中のオーケストレーション インスタンスに関連するメッセージを受信するためのメカニズムです。</span><span class="sxs-lookup"><span data-stu-id="2b89c-151">*Correlation* in orchestrations is the mechanism for receiving related messages into the same running orchestration instance.</span></span> <span data-ttu-id="2b89c-152">オーケストレーション デザイナーで、開発者は次の一般的な手順に従って関連付けを使用します。</span><span class="sxs-lookup"><span data-stu-id="2b89c-152">In the Orchestration Designer a developer follows these general steps to use a correlation:</span></span>  
  
-   <span data-ttu-id="2b89c-153">メッセージの関連付けに使用する昇格させたプロパティが含まれる関連付けの種類を定義します。</span><span class="sxs-lookup"><span data-stu-id="2b89c-153">Defines a correlation type that includes the promoted properties that are used to relate messages.</span></span>  
  
-   <span data-ttu-id="2b89c-154">定義した関連付けの種類のインスタンスである関連付けセットを定義します。</span><span class="sxs-lookup"><span data-stu-id="2b89c-154">Defines a correlation set that is an instance of the correlation type just defined.</span></span>  
  
-   <span data-ttu-id="2b89c-155">送信ポートおよび受信ポートに対して、指定された関連付けセットを開始するかそれに従うかを指定します。</span><span class="sxs-lookup"><span data-stu-id="2b89c-155">For the send and receive ports, specifies whether they initiate or follow a given correlation set.</span></span>  
  
 <span data-ttu-id="2b89c-156">インスタンス サブスクリプションが動作するのは、関連付けセットが開始したとき、つまりこの関連付けセットに従うすべてのポートがメッセージを受信するためのサブスクリプションが作成されたときです。</span><span class="sxs-lookup"><span data-stu-id="2b89c-156">Instance subscriptions come into play when a correlation set is initiated, as this is when subscriptions are created for all of those ports that follow this correlation set to receive messages.</span></span> <span data-ttu-id="2b89c-157">関連付けに使用されるプロパティは関連付けの種類で定義されているので、オーケストレーション エンジンは開始アクションによって送信または受信されるメッセージからこれらのプロパティを抽出できます。</span><span class="sxs-lookup"><span data-stu-id="2b89c-157">Because the correlation type defines the properties to be used for correlation, the orchestration engine can extract these properties from the message being sent or received by the initiating action.</span></span> <span data-ttu-id="2b89c-158">これらの値は、この関連付けセットに従うすべての他のアクションのサブスクリプションの定義に使用されます。</span><span class="sxs-lookup"><span data-stu-id="2b89c-158">These values are then used to define subscriptions for all of the remaining actions which follow this correlation set.</span></span>  
  
 <span data-ttu-id="2b89c-159">BizTalk Server が受信して関連付けに使用するメッセージでは、昇格させたプロパティが正しく定義されており、メッセージ コンテキストに昇格されていることが重要です。</span><span class="sxs-lookup"><span data-stu-id="2b89c-159">It is important that messages received into BizTalk Server and intended for use in a correlation have their promoted properties correctly defined and promoted to the message context.</span></span> <span data-ttu-id="2b89c-160">大部分のプロパティは、メッセージの最初の受信時にパイプライン内の逆アセンブラー コンポーネントが値を抽出すると昇格されます。</span><span class="sxs-lookup"><span data-stu-id="2b89c-160">Most properties get promoted when a disassembler component in a pipeline extracts the values when the message is initially received.</span></span> <span data-ttu-id="2b89c-161">このため、オーケストレーションの実行中のインスタンスに関連付ける必要のあるメッセージをパススルー受信パイプラインで受信することはできません。</span><span class="sxs-lookup"><span data-stu-id="2b89c-161">For this reason, it is not possible to use the PassThrough receive pipeline to receive messages that must be correlated to a running instance of an orchestration.</span></span> <span data-ttu-id="2b89c-162">この問題は、SOAP 受信アダプターを使用して、関連付けられたメッセージの受信する場合に発生します。これは、Web サービス公開ウィザードを使用した場合、受信パイプラインの既定値がパススルー パイプラインであるためです。</span><span class="sxs-lookup"><span data-stu-id="2b89c-162">This issue arises when you use the SOAP receive adapter to receive correlated messages, because the PassThrough pipeline is the default value for the receive pipeline when using the Web Services Publishing Wizard.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="2b89c-163">参照</span><span class="sxs-lookup"><span data-stu-id="2b89c-163">See Also</span></span>  
 <span data-ttu-id="2b89c-164">[成果物](../core/artifacts.md) </span><span class="sxs-lookup"><span data-stu-id="2b89c-164">[Artifacts](../core/artifacts.md) </span></span>  
 [<span data-ttu-id="2b89c-165">オーケストレーション デザイナーを使用してオーケストレーションの作成</span><span class="sxs-lookup"><span data-stu-id="2b89c-165">Creating Orchestrations Using Orchestration Designer</span></span>](../core/creating-orchestrations-using-orchestration-designer.md)