---
title: マスター シークレットの Server1 をクラスター化する方法 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- Master Secret server, second node
- Master Secret server, restoring
- clustering, Master Secret server
- Master Secret server, clustering
ms.assetid: ef817fa4-e43d-4e3d-8686-5bd675708001
caps.latest.revision: 47
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 88f7b25a8cf3138862e65f7c8bd96f041fc512d1
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/07/2019
ms.locfileid: "65386953"
---
# <a name="how-to-cluster-the-master-secret-server"></a>マスター シークレット サーバーをクラスター化する方法
マスタ シークレット サーバーでエンタープライズ シングル サインオン (SSO) サービスを正常にクラスターのこのセクションの指示に従うことをお勧めします。  
  
 マスター シークレット サーバーをクラスター化するときにシングル サインオン サーバー、マスター シークレット サーバーのアクティブなクラスター化されたインスタンスと通信します。 同様に、マスター シークレット サーバーのアクティブなクラスター化されたインスタンスは、SSO データベースと通信します。  
  
 この手順を実行する SSO 管理者である必要があります。  
  
> [!CAUTION]
>  ネットワーク負荷分散 (NLB) クラスターで、マスター シークレット サーバーをインストールすることはできません。  
  
### <a name="to-install-and-configure-enterprise-sso-on-the-cluster-nodes"></a>インストールして、クラスター ノードにエンタープライズ SSO を構成するには  
  
1. インストール[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]各クラスター ノードにします。 **コンポーネントのインストール**、**エンタープライズ シングル サインオン管理モジュール**と**エンタープライズ シングル サインオン マスター シークレット サーバー**します。 インストールが正常に完了したら後、は、**いない**実行、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]構成します。  
  
2. 作成**SSO 管理者**と**SSO 関連管理者**ドメイン グループです。 エンタープライズ SSO サービスのクラスター化されたインスタンスを作成するには、ドメイン グループとしてこれらのグループを作成する必要があります。  
  
3. 作成またはのメンバであるドメイン アカウントを指定、 **SSO 管理者**ドメイン グループです。 このドメイン アカウントとしてログオンする各ノードで、エンタープライズ SSO サービスが構成されます。 このアカウントが必要、**サービスとしてログオン**クラスター内の各ノードで右。  
  
4. ドメインに構成プロセス中にログオンに使用しているアカウントを追加**SSO 管理者**グループ。  
  
   > [!IMPORTANT]
   >  手順 3 と 4 が完了していない場合、エンタープライズ SSO サービスの構成が失敗します。  
  
5. 開始、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]構成します。  
  
6. 選択**カスタム構成**オプションし、入力、**データベース サーバー名**、**ユーザー名**、および**パスワード**値。 選択**構成**を続行します。  
  
   > [!NOTE]
   >  必ずためこの時点で、エンタープライズ SSO サービスを構成だけを入力できます先ほど作成したここで、ドメイン アカウント。  
  
7. 選択、**エンタープライズ SSO**左側のウィンドウからオプションを選択し、エンタープライズ SSO 機能の次のオプションを設定します。  
  
   1.  選択、**を有効にするエンタープライズ シングル サインオン コンピューターこの**チェック ボックスをオンします。  
  
   2.  選択**新しい SSO システムを作成する**します。  
  
   3.  入力、**データ ストア**の**サーバー名**と**データベース名**値。  
  
   4.  先ほど作成したドメイン アカウントが、エンタープライズ SSO サービスに関連付けられているアカウントであることを確認します。  
  
   5.  SSO 管理者ロールに関連付けられたグループとして、先ほど作成したドメイン SSO 管理者グループを入力します。  
  
   6.  SSO 関連管理者ロールに関連付けられたグループとして、先ほど作成したドメイン SSO 関連管理者グループを入力します。  
  
8. 選択、**エンタープライズ SSO シークレットのバックアップ**左側のウィンドウからオプションを選択し、エンタープライズ SSO シークレットをバックアップするための適切なパラメーターを提供します。 既定では、エンタープライズ SSO シークレットがバックアップされる *\<ドライブ\>* : \enterprise シングル サインオン \Program Files\Common\\*SSOxxxx*.bak です。  
  
9. をクリックして、**構成の適用**と概要を確認します。  
  
10. をクリックして**次**構成を適用します。  
  
11. クリックして**完了**構成ウィザードを閉じます。  
  
12. 閉じる、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]構成します。  
  
13. パッシブ クラスター ノードと開始のログオン、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]構成します。  
  
14. 選択、**カスタム構成**オプションし、同じ値を入力します、**データベース サーバー名**、**ユーザー名**、および**パスワード**です最初のクラスター ノードを構成するときに入力したとします。 これらの値を入力すると、次のようにクリックします。**構成**を続行します。  
  
15. 選択、**エンタープライズ SSO**左側のウィンドウからオプションを選択し、エンタープライズ SSO 機能の次のオプションを設定します。  
  
    1.  選択、**を有効にするエンタープライズ シングル サインオン コンピューターこの**オプション。  
  
    2.  選択**既存の SSO システムに参加**します。  
  
    3.  SSO データベースの同じ値を入力**サーバー名**と**データベース名**最初のクラスター ノードを構成するときに入力したことです。  
  
    4.  最初のクラスター ノードを構成するときに入力したドメイン アカウントには、同じ値を入力します。  
  
16. 選択**構成の適用**結果を表示します。  
  
17. 選択**次**構成を適用します。  
  
18. 選択**完了**構成ウィザードを閉じます。  
  
19. 閉じる、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]構成します。  
  
### <a name="to-update-the-master-secret-server-name-in-the-sso-database"></a>SSO データベースのマスター シークレット サーバー名を更新するには  
  
1.  停止して、エンタープライズ SSO サービスを再起動するアクティブなクラスター ノードでコマンド プロンプトから次のコマンドを入力します。  
  
    ```  
    net stop entsso  
    ```  
  
     、  
  
    ```  
    net start entsso  
    ```  
  
2.  SSO データベースのマスター シークレット サーバー名を次の手順に従って、クラスター名に変更します。  
  
    > [!NOTE]
    >  クラスター名が定義されているクラスターで作成したネットワーク名リソース名グループ/クラスター化されたサービスまたはアプリケーションをクラスター化されたエンタープライズ SSO サービスにが含まれます。 たとえば、名前があります*BIZTALKCLUSTER*します。  
  
    1.  テキスト エディターで、次のコードを貼り付けます。  
  
        ```  
        <sso>  
          <globalInfo>  
            <secretServer>BIZTALKCLUSTER</secretServer>  
          </globalInfo>  
        </sso>  
        ```  
  
        > [!NOTE]
        >  *BIZTALKCLUSTER*クラスターで作成される実際のネットワーク名リソースのプレース ホルダーは、グループ/クラスター化されたサービスまたはアプリケーション。  
  
    2.  .Xml ファイルとして保存します。 たとえば、ssocluster.xml ファイルを保存します。  
  
    3.  コマンド プロンプトで、エンタープライズ SSO のインストール フォルダーに変更します。 インストール フォルダーは、既定では、 *\<ドライブ\>* : \Program Files\Common \enterprise シングル サインオンします。  
  
    4.  データベースのマスター シークレット サーバー名を更新するコマンド プロンプトで次のコマンドを入力します。  
  
        ```  
        ssomanage -updatedb XMLFile  
        ```  
  
        > [!NOTE]
        >  *XMLFile*は以前に保存した .xml ファイルの名前のプレース ホルダーです。  
  
### <a name="to-create-the-clustered-enterprise-sso-resource"></a>クラスター化されたエンタープライズ SSO リソースを作成するには  
  
1.  「フォールト トレランスで BizTalk Server でを使用してクラスターを向上させる Windows Server」ホワイト ペーパーの手順に従って、クラスターはクラスター化された分散トランザクション コーディネーター (MSDTC) リソースで構成されていない場合[ http://go.microsoft.com/fwlink/?LinkId=69207 ](http://go.microsoft.com/fwlink/?LinkId=69207)クラスター化された MSDTC リソースを作成します。  
  
2.  クリックして**開始**、**プログラム**、**管理ツール**、し**フェールオーバー クラスター管理**フェールオーバー クラスターを起動するには管理プログラム。  
  
3.  左側のウィンドウで右クリック**フェールオーバー クラスター管理** をクリック**クラスターの管理**します。  
  
4.  **を管理するクラスターを選択** ダイアログ ボックスに、管理する をクリックしてクラスターを入力**OK**。  
  
5.  左側にあるウィンドウをクリックして、クラスター化されたサービスまたはアプリケーションを選択する、IP アドレスおよびネットワーク名リソースが含まれています。 次の手順では、[ディスク、IP アドレス、および名前リソースをクラスター グループを作成する方法](../core/how-to-create-a-cluster-group-with-a-disk-ip-address-and-name-resource1.md)が既に存在しない場合は、IP アドレスおよびネットワーク名リソース グループを作成します。  
  
    > [!NOTE]
    >  クラスター化されたエンタープライズ SSO サービスは、同じグループ内のクラスター化された物理ディスク リソースの使用を明示的に要求されません。  
  
6.  クラスター化されたサービスまたはアプリケーションを右クリックし、[**リソースを追加**、] をクリック**汎用サービス**を表示する、**の新しいリソース ウィザード**ダイアログ。  
  
    > [!IMPORTANT]
    >  **汎用サービス パラメーター**  ダイアログ ボックスで、クリックして選択しない場合、**コンピューター名のネットワーク名を使う**チェック ボックスをオン SSO クライアント コンピューターでは、次のようなエラーを生成しますときに、。エンタープライズ SSO サービスのクラスター化されたこのインスタンスに接続しようとしてください。  
    >   
    >  マスター シークレットを取得できませんでした。  
    >   
    >  マスター シークレット サーバー名が正しいことと、使用可能なであることを確認します。 シークレット サーバー名:ENTSSO エラー コード:0x800706D9、エンドポイントがあるエンドポイント マッパーから使用できます。  
  
7.  **サービスの選択**のページ、**リソースの新規作成ウィザード**をクリックして選択**エンタープライズ シングル サインオン サービス** をクリック**次**します。  
  
8.  **確認**ページ クリック **[次へ]** します。  
  
9. **概要**ページ クリック**完了**。 エンタープライズ シングル サインオン サービスのクラスター化されたインスタンスは、下に表示されます**その他のリソース**の中央のペインで、**フェールオーバー クラスター管理**インターフェイス。  
  
10. エンタープライズ シングル サインオン サービスのクラスター化されたインスタンスを右クリックして**プロパティ**を表示する、**エンタープライズ シングル サインオン サービスのプロパティ** ダイアログ ボックス。  
  
11. をクリックして、**依存関係**プロパティ ダイアログ ボックスのタブ**挿入**します。  
  
12. ドロップダウン ボックスをクリックします。**リソース**を選択、**名:** リソースをクリックします **[ok]** します。  
  
### <a name="to-restore-the-master-secret-on-the-second-cluster-node"></a>2 番目のクラスター ノードでマスター シークレットを復元するには  
  
1.  フェールオーバー クラスターの管理では、クラスター化されたサービスまたはアプリケーションをクラスター化されたエンタープライズ シングル サインオン サービスを含む右クリックし、順にクリックします**このサービスまたはアプリケーションをオンライン**内のリソースのすべてを開始するにはクラスター化されたサービスまたはアプリケーション。  
  
2.  クラスター化されたサービスまたはアプリケーションを右クリックし、**このサービスまたはアプリケーションを別のノードに移動**、2 番目のノードをクリックします。 この手順では、クラスター化されたサービスまたは 2 番目のノードに最初のノードからクラスター化されたエンタープライズ シングル サインオン サービスを含むアプリケーションを移動します。  
  
3.  クラスター化されたエンタープライズ シングル サインオン サービスを右クリックし、をクリックして**このサービスまたはアプリケーションをオフラインに**、エンタープライズ SSO サービスのクラスター化されたインスタンスを右クリックしておよびクリックして**このサービスまたはアプリケーションをオンライン**します。  
  
    > [!NOTE]
    >  この手順を完了していない場合、マスター シークレットを復元する試行が失敗します。  
  
4.  最初のノードから 2 番目のノードのインストール フォルダーでシングル サインオン \Enterprise にマスター シークレットのバックアップ ファイルをコピーします。 インストール フォルダーは、既定では、 *\<ドライブ\>* : \Program Files\Common \enterprise シングル サインオンします。  
  
5.  2 番目のノードには、コマンド プロンプトで、ログオン、エンタープライズ SSO のインストール フォルダーに移動します。  
  
6.  2 番目のノードにマスター シークレットを復元するコマンド プロンプトから次のコマンドを入力します。  
  
    ```  
    ssoconfig -restoresecret RestoreFile  
    ```  
  
    > [!NOTE]
    >  置換*RestoreFile*のパスと、マスター シークレットを含むバックアップ ファイルの名前を使用します。  
  
     マスター シークレットは、次の場所にレジストリに格納されます。  
  
     HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\ENTSSO\SSOSS  
  
7.  クラスター化されたサービスまたはフェールオーバー機能を確認するには、その他のクラスター ノードにこのクラスター ノードからクラスター化されたエンタープライズ シングル サインオン サービスを含むアプリケーションを移動します。 クラスター グループに戻す、フェールバック機能を確認します。  
  
## <a name="see-also"></a>参照  
 [ディスク、IP アドレス、および名前リソースをクラスター グループを作成する方法](../core/how-to-create-a-cluster-group-with-a-disk-ip-address-and-name-resource1.md)
