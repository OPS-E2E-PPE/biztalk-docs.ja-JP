---
title: マスター シークレットの Server1 をクラスター化する方法 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- Master Secret server, second node
- Master Secret server, restoring
- clustering, Master Secret server
- Master Secret server, clustering
ms.assetid: ef817fa4-e43d-4e3d-8686-5bd675708001
caps.latest.revision: 47
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 94355632973a60a6f126d896c77c56961a5d529a
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/27/2018
ms.locfileid: "37003371"
---
# <a name="how-to-cluster-the-master-secret-server"></a>マスター シークレット サーバーをクラスター化する方法
マスター シークレット サーバーのエンタープライズ シングル サインオン (SSO) サービスを正常にクラスター化するには、このセクションに記載されている指示に従うことをお勧めします。  
  
 マスター シークレット サーバーをクラスター化した場合、シングル サインオン サーバーでは、マスター シークレット サーバーのアクティブなクラスター化インスタンスとの通信が行われます。 同様に、マスター シークレット サーバーのアクティブなクラスター化インスタンスでは、SSO データベースとの通信が行われます。  
  
 ここで示す手順を実行するには、SSO 管理者である必要があります。  
  
> [!CAUTION]
>  ネットワーク負荷分散 (NLB) クラスターにマスター シークレット サーバーをインストールすることはできません。  
  
### <a name="to-install-and-configure-enterprise-sso-on-the-cluster-nodes"></a>クラスタ ノードにエンタープライズ SSO をインストールおよび構成するには  
  
1. 各クラスター ノードに [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] をインストールします。 **コンポーネントのインストール**、**エンタープライズ シングル サインオン管理モジュール**と**エンタープライズ シングル サインオン マスター シークレット サーバー**します。 インストールが正常に完了したら後、は、**いない**実行、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]構成します。  
  
2. 作成**SSO 管理者**と**SSO 関連管理者**ドメイン グループです。 エンタープライズ SSO サービスのクラスター化インスタンスを作成するのには、これらのグループをドメイン グループとして作成する必要があります。  
  
3. 作成またはのメンバであるドメイン アカウントを指定、 **SSO 管理者**ドメイン グループです。 各ノードのエンタープライズ SSO サービスは、このドメイン アカウントとしてログオンするように構成されます。 このアカウントが必要、**サービスとしてログオン**クラスター内の各ノードで右。  
  
4. ドメインに構成プロセス中にログオンに使用しているアカウントを追加**SSO 管理者**グループ。  
  
   > [!IMPORTANT]
   >  手順 3. および手順 4. を完了しないと、エンタープライズ SSO サービスの構成が失敗します。  
  
5. [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] の構成を起動します。  
  
6. 選択**カスタム構成**オプションし、入力、**データベース サーバー名**、**ユーザー名**、および**パスワード**値。 選択**構成**を続行します。  
  
   > [!NOTE]
   >  必ずためこの時点で、エンタープライズ SSO サービスを構成だけを入力できます先ほど作成したここで、ドメイン アカウント。  
  
7. 選択、**エンタープライズ SSO**左側のウィンドウからオプションを選択し、エンタープライズ SSO 機能の次のオプションを設定します。  
  
   1.  選択、**を有効にするエンタープライズ シングル サインオン コンピューターこの**チェック ボックスをオンします。  
  
   2.  選択**新しい SSO システムを作成する**します。  
  
   3.  入力、**データ ストア**の**サーバー名**と**データベース名**値。  
  
   4.  先ほど作成したドメイン アカウントが、エンタープライズ SSO サービスに関連付けられたアカウントになっていることを確認します。  
  
   5.  SSO 管理者ロールに関連付けられたグループとして、先ほど作成したドメイン SSO 管理者グループを入力します。  
  
   6.  SSO 関連管理者ロールに関連付けられたグループとして、先ほど作成したドメイン SSO 関連管理者グループを入力します。  
  
8. 選択、**エンタープライズ SSO シークレットのバックアップ**左側のウィンドウからオプションを選択し、エンタープライズ SSO シークレットをバックアップするための適切なパラメーターを提供します。 既定では、エンタープライズ SSO シークレットがバックアップされる*\<ドライブ\>*: \enterprise シングル サインオン \Program Files\Common\\*SSOxxxx*.bak です。  
  
9. をクリックして、**構成の適用**と概要を確認します。  
  
10. をクリックして**次**構成を適用します。  
  
11. クリックして**完了**構成ウィザードを閉じます。  
  
12. [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] の構成を閉じます。  
  
13. パッシブ クラスター ノードにログオンし、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] の構成を起動します。  
  
14. 選択、**カスタム構成**オプションし、同じ値を入力します、**データベース サーバー名**、**ユーザー名**、および**パスワード**です最初のクラスター ノードを構成するときに入力したとします。 これらの値を入力すると、次のようにクリックします。**構成**を続行します。  
  
15. 選択、**エンタープライズ SSO**左側のウィンドウからオプションを選択し、エンタープライズ SSO 機能の次のオプションを設定します。  
  
    1.  選択、**を有効にするエンタープライズ シングル サインオン コンピューターこの**オプション。  
  
    2.  選択**既存の SSO システムに参加**します。  
  
    3.  SSO データベースの同じ値を入力**サーバー名**と**データベース名**最初のクラスター ノードを構成するときに入力したことです。  
  
    4.  ドメイン アカウントに、最初のクラスター ノードを構成したときと同じ値を入力します。  
  
16. 選択**構成の適用**結果を表示します。  
  
17. 選択**次**構成を適用します。  
  
18. 選択**完了**構成ウィザードを閉じます。  
  
19. 閉じる、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]構成します。  
  
### <a name="to-update-the-master-secret-server-name-in-the-sso-database"></a>SSO データベースのマスター シークレット サーバー名を更新するには  
  
1.  アクティブなクラスター ノードのコマンド プロンプトで次のコマンドを入力して、エンタープライズ SSO サービスを停止および再開します。  
  
    ```  
    net stop entsso  
    ```  
  
     クエリと  
  
    ```  
    net start entsso  
    ```  
  
2.  次の手順を実行して、SSO データベースのマスター シークレット サーバー名をクラスター名に変更します。  
  
    > [!NOTE]
    >  このクラスター名は、クラスター化されたエンタープライズ SSO サービスを含むクラスター グループ/クラスター化されたサービスまたはアプリケーションで作成したネットワーク名リソース用に定義された名前です。 たとえば、名前があります*BIZTALKCLUSTER*します。  
  
    1.  テキスト エディターに次のコードを貼り付けます。  
  
        ```  
        <sso>  
          <globalInfo>  
            <secretServer>BIZTALKCLUSTER</secretServer>  
          </globalInfo>  
        </sso>  
        ```  
  
        > [!NOTE]
        >  *BIZTALKCLUSTER*クラスターで作成される実際のネットワーク名リソースのプレース ホルダーは、グループ/クラスター化されたサービスまたはアプリケーション。  
  
    2.  ファイルを .xml ファイルとして保存します。 たとえば、SSOCLUSTER.xml という名前で保存します。  
  
    3.  コマンド プロンプトで、エンタープライズ SSO のインストール フォルダーに移動します。 インストール フォルダーは、既定では、 *\<ドライブ\>*: \Program Files\Common \enterprise シングル サインオンします。  
  
    4.  コマンド プロンプトで次のコマンドを入力して、データベース内のマスター シークレット サーバー名を更新します。  
  
        ```  
        ssomanage -updatedb XMLFile  
        ```  
  
        > [!NOTE]
        >  *XMLFile*は以前に保存した .xml ファイルの名前のプレース ホルダーです。  
  
### <a name="to-create-the-clustered-enterprise-sso-resource"></a>クラスタ化されたエンタープライズ SSO リソースを作成するには  
  
1.  「フォールト トレランスで BizTalk Server でを使用してクラスターを向上させる Windows Server」ホワイト ペーパーの手順に従って、クラスターはクラスター化された分散トランザクション コーディネーター (MSDTC) リソースで構成されていない場合[ http://go.microsoft.com/fwlink/?LinkId=69207 ](http://go.microsoft.com/fwlink/?LinkId=69207)クラスター化された MSDTC リソースを作成します。  
  
2.  クリックして**開始**、**プログラム**、**管理ツール**、し**フェールオーバー クラスター管理**フェールオーバー クラスターを起動するには管理プログラム。  
  
3.  左側のウィンドウで右クリック**フェールオーバー クラスター管理** をクリック**クラスターの管理**します。  
  
4.  **を管理するクラスターを選択** ダイアログ ボックスに、管理する をクリックしてクラスターを入力**OK**。  
  
5.  左側のウィンドウで、IP アドレスおよびネットワーク名リソースが入ったクラスター化されたサービスかアプリケーションをクリックして選択します。 次の手順では、[ディスク、IP アドレス、および名前リソースをクラスター グループを作成する方法](../core/how-to-create-a-cluster-group-with-a-disk-ip-address-and-name-resource1.md)が既に存在しない場合は、IP アドレスおよびネットワーク名リソース グループを作成します。  
  
    > [!NOTE]
    >  クラスター化されたエンタープライズ SSO サービスでは、同じグループ内でクラスター化された物理ディスク リソースの使用は明示的に要求されません。  
  
6.  クラスター化されたサービスまたはアプリケーションを右クリックし、[**リソースを追加**、] をクリック**汎用サービス**を表示する、**の新しいリソース ウィザード**ダイアログ。  
  
    > [!IMPORTANT]
    >  **汎用サービス パラメーター**  ダイアログ ボックスで、クリックして選択しない場合、**コンピューター名のネットワーク名を使う**チェック ボックスをオン SSO クライアント コンピューターでは、次のようなエラーを生成しますときに、。エンタープライズ SSO サービスのクラスター化されたこのインスタンスに接続しようとしてください。  
    >   
    >  マスター シークレットを取得できませんでした。  
    >   
    >  マスター シークレット サーバー名が正しいこと、および利用可能であることを確認してください。 シークレット サーバー名: ENTSSO エラー コード: 0x800706D9、エンドポイント マッパーから使用できるエンドポイントはこれ以上ありません。  
  
7.  **サービスの選択**のページ、**リソースの新規作成ウィザード**をクリックして選択**エンタープライズ シングル サインオン サービス** をクリック**次**します。  
  
8.  **確認**ページ クリック **[次へ]** します。  
  
9. **概要**ページ クリック**完了**。 エンタープライズ シングル サインオン サービスのクラスター化されたインスタンスは、下に表示されます**その他のリソース**の中央のペインで、**フェールオーバー クラスター管理**インターフェイス。  
  
10. エンタープライズ シングル サインオン サービスのクラスター化されたインスタンスを右クリックして**プロパティ**を表示する、**エンタープライズ シングル サインオン サービスのプロパティ** ダイアログ ボックス。  
  
11. をクリックして、**依存関係**プロパティ ダイアログ ボックスのタブ**挿入**します。  
  
12. ドロップダウン ボックスをクリックします。**リソース**を選択、**名:** リソースをクリックします **[ok]** します。  
  
### <a name="to-restore-the-master-secret-on-the-second-cluster-node"></a>2 番目のクラスタ ノードでマスタ シークレットを復元するには  
  
1.  フェールオーバー クラスターの管理では、クラスター化されたサービスまたはアプリケーションをクラスター化されたエンタープライズ シングル サインオン サービスを含む右クリックし、順にクリックします**このサービスまたはアプリケーションをオンライン**内のリソースのすべてを開始するにはクラスター化されたサービスまたはアプリケーション。  
  
2.  クラスター化されたサービスまたはアプリケーションを右クリックし、**このサービスまたはアプリケーションを別のノードに移動**、2 番目のノードをクリックします。 この手順では、クラスター化されたエンタープライズ シングル サインオン サービスが入ったクラスター化されたサービスまたはアプリケーションを最初のノードから 2 番目のノードに移動します。  
  
3.  クラスター化されたエンタープライズ シングル サインオン サービスを右クリックし、をクリックして**このサービスまたはアプリケーションをオフラインに**、エンタープライズ SSO サービスのクラスター化されたインスタンスを右クリックしておよびクリックして**このサービスまたはアプリケーションをオンライン**します。  
  
    > [!NOTE]
    >  この手順を省略すると、マスター シークレットの復元に失敗する場合があります。  
  
4.  最初のノードのマスター シークレットのバックアップ ファイルを、2 番目のノードの \Enterprise Single Sign-On インストール フォルダーにコピーします。 インストール フォルダーは、既定では、 *\<ドライブ\>*: \Program Files\Common \enterprise シングル サインオンします。  
  
5.  2 番目のノードにログオンし、コマンド プロンプトで、エンタープライズ SSO のインストール フォルダーに移動します。  
  
6.  コマンド プロンプトで次のコマンドを入力し、マスター シークレットを 2 番目のノードに復元します。  
  
    ```  
    ssoconfig -restoresecret RestoreFile  
    ```  
  
    > [!NOTE]
    >  置換*RestoreFile*のパスと、マスター シークレットを含むバックアップ ファイルの名前を使用します。  
  
     マスター シークレットがレジストリの次の場所に保存されます。  
  
     HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\ENTSSO\SSOSS  
  
7.  このクラスター ノードから他のクラスター ノードに、クラスター化されたエンタープライズ シングル サインオン サービスを含むクラスター化されたサービスまたはアプリケーションを移動して、フェールオーバー機能を確認します。 次に、クラスター グループを元に戻して、フェールバック機能を検証します。  
  
## <a name="see-also"></a>参照  
 [ディスク、IP アドレス、および名前リソースをクラスター グループを作成する方法](../core/how-to-create-a-cluster-group-with-a-disk-ip-address-and-name-resource1.md)
