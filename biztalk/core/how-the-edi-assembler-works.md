---
title: EDI アセンブラーの動作のしくみ |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: c3785870-08ab-4fc2-8f7e-7c5a37639a7a
caps.latest.revision: 33
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 480bb6c17bc4e6085147e2c79ab3e3ba58d2746e
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/07/2019
ms.locfileid: "65344103"
---
# <a name="how-the-edi-assembler-works"></a>EDI アセンブラの動作
[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] は、送信される EDI エンコード インターチェンジの処理の大部分を、EDI 送信パイプライン (`Microsoft.BizTalk.DefaultPipelines.EDISendPipeline`) で実行します。 このパイプラインには、EDI アセンブラ パイプライン コンポーネントが含まれ、このコンポーネントにより、次の処理が実行されます。  
  
-   EDI インターチェンジをシリアル化します。これによって、XML エンコード メッセージがインターチェンジ内の EDI トランザクション セットに変換されます。  
  
-   EDI スキーマ検証、X12 エンコード メッセージのクロスフィールド検証 (設定されている場合)、EDI 構造検証、および拡張スキーマ検証 (スキーマがカスタマイズされており、EDI 以外のデータ型のノードがある場合) を実行します。  
  
-   EDI メッセージにエンベロープを適用します。  
  
-   EDI メッセージへの応答として受信した、技術および機能の確認を処理し、確認のバッチ解除を行います (設定されている場合)。  
  
## <a name="applying-an-envelope-to-an-outgoing-edi-message"></a>送信 EDI メッセージへのエンベロープの適用  
 EDI 送信パイプラインが中間 XML ファイルから送信 EDI メッセージを作成するときに、インターチェンジとグループのヘッダーが含まれたエンベロープがメッセージに適用されます。このエンベロープは、受信側のアグリーメントに対して設定された EDI プロパティに基づいて適用されます。 受信アグリーメントを送信ポートから特定できなかった場合は、フォールバック アグリーメントを使用してエンベロープが適用されます。  
  
 `EdiOverride.OverrideEdiHeader` コンテキスト プロパティが true に設定されている場合は、EdiOverride プロパティ コレクションで指定されている値を使用してエンベロープが作成されます。 このコレクションにない値については、アグリーメント プロパティ内の対応する EDI 値が使用されます。 EdiOverride コレクションとアグリーメント プロパティのどちらにもない値については、フォールバック EDI アグリーメントのプロパティが使用されます。  
  
 中間 XML ファイルに予約済みのタグまたは ReuseEnvelope コンテキスト プロパティが含まれている場合、メッセージは保護されたバッチであるため、エンベロープ アプリケーション ロジックは適用されません。  
  
### <a name="sources-for-x12-envelope-values"></a>X12 エンベロープ値のソース  
 次の表に、EDI 送信パイプラインが、X12 エンベロープの各部分に必要な情報を取得する場所を示します。  
  
|[ヘッダー]|Source|  
|------------|------------|  
|インターチェンジ制御ヘッダー (ISA)|-EdiOverride コンテキスト プロパティ (場合`EdiOverride.OverrideEdiHeader`が true)。<br />-ISA セグメントの定義の下のさまざまなページ アグリーメントが定義されている場合、**インターチェンジの設定**で一方向のアグリーメント プロパティのセクション、**アグリーメントのプロパティ** ダイアログ ボックス。<br />-ISA セグメントの定義の下のさまざまなページ アグリーメントが定義されていない場合、**インターチェンジの設定**セクション、 **EDIFACT フォールバックの設定** ダイアログ ボックス。|  
|機能グループ ヘッダー (GS)|-EdiOverride コンテキスト プロパティ (場合`EdiOverride.OverrideEdiHeader`が true)<br />-GS セグメントの定義アグリーメントが定義されている場合、**エンベロープ**ページ ([**トランザクション セットの設定**セクション) で一方向アグリーメント プロパティで、**アグリーメントのプロパティ** ] ダイアログ ボックス<br />-GS セグメントの定義アグリーメントが定義されていない場合、**エンベロープ**ページ ([**トランザクション セットの設定**セクション) で、 **X12 フォールバック設定**] ダイアログ ボックス<br /><br /> アグリーメントが定義されている場合は、GS データ要素の値はトランザクション セット識別子 (ST1)、バージョン、およびターゲットの名前空間の組み合わせに基づいて決定されます。 これらの値でグリッドと比較されます、**エンベロープ**ページ (**トランザクション セットの設定**セクション) (アグリーメントが定義されている) 場合、アグリーメントのプロパティまたはフォールバック アグリーメントのプロパティ (の場合のアグリーメントが定義されていない)。<br /><br /> -一致する行がある場合、一致する行に含まれる値は、GS ヘッダーに使用されます。<br />場合、一致はありませんが、既定の行が定義されている、GS01 を除くすべての GS データ要素は、既定の行から作成されます。 GS01 は、ST1 の値に基づいて動的に決定されます。<br />場合、一致する行、および既定の行もが、メッセージが中断されます。 **注:**、他のグループから一意であるグループの別のグループの場合と同じすべてこれらの値の指定できます。 <br /><br /> アグリーメントが定義されていない場合は、フォールバック アグリーメントのプロパティから GS データ要素の値が取得されます。|  
  
### <a name="sources-for-edifact-envelope-values"></a>EDIFACT エンベロープ値のソース  
 次の表に、EDI 送信パイプラインが、EDIFACT エンベロープの各部分に必要な情報を取得する場所を示します。  
  
|[ヘッダー]|Source|  
|------------|------------|  
|文字列サービス通知 (UNA)|-EdiOverride コンテキスト プロパティ (場合`EdiOverride.OverrideEdiHeader`が true)。<br />の UNA セグメントの定義場合は、アグリーメントが定義されている場合、**文字セットと区切り記号**一方向のアグリーメント プロパティのページ、**アグリーメントのプロパティ** ダイアログ ボックス。<br />の UNA セグメントの定義場合、アグリーメントが定義されていない**文字セットと区切り記号**ページで、 **EDIFACT フォールバックの設定** ダイアログ ボックス。|  
|インターチェンジ制御ヘッダー (UNB)|-EdiOverride コンテキスト プロパティ (場合`EdiOverride.OverrideEdiHeader`が true)。<br />-UNB セグメントの定義の下のさまざまなページ アグリーメントが定義されている場合、**インターチェンジの設定**で一方向のアグリーメント プロパティのセクション、**アグリーメントのプロパティ** ダイアログ ボックス。<br />-UNB セグメントの定義の下のさまざまなページ アグリーメントが定義されていない場合、**インターチェンジの設定**セクション、 **EDIFACT フォールバックの設定** ダイアログ ボックス。|  
|機能グループ ヘッダー (UNG)|-EdiOverride コンテキスト プロパティ (場合`EdiOverride.OverrideEdiHeader`が true)。<br />-アグリーメントが定義されている場合、UNG および UNH セグメントの定義、**エンベロープ**ページ (**トランザクション セットの設定**セクション) で一方向アグリーメント プロパティで、**アグリーメントプロパティ** ダイアログ ボックス<br />-アグリーメントが定義されていない場合、[UNG および UNH セグメントの定義、**エンベロープ**ページ ([**トランザクション セットの設定**セクション) で一方向アグリーメント プロパティで、**アグリーメントプロパティ**] ダイアログ ボックスで、 **EDIFACT フォールバックの設定**] ダイアログ ボックス<br /><br /> アグリーメントが定義されている場合は、UNG データ要素の値はメッセージの種類 (UNH2.1)、メッセージのリリース番号 (UNH2.3)、割り当てコード (UNH2.5)、バージョン、およびターゲットの名前空間の組み合わせに基づいて決定されます。 **注:**、他のグループから一意であるグループの別のグループの場合と同じすべてこれらの値の指定できます。|  
  
### <a name="applying-transaction-set-header-and-trailer-segments"></a>トランザクション セット ヘッダーおよびトレーラ セグメントの適用  
 送信 EDI インターチェンジにシリアル化される XML トランザクション セットには、トランザクション セット ヘッダーとトレーラーが必要です。 ただし、EDI アセンブラーは、トランザクション セット ヘッダーまたはトレーラーがなくても、メッセージを処理します。 XML トランザクション セットでは、X12 および EDIFACT スキーマのトランザクション セット ヘッダーおよびトレーラー セグメントはオプションです。 トランザクションにヘッダーまたはトレーラーがない場合、EDISend または AS2EDISend 送信パイプラインの EDI アセンブラーは、トランザクションにトランザクション セット ヘッダー値およびトレーラー値を追加します。 これらの値は、マッピングまたは計算に基づきます。 EDI アセンブラーは、この処理をインターチェンジ XML (保護されたバッチ)、バッチ トランザクション セット XML、およびトランザクション セット XML に対して行います。  
  
 マッピングによって検証エラーが発生した場合、イベント ビューアに無効な長さやデータ型、無効な制御機関コードなどの該当するエラーが表示され、XML トランザクション セットまたはインターチェンジ XML は中断されます。  
  
####  <a name="BKMK_X12"></a> X12 トランザクション セット ヘッダーおよびトレーラ セグメント  
 ヘッダーおよびトレーラ セグメントのない X12 エンコード トランザクション セットの場合、EDI アセンブラは、ST および SE セグメントを次の値に設定します。  
  
|ヘッダーおよびトレーラ セグメント|値|  
|----------------------------|-----------|  
|ST01 (トランザクション セット識別コード)|受信 XML トランザクション セットの RootNode 名の最後の 3 文字にマップされます。 たとえば、"X12_00401_855" の場合は、"855" にマップされます。 TS 識別コードが 837P、837D、または 837I の HIPAA クレームの場合、"837" が使用されます。|  
|ST02 (トランザクション セット制御番号)|値`EdiOverride.ST02`(場合`EdiOveride.OverrideEdiHeader`が true の場合) かの値にマップされて、**トランザクション セット制御番号 (ST02)** で、**ローカル ホスト設定**ページ ([**インターチェンジ設定**) の一方向アグリーメント タブの**アグリーメントのプロパティ**] ダイアログ ボックス。<br /><br /> 設定に関係なく、新しいまたは増分制御番号が適用される、**新しい ID の適用**プロパティ。|  
|ST03 (バージョン識別子)|受信 XML トランザクション セットの ST03 の値にマップされます。 たとえば、5010 HIPAA 820 ドキュメント (給与控除) の場合は "005010X218" です。 ST03 は、トランザクション セットの検証に使用されるスキーマに対して検証されます。 **注:** ST03 は、すべての HIPAA バージョン 5010 トランザクション 835 を除く必須です。|  
|SE01 (含まれているセグメントの数)|ST および SE セグメントを含む、トランザクション セットのセグメントの合計数に設定されます。|  
|SE02 (トランザクション セット制御番号)|トランザクション セットの ST02 の値にマップされます。|  
  
 ST03 など、トランザクション セット ヘッダーの他のデータ要素は省略可能であるため、生成されるセグメントでは評価されません。  
  
####  <a name="BKMK_EDIFACT"></a> EDIFACT トランザクション セット ヘッダーおよびトレーラ セグメント  
 ヘッダーおよびトレーラ セグメントのない EDIFACT エンコード トランザクション セットの場合、EDI アセンブラは、UNH および UNT セグメントを次の値に設定します。  
  
|ヘッダーおよびトレーラ セグメント|値|  
|----------------------------|-----------|  
|UNH01 (メッセージ参照制御番号)|値`EdiOverride.UNH1`(場合`EdiOverride.OverrideEdiHeader`が true の場合) の値にマップされた**参照番号 (UNH1)** で、**ローカル ホスト設定**ページ ( **インターチェンジの設定**)一方向アグリーメント タブの **アグリーメントのプロパティ** ダイアログ ボックス。 設定に関係なく、新しいまたは増分制御番号が適用される、**新しい ID の適用**プロパティ。|  
|UNH2.1 (メッセージの種類)|受信 XML トランザクション セットの RootNode 名の最後の 6 文字にマップされます。 たとえば、"EFACT_D96A_INVOIC" の場合は、"INVOIC" にマップされます。|  
|UNH2.2 (メッセージのバージョン番号)|受信 XML トランザクション セットの RootNode 名の 7 番目の文字にマップされます。 たとえば、"EFACT_D96A_INVOIC" の場合は、"D" にマップされます。|  
|UNH2.3 (メッセージのリリース番号)|受信 XML トランザクション セットの RootNode 名の 8、9、および 10 番目の文字にマップされます。 たとえば、"EFACT_D96A_INVOIC" の場合は、"96A" にマップされます。|  
|UNH2.4 (制御機関コード)|常に文字列 'UN' にマップされます。|  
|UNT01 (含まれているセグメントの数)|UNH および UNT セグメントを含む、トランザクション セットのセグメントの合計数に設定されます。|  
|UNH02 (メッセージ参照制御番号)|値にマップされている**参照番号 (UNH1)** で、**ローカル ホスト設定**ページ ([**インターチェンジの設定**) の一方向アグリーメント タブの**アグリーメントのプロパティ**] ダイアログ ボックス|  
  
 UNH3 から UNH6 などのトランザクション セット ヘッダーの他のデータ要素は省略可能であるため、生成されるセグメントでは評価されません。 これらのフィールドが必要な場合は、受信 XML トランザクション セットの値に設定する必要があります。  
  
### <a name="additional-processing-on-envelope-of-an-outgoing-message"></a>送信メッセージのエンベロープの追加処理  
 EDI 送信パイプラインは、送信メッセージのエンベロープで次の処理を実行します。  
  
#### <a name="control-numbers"></a>制御番号  
 EDI 送信パイプラインは、各送信インターチェンジのエンベロープ セグメントに、インターチェンジ制御番号、グループ制御番号、およびトランザクション セット制御 (または参照) 番号を入力します。 次の表に、これらの番号を示します。  
  
|制御番号|X12 フィールド|EDIFACT フィールド|  
|--------------------|---------------|-------------------|  
|インターチェンジ制御番号|ISA13|UNB5|  
|グループ制御番号|GS6|UNG5|  
|トランザクション セット制御番号 (X12)<br /><br /> トランザクション セット参照番号 (EDIFACT)|ST2|UNH1|  
  
 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] [次へ] に入力した値の範囲に基づいて、送信インターチェンジのインターチェンジ制御番号を設定、**インターチェンジ制御番号 (ISA13)** プロパティを**ローカル ホスト設定**(ページ[**インターチェンジの設定**) の一方向アグリーメント タブの**アグリーメントのプロパティ**] ダイアログ ボックス。 この番号は、以降のインターチェンジごとに増分されます (最大値に達するまで)。  
  
 インターチェンジ制御番号が EdiOverride コンテキスト プロパティを使用して指定されている場合は、その値がこのインターチェンジで使用されるので、アグリーメントで指定されたインターチェンジ制御番号の影響は受けません。  
  
> [!NOTE]
>  場合にのみ EDIFACT のグループ制御番号が増分されます、 **UNG セグメントを適用**プロパティ、**エンベロープ**EDIFACT アグリーメントのプロパティのページを選択します。 2 番目のフィールド (参照番号) は増分されますが、プレフィクックスおよびサフィックス フィールドは増分されません。 トランザクション セット制御番号は場合にのみ増分されます、**新しい ID を適用**プロパティが選択されています。  
  
> [!NOTE]
>  保護されているバッチ インターチェンジでは、メッセージ強化サンプルを使用して、カスタム インターチェンジ制御番号を作成できます。 詳細については、次を参照してください。[メッセージ強化サンプル (BizTalk Server サンプル)](../core/message-enrichment-sample-biztalk-server-sample.md)します。  
  
 アグリーメントが定義されていない場合は、フォールバック アグリーメントの同じページから番号が取得されます。 送信パイプラインは、最後に使用された制御番号を格納し、次のインターチェンジ、グループ、およびトランザクション セットについては増分された番号を入力します。  
  
> [!NOTE]
>  制御番号が、指定された範囲の最大値に達した場合は、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] によってエラーが生成され、インターチェンジは保留となります。 手動で制御番号をリセットしたり、設定できます[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]で下限の値を自動的にリセットする、**ローカル ホスト設定**ページで、**アグリーメントのプロパティ**x12 の両方のダイアログ ボックスとEDIFACT メッセージです。  
> 
> [!NOTE]
>  制御番号は、BizTalk MessageBox データベースの dbo.EdiSequenceNumbers テーブルに保存されています。 必要に応じて、このテーブルの制御番号を削除するかアーカイブすることによって、このデータベースを管理する必要があります。  
  
 EDIFACT では、制御番号は英数字で構成されます。 次の書式がサポートされています。  
  
- Numbers ("1" など)  
  
- PrefixNumbersSuffix ("WA1A" など)  
  
- PrefixNumbers ("AA1" など)。  
  
- NumbersSuffix ("1AA" など)  
  
  これらの書式では、数字には "0" ～ "9"、プレフィックスとサフィックスには数字以外の任意の文字を使用できます。 数字のみが最大値に達するまで増分されます。  
  
#### <a name="count-of-segments"></a>セグメント数  
 インターチェンジのトランザクション セットごとに、EDI 送信パイプラインは、トランザクション セットのセグメント数を検証します。これは、X12 の場合は SE1 データ要素、EDIFACT の場合は UNT01 データ要素で示されます。 該当するデータ要素の値が実際の数と一致しない場合、送信パイプラインは実際のセグメント数を反映するように数を更新します。 数が間違っていても、トランザクション セットは拒否されません。 数の更新は、イベント ビューアの警告に記録されます。 これは、保護されたバッチの処理には適用されません。  
  
## <a name="additional-steps-in-serializing-an-edi-interchange"></a>EDI インターチェンジのシリアル化の追加手順  
 EDI 送信パイプラインは、シリアル化中に次の手順も実行します。  
  
### <a name="serializing-the-release-indicator"></a>リリース インジケータのシリアル化  
 EDIFACT メッセージのシリアル化中、EDI 送信パイプラインは、必要なリリース インジケータを EDI インターチェンジに挿入します。 送信パイプラインにルーティングされた中間 XML には、エスケープされるデータは含まれないと想定されています。 たとえば、送信パイプラインにルーティングされる XML データにリリース インジケータが存在する場合、送信パイプラインは、既存のリリース インジケータの前に別のリリース インジケータを追加して、既存のリリース インジケータをエスケープします。  
  
 リリース インジケータは、EDI 検証には含まれません。 長さ制限が計算されるとき、リリース インジケータは含まれません。  
  
### <a name="adding-trailing-zeroes-to-meet-implied-decimal-requirements"></a>暗黙の小数点以下の桁数要件を満たすために後ろにゼロを追加  
 EDI アセンブラは、小数点以下の桁数が足りない数字を検出すると、暗黙の桁数要件を満たすために後ろにゼロを追加します。 たとえば、数字の書式が N2 である必要がある場合に、数字が "4.5" であれば、EDI アセンブラは数字を "4.50" に変更します。  
  
### <a name="replacing-separators-in-payload-data"></a>ペイロード データ内の区切り記号の置き換え  
 データ、セグメント、またはコンポーネントの区切り記号としても設定されている文字が送信メッセージのデータに含まれている場合は、その文字を EDI 送信パイプラインによって置き換えることができます。 たとえば、メッセージには値が含まれています"テスト * データ"データ要素区切り記号が構成されている '\*'、受信側システムで解析の問題が発生します。  
  
 有効にすると、この文字を置換する EDI 送信パイプラインを構成することができます、**を使用してペイロードの区切り記号を置き換えます**プロパティと、置換文字を指定します。 このプロパティにある、**文字セットと区切り記号**の一方向アグリーメント タブのページで、**アグリーメントのプロパティ** ダイアログ ボックス。  
  
### <a name="transform-hipaa-records-based-on-trigger-fields"></a>トリガー フィールドに基づく HIPAA レコードの変換  
 EDI アセンブラーが一致する汎用の EDI セグメントに、トリガー フィールドを含む一意の XML レコードを変換、送信ドキュメントが HIPAA トランザクション セットの場合は、(を参照してください[HIPAA スキーマのトリガー フィールドの注釈](../core/hipaa-schema-trigger-field-annotations.md))。 この処理は、具体的には XML レコード名の "_" 文字の後にあるサフィックスを削除するというものです。  
  
 たとえば、要素 <N1_PayerIdentification_TS835W1_1000A> と <N1_PayeeIdentification_TS835W1_1000B> のどちらも N1 セグメントになります。  
  
## <a name="see-also"></a>参照  
 [BizTalk Server が EDI メッセージを送信する方法](../core/how-biztalk-server-sends-edi-messages.md)