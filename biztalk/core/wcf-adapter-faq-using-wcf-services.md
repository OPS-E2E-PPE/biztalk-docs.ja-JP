---
title: 'WCF アダプター FAQ: WCF サービスの使用 |Microsoft ドキュメント'
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: befa2268-8a65-465f-8086-70a66808845e
caps.latest.revision: ''
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 41d02fe0b7be1f53edaac4c18cfd7717a25c3a71
ms.sourcegitcommit: 8418b1a8f38b7f56979cd6e203f0b591e2f40fe1
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/23/2018
---
# <a name="wcf-adapter-faq-using-wcf-services"></a><span data-ttu-id="db2c2-102">WCF アダプターに関する FAQ: WCF サービスの使用</span><span class="sxs-lookup"><span data-stu-id="db2c2-102">WCF Adapter FAQ: Using WCF Services</span></span>
## <a name="how-does-biztalk-server-use-its-wcf-adapters-to-access-wcf-services"></a><span data-ttu-id="db2c2-103">BizTalk Server が WCF アダプターを使用して WCF サービスにアクセスするしくみ</span><span class="sxs-lookup"><span data-stu-id="db2c2-103">How does BizTalk Server use its WCF adapters to access WCF services?</span></span>  
 <span data-ttu-id="db2c2-104">BizTalk WCF アダプターは、WCF 受信場所または送信ポートを通じて BizTalk Server で構成されます。</span><span class="sxs-lookup"><span data-stu-id="db2c2-104">BizTalk WCF adapters are configured in BizTalk Server through either a WCF receive location or a send port.</span></span> <span data-ttu-id="db2c2-105">WCF アダプターを使用する受信場所が有効になっている場合、各受信場所に対して 1 つの ServiceHost インスタンスがインスタンス化および初期化されます。</span><span class="sxs-lookup"><span data-stu-id="db2c2-105">When a receive location using a WCF adapter is enabled, a single ServiceHost instance is instantiated and initialized for each receive location.</span></span> <span data-ttu-id="db2c2-106">ServiceHost は受信 WCF メッセージを受け取る汎用サービスを実行し、受信 WCF メッセージを BizTalk メッセージに変換してから BizTalk メッセージ ボックス データベースサービスに公開します。</span><span class="sxs-lookup"><span data-stu-id="db2c2-106">The ServiceHost runs a generic service that accepts incoming WCF messages, and converts them to BizTalk messages before publishing them to the BizTalk MessageBox database.</span></span> <span data-ttu-id="db2c2-107">汎用的な ServiceHost サービスは WCF BizTalk 受信アダプター実装内部のサービスであり、型宣言が不要なコントラクトを公開します。</span><span class="sxs-lookup"><span data-stu-id="db2c2-107">The generic ServiceHost service is internal to the WCF BizTalk receive adapter implementation and exposes a typeless contract.</span></span> <span data-ttu-id="db2c2-108">WCF では、型宣言不要なコントラクトは WCF System.ServiceModel.Channel.Message 型の 1 つのパラメーターを使用する操作署名で構成されます。</span><span class="sxs-lookup"><span data-stu-id="db2c2-108">In WCF, a typeless contract consists of operation signatures that take a single parameter of type WCF System.ServiceModel.Channel.Message.</span></span>  
  
 <span data-ttu-id="db2c2-109">返されるデータがなくても、BizTalk 送信ポートからアクセスする場合は、WCF サービスの操作を IsOneWay=false としてマークする必要があります。</span><span class="sxs-lookup"><span data-stu-id="db2c2-109">The operation  of a WCF service should be marked as IsOneWay=false if they are to be accessed by a BizTalk send port even if there is no data to return.</span></span> <span data-ttu-id="db2c2-110">クライアント側コントラクトに対する操作には、IsOneWay=false および ReplyAction="\*" で注釈を付ける必要があります。</span><span class="sxs-lookup"><span data-stu-id="db2c2-110">The operations on the client-side contract should be annotated with IsOneWay=false and ReplyAction=”\*”.</span></span>  <span data-ttu-id="db2c2-111">また、クライアントからの呼び出しはすべて IsOneWay="false" でマークする必要があります。</span><span class="sxs-lookup"><span data-stu-id="db2c2-111">Additionally all calls from the client should be marked at IsOneWay=”false”.</span></span> <span data-ttu-id="db2c2-112">双方向のサービス操作はメッセージ型の値を返す場合があります。</span><span class="sxs-lookup"><span data-stu-id="db2c2-112">A two-way service operation may return a value of type Message.</span></span> <span data-ttu-id="db2c2-113">ただし、WCF-NetMsmq アダプターを使用する場合は例外です。これは、WCF-NetMsmq アダプターはメッセージを MSMQ キューに送信する一方向の操作を実行するためです。</span><span class="sxs-lookup"><span data-stu-id="db2c2-113">The exception to this is using the WCF-NetMsmq adapter since it executes a one-way operation that posts a message into an MSMQ queue.</span></span> <span data-ttu-id="db2c2-114">この場合、送信ポートは一方向になり、サービス操作は IsOneWay=true としてマークされます。</span><span class="sxs-lookup"><span data-stu-id="db2c2-114">In this case the send port can be one-way and any service operation marked as IsOneWay=true.</span></span>  
  
 <span data-ttu-id="db2c2-115">WCF では実際に void を返すメソッドで isOneWay=false OperationContract も定義できることから、混乱が生じる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="db2c2-115">It may be a little confusing that it is also possible in WCF to define an isOneWay=false OperationContract on a method that actually returns void.</span></span> <span data-ttu-id="db2c2-116">このような場合、実際には、WCF ランタイムによって作成されたメッセージが有線ネットワークで返されます。</span><span class="sxs-lookup"><span data-stu-id="db2c2-116">In such a situation there is actually a message returned on the wire created by the WCF runtime for you.</span></span>  
  
 <span data-ttu-id="db2c2-117">BizTalk WCF アダプターはこの機能を利用します。</span><span class="sxs-lookup"><span data-stu-id="db2c2-117">The BizTalk WCF adapters make use of this feature.</span></span> <span data-ttu-id="db2c2-118">一方向の BizTalk ポートを指定すると、実際には WCF アダプターの実装内で isOneWay=false の void メソッドを受け取ります。</span><span class="sxs-lookup"><span data-stu-id="db2c2-118">When you specify a one-way BizTalk port you actually get a void method with isOneWay=false within the implementation of the WCF adapter.</span></span> <span data-ttu-id="db2c2-119">重要なのは、HTTP や net.tcp などの直接チャネルを使用する場合、一方向の BizTalk ポートは実際には isOneWay=false OperationContract に対応することです。</span><span class="sxs-lookup"><span data-stu-id="db2c2-119">The point is that a BizTalk one-way port, when using a direct channel such as HTTP or net.tcp, will actually correspond to an isOneWay=false OperationContract.</span></span> <span data-ttu-id="db2c2-120">net.msmq などのキューに登録済みのチャネルでは、一方向の BizTalk ポートが isOneWay=true OperationContract と通信することがあるという点が異なります。</span><span class="sxs-lookup"><span data-stu-id="db2c2-120">Queued channels such as net.msmq are different in that a one-way BizTalk port does happen to talk to an isOneWay=true OperationContract.</span></span> <span data-ttu-id="db2c2-121">これは、WCF ディスパッチャーがチャネルに対してトランザクションを使用しているためです。</span><span class="sxs-lookup"><span data-stu-id="db2c2-121">The situation is different because the WCF dispatcher is using a transaction against the channel.</span></span>  
  
## <a name="how-do-you-create-and-use-a-custom-binding-with-a-wcf-custom-adapter"></a><span data-ttu-id="db2c2-122">WCF カスタム アダプターを使用してカスタム バインドを作成および使用する方法</span><span class="sxs-lookup"><span data-stu-id="db2c2-122">How do you create and use a custom binding with a WCF custom adapter?</span></span>  
 <span data-ttu-id="db2c2-123">WCF CustomBinding は BindingElement のコレクションで構成されています。</span><span class="sxs-lookup"><span data-stu-id="db2c2-123">A WCF CustomBinding consists of a collection of BindingElements.</span></span> <span data-ttu-id="db2c2-124">CustomBinding を作成するには、既存の BindingElement をまとめます (たとえば、既存のトランスポートと別のソースの既存のエンコーダーを組み合わせます)。</span><span class="sxs-lookup"><span data-stu-id="db2c2-124">A CustomBinding can be created by pulling together pre-existing BindingElements (for example, combining a pre-existing Transport with a pre-existing Encoder from another source).</span></span> <span data-ttu-id="db2c2-125">既存の BindingElement と新規に作成されたカスタム BindingElement を組み合わせて作成することもできます。</span><span class="sxs-lookup"><span data-stu-id="db2c2-125">Or it can be created by combining a pre-existing BindingElement with a newly written custom BindingElement.</span></span> <span data-ttu-id="db2c2-126">コードでは、プログラムによって BindingElement を追加することで、これらのコンポーネントから CustomBinding を作成できます。</span><span class="sxs-lookup"><span data-stu-id="db2c2-126">In code a CustomBinding can be built from these component BindingElements by adding them programmatically.</span></span> <span data-ttu-id="db2c2-127">WCF では .NET 構成 (config ファイル) を使用して構築することもできます。</span><span class="sxs-lookup"><span data-stu-id="db2c2-127">WCF also allows this construction through .NET Configuration (config files).</span></span> <span data-ttu-id="db2c2-128">BizTalk Server を使用することで、BizTalk WCF カスタム アダプターでこの CustomBinding を作成できます。</span><span class="sxs-lookup"><span data-stu-id="db2c2-128">By using BizTalk Server this CustomBinding can be created through the BizTalk WCF Custom adapter.</span></span>  
  
 <span data-ttu-id="db2c2-129">BizTalk WCF カスタム アダプターでは、BindingElement から新しいバインドを作成できるだけでなく、新しいバインドを直接構成することもできます。</span><span class="sxs-lookup"><span data-stu-id="db2c2-129">The BizTalk WCF Custom adapter not only allows you to build a new binding from BindingElements but also lets you configure a new binding directly.</span></span> <span data-ttu-id="db2c2-130">また、標準バインド上の動作を構成することもできます。</span><span class="sxs-lookup"><span data-stu-id="db2c2-130">It also allows you to configure behaviors on standard bindings.</span></span> <span data-ttu-id="db2c2-131">カスタム動作の作成は、新しい BindingElement オブジェクトの作成より簡単なため、これは特に便利です。</span><span class="sxs-lookup"><span data-stu-id="db2c2-131">This is particularly useful because writing custom behaviors is much easier than writing new BindingElements objects.</span></span>  
  
 <span data-ttu-id="db2c2-132">BindingElement の構築は複雑な開発作業であり、参照することはハイパーリンクで WCF サンプル"http://go.microsoft.com/fwlink/?LinkId=142449"\t"_blank"http://go.microsoft.com/fwlink/?LinkId=142449です。</span><span class="sxs-lookup"><span data-stu-id="db2c2-132">Building a BindingElement is an involved development exercise and the best source of reference for it is the WCF samples at  HYPERLINK "http://go.microsoft.com/fwlink/?LinkId=142449" \t "_blank" http://go.microsoft.com/fwlink/?LinkId=142449.</span></span> <span data-ttu-id="db2c2-133">カスタム BindingElement を作成するには、BindingElement から派生するクラスを作成します。</span><span class="sxs-lookup"><span data-stu-id="db2c2-133">To create a custom BindingElement you create a class that derives from BindingElement.</span></span> <span data-ttu-id="db2c2-134">新しい BindingElement は新しいアセンブリに含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="db2c2-134">A new BindingElement will have to be in a new assembly.</span></span> <span data-ttu-id="db2c2-135">このアセンブリは、BizTalk ホスト、送信ポート、および受信場所が構成される管理コンピューターのグローバル アセンブリ キャッシュ (GAC) にあらかじめインストールされている必要があります。</span><span class="sxs-lookup"><span data-stu-id="db2c2-135">This assembly must be installed into the Global Assembly Cache (GAC) of the administration computer where the BizTalk Host, send port, and receive location are configured.</span></span> <span data-ttu-id="db2c2-136">カスタム バインドを関連付ける特定の送信ポートまたは受信場所は、まずに追加する、 \<bindingElementExtensions\>同じコンピューター上の machine.config ファイルのセクションでします。</span><span class="sxs-lookup"><span data-stu-id="db2c2-136">To associate a custom binding with a specific send port or receive location, you first need to add it to the \<bindingElementExtensions\> section of the machine.config file on the same computer.</span></span>  
  
 <span data-ttu-id="db2c2-137">開くことができますし、その変更を行った後、 **トランスポートのプロパティの構成** ダイアログ ボックスをバインドを構成します。</span><span class="sxs-lookup"><span data-stu-id="db2c2-137">After making that change you can then bring up the **Transport Properties Configuration** dialog box to configure the binding.</span></span>  
  
1.  <span data-ttu-id="db2c2-138">**バインド** ] タブの [バインドの種類、select **customBinding**します。</span><span class="sxs-lookup"><span data-stu-id="db2c2-138">On the **Binding** tab, for Binding type, select **customBinding**.</span></span>  
  
2.  <span data-ttu-id="db2c2-139">**バインド**  ウィンドウを右クリックして **CustomBindingElement**, を選択して **拡張機能の追加**します。</span><span class="sxs-lookup"><span data-stu-id="db2c2-139">In the **Binding** pane, right-click **CustomBindingElement**, and select **Add Extension**.</span></span>  
  
3.  <span data-ttu-id="db2c2-140">machine.config ファイルで指定したバインド要素を選択し、必要に応じてバインドを構成します。</span><span class="sxs-lookup"><span data-stu-id="db2c2-140">Select the binding element you specified in the machine.config file and configure the binding as required.</span></span> <span data-ttu-id="db2c2-141">これで、メッセージの送信または受信に使用する準備ができました。</span><span class="sxs-lookup"><span data-stu-id="db2c2-141">It is now ready to use for message transmission or receipt.</span></span>  
  
 <span data-ttu-id="db2c2-142">この方法でカスタム バインドが追加された場合、BizTalk で行われる検証は非常に限られたものです。</span><span class="sxs-lookup"><span data-stu-id="db2c2-142">BizTalk does very limited validation for a custom binding when it has been added in this manner.</span></span> <span data-ttu-id="db2c2-143">このため、バインド要素が正しい順序で表示されるようにすることが重要です。</span><span class="sxs-lookup"><span data-stu-id="db2c2-143">Therefore, it is important to ensure the binding elements are listed in the correct order.</span></span> <span data-ttu-id="db2c2-144">実行時に初めて呼び出すバインド要素は、ダイアログ ボックスの CustomBindingElement バインド ツリーの下部に配置する必要があります。</span><span class="sxs-lookup"><span data-stu-id="db2c2-144">The binding element you want invoked first at runtime must be on the bottom of the CustomBindingElement binding tree in the dialog box.</span></span> <span data-ttu-id="db2c2-145">BindingElement の一覧にはトランスポートが含まれている必要があります。トランスポートは一覧の下部に配置する必要があります。</span><span class="sxs-lookup"><span data-stu-id="db2c2-145">The list of BindingElements must contain a Transport and that Transport must be at the bottom of the list.</span></span> <span data-ttu-id="db2c2-146">一連の BindingElement にエンコーダーが含まれる場合もあります。</span><span class="sxs-lookup"><span data-stu-id="db2c2-146">The set of BindingElements may also contain an Encoder.</span></span> <span data-ttu-id="db2c2-147">詳細については、バインド要素に関する WCF ドキュメントを参照してください。 [ http://go.microsoft.com/fwlink/?LinkId=142449](http://go.microsoft.com/fwlink/?LinkId=142449)です。</span><span class="sxs-lookup"><span data-stu-id="db2c2-147">For more information, see the WCF documentation on binding elements at [http://go.microsoft.com/fwlink/?LinkId=142449](http://go.microsoft.com/fwlink/?LinkId=142449).</span></span>  
  
## <a name="what-is-a-wcf-custom-behavior-and-how-do-i-use-one-with-biztalk-server"></a><span data-ttu-id="db2c2-148">WCF カスタム動作についての説明と WCF カスタム動作の BizTalk Server における使用方法</span><span class="sxs-lookup"><span data-stu-id="db2c2-148">What is a WCF custom behavior and how do I use one with BizTalk Server?</span></span>  
 <span data-ttu-id="db2c2-149">WCF をメッセージ通信メカニズムとして使用する利点の 1 つは、カスタム コードを使用することでサービスの機能を拡張できる点です。</span><span class="sxs-lookup"><span data-stu-id="db2c2-149">One of the advantages of using WCF as a message communication mechanism is the opportunity to extend the functionality of its services by using custom code.</span></span> <span data-ttu-id="db2c2-150">カスタム動作拡張機能は、市場の他の Web サービス テクノロジにはない、WCF の機能の 1 つです。</span><span class="sxs-lookup"><span data-stu-id="db2c2-150">Custom behavior extensions are one of the features that differentiate WCF from other Web services technologies in the market.</span></span>  
  
 <span data-ttu-id="db2c2-151">WCF メッセージのフロー内には、メッセージが最終送信先に到達する前にカスタム処理を傍受および実行する別のポイントもあります。</span><span class="sxs-lookup"><span data-stu-id="db2c2-151">There are different points within the flow of a WCF message to intercept and execute custom processing before a message reaches its final destination.</span></span> <span data-ttu-id="db2c2-152">WCF カスタム動作拡張機能はこのような種類の傍受メカニズムの 1 つであり、細分化されたさまざまなレベルで WCF サービスまたはクライアント機能を拡張するために使用できます。</span><span class="sxs-lookup"><span data-stu-id="db2c2-152">WCF custom behavior extensions are one such type of interception mechanism and can be used to extend WCF service or client functionality at different levels of granularity.</span></span> <span data-ttu-id="db2c2-153">カスタム動作拡張機能は、WCF サービス レベルとクライアント レベルの両方で設定できます。</span><span class="sxs-lookup"><span data-stu-id="db2c2-153">Custom behavior extensions can exist at both the WCF service and client levels.</span></span> <span data-ttu-id="db2c2-154">WCF サービスへのコール スタックで動作を構成しても、呼び出しに使用される通信バインドには影響しません。</span><span class="sxs-lookup"><span data-stu-id="db2c2-154">Configuring a behavior on the call stack to a WCF service has no influence on the communication binding used to make the call.</span></span> <span data-ttu-id="db2c2-155">実際には、動作はサービスが公開するメタデータ内に表示されないため、通常はクライアントに対しては表示されません。</span><span class="sxs-lookup"><span data-stu-id="db2c2-155">In fact, behaviors are typically invisible to the client because they are not displayed in the metadata a service publishes.</span></span> <span data-ttu-id="db2c2-156">通常、WCF 操作の呼び出し中に動作が実行されていることは、クライアントにはわかりません。</span><span class="sxs-lookup"><span data-stu-id="db2c2-156">The client typically has no idea that the behaviors are executing during a call to a WCF operation.</span></span>  
  
 <span data-ttu-id="db2c2-157">WCF サービスの呼び出しでカスタム処理を簡単に実装する機能は、Web アプリケーション間の他の通信方法と比較して、WCF が機能豊富なプログラミング パラダイムである主な理由の 1 つです。</span><span class="sxs-lookup"><span data-stu-id="db2c2-157">The ability to easily implement custom processing in a call to a WCF service is one of the main reasons why WCF is such a rich programming paradigm compared to other ways of communication between Web applications.</span></span> <span data-ttu-id="db2c2-158">このカスタム処理は、Web アプリケーション内の拡張機能要件で必要とされる、ほぼすべての形式に対応できます。</span><span class="sxs-lookup"><span data-stu-id="db2c2-158">This custom processing can take almost any form as dictated by extensibility requirements within a Web application.</span></span> <span data-ttu-id="db2c2-159">開発者は、サービス構成を調査および検証したり、WCF クライアント アプリケーションおよびサービス アプリケーションの実行時の動作を変更したりするカスタム拡張機能を作成できます。</span><span class="sxs-lookup"><span data-stu-id="db2c2-159">Developers can create custom extensions that inspect and validate service configuration or modify runtime behavior in WCF client and service applications.</span></span> <span data-ttu-id="db2c2-160">動作では、通常のメッセージ処理を補完する、処理中にメッセージを変更する、特定の構成条件を精査して適切なアクションを実行する、呼び出し側の ID を確認して問題がなければメッセージを渡す、などを実行できます。これは完全にカスタム処理メカニズムであるため、アプリケーションに必要であればどのような拡張でも実装できます。</span><span class="sxs-lookup"><span data-stu-id="db2c2-160">Behaviors can supplement normal message processing, modify the message during processing, scrutinize certain configuration criteria and take appropriate action, validate identities of the caller and pass the message on if it is successful, etc. Because it is truly a custom processing mechanism you implement whatever extensibility your application needs.</span></span>  
  
 <span data-ttu-id="db2c2-161">BizTalk Server で WCF カスタム動作を使用する、構成することを使用して、 **動作** 受信場所または送信ポートの Wcf-custom または Wcf-customisolated アダプターのタブをクリックします。</span><span class="sxs-lookup"><span data-stu-id="db2c2-161">To use a WCF custom behavior in BizTalk Server you will configure it by using the **Behavior** tab for the WCF-Custom or WCF-CustomIsolated adapter for a receive location or a send port.</span></span>