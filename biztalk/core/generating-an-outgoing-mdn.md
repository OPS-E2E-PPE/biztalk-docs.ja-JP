---
title: 送信 MDN の生成 |Microsoft ドキュメント
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 12d7da1c-0d3c-42d4-9388-29f499353d13
caps.latest.revision: 20
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: a903cc72a41362f6843449a4d635878706f2ea1e
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/20/2017
ms.locfileid: "22247954"
---
# <a name="generating-an-outgoing-mdn"></a>送信 MDN の生成
AS2 受信パイプラインは、受信メッセージに対する MDN (Message Disposition Notification) 応答を生成します。 これは、AS2EDIReceive 受信パイプラインの EDI 逆アセンブラー パイプライン コンポーネント (EDI エンコード メッセージに応答する場合) または AS2Receive 受信パイプラインの AS2 逆アセンブラー パイプライン コンポーネント (EDI でエンコードされていないメッセージに応答する場合) によって行われます。  
  
## <a name="when-and-how-an-mdn-is-generated"></a>MDN の生成のタイミングと方法  
 MDN は、通常、元の AS2 メッセージの AS2 ヘッダーに基づいて次のように生成されます。  
  
-   MDN は、AS2 メッセージに Disposition-Notification-To ヘッダーがある場合に送信されます。  
  
-   メッセージに Disposition-Notification-To ヘッダーと Receipt-Delivery-Option ヘッダーがある場合、MDN は非同期に送信されます。 このとき、元のメッセージとは別の接続を経由して、Receipt-Delivery-Option ヘッダーにある URL に送信されます。  
  
-   メッセージに Disposition-Notification-To ヘッダーがあって Receipt-Delivery-Option ヘッダーがない場合、MDN は元のメッセージと同じ接続を経由して同期的に送信されます。  
  
 逆アセンブラーは、受信した AS2 メッセージの AS2-To ヘッダーから MDN の AS2-From ヘッダーを作成し、受信した AS2 メッセージの AS2-From ヘッダーから MDN の AS2-To ヘッダーを作成します。  
  
 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] では、これらの設定を上書きして、MDN を生成するかどうか、および、パーティの AS2 アグリーメントのプロパティに基づいてどのように MDN を生成するかを指定できます。 使用して、メッセージの AS2 ヘッダーの設定を上書きする、**検証および MDN に対してメッセージ ヘッダーの代わりにアグリーメントの設定を使用して**の一方向の AS2 アグリーメント タブのプロパティ、**アグリーメントのプロパティ** ダイアログ ボックス。 このプロパティを使用すると、AS2 ヘッダーで要求されていない場合に MDN を送信することも、AS2 ヘッダーで同期接続が指定されている場合に MDN を非同期に送信することもできます。  
  
 設定した場合、**検証および MDN に対してメッセージ ヘッダーの代わりにアグリーメントの設定を使用して**内の値、プロパティ、 **mdn を要求する**のセクションで、**送信者の MDN 設定**ページ一方向の AS2 アグリーメント タブで、**アグリーメントのプロパティ**ダイアログ ボックスは、MDN の次のように使用されます。  
  
-   場合、MDN が送信されます、 **mdn を要求する**プロパティが選択されています。  
  
-   場合、 **mdn を要求する**プロパティが選択されていると、**非同期 MDN を要求する**プロパティが選択されている MDN は非同期に送信されます場合、。 MDN は、URL に送信すること、 **- Receipt-delivery-option (URL)** プロパティが、元のメッセージよりも別の接続をします。  
  
-   場合、 **mdn を要求する**プロパティが選択されているが、**非同期 MDN を要求する**プロパティが選択されていない、元のメッセージと同じ接続経由で MDN が同期的に送信されます。  
  
 場合、**検証および MDN に対してメッセージ ヘッダーの代わりにアグリーメントの設定を使用して**プロパティが設定されて、AS2-で MDN が AS2 を生成するプロパティ、メッセージのヘッダーが使用されます-には、アグリーメントのプロパティから取得し、パイプラインに従って MDN に署名する、**要求の署名付き mdn する**プロパティです。 AS2 ヘッダーとアグリーメントのプロパティの対応は次のとおりです。  
  
|アグリーメントのプロパティ|メッセージの AS2 ヘッダー|  
|------------------------|-------------------------------|  
|MDN を生成する|Disposition-Notification-To|  
|MDN に署名を付ける|Signed-Receipt-Protocol|  
|Receipt-Delivery-Option|Receipt-Delivery-Option|  
  
 MDN が有効にされている場合、受信パイプラインは次のコンテキスト プロパティを昇格させます。  
  
-   `EdiIntAS.DispositionMode`  
  
-   `EdiIntAS.DispositionType`  
  
 MDN を生成するには、これらのコンテキスト プロパティを両方とも昇格させる必要があります。 これらのコンテキスト プロパティの詳細については、次を参照してください。 [AS2 コンテキスト プロパティ](../core/as2-context-properties.md)です。  
  
 受信メッセージの構成設定とヘッダーの間に一貫性がない場合、パイプラインは否定 MDN を生成します。  
  
 アグリーメントのプロパティで MDN が要求されている場合、受信パイプラインは AS2 の処理中にエラーが発生しても MDN の送信を試みます。  
  
## <a name="how-the-receive-pipeline-processes-a-generated-mdn"></a>生成された MDN の受信パイプラインでの処理方法  
 上記のルールに従って MDN が生成されている場合、AS2EDIReceive 受信パイプラインまたは AS2Receive 受信パイプラインは次のように MDN を処理します。  
  
-   MDN (ワイヤ形式) のコピーを作成し、否認不可データベースに保存します (一方向の AS2 アグリーメント プロパティで有効になっている場合)。  
  
-   デジタル署名の適用を含む MIME 処理を実行します (一方向の AS2 アグリーメント プロパティで有効になっている場合)。  
  
-   AS2 メッセージ ペイロードの MIC (メッセージ整合性チェック) を計算し、その結果を MDN の Received-content-MIC 拡張フィールドに追加します。 MIC は、受信メッセージの署名確認メッセージ micalg ヘッダーによって決定されますに適用されるアルゴリズムまたは**署名アルゴリズム**プロパティを**送信者の MDN 設定**一方向のページアグリーメントのタブの**アグリーメントのプロパティ** ダイアログ ボックス (受信メッセージのプロパティがオーバーライドされる) とします。 SHA1 または MD5 のどちらかが適用されます。 このアルゴリズムの値も、MDN に含まれます。  
  
-   否認不可データベースに関連付けのエントリを作成します。  
  
-   MDN メッセージのコピーを作成します。  
  
-   MDN を同期的に送信する場合、パイプラインは `EdiIntAS.IsAS2AsynchronousMDN` プロパティを False に設定します。非同期に送信する場合は、このプロパティを True に設定します。  
  
-   MDN を同期的に送信する場合、双方向受信ポートに関連付けられている AS2Send 送信パイプラインは `EdiIntAS.IsAS2AsynchronousMDN` プロパティ (False に設定) に基づいて MDN を取得し、関連付けトークンも取得します。  
  
    > [!NOTE]
    >  送信同期 MDN をサブスクライブする送信ポートを設定することもできます。 そのためには、送信ポートのフィルターを `EdiIntAS.IsAS2MdnResponseMessage==True` に設定します。  
  
-   MDN を非同期に送信する場合、受信パイプラインは MDN をメッセージ ボックスにルーティングします。 送信ポート フィルターを `IsAS2AsynchronousMdn==True` に設定して、MDN をサブスクライブする送信ポートを設定する必要があります。 AS2Send 送信パイプラインは、そのプロパティに基づいてメッセージを取得し、関連付けトークンも取得します。 動的送信ポートの場合、送信ポートは、メッセージのヘッダーにある Receipt-Delivery-Notification 行のアドレスに基づいて MDN をルーティングします。 静的送信ポートの場合、送信ポートは、送信ポートの "URI を転送する" プロパティに基づいてメッセージをルーティングします。  
  
## <a name="mdn-generation-rules"></a>MDN の生成ルール  
 MDN の生成には、次のルールが適用されます。  
  
-   メッセージの送信者が確認メッセージ (署名付き) を要求しているが、メッセージのコンテンツの処理中にエラーが発生した場合、メッセージの受信者は、トランザクション自体が無効になっても確認メッセージ (署名付き) を返す必要があります。 メッセージのコンテンツの処理中に発生したエラーの理由が、"disposition-field" に設定される必要があります。  
  
-   MDN 確認メッセージの要求で署名付きの確認メッセージが明示的に指定されているが、元のメッセージの受信者が要求されたプロトコル形式または要求された MIC アルゴリズムをサポートしていない場合、受信者は署名付きまたは署名なしの確認メッセージを返す必要があります。  
  
-   署名が明示的に要求されていない場合や、署名付きの確認メッセージの要求パラメーターが受信側パーティのアグリーメントで認識されない場合、受信側パーティは、署名付きまたは署名なしの確認メッセージを返すか、確認メッセージを返しません。  
  
## <a name="mic-generation"></a>MIC の生成  
 MDN が要求されている場合、元のメッセージの受信者は MIC (メッセージ整合性チェック) を生成して MDN に追加します。 EDI インターチェンジがマルチパートの MIME コンテンツ タイプの一部では、EDI インターチェンジと MIME ヘッダーを含む、マルチパート コンテンツ全体にまたがる MIC を計算する必要があります。 暗号化された署名されていないメッセージでは、返される MIC は、解読された MIME ヘッダーとコンテンツに基づいて計算されます。 署名も暗号化もされていないメッセージでは、MIC は、MIME ヘッダーを含まないメッセージのコンテンツに基づいて計算される必要があります。  
  
## <a name="see-also"></a>参照  
 [BizTalk Server が AS2 メッセージを受信する方法](../core/how-biztalk-server-receives-as2-messages.md)