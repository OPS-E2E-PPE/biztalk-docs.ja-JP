---
title: 送信 MDN の生成 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 12d7da1c-0d3c-42d4-9388-29f499353d13
caps.latest.revision: 20
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: a002383265b0b8d4001c89f61131c6749668cdd6
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/07/2019
ms.locfileid: "65345219"
---
# <a name="generating-an-outgoing-mdn"></a><span data-ttu-id="c64ad-102">送信 MDN の生成</span><span class="sxs-lookup"><span data-stu-id="c64ad-102">Generating an Outgoing MDN</span></span>
<span data-ttu-id="c64ad-103">AS2 受信パイプラインは、受信メッセージに対する MDN (Message Disposition Notification) 応答を生成します。</span><span class="sxs-lookup"><span data-stu-id="c64ad-103">The AS2 receive pipelines generate an MDN (Message Disposition Notification) response for an incoming message.</span></span> <span data-ttu-id="c64ad-104">これは、AS2EDIReceive 受信パイプラインの EDI 逆アセンブラー パイプライン コンポーネント (EDI エンコード メッセージに応答する場合) または AS2Receive 受信パイプラインの AS2 逆アセンブラー パイプライン コンポーネント (EDI でエンコードされていないメッセージに応答する場合) によって行われます。</span><span class="sxs-lookup"><span data-stu-id="c64ad-104">This is performed by the EDI Disassembler pipeline component in the AS2EDIReceive receive pipeline (in response to an EDI-encoded message) or the AS2 Disassembler pipeline component in the AS2Receive receive pipeline (in response to a non-EDI-encoded message).</span></span>  
  
## <a name="when-and-how-an-mdn-is-generated"></a><span data-ttu-id="c64ad-105">MDN の生成のタイミングと方法</span><span class="sxs-lookup"><span data-stu-id="c64ad-105">When and How an MDN is Generated</span></span>  
 <span data-ttu-id="c64ad-106">MDN は、通常、元の AS2 メッセージの AS2 ヘッダーに基づいて次のように生成されます。</span><span class="sxs-lookup"><span data-stu-id="c64ad-106">An MDN is normally generated based upon the AS2 headers in the original AS2 message, as follows:</span></span>  
  
- <span data-ttu-id="c64ad-107">MDN は、AS2 メッセージに Disposition-Notification-To ヘッダーがある場合に送信されます。</span><span class="sxs-lookup"><span data-stu-id="c64ad-107">An MDN will be sent if the Disposition-Notification-To header is present in the AS2 message.</span></span>  
  
- <span data-ttu-id="c64ad-108">メッセージに Disposition-Notification-To ヘッダーと Receipt-Delivery-Option ヘッダーがある場合、MDN は非同期に送信されます。</span><span class="sxs-lookup"><span data-stu-id="c64ad-108">If the Disposition-Notification-To header and the Receipt-Delivery-Option header are present in the message, the MDN will be sent asynchronously.</span></span> <span data-ttu-id="c64ad-109">このとき、元のメッセージとは別の接続を経由して、Receipt-Delivery-Option ヘッダーにある URL に送信されます。</span><span class="sxs-lookup"><span data-stu-id="c64ad-109">It will be sent to the URL in the Receipt-Delivery-Option header, over a different connection than the original message.</span></span>  
  
- <span data-ttu-id="c64ad-110">メッセージに Disposition-Notification-To ヘッダーがあって Receipt-Delivery-Option ヘッダーがない場合、MDN は元のメッセージと同じ接続を経由して同期的に送信されます。</span><span class="sxs-lookup"><span data-stu-id="c64ad-110">If the Disposition-Notification-To header is present in the message, but the Receipt-Delivery-Option header is not present in the message, the MDN will be sent synchronously over the same connection as the original message.</span></span>  
  
  <span data-ttu-id="c64ad-111">逆アセンブラーは、受信した AS2 メッセージの AS2-To ヘッダーから MDN の AS2-From ヘッダーを作成し、受信した AS2 メッセージの AS2-From ヘッダーから MDN の AS2-To ヘッダーを作成します。</span><span class="sxs-lookup"><span data-stu-id="c64ad-111">The Disassembler creates the AS2-From header in the MDN from the AS2-To header in the received AS2 message, and it creates the AS2-To header in the MDN from the AS2-From header in the received AS2 message.</span></span>  
  
  <span data-ttu-id="c64ad-112">  [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] では、これらの設定をオーバーライドして、MDN を生成するかどうか、および、パーティの AS2 アグリーメントのプロパティに基づいてどのように MDN を生成するかを指定できます。</span><span class="sxs-lookup"><span data-stu-id="c64ad-112">[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] enables you to override these settings, specifying whether an MDN will be generated and how it will be generated based upon a party's AS2 agreement properties.</span></span> <span data-ttu-id="c64ad-113">使用して、メッセージの AS2 ヘッダーの設定を上書きする、**検証および MDN に対してメッセージ ヘッダーの代わりにアグリーメントの設定を使用して**の一方向の AS2 アグリーメント タブのプロパティ、**アグリーメントのプロパティ** ダイアログ ボックス。</span><span class="sxs-lookup"><span data-stu-id="c64ad-113">You override the AS2 header settings in the message using the **Use agreement settings for validation and MDN instead of message header** property in the one-way AS2 agreement tab of the **Agreement Properties** dialog box.</span></span> <span data-ttu-id="c64ad-114">このプロパティを使用すると、AS2 ヘッダーで要求されていない場合に MDN を送信することも、AS2 ヘッダーで同期接続が指定されている場合に MDN を非同期に送信することもできます。</span><span class="sxs-lookup"><span data-stu-id="c64ad-114">This property enables you to send an MDN even if the AS2 header does not call for one, or to send the MDN asynchronously when the AS2 header specifies a synchronous connection.</span></span>  
  
  <span data-ttu-id="c64ad-115">設定した場合、**検証および MDN に対してメッセージ ヘッダーの代わりにアグリーメントの設定を使用して**内の値、プロパティ、 **mdn を要求する**のセクション、**送信者の MDN 設定**ページ一方向の AS2 アグリーメント タブで、**アグリーメントのプロパティ**ダイアログ ボックスは、MDN の次のように使用されます。</span><span class="sxs-lookup"><span data-stu-id="c64ad-115">If you set the **Use agreement settings for validation and MDN instead of message header** property, the values in the **Request MDN** section of the **Sender MDN Settings** page in the one-way AS2 agreement tab of the **Agreement Properties** dialog box will be used for the MDN, as follows:</span></span>  
  
- <span data-ttu-id="c64ad-116">場合、MDN が送信される、 **mdn を要求する**プロパティが選択されています。</span><span class="sxs-lookup"><span data-stu-id="c64ad-116">An MDN will be sent if the **Request MDN** property is selected.</span></span>  
  
- <span data-ttu-id="c64ad-117">場合、 **mdn を要求する**プロパティが選択されていると、**非同期 MDN を要求する**プロパティが選択されている MDN は非同期に送信されます場合、。</span><span class="sxs-lookup"><span data-stu-id="c64ad-117">If the **Request MDN** property is selected, and the **Request asynchronous MDN** property is selected, the MDN will be sent asynchronously.</span></span> <span data-ttu-id="c64ad-118">URL に、MDN が送信されますが、 **- Receipt-delivery-option (URL)** プロパティは、元のメッセージとは別の接続上に、設定します。</span><span class="sxs-lookup"><span data-stu-id="c64ad-118">The MDN will be sent to the URL that the **Receipt-Delivery-Option (URL)** property is set to, over a different connection than the original message.</span></span>  
  
- <span data-ttu-id="c64ad-119">場合、 **mdn を要求する**プロパティが選択されているが、**非同期 MDN を要求する**プロパティが選択されていない、元のメッセージと同じ接続経由で MDN が同期的に送信されます。</span><span class="sxs-lookup"><span data-stu-id="c64ad-119">If the **Request MDN** property is selected, but the **Request asynchronous MDN** property is not selected, the MDN will be sent synchronously over the same connection as the original message.</span></span>  
  
  <span data-ttu-id="c64ad-120">場合、**検証および MDN に対してメッセージ ヘッダーの代わりにアグリーメントの設定を使用して**プロパティを設定、AS2-で MDN が AS2 を生成するプロパティ、メッセージのヘッダーが使用されます-にはアグリーメントのプロパティから取得し、パイプラインはに従って MDN に署名、**署名付き MDN を要求**プロパティ。</span><span class="sxs-lookup"><span data-stu-id="c64ad-120">If the **Use agreement settings for validation and MDN instead of message header** property is set, the AS2-From property in the message header will be used in generating the MDN, but AS2-To will be taken from the agreement properties, and the pipeline will sign the MDN according to the **Request Signed MDN** property.</span></span> <span data-ttu-id="c64ad-121">AS2 ヘッダーとアグリーメントのプロパティの対応は次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="c64ad-121">The AS2 headers correspond to the agreement properties as follows:</span></span>  
  
|<span data-ttu-id="c64ad-122">アグリーメントのプロパティ</span><span class="sxs-lookup"><span data-stu-id="c64ad-122">Agreement Property</span></span>|<span data-ttu-id="c64ad-123">メッセージの AS2 ヘッダー</span><span class="sxs-lookup"><span data-stu-id="c64ad-123">AS2 Header in the Message</span></span>|  
|------------------------|-------------------------------|  
|<span data-ttu-id="c64ad-124">MDN を生成する</span><span class="sxs-lookup"><span data-stu-id="c64ad-124">Generate MDN</span></span>|<span data-ttu-id="c64ad-125">Disposition-Notification-To</span><span class="sxs-lookup"><span data-stu-id="c64ad-125">Disposition-Notification-To</span></span>|  
|<span data-ttu-id="c64ad-126">MDN に署名を付ける</span><span class="sxs-lookup"><span data-stu-id="c64ad-126">Sign MDN</span></span>|<span data-ttu-id="c64ad-127">Signed-Receipt-Protocol</span><span class="sxs-lookup"><span data-stu-id="c64ad-127">Signed-Receipt-Protocol</span></span>|  
|<span data-ttu-id="c64ad-128">Receipt-Delivery-Option</span><span class="sxs-lookup"><span data-stu-id="c64ad-128">Receipt-Delivery-Option</span></span>|<span data-ttu-id="c64ad-129">Receipt-Delivery-Option</span><span class="sxs-lookup"><span data-stu-id="c64ad-129">Receipt-Delivery-Option</span></span>|  
  
 <span data-ttu-id="c64ad-130">MDN が有効にされている場合、受信パイプラインは次のコンテキスト プロパティを昇格させます。</span><span class="sxs-lookup"><span data-stu-id="c64ad-130">If an MDN is enabled, the receive pipeline will promote the following context properties:</span></span>  
  
- `EdiIntAS.DispositionMode`  
  
- `EdiIntAS.DispositionType`  
  
  <span data-ttu-id="c64ad-131">MDN を生成するには、これらのコンテキスト プロパティを両方とも昇格させる必要があります。</span><span class="sxs-lookup"><span data-stu-id="c64ad-131">Both of these context properties must be promoted in order for the MDN to be generated.</span></span> <span data-ttu-id="c64ad-132">これらのコンテキスト プロパティの詳細については、次を参照してください。 [AS2 コンテキスト プロパティ](../core/as2-context-properties.md)します。</span><span class="sxs-lookup"><span data-stu-id="c64ad-132">For more information about these context properties, see [AS2 Context Properties](../core/as2-context-properties.md).</span></span>  
  
  <span data-ttu-id="c64ad-133">受信メッセージの構成設定とヘッダーの間に一貫性がない場合、パイプラインは否定 MDN を生成します。</span><span class="sxs-lookup"><span data-stu-id="c64ad-133">If the configuration settings and the headers in the incoming message are inconsistent, the pipeline will generate a negative MDN.</span></span>  
  
  <span data-ttu-id="c64ad-134">アグリーメントのプロパティで MDN が要求されている場合、受信パイプラインは AS2 の処理中にエラーが発生しても MDN の送信を試みます。</span><span class="sxs-lookup"><span data-stu-id="c64ad-134">If the MDN is requested in the agreement properties, the receive pipeline will attempt to send an MDN even if an error occurs in AS2 processing.</span></span>  
  
## <a name="how-the-receive-pipeline-processes-a-generated-mdn"></a><span data-ttu-id="c64ad-135">生成された MDN の受信パイプラインでの処理方法</span><span class="sxs-lookup"><span data-stu-id="c64ad-135">How the Receive Pipeline Processes a Generated MDN</span></span>  
 <span data-ttu-id="c64ad-136">上記のルールに従って MDN が生成されている場合、AS2EDIReceive 受信パイプラインまたは AS2Receive 受信パイプラインは次のように MDN を処理します。</span><span class="sxs-lookup"><span data-stu-id="c64ad-136">If an MDN is generated according to the above rules, the AS2EDIReceive or AS2Receive receive pipeline will process the MDN as follows:</span></span>  
  
-   <span data-ttu-id="c64ad-137">MDN (ワイヤ形式) のコピーを作成し、否認不可データベースに保存します (一方向の AS2 アグリーメント プロパティで有効になっている場合)。</span><span class="sxs-lookup"><span data-stu-id="c64ad-137">Makes a copy of the MDN (in wire format), and stores it in the non-repudiation database, if enabled in the one-way AS2 agreement properties.</span></span>  
  
-   <span data-ttu-id="c64ad-138">デジタル署名の適用を含む MIME 処理を実行します (一方向の AS2 アグリーメント プロパティで有効になっている場合)。</span><span class="sxs-lookup"><span data-stu-id="c64ad-138">Performs MIME processing, including applying a digital signature, if enabled in the one-way AS2 agreement properties.</span></span>  
  
-   <span data-ttu-id="c64ad-139">AS2 メッセージ ペイロードの MIC (メッセージ整合性チェック) を計算し、その結果を MDN の Received-content-MIC 拡張フィールドに追加します。</span><span class="sxs-lookup"><span data-stu-id="c64ad-139">Calculates the MIC (Message Integrity Check) for the AS2 message payload and appends it to the Received-content-MIC extension field of the MDN.</span></span> <span data-ttu-id="c64ad-140">MIC は、受信メッセージの署名された受領書 micalg ヘッダーによって決定されます適用されるアルゴリズムまたは**署名アルゴリズム**プロパティを、**送信者の MDN 設定**、一方向のページ。アグリーメント タブの**アグリーメントのプロパティ** ダイアログ ボックス (受信メッセージのプロパティがオーバーライドされる) とします。</span><span class="sxs-lookup"><span data-stu-id="c64ad-140">The algorithm to be applied for the MIC is determined by the signed-receipt-micalg header of the incoming message or the **Signing Algorithm** property on the **Sender MDN Settings** page of the one-way agreement tab of the **Agreement Properties** dialog box (when the inbound message properties are overridden).</span></span> <span data-ttu-id="c64ad-141">SHA1 または MD5 のどちらかが適用されます。</span><span class="sxs-lookup"><span data-stu-id="c64ad-141">It can be either SHA1 or MD5.</span></span> <span data-ttu-id="c64ad-142">このアルゴリズムの値も、MDN に含まれます。</span><span class="sxs-lookup"><span data-stu-id="c64ad-142">The value of the algorithm is also included in the MDN.</span></span>  
  
-   <span data-ttu-id="c64ad-143">否認不可データベースに関連付けのエントリを作成します。</span><span class="sxs-lookup"><span data-stu-id="c64ad-143">Makes correlation entries in the non-repudiation database.</span></span>  
  
-   <span data-ttu-id="c64ad-144">MDN メッセージのコピーを作成します。</span><span class="sxs-lookup"><span data-stu-id="c64ad-144">Makes a copy of the MDN message.</span></span>  
  
-   <span data-ttu-id="c64ad-145">MDN を同期的に送信する場合、パイプラインは `EdiIntAS.IsAS2AsynchronousMDN` プロパティを False に設定します。非同期に送信する場合は、このプロパティを True に設定します。</span><span class="sxs-lookup"><span data-stu-id="c64ad-145">If the MDN is to be transmitted synchronously, the pipeline sets the `EdiIntAS.IsAS2AsynchronousMDN` property to False; if asynchronously, it sets the property to True.</span></span>  
  
-   <span data-ttu-id="c64ad-146">MDN を同期的に送信する場合、双方向受信ポートに関連付けられている AS2Send 送信パイプラインは `EdiIntAS.IsAS2AsynchronousMDN` プロパティ (False に設定) に基づいて MDN を取得し、関連付けトークンも取得します。</span><span class="sxs-lookup"><span data-stu-id="c64ad-146">If the MDN is to be transmitted synchronously, the AS2Send send pipeline associated with the two-way receive port will pick up the MDN based upon the `EdiIntAS.IsAS2AsynchronousMDN` property (set to False) and the correlation tokens.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="c64ad-147">送信同期 MDN をサブスクライブする送信ポートを設定することもできます。</span><span class="sxs-lookup"><span data-stu-id="c64ad-147">You can also set up a send port that subscribes to the outgoing synchronous MDN.</span></span> <span data-ttu-id="c64ad-148">そのためには、送信ポートのフィルターを `EdiIntAS.IsAS2MdnResponseMessage==True` に設定します。</span><span class="sxs-lookup"><span data-stu-id="c64ad-148">To do so, set the send port filter to `EdiIntAS.IsAS2MdnResponseMessage==True`.</span></span>  
  
-   <span data-ttu-id="c64ad-149">MDN を非同期に送信する場合、受信パイプラインは MDN をメッセージ ボックスにルーティングします。</span><span class="sxs-lookup"><span data-stu-id="c64ad-149">If the MDN is to be transmitted asynchronously, the receive pipeline routes the MDN to the MessageBox.</span></span> <span data-ttu-id="c64ad-150">送信ポート フィルターを `IsAS2AsynchronousMdn==True` に設定して、MDN をサブスクライブする送信ポートを設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c64ad-150">You must set up a send port to subscribe to the MDN, setting the send port filter to `IsAS2AsynchronousMdn==True`.</span></span> <span data-ttu-id="c64ad-151">AS2Send 送信パイプラインは、そのプロパティに基づいてメッセージを取得し、関連付けトークンも取得します。</span><span class="sxs-lookup"><span data-stu-id="c64ad-151">The AS2Send send pipeline picks up the message based upon that property and the correlation tokens.</span></span> <span data-ttu-id="c64ad-152">動的送信ポートの場合、送信ポートは、メッセージのヘッダーにある Receipt-Delivery-Notification 行のアドレスに基づいて MDN をルーティングします。</span><span class="sxs-lookup"><span data-stu-id="c64ad-152">If the send port is dynamic, it will route the MDN based to the address in the Receipt-Delivery-Notification line in the header of the message.</span></span> <span data-ttu-id="c64ad-153">静的送信ポートの場合、送信ポートは、送信ポートの "URI を転送する" プロパティに基づいてメッセージをルーティングします。</span><span class="sxs-lookup"><span data-stu-id="c64ad-153">If the send port is static, it will route the message based upon Transport URI property of the send port.</span></span>  
  
## <a name="mdn-generation-rules"></a><span data-ttu-id="c64ad-154">MDN の生成ルール</span><span class="sxs-lookup"><span data-stu-id="c64ad-154">MDN Generation Rules</span></span>  
 <span data-ttu-id="c64ad-155">MDN の生成には、次のルールが適用されます。</span><span class="sxs-lookup"><span data-stu-id="c64ad-155">The following rules apply to MDN generation:</span></span>  
  
-   <span data-ttu-id="c64ad-156">メッセージの送信者が確認メッセージ (署名付き) を要求しているが、メッセージのコンテンツの処理中にエラーが発生した場合、メッセージの受信者は、トランザクション自体が無効になっても確認メッセージ (署名付き) を返す必要があります。</span><span class="sxs-lookup"><span data-stu-id="c64ad-156">When a message sender specifically requests a signed receipt, but there is error in processing the contents of the message, the message receiver must still return a signed receipt, even though the transaction itself may not be valid.</span></span> <span data-ttu-id="c64ad-157">メッセージのコンテンツの処理中に発生したエラーの理由が、"disposition-field" に設定される必要があります。</span><span class="sxs-lookup"><span data-stu-id="c64ad-157">The reason for the error in processing the contents of the message must be set in the "disposition-field".</span></span>  
  
-   <span data-ttu-id="c64ad-158">MDN 確認メッセージの要求で署名付きの確認メッセージが明示的に指定されているが、元のメッセージの受信者が要求されたプロトコル形式または要求された MIC アルゴリズムをサポートしていない場合、受信者は署名付きまたは署名なしの確認メッセージを返す必要があります。</span><span class="sxs-lookup"><span data-stu-id="c64ad-158">When the request for the MDN receipt explicitly specifies that the receipt be signed, but the receiver of the original message cannot support either the requested protocol format or the requested MIC algorithm, then either a signed or unsigned receipt should be returned.</span></span>  
  
-   <span data-ttu-id="c64ad-159">署名が明示的に要求されていない場合や、署名付きの確認メッセージの要求パラメーターが受信側パーティのアグリーメントで認識されない場合、受信側パーティは、署名付きまたは署名なしの確認メッセージを返すか、確認メッセージを返しません。</span><span class="sxs-lookup"><span data-stu-id="c64ad-159">When a signature is not explicitly requested, or if the signed receipt request parameter is not recognized by the agreement for the receiving party, then the receiving party may return an unsigned receipt, a signed receipt, or no receipt.</span></span>  
  
## <a name="mic-generation"></a><span data-ttu-id="c64ad-160">MIC の生成</span><span class="sxs-lookup"><span data-stu-id="c64ad-160">MIC Generation</span></span>  
 <span data-ttu-id="c64ad-161">MDN が要求されている場合、元のメッセージの受信者は MIC (メッセージ整合性チェック) を生成して MDN に追加します。</span><span class="sxs-lookup"><span data-stu-id="c64ad-161">When an MDN is required, the receiver of the original message generates an MIC (Message Integrity Check) and adds it to the MDN.</span></span> <span data-ttu-id="c64ad-162">EDI インターチェンジがマルチパートの MIME コンテンツ タイプの一部である場合、EDI インターチェンジと、MIME ヘッダーを含む、マルチパート コンテンツ全体にまたがる MIC を計算する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c64ad-162">When the EDI interchange is part of a multi-part MIME content-type, the MIC must be calculated across the entire multi-part content, including the EDI interchange and the MIME headers.</span></span> <span data-ttu-id="c64ad-163">暗号化された署名されていないメッセージでは、返される MIC は、解読された MIME ヘッダーとコンテンツに基づいて計算されます。</span><span class="sxs-lookup"><span data-stu-id="c64ad-163">For encrypted, unsigned messages, the MIC to be returned is calculated on the decrypted MIME header and content.</span></span> <span data-ttu-id="c64ad-164">署名も暗号化もされていないメッセージでは、MIC は、MIME ヘッダーを含まないメッセージのコンテンツに基づいて計算される必要があります。</span><span class="sxs-lookup"><span data-stu-id="c64ad-164">For unsigned, unencrypted messages, the MIC must be calculated over the message contents without the MIME headers.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="c64ad-165">参照</span><span class="sxs-lookup"><span data-stu-id="c64ad-165">See Also</span></span>  
 [<span data-ttu-id="c64ad-166">BizTalk Server が AS2 メッセージを受信する方法</span><span class="sxs-lookup"><span data-stu-id="c64ad-166">How BizTalk Server Receives AS2 Messages</span></span>](../core/how-biztalk-server-receives-as2-messages.md)