---
title: 作成する方法について呼び出されたオーケストレーションに受信サブスクリプション |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 3423309a-cb5a-40a5-9582-6ee3ac82b538
caps.latest.revision: 9
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: a3ccb4743b2054a02d492b053de21a32a27badaf
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/27/2018
ms.locfileid: "37010307"
---
# <a name="how-to-create-receive-subscriptions-at-invoked-orchestrations"></a><span data-ttu-id="9424e-102">呼び出されたオーケストレーションに受信サブスクリプションを作成する方法</span><span class="sxs-lookup"><span data-stu-id="9424e-102">How to Create Receive Subscriptions at Invoked Orchestrations</span></span>
<span data-ttu-id="9424e-103">メッセージをパラメーターとして渡すことができますが、**オーケストレーションの開始**図形の後に呼び出されたオーケストレーションに呼び出し元オーケストレーションからメッセージを送信する一部のシナリオで、オーケストレーションを開始すると、呼び出し。</span><span class="sxs-lookup"><span data-stu-id="9424e-103">Although you can pass messages as parameters through the **Start Orchestration** shape when you start an orchestration, in some scenarios you may want to send messages from the caller orchestration to the invoked orchestration after the invocation.</span></span> <span data-ttu-id="9424e-104">たとえば、渡すべきメッセージが呼び出しの時点で判明していない場合や、呼び出されたオーケストレーションに他のオーケストレーションから動的にメッセージを送信する場合などです。</span><span class="sxs-lookup"><span data-stu-id="9424e-104">For example, you may not know what messages you want to pass at the time of invocation, or other orchestrations may need to send messages to the invoked orchestration dynamically.</span></span>  
  
 <span data-ttu-id="9424e-105">呼び出し先オーケストレーションにメッセージを送信するには、関連付けを渡します。呼び出し先オーケストレーションはこの関連付けに基づいてサブスクリプションを作成し、さらにそのサブスクリプションを使用してメッセージを受信します。</span><span class="sxs-lookup"><span data-stu-id="9424e-105">The way to send a message to an invoked orchestration is to pass in a correlation so that the invoked orchestration can create the subscription that the correlation helps define and then receive the message by using that subscription.</span></span> <span data-ttu-id="9424e-106">ただし、呼び出し先オーケストレーションに関連付けを渡すだけでは、関連付けに基づくサブスクリプションは作成されず、サブスクリプションのメッセージも受信されません。</span><span class="sxs-lookup"><span data-stu-id="9424e-106">However, you cannot simply pass in a correlation and expect the invoked orchestration to create the subscription based on the correlation and receive a message on the subscription.</span></span> <span data-ttu-id="9424e-107">アプローチを使用する場合、エラーは、「、パブリッシュされたメッセージがルーティングでしたサブスクライバーが見つからなかったためです」呼び出し元オーケストレーションから呼び出されたオーケストレーションに送信するメッセージが発生します。</span><span class="sxs-lookup"><span data-stu-id="9424e-107">If you use that approach, the messages you send from the caller orchestration to the invoked orchestration will result in the error, "The published message could not be routed because no subscribers were found."</span></span> <span data-ttu-id="9424e-108">これは、次の理由によりします。</span><span class="sxs-lookup"><span data-stu-id="9424e-108">This is because of the following:</span></span>  
  
- <span data-ttu-id="9424e-109">呼び出し先のオーケストレーションに競合状態が存在する</span><span class="sxs-lookup"><span data-stu-id="9424e-109">There is a race condition in the invoked orchestration.</span></span>  
  
- <span data-ttu-id="9424e-110">呼び出し先オーケストレーションがメッセージ ボックス データベースへサブスクリプションを送信するためのコミット ポイントが存在しないので、ルーティングされたメッセージを受け取ることができない。</span><span class="sxs-lookup"><span data-stu-id="9424e-110">There is no commit point for the invoked orchestration to send the subscription to the MessageBox database for routing so that it can receive the messages.</span></span>  
  
  <span data-ttu-id="9424e-111">この問題を解決する方法、次の手順を実行することです。</span><span class="sxs-lookup"><span data-stu-id="9424e-111">A way to resolve this problem is to perform the following steps:</span></span>  
  
1. <span data-ttu-id="9424e-112">呼び出し先オーケストレーションで、メッセージを受信するアクティブ化受信を作成します。</span><span class="sxs-lookup"><span data-stu-id="9424e-112">In the caller orchestration, you have an activate receive to receive the message.</span></span> <span data-ttu-id="9424e-113">経由の直接バインド ポートを受信する、自己関連付けと呼び出し先オーケストレーションでメッセージが表示される、関連付けセットを初期化、および関連付けセットを渡して、**オーケストレーションの開始**図形。</span><span class="sxs-lookup"><span data-stu-id="9424e-113">After you receive the message in the caller orchestration, initialize the correlation set, and then pass the correlation set and a self-correlating receive direct-bound port through the **Start Orchestration** shape.</span></span> <span data-ttu-id="9424e-114">渡したポートが、呼び出し先オーケストレーションの送信ポートになります。このポートを使用してメッセージを返し、呼び出し元オーケストレーションと同期します。</span><span class="sxs-lookup"><span data-stu-id="9424e-114">The port that you pass in becomes a send port in the invoked orchestration, and you will use it to send the message back to synchronize with the caller orchestration.</span></span>  
  
2. <span data-ttu-id="9424e-115">呼び出し先オーケストレーションで、自己関連付けポートを通じて、呼び出し元オーケストレーションにメッセージを返します。</span><span class="sxs-lookup"><span data-stu-id="9424e-115">In the invoked orchestration, send a message back to the caller orchestration through the self-correlating port.</span></span> <span data-ttu-id="9424e-116">これで呼び出し元オーケストレーションと同期をとれるので、競合状態を回避し、コミット ポイントを設けることができます。また、呼び出し先オーケストレーションでは、メッセージ ボックスへの受信サブスクリプションを作成し、メッセージがルーティングされるようにします。</span><span class="sxs-lookup"><span data-stu-id="9424e-116">This synchronizes with the caller orchestration to prevent race conditions and to provide a commit point while creating the receive subscription to the MessageBox for routing in the invoked orchestration.</span></span>  
  
3. <span data-ttu-id="9424e-117">呼び出し元オーケストレーションは、自己関連付けポートを通じてメッセージを受信し、呼び出し先オーケストレーションと同期します。</span><span class="sxs-lookup"><span data-stu-id="9424e-117">The caller orchestration receives the message through the self-correlating port and synchronizes with the invoked orchestration.</span></span> <span data-ttu-id="9424e-118">自己関連付けポートの受信には、フォロー関連付けが必要ありません。</span><span class="sxs-lookup"><span data-stu-id="9424e-118">Note that self-correlating port receives do not need correlation followers.</span></span> <span data-ttu-id="9424e-119">これで、呼び出し元オーケストレーションからのメッセージを、呼び出し先オーケストレーションへ安全に送信できるようになりました。呼び出し先オーケストレーションは、関連付けに基づいてメッセージを受信します。</span><span class="sxs-lookup"><span data-stu-id="9424e-119">You can now safely send messages from the caller orchestration to the invoked orchestration, and the invoked orchestration will receive the messages based upon the correlation.</span></span>  
  
   <span data-ttu-id="9424e-120">前の方法でも目的を達成できますが、より良い方法として、受信に使用する関連付けを初期化するメッセージを渡す方法があります。</span><span class="sxs-lookup"><span data-stu-id="9424e-120">Although the preceding approach can achieve the goal, a better approach is to pass in the message that initializes the correlation on which you want to receive upon.</span></span> <span data-ttu-id="9424e-121">自己関連付けポートを通じて、呼び出し元オーケストレーションと呼び出し先オーケストレーションを同期するときは、関連付けの初期化に必要なメッセージを渡すことをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="9424e-121">When you are synchronizing a caller orchestration with an invoked orchestration through a self-correlating port, we recommend that you always pass in the message that you need for initializing the correlations.</span></span> <span data-ttu-id="9424e-122">次の手順は、信頼性とパフォーマンスが最も高い方法です。</span><span class="sxs-lookup"><span data-stu-id="9424e-122">The following steps provide the most reliable and highest-performance approach:</span></span>  
  
4. <span data-ttu-id="9424e-123">呼び出し先オーケストレーションで、メッセージを受信するアクティブ化受信を作成します。</span><span class="sxs-lookup"><span data-stu-id="9424e-123">In the caller orchestration, you have an activate receive to receive the message.</span></span> <span data-ttu-id="9424e-124">メッセージを渡すし、を介して直接バインド ポートを受信する、自己関連付けメッセージが表示されたら、**オーケストレーションの開始**図形。</span><span class="sxs-lookup"><span data-stu-id="9424e-124">After you receive the message, pass a message and a self-correlating receive direct-bound port through the **Start Orchestration** shape.</span></span> <span data-ttu-id="9424e-125">呼び出し先オーケストレーションでは、ここで渡したメッセージを使用して関連付けが初期化されます。</span><span class="sxs-lookup"><span data-stu-id="9424e-125">The message you pass in will be used to initialize the correlation in the invoked orchestration.</span></span> <span data-ttu-id="9424e-126">渡したポートが、呼び出し先オーケストレーションの送信ポートになります。このポートを使用してメッセージを返し、呼び出し元オーケストレーションと同期します。</span><span class="sxs-lookup"><span data-stu-id="9424e-126">The port that you pass in becomes a send port in the invoked orchestration, and you will use it to send the message back to synchronize with the caller orchestration.</span></span>  
  
5. <span data-ttu-id="9424e-127">呼び出し先オーケストレーションでは、関連付けを初期化して、呼び出し元オーケストレーションにメッセージを返します。</span><span class="sxs-lookup"><span data-stu-id="9424e-127">In the invoked orchestration, initialize the correlation and send a message back to the caller orchestration.</span></span> <span data-ttu-id="9424e-128">これで呼び出し元オーケストレーションと同期をとれるので、競合状態を回避し、コミット ポイントを設けることができます。また、呼び出し先オーケストレーションでは、メッセージ ボックスへの受信サブスクリプションを作成し、メッセージがルーティングされるようにします。</span><span class="sxs-lookup"><span data-stu-id="9424e-128">This synchronizes with the caller orchestration to prevent race conditions and to provide a commit point while creating the receive subscription to the MessageBox for routing in the invoked orchestration.</span></span>  
  
6. <span data-ttu-id="9424e-129">呼び出し元オーケストレーションは、自己関連付けポートを通じてメッセージを受信し、呼び出し先オーケストレーションと同期します。</span><span class="sxs-lookup"><span data-stu-id="9424e-129">The caller orchestration receives the message through the self-correlating port and synchronizes with the invoked orchestration.</span></span> <span data-ttu-id="9424e-130">注、自己関連付けポートを受信するには、フォロー関連付けは必要ありません。</span><span class="sxs-lookup"><span data-stu-id="9424e-130">Note that the self-correlating port receives do not need correlation followers.</span></span> <span data-ttu-id="9424e-131">これで、呼び出し元オーケストレーションからのメッセージを、呼び出し先オーケストレーションへ安全に送信できるようになりました。呼び出し先オーケストレーションは、関連付けに基づいてメッセージを受信します。</span><span class="sxs-lookup"><span data-stu-id="9424e-131">You can now safely send messages from the caller orchestration to the invoked orchestration, and the invoked orchestration will receive the messages based upon the correlation.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="9424e-132">参照</span><span class="sxs-lookup"><span data-stu-id="9424e-132">See Also</span></span>  
 <span data-ttu-id="9424e-133">[オーケストレーションでの相関関係の使用](../core/using-correlations-in-orchestrations.md) </span><span class="sxs-lookup"><span data-stu-id="9424e-133">[Using Correlations in Orchestrations](../core/using-correlations-in-orchestrations.md) </span></span>  
 [<span data-ttu-id="9424e-134">自己関連付けを行う Direct を使用する方法のポートのバインド</span><span class="sxs-lookup"><span data-stu-id="9424e-134">How to Use Self-Correlating Direct Bound Ports</span></span>](../core/how-to-use-self-correlating-direct-bound-ports.md)