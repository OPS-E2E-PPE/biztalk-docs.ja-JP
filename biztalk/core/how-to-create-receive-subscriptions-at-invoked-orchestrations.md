---
title: 作成する方法について呼び出されたオーケストレーションに受信サブスクリプション |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 3423309a-cb5a-40a5-9582-6ee3ac82b538
caps.latest.revision: 9
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: b4c1e32e6d14673ba0a06a45e08d25c531824e1d
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/07/2019
ms.locfileid: "65385475"
---
# <a name="how-to-create-receive-subscriptions-at-invoked-orchestrations"></a><span data-ttu-id="57d6b-102">作成する方法について呼び出されたオーケストレーションに受信サブスクリプション</span><span class="sxs-lookup"><span data-stu-id="57d6b-102">How to Create Receive Subscriptions at Invoked Orchestrations</span></span>
<span data-ttu-id="57d6b-103">メッセージをパラメーターとして渡すことができますが、**オーケストレーションの開始**図形の後に呼び出されたオーケストレーションに呼び出し元オーケストレーションからメッセージを送信する一部のシナリオで、オーケストレーションを開始すると、呼び出し。</span><span class="sxs-lookup"><span data-stu-id="57d6b-103">Although you can pass messages as parameters through the **Start Orchestration** shape when you start an orchestration, in some scenarios you may want to send messages from the caller orchestration to the invoked orchestration after the invocation.</span></span> <span data-ttu-id="57d6b-104">たとえば、呼び出し時に渡すメッセージご存知ないかもしれませんまたは他のオーケストレーションが呼び出されたオーケストレーションにメッセージを動的に送信する必要があります。</span><span class="sxs-lookup"><span data-stu-id="57d6b-104">For example, you may not know what messages you want to pass at the time of invocation, or other orchestrations may need to send messages to the invoked orchestration dynamically.</span></span>  
  
 <span data-ttu-id="57d6b-105">呼び出されたオーケストレーションにメッセージを送信する方法では、呼び出されたオーケストレーションは、相関関係により、定義し、そのサブスクリプションを使用して、メッセージを受信するサブスクリプションを作成できるように、相関関係に渡します。</span><span class="sxs-lookup"><span data-stu-id="57d6b-105">The way to send a message to an invoked orchestration is to pass in a correlation so that the invoked orchestration can create the subscription that the correlation helps define and then receive the message by using that subscription.</span></span> <span data-ttu-id="57d6b-106">ただし、ことはできませんだけを渡して、関連付けと呼び出し先オーケストレーションの相関関係に基づいてサブスクリプションを作成するし、サブスクリプションでメッセージを受信します。</span><span class="sxs-lookup"><span data-stu-id="57d6b-106">However, you cannot simply pass in a correlation and expect the invoked orchestration to create the subscription based on the correlation and receive a message on the subscription.</span></span> <span data-ttu-id="57d6b-107">アプローチを使用する場合、エラーは、「、パブリッシュされたメッセージがルーティングでしたサブスクライバーが見つからなかったためです」呼び出し元オーケストレーションから呼び出されたオーケストレーションに送信するメッセージが発生します。</span><span class="sxs-lookup"><span data-stu-id="57d6b-107">If you use that approach, the messages you send from the caller orchestration to the invoked orchestration will result in the error, "The published message could not be routed because no subscribers were found."</span></span> <span data-ttu-id="57d6b-108">これは、次の理由によりします。</span><span class="sxs-lookup"><span data-stu-id="57d6b-108">This is because of the following:</span></span>  
  
- <span data-ttu-id="57d6b-109">呼び出されたオーケストレーションに競合状態があります。</span><span class="sxs-lookup"><span data-stu-id="57d6b-109">There is a race condition in the invoked orchestration.</span></span>  
  
- <span data-ttu-id="57d6b-110">呼び出されたオーケストレーションのルーティング、メッセージを受信できるように、メッセージ ボックス データベースにサブスクリプションを送信するためのコミット ポイントはありません。</span><span class="sxs-lookup"><span data-stu-id="57d6b-110">There is no commit point for the invoked orchestration to send the subscription to the MessageBox database for routing so that it can receive the messages.</span></span>  
  
  <span data-ttu-id="57d6b-111">この問題を解決する方法、次の手順を実行することです。</span><span class="sxs-lookup"><span data-stu-id="57d6b-111">A way to resolve this problem is to perform the following steps:</span></span>  
  
1. <span data-ttu-id="57d6b-112">呼び出し元オーケストレーションでは、アクティブ化メッセージを受信する受信があります。</span><span class="sxs-lookup"><span data-stu-id="57d6b-112">In the caller orchestration, you have an activate receive to receive the message.</span></span> <span data-ttu-id="57d6b-113">経由の直接バインド ポートを受信する、自己関連付けと呼び出し先オーケストレーションでメッセージが表示される、関連付けセットを初期化、および関連付けセットを渡して、**オーケストレーションの開始**図形。</span><span class="sxs-lookup"><span data-stu-id="57d6b-113">After you receive the message in the caller orchestration, initialize the correlation set, and then pass the correlation set and a self-correlating receive direct-bound port through the **Start Orchestration** shape.</span></span> <span data-ttu-id="57d6b-114">渡されたポートが呼び出されたオーケストレーションの送信ポートとメッセージの送信に使用するが、呼び出し元オーケストレーションと同期します。</span><span class="sxs-lookup"><span data-stu-id="57d6b-114">The port that you pass in becomes a send port in the invoked orchestration, and you will use it to send the message back to synchronize with the caller orchestration.</span></span>  
  
2. <span data-ttu-id="57d6b-115">呼び出されたオーケストレーションでは、自己関連付けポートを通じて、呼び出し元オーケストレーションにメッセージを送信します。</span><span class="sxs-lookup"><span data-stu-id="57d6b-115">In the invoked orchestration, send a message back to the caller orchestration through the self-correlating port.</span></span> <span data-ttu-id="57d6b-116">これは、競合状態を防ぐために、呼び出されたオーケストレーションでのルーティング用のメッセージ ボックスへの受信サブスクリプションを作成するときにコミット ポイントを提供して、呼び出し元オーケストレーションと同期されます。</span><span class="sxs-lookup"><span data-stu-id="57d6b-116">This synchronizes with the caller orchestration to prevent race conditions and to provide a commit point while creating the receive subscription to the MessageBox for routing in the invoked orchestration.</span></span>  
  
3. <span data-ttu-id="57d6b-117">呼び出し元オーケストレーションは、自己関連付けポートを通じてメッセージを受信し、呼び出されたオーケストレーションと同期します。</span><span class="sxs-lookup"><span data-stu-id="57d6b-117">The caller orchestration receives the message through the self-correlating port and synchronizes with the invoked orchestration.</span></span> <span data-ttu-id="57d6b-118">自己関連付けポートの受信には、フォロー関連付けには必要ありません。</span><span class="sxs-lookup"><span data-stu-id="57d6b-118">Note that self-correlating port receives do not need correlation followers.</span></span> <span data-ttu-id="57d6b-119">これで安全にメッセージを送信できます、呼び出し元オーケストレーションから呼び出されたオーケストレーションに、呼び出されたオーケストレーションは、関連付けに基づいてメッセージを受信する.</span><span class="sxs-lookup"><span data-stu-id="57d6b-119">You can now safely send messages from the caller orchestration to the invoked orchestration, and the invoked orchestration will receive the messages based upon the correlation.</span></span>  
  
   <span data-ttu-id="57d6b-120">前の方法では、目標を実現することも、ほうが効果的に渡すメッセージを受信する相関関係を初期化します。</span><span class="sxs-lookup"><span data-stu-id="57d6b-120">Although the preceding approach can achieve the goal, a better approach is to pass in the message that initializes the correlation on which you want to receive upon.</span></span> <span data-ttu-id="57d6b-121">自己関連付けポートを通じて呼び出されたオーケストレーションと呼び出し先オーケストレーションを同期するときに、関連付けの初期化に必要なメッセージで常に渡すことをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="57d6b-121">When you are synchronizing a caller orchestration with an invoked orchestration through a self-correlating port, we recommend that you always pass in the message that you need for initializing the correlations.</span></span> <span data-ttu-id="57d6b-122">次の手順では、信頼性とパフォーマンスが最も高いアプローチを提供します。</span><span class="sxs-lookup"><span data-stu-id="57d6b-122">The following steps provide the most reliable and highest-performance approach:</span></span>  
  
4. <span data-ttu-id="57d6b-123">呼び出し元オーケストレーションでは、アクティブ化メッセージを受信する受信があります。</span><span class="sxs-lookup"><span data-stu-id="57d6b-123">In the caller orchestration, you have an activate receive to receive the message.</span></span> <span data-ttu-id="57d6b-124">メッセージを渡すし、を介して直接バインド ポートを受信する、自己関連付けメッセージが表示されたら、**オーケストレーションの開始**図形。</span><span class="sxs-lookup"><span data-stu-id="57d6b-124">After you receive the message, pass a message and a self-correlating receive direct-bound port through the **Start Orchestration** shape.</span></span> <span data-ttu-id="57d6b-125">渡すメッセージが呼び出されたオーケストレーションで関連付けを初期化するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="57d6b-125">The message you pass in will be used to initialize the correlation in the invoked orchestration.</span></span> <span data-ttu-id="57d6b-126">渡されたポートが呼び出されたオーケストレーションの送信ポートとメッセージの送信に使用するが、呼び出し元オーケストレーションと同期します。</span><span class="sxs-lookup"><span data-stu-id="57d6b-126">The port that you pass in becomes a send port in the invoked orchestration, and you will use it to send the message back to synchronize with the caller orchestration.</span></span>  
  
5. <span data-ttu-id="57d6b-127">呼び出されたオーケストレーションでは、相関関係を初期化し、呼び出し元オーケストレーションにメッセージを送信します。</span><span class="sxs-lookup"><span data-stu-id="57d6b-127">In the invoked orchestration, initialize the correlation and send a message back to the caller orchestration.</span></span> <span data-ttu-id="57d6b-128">これは、競合状態を防ぐために、呼び出されたオーケストレーションでのルーティング用のメッセージ ボックスへの受信サブスクリプションを作成するときにコミット ポイントを提供して、呼び出し元オーケストレーションと同期されます。</span><span class="sxs-lookup"><span data-stu-id="57d6b-128">This synchronizes with the caller orchestration to prevent race conditions and to provide a commit point while creating the receive subscription to the MessageBox for routing in the invoked orchestration.</span></span>  
  
6. <span data-ttu-id="57d6b-129">呼び出し元オーケストレーションは、自己関連付けポートを通じてメッセージを受信し、呼び出されたオーケストレーションと同期します。</span><span class="sxs-lookup"><span data-stu-id="57d6b-129">The caller orchestration receives the message through the self-correlating port and synchronizes with the invoked orchestration.</span></span> <span data-ttu-id="57d6b-130">注、自己関連付けポートを受信するには、フォロー関連付けは必要ありません。</span><span class="sxs-lookup"><span data-stu-id="57d6b-130">Note that the self-correlating port receives do not need correlation followers.</span></span> <span data-ttu-id="57d6b-131">これで安全にメッセージを送信できます、呼び出し元オーケストレーションから呼び出されたオーケストレーションに、呼び出されたオーケストレーションは、関連付けに基づいてメッセージを受信する.</span><span class="sxs-lookup"><span data-stu-id="57d6b-131">You can now safely send messages from the caller orchestration to the invoked orchestration, and the invoked orchestration will receive the messages based upon the correlation.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="57d6b-132">参照</span><span class="sxs-lookup"><span data-stu-id="57d6b-132">See Also</span></span>  
 <span data-ttu-id="57d6b-133">[オーケストレーションでの相関関係の使用](../core/using-correlations-in-orchestrations.md) </span><span class="sxs-lookup"><span data-stu-id="57d6b-133">[Using Correlations in Orchestrations](../core/using-correlations-in-orchestrations.md) </span></span>  
 [<span data-ttu-id="57d6b-134">自己関連付けを行う Direct を使用する方法のポートのバインド</span><span class="sxs-lookup"><span data-stu-id="57d6b-134">How to Use Self-Correlating Direct Bound Ports</span></span>](../core/how-to-use-self-correlating-direct-bound-ports.md)