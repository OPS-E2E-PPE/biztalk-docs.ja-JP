---
title: SQL Server Always On 可用性グループを使用して高可用性 |Microsoft Docs
description: SQL Server 常にで使用可能なグループ (AG)、システム要件や制限事項などを使用して高可用性 (HA) ソリューションを取得する別のノードで BizTalk Server データベースをグループ化します。 Always on AG では、Windows Server フェールオーバー クラスタ リング (WSFC) が必要です。
ms.custom: ''
ms.date: 06/27/2018
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 4511a578-77d2-49ee-99bd-f0406ad625d0
caps.latest.revision: 10
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 24a72698a97aa79ccd1b748a390f8e919ff0717f
ms.sourcegitcommit: 6379723045cf05ed36f2bc500f6b41be1135f47c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/28/2018
ms.locfileid: "37069399"
---
# <a name="high-availability-using-sql-server-always-on-availability-groups---biztalk-server"></a><span data-ttu-id="c6597-104">SQL Server Always On 可用性グループの BizTalk Server を使用して高可用性</span><span class="sxs-lookup"><span data-stu-id="c6597-104">High Availability using SQL Server Always On Availability Groups - BizTalk Server</span></span>
<span data-ttu-id="c6597-105">SQL Server AlwaysOn 可用性グループを使用して高可用性を構成します。</span><span class="sxs-lookup"><span data-stu-id="c6597-105">Configure high availability using SQL Server AlwaysOn availability groups.</span></span>

> [!TIP]
> <span data-ttu-id="c6597-106">[ラボをグループの可用性を使用して BizTalk Server 2016 セットアップ](https://skastberg.wordpress.com/2017/02/22/setting-up-my-biztalk-server-2016-using-availability-groups-lab/)Microsoft のフィールド エンジニアによって作成されたステップ バイ ステップ ガイドを提供します。</span><span class="sxs-lookup"><span data-stu-id="c6597-106">[Setting up BizTalk Server 2016 using availability groups LAB](https://skastberg.wordpress.com/2017/02/22/setting-up-my-biztalk-server-2016-using-availability-groups-lab/) provides a step-by-step guide written by a Microsoft field engineer.</span></span> <span data-ttu-id="c6597-107">ラボ環境に基づいており、いくつか所見が含まれています。</span><span class="sxs-lookup"><span data-stu-id="c6597-107">It is based on a lab environment, and includes some observations.</span></span> <span data-ttu-id="c6597-108">試してみて下さい。</span><span class="sxs-lookup"><span data-stu-id="c6597-108">Check it out.</span></span>  
> 
> [!IMPORTANT]
> * <span data-ttu-id="c6597-109">Always On 可用性グループは、SQL Server 2016 以降から使用できます。</span><span class="sxs-lookup"><span data-stu-id="c6597-109">Always On Availability Groups is available starting with SQL Server 2016.</span></span> <span data-ttu-id="c6597-110">SQL Server の以前のバージョンを使用している場合にこのトピックでは適用されません。</span><span class="sxs-lookup"><span data-stu-id="c6597-110">If you are using a previous SQL Server version, this topic does not apply to you.</span></span> 
> * <span data-ttu-id="c6597-111">BizTalk Server 2016 には、同期コミット モードがサポートしています非同期コミット モードがサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="c6597-111">BizTalk Server 2016 supports synchronous-commit mode; asynchronous-commit mode is not supported.</span></span> <span data-ttu-id="c6597-112">ディザスター リカバリーを BizTalk Server のバックアップ ジョブを構成およびログ配布を使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="c6597-112">For disaster recovery, it is recommended to configure the Backup BizTalk Server job, and use log shipping.</span></span> <span data-ttu-id="c6597-113">参照してください[Backing Up and BizTalk Server データベースの復元](../core/backing-up-and-restoring-biztalk-server-databases.md)に関する特定の詳細。</span><span class="sxs-lookup"><span data-stu-id="c6597-113">See [Backing Up and Restoring BizTalk Server Databases](../core/backing-up-and-restoring-biztalk-server-databases.md) for specific details.</span></span>
> 
>    <span data-ttu-id="c6597-114">[可用性モード](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/availability-modes-always-on-availability-groups)Always On 可用性グループのコミットのオプションの詳細。</span><span class="sxs-lookup"><span data-stu-id="c6597-114">[Availability Modes](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/availability-modes-always-on-availability-groups) details the commit options with Always On Availability Groups.</span></span> 


## <a name="background-and-history"></a><span data-ttu-id="c6597-115">背景と履歴</span><span class="sxs-lookup"><span data-stu-id="c6597-115">Background and history</span></span>

<span data-ttu-id="c6597-116">データの永続性、BizTalk Server が SQL Server では大きく依存します。</span><span class="sxs-lookup"><span data-stu-id="c6597-116">BizTalk Server relies heavily on SQL Server for data persistence.</span></span> <span data-ttu-id="c6597-117">その他のコンポーネントおよび BizTalk server ホストの受信、処理、またはメッセージのルーティングなどのさまざまなビジネス アプリケーションを統合するときに特定のロールがあります。</span><span class="sxs-lookup"><span data-stu-id="c6597-117">Other components and hosts in BizTalk Server have specific roles when integrating disparate business applications, such as receiving, processing, or routing messages.</span></span> <span data-ttu-id="c6597-118">データベース コンピューターは、この動作をキャプチャし、ディスクに永続化します。</span><span class="sxs-lookup"><span data-stu-id="c6597-118">The database computer captures this work, and persists it to disk.</span></span> 

<span data-ttu-id="c6597-119">BizTalk では、SQL Server フェールオーバー クラスタ リングとログ配布を使用して、そのオンプレミス データベースの高可用性、バックアップと復元、およびディザスター リカバリーを提供します。</span><span class="sxs-lookup"><span data-stu-id="c6597-119">BizTalk uses SQL Server Failover Clustering and Log Shipping to provide high availability, backup and restore, and disaster recovery for its on-premises databases.</span></span> <span data-ttu-id="c6597-120">Azure iaas (Azure の仮想マシン) で SQL Server の以前のバージョンは、フェールオーバー クラスター インスタンス (MSDTC はサポートされません) をサポートしています。</span><span class="sxs-lookup"><span data-stu-id="c6597-120">In Azure IaaS (Azure virtual machines), previous versions of SQL Server do not support Failover Cluster Instances (no MSDTC support).</span></span> <span data-ttu-id="c6597-121">その結果、Azure Vm を使用する場合、BizTalk は、HA ソリューションがありませんでした。</span><span class="sxs-lookup"><span data-stu-id="c6597-121">As a result, BizTalk did not have a HA solution when using Azure VMs.</span></span>

<span data-ttu-id="c6597-122">SQL Server 2016 以降、SQL Server AlwaysOn 可用性グループは、オンプレミスと Azure Vm を使用して MSDTC をサポートします。</span><span class="sxs-lookup"><span data-stu-id="c6597-122">Starting with SQL Server 2016, SQL Server AlwaysOn Availability Groups supports MSDTC for on-premises and using Azure VMs.</span></span> <span data-ttu-id="c6597-123">その結果、BizTalk データベース、オンプレミスまたは Azure IaaS のシナリオで、SQL Server 2016 AlwaysOn 機能はサポートされています。</span><span class="sxs-lookup"><span data-stu-id="c6597-123">As a result, the SQL Server 2016 AlwaysOn feature is supported for BizTalk databases on-premises or in Azure IaaS scenarios.</span></span> 

## <a name="sql-server-2016-alwayson-availability-groups"></a><span data-ttu-id="c6597-124">SQL Server 2016 AlwaysOn 可用性グループ</span><span class="sxs-lookup"><span data-stu-id="c6597-124">SQL Server 2016 AlwaysOn Availability Groups</span></span> 
<span data-ttu-id="c6597-125">AlwaysOn 可用性グループを展開するには、Windows Server フェールオーバー クラスタ リング (WSFC) クラスターが必要です。</span><span class="sxs-lookup"><span data-stu-id="c6597-125">Deploying AlwaysOn Availability Groups requires a Windows Server Failover Clustering (WSFC) cluster.</span></span> <span data-ttu-id="c6597-126">指定された可用性グループの各可用性レプリカは、同一の WSFC クラスターの異なるノード上に存在する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c6597-126">Each availability replica of a given availability group must reside on a different node of the same WSFC cluster.</span></span> <span data-ttu-id="c6597-127">WSFC リソース グループは、作成されたすべての可用性グループに対して作成されます。</span><span class="sxs-lookup"><span data-stu-id="c6597-127">A WSFC resource group is created for every availability group that you create.</span></span> <span data-ttu-id="c6597-128">WSFC クラスターは、このリソース グループを監視して、プライマリ レプリカの正常性を評価します。</span><span class="sxs-lookup"><span data-stu-id="c6597-128">The WSFC cluster monitors this resource group to evaluate the health of the primary replica.</span></span>  

<span data-ttu-id="c6597-129">次の図は、1 つのプライマリ レプリカと 4 つのセカンダリ レプリカを含む可用性グループを示しています。</span><span class="sxs-lookup"><span data-stu-id="c6597-129">The following illustration shows an availability group that contains one primary replica and four secondary replicas.</span></span>  
 
 ![SQLAG_PrimaryReplica](../core/media/sqlag-primaryreplica.png)

<span data-ttu-id="c6597-131">クライアントは、可用性グループ リスナーを使用して特定の可用性グループのプライマリ レプリカに接続できます。</span><span class="sxs-lookup"><span data-stu-id="c6597-131">Clients can connect to the primary replica of a given availability group using an availability group listener.</span></span> <span data-ttu-id="c6597-132">可用性グループ リスナーは、一連の適切な可用性レプリカに対するクライアント接続を送るための特定の可用性グループに関連付けられているリソースを提供します。</span><span class="sxs-lookup"><span data-stu-id="c6597-132">An availability group listener provides a set of resources that are attached to a given availability group to direct client connections to the appropriate availability replica.</span></span> 

>[!IMPORTANT]
> <span data-ttu-id="c6597-133">SQL Server 2016 では、Windows Server 2016 および Windows Server 2012 R2 で MSDTC AlwaysOn 可用性グループ (AG) をサポートしています。</span><span class="sxs-lookup"><span data-stu-id="c6597-133">SQL Server 2016 supports MSDTC with AlwaysOn Availability Groups (AG) on Windows Server 2016 and Windows Server 2012 R2.</span></span> <span data-ttu-id="c6597-134">**Windows Server 2012 R2**が必要です、 [3090973](https://support.microsoft.com/kb/3090973)インストールする Windows 修正プログラム。</span><span class="sxs-lookup"><span data-stu-id="c6597-134">**Windows Server 2012 R2** requires  the [3090973](https://support.microsoft.com/kb/3090973) Windows hotfix  to be installed.</span></span> 
> <span data-ttu-id="c6597-135">**Windows Server 2016**いる必要があります、 [RemoteAccessEnabled レジストリ キー](https://support.microsoft.com/kb/3182294)を有効にします。</span><span class="sxs-lookup"><span data-stu-id="c6597-135">**Windows Server 2016** requires that the [RemoteAccessEnabled registry key](https://support.microsoft.com/kb/3182294) be enabled.</span></span>

<span data-ttu-id="c6597-136">SQL Server は、2016年より前のバージョンの AlwaysOn AG で MSDTC をサポートしていません。</span><span class="sxs-lookup"><span data-stu-id="c6597-136">SQL Server does not support MSDTC with AlwaysOn AG for any versions prior to 2016.</span></span>  

<span data-ttu-id="c6597-137">SQL Server AlwaysOn 可用性グループでは、同じ SQL Server インスタンス上のデータベース間の MSDTC はサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="c6597-137">MSDTC between databases on same SQL Server instance is not supported with SQL Server AlwaysOn Availability Groups.</span></span> <span data-ttu-id="c6597-138">つまり、同じ SQL server インスタンスに分散トランザクションに 2 つの BizTalk データベースをホストすることができます。</span><span class="sxs-lookup"><span data-stu-id="c6597-138">This means that no two BizTalk databases in a distributed transaction can be hosted on the same SQL server instance.</span></span> <span data-ttu-id="c6597-139">トランザクションの一貫性を保つのためには、別の SQL server インスタンスでの分散トランザクションに参加している BizTalk データベースをホストする必要があります。</span><span class="sxs-lookup"><span data-stu-id="c6597-139">For transactional consistency, BizTalk databases participating in distributed transaction should be hosted on different SQL server instances.</span></span> <span data-ttu-id="c6597-140">SQL インスタンスが同じコンピューターまたは別のコンピューター上にあるかどうかが重要でないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="c6597-140">Note that it does not matter whether SQL instances are on the same computer, or different computers.</span></span> 


## <a name="provide-high-availability-for-biztalk-databases-using-alwayson-availability-groups"></a><span data-ttu-id="c6597-141">AlwaysOn 可用性グループを使用して BizTalk データベースの高可用性を実現します。</span><span class="sxs-lookup"><span data-stu-id="c6597-141">Provide high availability for BizTalk databases using AlwaysOn Availability Groups</span></span> 
<span data-ttu-id="c6597-142">BizTalk Server の基本的な構成で 9 データベースの最小値は、ルールや BAM などのデータベースに作成されます。</span><span class="sxs-lookup"><span data-stu-id="c6597-142">In the basic configuration of BizTalk Server, a minimum of 9 databases are created including Rules and BAM databases.</span></span> <span data-ttu-id="c6597-143">MSDTC が原因で可用性グループの制限が前に説明した、次などの構成ではトランザクションの一貫性が確保されません。</span><span class="sxs-lookup"><span data-stu-id="c6597-143">Due to the MSDTC limitation with Availability Groups mentioned previously, a configuration such as following does not ensure transactional consistency.</span></span> 

![SQLAG_NoTrans](../core/media/sqlag-notrans.gif)
 
<span data-ttu-id="c6597-145">BizTalk Server データベースが次の 4 つの SQL Server インスタンスにまとめられていることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="c6597-145">We recommend that the BizTalk Server databases are grouped into the following four SQL Server instances:</span></span>
 
| <span data-ttu-id="c6597-146">Instance</span><span class="sxs-lookup"><span data-stu-id="c6597-146">Instance</span></span> |<span data-ttu-id="c6597-147">ロール</span><span class="sxs-lookup"><span data-stu-id="c6597-147">Role</span></span> |<span data-ttu-id="c6597-148">そのグループ内の BizTalk データベース</span><span class="sxs-lookup"><span data-stu-id="c6597-148">BizTalk Databases in that group</span></span>  |
|--- | --- | ---|
|<span data-ttu-id="c6597-149">1</span><span class="sxs-lookup"><span data-stu-id="c6597-149">1</span></span> |<span data-ttu-id="c6597-150">[認証]</span><span class="sxs-lookup"><span data-stu-id="c6597-150">Authentication</span></span> |<span data-ttu-id="c6597-151">SSODB</span><span class="sxs-lookup"><span data-stu-id="c6597-151">SSODB</span></span>|
|<span data-ttu-id="c6597-152">2</span><span class="sxs-lookup"><span data-stu-id="c6597-152">2</span></span> |<span data-ttu-id="c6597-153">管理</span><span class="sxs-lookup"><span data-stu-id="c6597-153">Management</span></span> |<span data-ttu-id="c6597-154">BizTalkMgmtDb</span><span class="sxs-lookup"><span data-stu-id="c6597-154">BizTalkMgmtDb</span></span>| 
|<span data-ttu-id="c6597-155">3</span><span class="sxs-lookup"><span data-stu-id="c6597-155">3</span></span> |<span data-ttu-id="c6597-156">ランタイム</span><span class="sxs-lookup"><span data-stu-id="c6597-156">Runtime</span></span> |<span data-ttu-id="c6597-157">BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="c6597-157">BizTalkMsgBoxDb</span></span><br/> <span data-ttu-id="c6597-158">BizTalkRulesEngineDb</span><span class="sxs-lookup"><span data-stu-id="c6597-158">BizTalkRulesEngineDb</span></span><br/> <span data-ttu-id="c6597-159">BAMPrimaryImport</span><span class="sxs-lookup"><span data-stu-id="c6597-159">BAMPrimaryImport</span></span><br/><span data-ttu-id="c6597-160">BAMStarSchema</span><span class="sxs-lookup"><span data-stu-id="c6597-160">BAMStarSchema</span></span> <br/><span data-ttu-id="c6597-161">BAMAlertsApplication</span><span class="sxs-lookup"><span data-stu-id="c6597-161">BAMAlertsApplication</span></span> |
|<span data-ttu-id="c6597-162">4</span><span class="sxs-lookup"><span data-stu-id="c6597-162">4</span></span> |<span data-ttu-id="c6597-163">Tracking</span><span class="sxs-lookup"><span data-stu-id="c6597-163">Tracking</span></span> |<span data-ttu-id="c6597-164">BizTalkDTADb</span><span class="sxs-lookup"><span data-stu-id="c6597-164">BizTalkDTADb</span></span><br/><span data-ttu-id="c6597-165">EsbItineraryDb</span><span class="sxs-lookup"><span data-stu-id="c6597-165">EsbItineraryDb</span></span><br/><span data-ttu-id="c6597-166">EsbExceptionDb</span><span class="sxs-lookup"><span data-stu-id="c6597-166">EsbExceptionDb</span></span> | 
 
<span data-ttu-id="c6597-167">スケール アウト メッセージ ボックス シナリオ (1 つ以上のメッセージ ボックスと構成) では、1 つ以上のメッセージ ボックス データベースと、各メッセージ ボックス データベースは、独自の SQL Server インスタンスである必要があります。</span><span class="sxs-lookup"><span data-stu-id="c6597-167">In a scaled-out MessageBox scenario (a configuration with more than one MessageBox), there is more than one MessageBox database, and each MessageBox database must be on its own SQL Server instance.</span></span> 

<span data-ttu-id="c6597-168">BizTalk Server は、SQL Server Analysis Services と BAM 分析とアーカイブのための SQL Server Integration Services にも依存します。</span><span class="sxs-lookup"><span data-stu-id="c6597-168">BizTalk Server also depends on SQL Server Analysis Services and SQL Server Integration Services for BAM Analysis and Archiving.</span></span> <span data-ttu-id="c6597-169">SQL Server は Integration Services または Azure IaaS での Analysis Services の高可用性ソリューションを提供していません。</span><span class="sxs-lookup"><span data-stu-id="c6597-169">SQL Server does not provide a high availability solution for Integration Services or Analysis Services in Azure IaaS.</span></span> <span data-ttu-id="c6597-170">そのため、BAMArchive と BAMAnalysis Analysis Services データベースを別のスタンドアロン SQL Server インスタンスを使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="c6597-170">It is therefore recommended to use another standalone SQL Server instance for the BAMArchive and BAMAnalysis Analysis Services databases.</span></span> <span data-ttu-id="c6597-171">オンプレミスでインストールする場合、高可用性構成の設定を SQL フェールオーバー クラスタ リング インスタンスを使用できます。</span><span class="sxs-lookup"><span data-stu-id="c6597-171">For on-premises installations, SQL Failover Clustering Instance can be used for setting up a high availability configuration.</span></span> 

<span data-ttu-id="c6597-172">この構成は、次の図に、可用性グループ内の BizTalk データベースのことをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="c6597-172">This configuration is illustrated below, and recommended for BizTalk Databases in Availability Groups:</span></span>  

![SQLAG_Recommended](../core/media/sqlag-recommended.png)
 
<span data-ttu-id="c6597-174">BizTalk Server の構成と SQL Server データベース、SQL Server セキュリティ ログイン、SQL エージェント ジョブも作成されます。</span><span class="sxs-lookup"><span data-stu-id="c6597-174">Along with SQL Server databases, BizTalk Server configuration also creates SQL Server security logins and SQL Agent Jobs.</span></span> <span data-ttu-id="c6597-175">AlwaysOn 可用性グループは、可用性グループ内のデータベースを管理する機能のみを提供します。</span><span class="sxs-lookup"><span data-stu-id="c6597-175">AlwaysOn Availability Groups only provide the ability to manage databases inside an Availability Group.</span></span> <span data-ttu-id="c6597-176">ログインと BizTalk の SQL エージェント ジョブは、作成および更新/管理できる手動ですべての可用性レプリカにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="c6597-176">Logins and SQL Agent Jobs for BizTalk need to be created and updated/managed manually on all the availability replicas.</span></span>  

> [!NOTE]
> <span data-ttu-id="c6597-177">SQL Server 2016 Service Pack 2 では、同じ可用性グループ内の複数のデータベース間の DTC トランザクションをサポートします。</span><span class="sxs-lookup"><span data-stu-id="c6597-177">SQL Server 2016 Service Pack 2 supports DTC transactions between multiple databases within the same Availability Group.</span></span> <span data-ttu-id="c6597-178">BizTalk Server では、CU5 以降、この機能をサポートします。</span><span class="sxs-lookup"><span data-stu-id="c6597-178">BizTalk Server supports this functionality starting with CU5.</span></span>

<span data-ttu-id="c6597-179">次の SQL Server セキュリティ ログインの一覧は、BizTalk Server に関連付けられます。</span><span class="sxs-lookup"><span data-stu-id="c6597-179">The following list of SQL Server security logins are associated with BizTalk Server.</span></span> <span data-ttu-id="c6597-180">追加のログインが、BizTalk Server アプリケーション用に作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c6597-180">You may have additional logins created for your BizTalk Server applications.</span></span> <span data-ttu-id="c6597-181">そうである場合は、BizTalk データベースのレプリカをホストする SQL Server のすべてのインスタンスでこれらをレプリケートする必要があります。</span><span class="sxs-lookup"><span data-stu-id="c6597-181">If so, you need to replicate them on every instance of SQL Server hosting a replica of BizTalk databases.</span></span> 

1. <span data-ttu-id="c6597-182">BizTalk アプリケーション ユーザーが (各インプロセス ホストに対応する 1 つまたは複数)</span><span class="sxs-lookup"><span data-stu-id="c6597-182">BizTalk Application Users (one or more corresponding to each in-proc Host)</span></span> 
2. <span data-ttu-id="c6597-183">BizTalk 分離ホスト ユーザー (分離ホストごとに対応する 1 つまたは複数)</span><span class="sxs-lookup"><span data-stu-id="c6597-183">BizTalk Isolated Host Users (one or more corresponding to each Isolated Host)</span></span> 
3. <span data-ttu-id="c6597-184">BizTalk Server 管理者</span><span class="sxs-lookup"><span data-stu-id="c6597-184">BizTalk Server Administrators</span></span> 
4. <span data-ttu-id="c6597-185">[BizTalk Server B2B Operators]</span><span class="sxs-lookup"><span data-stu-id="c6597-185">BizTalk Server B2B Operators</span></span> 
5. <span data-ttu-id="c6597-186">BizTalk Server オペレータ</span><span class="sxs-lookup"><span data-stu-id="c6597-186">BizTalk Server Operators</span></span> 
6. <span data-ttu-id="c6597-187">SSO 管理者</span><span class="sxs-lookup"><span data-stu-id="c6597-187">SSO Administrators</span></span> 
7. <span data-ttu-id="c6597-188">BAM 警告ユーザー</span><span class="sxs-lookup"><span data-stu-id="c6597-188">BAM Alerts User</span></span> 
8. <span data-ttu-id="c6597-189">BAM 管理 Web サービス ユーザー</span><span class="sxs-lookup"><span data-stu-id="c6597-189">BAM Management Web Service User</span></span> 
9. <span data-ttu-id="c6597-190">ルール エンジン更新サービス アカウント</span><span class="sxs-lookup"><span data-stu-id="c6597-190">Rule Engine Update Service Account</span></span> 

<span data-ttu-id="c6597-191">追加のホストを作成した後で追加のホストを作成するか、このプロセスの一環として作成された新しい SQL ログインがあります。</span><span class="sxs-lookup"><span data-stu-id="c6597-191">If you have created additional hosts or will create additional hosts later, there will be new SQL logins created as part of this process.</span></span> <span data-ttu-id="c6597-192">対応するレプリカに手動でこれらの SQL ログインを作成することを確認しておく必要があります。</span><span class="sxs-lookup"><span data-stu-id="c6597-192">You must make sure to create these SQL logins manually on the corresponding replicas.</span></span>

<span data-ttu-id="c6597-193">以下の SQL Server エージェント ジョブが BizTalk Server と関連付けられています。</span><span class="sxs-lookup"><span data-stu-id="c6597-193">The following SQL Server Agent jobs are associated with BizTalk Server.</span></span> <span data-ttu-id="c6597-194">各サーバーにインストールされるジョブは、インストールされて構成されている機能によって異なります。</span><span class="sxs-lookup"><span data-stu-id="c6597-194">The jobs installed on each server are different depending on which features are installed and configured.</span></span> <span data-ttu-id="c6597-195">これらのジョブのほとんどは、BizTalk Server の構成中に作成されます。</span><span class="sxs-lookup"><span data-stu-id="c6597-195">Most of these jobs are created during BizTalk Server configuration.</span></span> <span data-ttu-id="c6597-196">ログ配布の構成を行う際に作成されるものもあります。</span><span class="sxs-lookup"><span data-stu-id="c6597-196">Several are created when configuring log shipping.</span></span> <span data-ttu-id="c6597-197">これらのジョブは、対応する BizTalk データベースの SQL Server ホストのレプリカの各インスタンスにレプリケートする必要があります。</span><span class="sxs-lookup"><span data-stu-id="c6597-197">These jobs need to be replicated on each instance of SQL Server hosting replica of their corresponding BizTalk database.</span></span> <span data-ttu-id="c6597-198">これは手動で実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c6597-198">This must be performed manually.</span></span> 

- <span data-ttu-id="c6597-199">BizTalkMgmtDb ジョブ:</span><span class="sxs-lookup"><span data-stu-id="c6597-199">BizTalkMgmtDb jobs:</span></span> 
    - <span data-ttu-id="c6597-200">BizTalk Server のバックアップ (BizTalkMgmtDb)</span><span class="sxs-lookup"><span data-stu-id="c6597-200">Backup BizTalk Server (BizTalkMgmtDb)</span></span> 
    - <span data-ttu-id="c6597-201">CleanupBTFExpiredEntriesJob_BizTalkMgmtDb</span><span class="sxs-lookup"><span data-stu-id="c6597-201">CleanupBTFExpiredEntriesJob_BizTalkMgmtDb</span></span> 
    - <span data-ttu-id="c6597-202">BizTalk Server の監視 (BizTalkMgmtDb)</span><span class="sxs-lookup"><span data-stu-id="c6597-202">Monitor BizTalk Server (BizTalkMgmtDb)</span></span> 
- <span data-ttu-id="c6597-203">BizTalkMsgBoxDb ジョブ:</span><span class="sxs-lookup"><span data-stu-id="c6597-203">BizTalkMsgBoxDb jobs:</span></span> 
    - <span data-ttu-id="c6597-204">MessageBox_DeadProcesses_Cleanup_BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="c6597-204">MessageBox_DeadProcesses_Cleanup_BizTalkMsgBoxDb</span></span> 
    - <span data-ttu-id="c6597-205">MessageBox_Message_Cleanup_BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="c6597-205">MessageBox_Message_Cleanup_BizTalkMsgBoxDb</span></span>
    - <span data-ttu-id="c6597-206">MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="c6597-206">MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb</span></span>
    - <span data-ttu-id="c6597-207">MessageBox_Parts_Cleanup_BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="c6597-207">MessageBox_Parts_Cleanup_BizTalkMsgBoxDb</span></span> 
    - <span data-ttu-id="c6597-208">MessageBox_UpdateStats_BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="c6597-208">MessageBox_UpdateStats_BizTalkMsgBoxDb</span></span> 
    - <span data-ttu-id="c6597-209">Operations_OperateOnInstances_OnMaster_BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="c6597-209">Operations_OperateOnInstances_OnMaster_BizTalkMsgBoxDb</span></span> 
    - <span data-ttu-id="c6597-210">PurgeSubscriptionsJob_BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="c6597-210">PurgeSubscriptionsJob_BizTalkMsgBoxDb</span></span> 
    - <span data-ttu-id="c6597-211">TrackedMessages_Copy_BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="c6597-211">TrackedMessages_Copy_BizTalkMsgBoxDb</span></span> 
- <span data-ttu-id="c6597-212">追加のメッセージ ダイアログ上のジョブ</span><span class="sxs-lookup"><span data-stu-id="c6597-212">Jobs on additional msgboxes</span></span>
- <span data-ttu-id="c6597-213">BizTalkDTADb ジョブ:</span><span class="sxs-lookup"><span data-stu-id="c6597-213">BizTalkDTADb job:</span></span> 
    - <span data-ttu-id="c6597-214">DTA Purge and Archive (BizTalkDTADb)</span><span class="sxs-lookup"><span data-stu-id="c6597-214">DTA Purge and Archive (BizTalkDTADb)</span></span> 
- <span data-ttu-id="c6597-215">BizTalkRulesEngineDb ジョブ:</span><span class="sxs-lookup"><span data-stu-id="c6597-215">BizTalkRulesEngineDb job:</span></span> 
    - <span data-ttu-id="c6597-216">Rules_Database_Cleanup_BizTalkRuleEngineDb</span><span class="sxs-lookup"><span data-stu-id="c6597-216">Rules_Database_Cleanup_BizTalkRuleEngineDb</span></span> 
- <span data-ttu-id="c6597-217">BAMAlertsApplication ジョブ:</span><span class="sxs-lookup"><span data-stu-id="c6597-217">BAMAlertsApplication job:</span></span> 
    - <span data-ttu-id="c6597-218">0 または複数の DelAlertHistJob</span><span class="sxs-lookup"><span data-stu-id="c6597-218">0 or more DelAlertHistJob</span></span> 

<span data-ttu-id="c6597-219">異なり SQL フェールオーバー クラスタ リングのインスタンスでは、可用性グループですべてのレプリカはアクティブ、実行中、および使用できます。</span><span class="sxs-lookup"><span data-stu-id="c6597-219">Unlike SQL Failover Clustering Instances, in Availability Groups all replicas are active, running, and available.</span></span> <span data-ttu-id="c6597-220">SQL エージェント ジョブが各レプリカのフェールオーバーで重複しているときにするかどうかは、現在プライマリ ロールまたはセカンダリ ロールに関係なく、対応するレプリカに対して実行されます。</span><span class="sxs-lookup"><span data-stu-id="c6597-220">When SQL Agent jobs are duplicated on each replica for failover, they run against the corresponding replica, irrespective of whether it is currently in primary role or secondary role.</span></span> <span data-ttu-id="c6597-221">これらのジョブが現在プライマリ レプリカでのみ実行されるようにするに示すようにすべての手順では、すべてのジョブ、IF ブロックで囲む必要があります。</span><span class="sxs-lookup"><span data-stu-id="c6597-221">To make sure these jobs are executed only on the current primary replica, every step in every job must be enclosed within an IF block, as shown:</span></span> 

    ```
    IF (sys.fn_hadr_is_primary_replica(‘dbname’) = 1)  
    BEGIN  
    …  
    END
    ```
  
<span data-ttu-id="c6597-222">置換`‘dbname’`対応するデータベース名を対象となるジョブが実行するよう構成します。</span><span class="sxs-lookup"><span data-stu-id="c6597-222">Replace `‘dbname’` with the corresponding database name against which the job is configured to run.</span></span> <span data-ttu-id="c6597-223">次の例では、BizTalkMsgBoxDb で TrackedMessages_Copy_BizTalkMsgBoxDb にこの変更を示しています。</span><span class="sxs-lookup"><span data-stu-id="c6597-223">The following example shows this change for TrackedMessages_Copy_BizTalkMsgBoxDb on BizTalkMsgBoxDb:</span></span> 
 
 ![SQLAG_AgentJob](../core/media/sqlag-agentjob.gif)

### <a name="configure-biztalk-when-availability-groups-are-already-set-up"></a><span data-ttu-id="c6597-225">可用性グループが既にセットアップされているときに BizTalk を構成します。</span><span class="sxs-lookup"><span data-stu-id="c6597-225">Configure BizTalk when Availability Groups are already set up</span></span>

1. <span data-ttu-id="c6597-226">OS の要件を確認します。</span><span class="sxs-lookup"><span data-stu-id="c6597-226">Check your OS requirements:</span></span> 
2. <span data-ttu-id="c6597-227">すべての**Windows Server 2012 R2** 、コンピューターのインストール、 [3090973 MSDTC の修正プログラム](https://support.microsoft.com/kb/3090973)(サポート技術情報の記事が表示されます)</span><span class="sxs-lookup"><span data-stu-id="c6597-227">On all **Windows Server 2012 R2** computers, install the [3090973 MSDTC hotfix](https://support.microsoft.com/kb/3090973) (opens a KB article)</span></span>
3. <span data-ttu-id="c6597-228">すべての**Windows Server 2016** 、コンピューターを有効にする、 [RemoteAccessEnabled レジストリ キー](https://support.microsoft.com/kb/3182294) (サポート技術情報の記事が表示されます)</span><span class="sxs-lookup"><span data-stu-id="c6597-228">On all **Windows Server 2016** computers, enable the [RemoteAccessEnabled registry key](https://support.microsoft.com/kb/3182294) (opens a KB article)</span></span>
4. <span data-ttu-id="c6597-229">さまざまな BizTalk データベースをホストするには少なくとも 4 つの異なる SQL インスタンスを確認します。</span><span class="sxs-lookup"><span data-stu-id="c6597-229">Make sure to have at least four different SQL instances which will host the various BizTalk databases.</span></span> <span data-ttu-id="c6597-230">セカンダリ レプリカは、異なる SQL インスタンスで設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c6597-230">The secondary replicas should also be set up on different SQL instances.</span></span> <span data-ttu-id="c6597-231">これにより、(1 プライマリと 1 のセカンダリ レプリカを 4 つのインスタンスの各)、8 個の SQL インスタンスの最小値と 4 つの可用性グループの最小値。</span><span class="sxs-lookup"><span data-stu-id="c6597-231">This results in a minimum of 8 SQL instances (1 primary and 1 secondary replica for each of the 4 instances), and a minimum of 4 Availability Groups.</span></span> <span data-ttu-id="c6597-232">この可用性グループ構成上の図を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c6597-232">See the above illustration for this Availability Group configuration.</span></span> <span data-ttu-id="c6597-233">ことを確認して可用性グループを作成する、**データベースごとの DTC サポート**オプションとして、この後で変更することはできません。</span><span class="sxs-lookup"><span data-stu-id="c6597-233">Make sure Availability Groups are created with the **Per Database DTC Support** option as this cannot be changed later.</span></span> 
5. <span data-ttu-id="c6597-234">ときに BizTalk Server を構成し、SQL サーバー名を指定する実際のコンピューター名ではなく、可用性グループのリスナー名を使用します。</span><span class="sxs-lookup"><span data-stu-id="c6597-234">When configuring BizTalk Server and specifying the SQL server name, use the Availability Group’s listener name instead of the actual machine name.</span></span> <span data-ttu-id="c6597-235">これにより、現在のプライマリ レプリカで、BizTalk データベース、ログイン、および SQL エージェント ジョブが作成されます。</span><span class="sxs-lookup"><span data-stu-id="c6597-235">This creates the BizTalk databases, logins, and SQL Agent jobs on the current primary replica.</span></span> 
6. <span data-ttu-id="c6597-236">(ホスト インスタンス、SSO サービス、IIS、ルール エンジン更新サービス、BAMAlerts サービス、およびなど)、BizTalk 処理を停止し、SQL エージェント ジョブを停止します。</span><span class="sxs-lookup"><span data-stu-id="c6597-236">Stop BizTalk processing (Host Instances, SSO Service, IIS, Rules Engine Update Service, BAMAlerts Service, and so on), and stop the SQL Agent Jobs.</span></span> 
7. <span data-ttu-id="c6597-237">BIzTalk データベースをそれぞれの可用性グループに追加します。</span><span class="sxs-lookup"><span data-stu-id="c6597-237">Now add BIzTalk databases to the respective Availability Groups.</span></span> 
8. <span data-ttu-id="c6597-238">内の SQL エージェント ジョブ ステップの本文を囲む`IF`ブロック (前述) をターゲットがプライマリ レプリカである場合にのみを実行するかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="c6597-238">Enclose body of SQL Agent job steps within `IF` block (mentioned previously) to make sure they run only if the target is the primary replica.</span></span> 
9. <span data-ttu-id="c6597-239">対応するレプリカでこれらをレプリケートするには、ログインと SQL エージェント ジョブのスクリプトを作成します。</span><span class="sxs-lookup"><span data-stu-id="c6597-239">Script Logins and SQL Agent Jobs to replicate them on corresponding replica.</span></span> 
10. <span data-ttu-id="c6597-240">SQL DBMail プロファイルと、セカンダリ レプリカをホストしている、対応する SQL インスタンスで BAM 警告用のアカウントのレプリケート。</span><span class="sxs-lookup"><span data-stu-id="c6597-240">Replicate SQL DBMail Profile and Account for BAM Alerts on corresponding SQL instances hosting the secondary replica.</span></span> 
11. <span data-ttu-id="c6597-241">追加のメッセージ ボックス データベースを追加する新しい BAM アクティビティ/ビュー以降では、新しいし展開する場合は、新しいメッセージ ボックス データベースまたは現在のプライマリ レプリカ上の BAM 警告データベースの SQL ジョブが作成されます。</span><span class="sxs-lookup"><span data-stu-id="c6597-241">If you are adding an additional message box database or deploying a new BAM activity/view later, then new SQL jobs are created for new message box databases or BAM Alerts database on the current primary replica.</span></span> <span data-ttu-id="c6597-242">プライマリ レプリカで編集することを確認し、対応するセカンダリ レプリカでそれらを手動で作成します。</span><span class="sxs-lookup"><span data-stu-id="c6597-242">Make sure to edit it on primary replica, and then create them manually on the corresponding secondary replicas.</span></span> 

<span data-ttu-id="c6597-243">この構成を実行することも、プライマリ レプリカをホストしている SQL インスタンスを使用します。</span><span class="sxs-lookup"><span data-stu-id="c6597-243">This configuration can also be done using the SQL Instances hosting the primary replica.</span></span> <span data-ttu-id="c6597-244">この場合、BizTalk の構成後に実行、`UpdateDatabase.vbs`と`UpdateRegistry.vbs`BizTalk コンピューター上の手順の後のスクリプト。</span><span class="sxs-lookup"><span data-stu-id="c6597-244">In this case, after the BizTalk configuration, run the `UpdateDatabase.vbs` and `UpdateRegistry.vbs` scripts on the BizTalk machines after the above steps.</span></span> <span data-ttu-id="c6597-245">これは、次のセクションで詳しく説明します。</span><span class="sxs-lookup"><span data-stu-id="c6597-245">This is discussed in more detail in the next section.</span></span>  
 
### <a name="move-existing-biztalk-databases-to-availability-groups"></a><span data-ttu-id="c6597-246">既存の BizTalk データベースを可用性グループに移動します。</span><span class="sxs-lookup"><span data-stu-id="c6597-246">Move existing BizTalk databases to Availability Groups</span></span>

1. <span data-ttu-id="c6597-247">OS の要件を確認します。</span><span class="sxs-lookup"><span data-stu-id="c6597-247">Check your OS requirements:</span></span> 
2. <span data-ttu-id="c6597-248">すべての**Windows Server 2012 R2** 、コンピューターのインストール、 [3090973 MSDTC の修正プログラム](https://support.microsoft.com/kb/3090973)(サポート技術情報の記事が表示されます)</span><span class="sxs-lookup"><span data-stu-id="c6597-248">On all **Windows Server 2012 R2** computers, install the [3090973 MSDTC hotfix](https://support.microsoft.com/kb/3090973) (opens a KB article)</span></span>
3. <span data-ttu-id="c6597-249">すべての**Windows Server 2016** 、コンピューターを有効にする、 [RemoteAccessEnabled レジストリ キー](https://support.microsoft.com/kb/3182294) (サポート技術情報の記事が表示されます)</span><span class="sxs-lookup"><span data-stu-id="c6597-249">On all **Windows Server 2016** computers, enable the [RemoteAccessEnabled registry key](https://support.microsoft.com/kb/3182294) (opens a KB article)</span></span>
4. <span data-ttu-id="c6597-250">さまざまな BizTalk データベースをホストするには少なくとも 4 つの異なる SQL インスタンスを確認します。</span><span class="sxs-lookup"><span data-stu-id="c6597-250">Make sure to have at least four different SQL instances which will host the various BizTalk databases.</span></span> <span data-ttu-id="c6597-251">セカンダリ レプリカは、異なる SQL インスタンスで設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c6597-251">The secondary replicas should also be set up on different SQL instances.</span></span> <span data-ttu-id="c6597-252">これにより、(1 プライマリと 1 のセカンダリ レプリカを 4 つのインスタンスの各)、8 個の SQL インスタンスの最小値と 4 つの可用性グループの最小値。</span><span class="sxs-lookup"><span data-stu-id="c6597-252">This results in a minimum of 8 SQL instances (1 primary and 1 secondary replica for each of the 4 instances), and a minimum of 4 Availability Groups.</span></span> <span data-ttu-id="c6597-253">この可用性グループ構成上の図を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c6597-253">See the above illustration for this Availability Group configuration.</span></span> <span data-ttu-id="c6597-254">ことを確認して可用性グループを作成する**データベースごとの DTC サポート**オプションとして、この後で変更することはできません。</span><span class="sxs-lookup"><span data-stu-id="c6597-254">Make sure Availability Groups are created with **Per Database DTC Support** option as this cannot be changed later.</span></span>  
5. <span data-ttu-id="c6597-255">BizTalk 処理、SQL エージェント ジョブを停止します。</span><span class="sxs-lookup"><span data-stu-id="c6597-255">Stop BizTalk processing and SQL Agent Jobs.</span></span> 
6. <span data-ttu-id="c6597-256">すべての BizTalk データベースの完全バックアップを実行します。</span><span class="sxs-lookup"><span data-stu-id="c6597-256">Perform full backup of all BizTalk Databases.</span></span> 
7. <span data-ttu-id="c6597-257">可用性グループのプライマリ ロールの現在の SQL インスタンス上の BizTalk データベースを復元します。</span><span class="sxs-lookup"><span data-stu-id="c6597-257">Restore BizTalk databases on the SQL instances currently in the primary role in the Availability Group.</span></span> 
8. <span data-ttu-id="c6597-258">スクリプト ログインと SQL エージェント ジョブは現在、可用性グループのプライマリ ロールに対応する SQL インスタンスにします。</span><span class="sxs-lookup"><span data-stu-id="c6597-258">Script Logins and SQL Agent jobs on corresponding SQL Instances currently in the primary role in the Availability Group.</span></span>  
9. <span data-ttu-id="c6597-259">実行、`UpdateDatabase.vbs`と`UpdateRegistry.vbs`次の手順を使用して BizTalk のマシン上のスクリプト。</span><span class="sxs-lookup"><span data-stu-id="c6597-259">Run the `UpdateDatabase.vbs` and `UpdateRegistry.vbs` scripts on the BizTalk machines using the following steps.</span></span> <span data-ttu-id="c6597-260">入力の更新情報の xml で新しいサーバー名として、可用性グループ リスナーを入力します。</span><span class="sxs-lookup"><span data-stu-id="c6597-260">Enter the Availability Group Listener as the new server name in the input update info xml.</span></span>  
    1. <span data-ttu-id="c6597-261">BizTalk Server では、すべての BizTalk サービスとエンタープライズ SSO サービスを停止します。</span><span class="sxs-lookup"><span data-stu-id="c6597-261">Stop all BizTalk services and Enterprise SSO services on BizTalk Server.</span></span> <span data-ttu-id="c6597-262">SQL Server で SQL エージェント サービスを停止します。</span><span class="sxs-lookup"><span data-stu-id="c6597-262">Stop SQL Agent Service on SQL Server.</span></span> 
    2. <span data-ttu-id="c6597-263">BizTalk Server では、次のフォルダーに SampleUpdateInfo.xml を編集します。</span><span class="sxs-lookup"><span data-stu-id="c6597-263">On BizTalk Server, edit SampleUpdateInfo.xml in the following folder:</span></span> 
 
        <span data-ttu-id="c6597-264">32 ビット コンピューター: `%SystemRoot%\Program Files\Microsoft BizTalk Server 20xx\Schema\Restore`</span><span class="sxs-lookup"><span data-stu-id="c6597-264">32-bit computer: `%SystemRoot%\Program Files\Microsoft BizTalk Server 20xx\Schema\Restore`</span></span>
 
        <span data-ttu-id="c6597-265">64 ビット コンピューター: `%SystemRoot%\Program Files (x86)\Microsoft BizTalk Server 20xx\Bins32\Schema\Restore`</span><span class="sxs-lookup"><span data-stu-id="c6597-265">64-bit computer: `%SystemRoot%\Program Files (x86)\Microsoft BizTalk Server 20xx\Bins32\Schema\Restore`</span></span>
 
            1. Replace "SourceServer" with the source server name (old SQL Server hosting old databases).  
            2. Replace "DestinationServer" with the name of the destination server, which should be the availability group listener name.  
            3. If you have the BAMAnalysis, BAM databases or RuleEngineDB, uncomment the appropriate sections. 

    3. <span data-ttu-id="c6597-266">コマンド プロンプトを開きに移動します。</span><span class="sxs-lookup"><span data-stu-id="c6597-266">Open a command prompt, and go to:</span></span> 
 
        <span data-ttu-id="c6597-267">32 ビット コンピューター: `%SystemRoot%\Program Files\Microsoft BizTalk Server 20xx\Schema\Restore`</span><span class="sxs-lookup"><span data-stu-id="c6597-267">32-bit computer: `%SystemRoot%\Program Files\Microsoft BizTalk Server 20xx\Schema\Restore`</span></span> 
 
        <span data-ttu-id="c6597-268">64 ビット コンピューター: `%SystemRoot%\Program Files (x86)\Microsoft BizTalk Server 20xx\Bins32\Schema\Restore`</span><span class="sxs-lookup"><span data-stu-id="c6597-268">64-bit computer: `%SystemRoot%\Program Files (x86)\Microsoft BizTalk Server 20xx\Bins32\Schema\Restore`</span></span> 
 
        <span data-ttu-id="c6597-269">コマンド プロンプトで次のコマンドを実行します。</span><span class="sxs-lookup"><span data-stu-id="c6597-269">At the command prompt, run:</span></span>  
    `cscript UpdateDatabase.vbs SampleUpdateInfo.xml`  
 
        <span data-ttu-id="c6597-270">BizTalk グループ内の 1 つだけのサーバーで UpdateDatabase.vbs を実行します。</span><span class="sxs-lookup"><span data-stu-id="c6597-270">Run UpdateDatabase.vbs on only one server in the BizTalk group.</span></span> 

    4. <span data-ttu-id="c6597-271">この BizTalk グループ内のすべての BizTalk Server コンピューターの次のフォルダーには、編集した SampleUpdateInfo.xml ファイルをコピーします。</span><span class="sxs-lookup"><span data-stu-id="c6597-271">Copy the edited SampleUpdateInfo.xml file to the following folder on every BizTalk Server computer in this BizTalk group:</span></span> 
 
        <span data-ttu-id="c6597-272">32 ビット コンピューター: `%SystemRoot%\Program Files\Microsoft BizTalk Server 20xx\Schema\Restore`</span><span class="sxs-lookup"><span data-stu-id="c6597-272">32-bit computer: `%SystemRoot%\Program Files\Microsoft BizTalk Server 20xx\Schema\Restore`</span></span> 
 
        <span data-ttu-id="c6597-273">64 ビット コンピューター: `%SystemRoot%\Program Files (x86)\Microsoft BizTalk Server 20xx\Bins32\Schema\Restore`</span><span class="sxs-lookup"><span data-stu-id="c6597-273">64-bit computer: `%SystemRoot%\Program Files (x86)\Microsoft BizTalk Server 20xx\Bins32\Schema\Restore`</span></span> 
 
    5. <span data-ttu-id="c6597-274">BizTalk Server グループ内の各コンピューターでコマンド プロンプトを開きに移動します。</span><span class="sxs-lookup"><span data-stu-id="c6597-274">On each computer in the BizTalk Server group, open a command prompt, and go to:</span></span> 
 
        <span data-ttu-id="c6597-275">32 ビット コンピューター: `%SystemRoot%\Program Files\Microsoft BizTalk Server 20xx\Schema\Restore`</span><span class="sxs-lookup"><span data-stu-id="c6597-275">32-bit computer: `%SystemRoot%\Program Files\Microsoft BizTalk Server 20xx\Schema\Restore`</span></span>
 
        <span data-ttu-id="c6597-276">64 ビット コンピューター: `%SystemRoot%\Program Files (x86)\Microsoft BizTalk Server 20xx\Bins32\Schema\Restore`</span><span class="sxs-lookup"><span data-stu-id="c6597-276">64-bit computer: `%SystemRoot%\Program Files (x86)\Microsoft BizTalk Server 20xx\Bins32\Schema\Restore`</span></span> 
 
        <span data-ttu-id="c6597-277">コマンド プロンプトで次のコマンドを実行します。</span><span class="sxs-lookup"><span data-stu-id="c6597-277">At the command prompt, run:</span></span>  
    `cscript UpdateRegistry.vbs SampleUpdateInfo.xml` 
 
        <span data-ttu-id="c6597-278">BizTalk グループ内のすべてのサーバーで UpdateRegistry.vbs を実行します。</span><span class="sxs-lookup"><span data-stu-id="c6597-278">Run UpdateRegistry.vbs on every server in the BizTalk group.</span></span> 
 
10. <span data-ttu-id="c6597-279">今すぐデータベースをそれぞれの可用性グループに移動します。</span><span class="sxs-lookup"><span data-stu-id="c6597-279">Now move the databases to their respective Availability Groups.</span></span> 
11. <span data-ttu-id="c6597-280">SQL DBMail プロファイルと、SQL で BAM 警告のアカウントを BAMAlerts データベースのレプリカをホストのインスタンスをレプリケートします。</span><span class="sxs-lookup"><span data-stu-id="c6597-280">Replicate the SQL DBMail Profile and Account for BAM Alerts on the SQL instances hosting the replica of the BAMAlerts database.</span></span> 
12. <span data-ttu-id="c6597-281">ターゲットがプライマリである場合にのみを実行するかどうかを確認する IF ブロック内では、SQL エージェント ジョブ ステップの本文を囲みます。</span><span class="sxs-lookup"><span data-stu-id="c6597-281">Enclose the body of SQL Agent job steps within an IF block to make sure they run only if the target is the primary.</span></span> 
13. <span data-ttu-id="c6597-282">これらを対応するレプリカにレプリケートするには、ログインと SQL エージェント ジョブのスクリプトを作成します。</span><span class="sxs-lookup"><span data-stu-id="c6597-282">Script Logins and SQL Agent Jobs to replicate them on the corresponding replica.</span></span> <span data-ttu-id="c6597-283">UpdateDatabase スクリプトでは、Operations_OperateOnInstances_OnMaster_BizTalkMsgBoxDb および TrackedMessages_Copy_BizTalkMsgBoxDb ジョブ内のサーバー名も更新されます。</span><span class="sxs-lookup"><span data-stu-id="c6597-283">The UpdateDatabase script also updates the server name in the Operations_OperateOnInstances_OnMaster_BizTalkMsgBoxDb and TrackedMessages_Copy_BizTalkMsgBoxDb jobs.</span></span> <span data-ttu-id="c6597-284">そのスクリプト UpdateDatabase スクリプトを実行した後にのみ、SQL エージェント ジョブ。</span><span class="sxs-lookup"><span data-stu-id="c6597-284">So script the SQL Agent Jobs only after running the UpdateDatabase script.</span></span> 

## <a name="requirements"></a><span data-ttu-id="c6597-285">要件</span><span class="sxs-lookup"><span data-stu-id="c6597-285">Requirements</span></span> 
* <span data-ttu-id="c6597-286">BizTalk Server 2016 Enterprise</span><span class="sxs-lookup"><span data-stu-id="c6597-286">BizTalk Server 2016 Enterprise</span></span>
* <span data-ttu-id="c6597-287">SQL Server 2016 Enterprise または SQL Server 2016 Standard (を参照してください**既知の制限**このトピックの)</span><span class="sxs-lookup"><span data-stu-id="c6597-287">SQL Server 2016 Enterprise or SQL Server 2016 Standard (see **Known limitations** in this topic)</span></span>
* <span data-ttu-id="c6597-288">Windows Server 2012 R2 または Windows Server 2016</span><span class="sxs-lookup"><span data-stu-id="c6597-288">Windows Server 2012 R2 or Windows Server 2016</span></span> 

### <a name="availability-group-listener-configured-with-non-default-port-1433"></a><span data-ttu-id="c6597-289">既定以外で構成されている可用性グループ リスナー ポート (1433)</span><span class="sxs-lookup"><span data-stu-id="c6597-289">Availability Group Listener configured with non-default port (1433)</span></span> 
<span data-ttu-id="c6597-290">BizTalk Server コンピューターでエイリアス SQL を使用します。</span><span class="sxs-lookup"><span data-stu-id="c6597-290">Use SQL alias on BizTalk Server machines.</span></span> 

### <a name="support-availability-group-multi-subnet-failovers"></a><span data-ttu-id="c6597-291">サポートの可用性グループ マルチ サブネット フェールオーバー</span><span class="sxs-lookup"><span data-stu-id="c6597-291">Support Availability Group Multi-Subnet Failovers</span></span> 
<span data-ttu-id="c6597-292">BizTalk Server を使用して Microsoft OLE DB のデータベースの接続でサポートされていない、 **MultiSubnetFailover**接続オプションを選択します。</span><span class="sxs-lookup"><span data-stu-id="c6597-292">BizTalk Server uses Microsoft OLE DB for database connections, which does not support the **MultiSubnetFailover** connection option.</span></span> <span data-ttu-id="c6597-293">BizTalk Server がサポートしていません、`MultiSubnetFailover (=TRUE)`接続オプション、およびこれが上位の復旧時間マルチ サブネット フェールオーバー中にあります。</span><span class="sxs-lookup"><span data-stu-id="c6597-293">BizTalk Server does not support the `MultiSubnetFailover (=TRUE)` connection option, and this may cause higher recovery time during multi-subnet failover.</span></span> 

### <a name="read-only-routing"></a><span data-ttu-id="c6597-294">読み取り専用ルーティング</span><span class="sxs-lookup"><span data-stu-id="c6597-294">Read-Only Routing</span></span> 
<span data-ttu-id="c6597-295">読み取り専用ルーティングは読み取り専用ワークロードを許可するように構成されたセカンダリ レプリカを可用性グループ リスナーに対する着信接続をルーティングする SQL Server の機能を表します。</span><span class="sxs-lookup"><span data-stu-id="c6597-295">Read-only routing refers to the ability of SQL Server to route incoming connections for an availability group listener to a secondary replica that is configured to allow read-only workloads.</span></span> 

<span data-ttu-id="c6597-296">BizTalk は使いません読み取り専用ルーティングのいずれかのデータベースに接続します。</span><span class="sxs-lookup"><span data-stu-id="c6597-296">BizTalk does not use Read-Only Routing for any of the connections to its databases.</span></span> <span data-ttu-id="c6597-297">つまり、可用性グループ内の可用性レプリカ上の「読み取り可能なセカンダリ」オプションでは、BizTalk データベースの接続には、影響はありません。</span><span class="sxs-lookup"><span data-stu-id="c6597-297">This means the “Readable Secondary” option on Availability Replicas in the availability group does not have any impact on BizTalk database connections.</span></span> 

### <a name="behavior-of-biztalk-host-instances-during-sql-server-failover"></a><span data-ttu-id="c6597-298">SQL Server フェールオーバー時の BizTalk ホスト インスタンスの動作</span><span class="sxs-lookup"><span data-stu-id="c6597-298">Behavior of BizTalk Host Instances during SQL Server Failover</span></span> 
<span data-ttu-id="c6597-299">SQL Server 可用性グループにフェールオーバーが発生した場合、可用性グループの BizTalk Server データベースの内容が一時的に使用します。</span><span class="sxs-lookup"><span data-stu-id="c6597-299">If the SQL Server availability group experiences a failover, the BizTalk Server databases on the availability group are temporarily unavailable.</span></span> 

#### <a name="behavior-of-in-process-host-instances-during-sql-server-failover"></a><span data-ttu-id="c6597-300">SQL Server フェールオーバー時のインプロセス ホスト インスタンスの動作</span><span class="sxs-lookup"><span data-stu-id="c6597-300">Behavior of In-Process Host Instances during SQL Server Failover</span></span> 
<span data-ttu-id="c6597-301">BizTalk Server データベースが使用できない場合、BizTalk Server ホストのインプロセス インスタンスがリサイクルされる SQL Server への接続が復元されるまで。</span><span class="sxs-lookup"><span data-stu-id="c6597-301">If the BizTalk Server databases are unavailable, then an in-process instance of a BizTalk Server host is recycled until the connection to the SQL Server is restored.</span></span> <span data-ttu-id="c6597-302">SQL Server データベースへの接続が復元されると、通常ドキュメントの処理を再開します。</span><span class="sxs-lookup"><span data-stu-id="c6597-302">Once the connection to the SQL Server databases is restored, document processing resumes normally.</span></span>
 
#### <a name="behavior-of-isolated-host-instances-during-sql-server-failover"></a><span data-ttu-id="c6597-303">SQL Server フェールオーバー時の分離ホスト インスタンスの動作</span><span class="sxs-lookup"><span data-stu-id="c6597-303">Behavior of Isolated Host Instances During SQL Server Failover</span></span> 
<span data-ttu-id="c6597-304">BizTalk Server データベースが利用できない場合は、BizTalk Server ホストの分離インスタンスが一時停止し、および BizTalk Server アプリケーション ログに次のようなエラーが生成されます。</span><span class="sxs-lookup"><span data-stu-id="c6597-304">If the BizTalk Server databases are unavailable, then an isolated instance of a BizTalk Server host pauses, and an error similar to the following is generated in the BizTalk Server Application log:</span></span> 

    All receive locations are being temporarily disabled because either the MessageBox or Configuration database is not available. When these databases become available, the receive locations will be automatically enabled.
 
<span data-ttu-id="c6597-305">SQL Server データベースへの接続が復元されると、次のような情報メッセージは、BizTalk Server アプリケーション ログに書き込まれます、ドキュメントの処理を通常どおり再開します。</span><span class="sxs-lookup"><span data-stu-id="c6597-305">Once the connection to the SQL Server databases is restored, an informational message similar to the following is written to the BizTalk Server Application log, and then document processing resumes normally:</span></span> 

    All receive locations are being enabled because both the MessageBox and Configuration databases are back online.

#### <a name="log-shipping-for-disaster-recovery"></a><span data-ttu-id="c6597-306">ログ配布のディザスター リカバリー</span><span class="sxs-lookup"><span data-stu-id="c6597-306">Log Shipping for Disaster Recovery</span></span> 
<span data-ttu-id="c6597-307">BizTalk Server データベースを使用してデータベースのスタンバイ機能を実装するログ配布します。</span><span class="sxs-lookup"><span data-stu-id="c6597-307">BizTalk Server implements database standby capabilities through the use of database log shipping.</span></span> <span data-ttu-id="c6597-308">スタンバイ サーバーが、実稼働データベース サーバー、データベースが処理を再開できるようにログ配布のバックアップとデータベースとそのトランザクション ログ ファイルの復元を自動化する BizTalk Server は失敗します。</span><span class="sxs-lookup"><span data-stu-id="c6597-308">BizTalk Server log shipping automates the backup and restore of databases and their transaction log files, allowing a standby server to resume database processing in the event that the production database server fails.</span></span> 

<span data-ttu-id="c6597-309">**可用性グループ内のセカンダリ データベースは、バックアップではありません。**</span><span class="sxs-lookup"><span data-stu-id="c6597-309">**Secondary databases in availability group are not backups.**</span></span> <span data-ttu-id="c6597-310">BizTalk データベースのバックアップを続行し、BizTalk Server のログ配布ジョブを使用して、トランザクション ログに記録します。</span><span class="sxs-lookup"><span data-stu-id="c6597-310">Continue to backup BizTalk databases and their transaction logs using BizTalk Server Log Shipping jobs.</span></span> <span data-ttu-id="c6597-311">BizTalk ログ配布を実装する方法は、バックアップは常にすべてのデータベースの現在のプライマリ レプリカに対して実行することにより、します。</span><span class="sxs-lookup"><span data-stu-id="c6597-311">The way BizTalk Log Shipping is implemented ensures that backups are always performed against the current primary replica of every database.</span></span> <span data-ttu-id="c6597-312">可用性グループのバックアップ設定は、BizTalk Server のログ配布ジョブでは無視されます。</span><span class="sxs-lookup"><span data-stu-id="c6597-312">The backup preference setting on the availability group is not honored by the BizTalk Server Log Shipping jobs.</span></span> 

<span data-ttu-id="c6597-313">BizTalk データベースのバックアップ ジョブに他の BizTalk データベースを追加する場合は、バックアップのセットアップ時に、それらのデータベース サーバーとして、可用性グループ リスナー名を使用することを確認します。</span><span class="sxs-lookup"><span data-stu-id="c6597-313">If you are adding other BizTalk databases to the BizTalk Databases Backup job, be sure to use the Availability Group Listener name as the database server for them when setting up the Backup.</span></span>  
 
## <a name="references"></a><span data-ttu-id="c6597-314">References</span><span class="sxs-lookup"><span data-stu-id="c6597-314">References</span></span> 
 
* [<span data-ttu-id="c6597-315">BizTalk Server データベースの高可用性を実現します。</span><span class="sxs-lookup"><span data-stu-id="c6597-315">Providing High Availability for BizTalk Server Databases</span></span>](../core/providing-high-availability-for-biztalk-server-databases.md)  
* [<span data-ttu-id="c6597-316">Microsoft Azure 仮想マシンのマイクロソフト サーバー ソフトウェア サポート</span><span class="sxs-lookup"><span data-stu-id="c6597-316">Microsoft server software support for Microsoft Azure virtual machines</span></span>](https://support.microsoft.com/kb/2721672)  
* [<span data-ttu-id="c6597-317">SQL Server データベース ミラーリング、ボリューム シャドウ コピー サービス、および AlwaysOn の使用</span><span class="sxs-lookup"><span data-stu-id="c6597-317">SQL Server database mirroring, Volume Shadow Copy service and AlwaysOn</span></span>](../core/sql-server-database-mirroring-volume-shadow-copy-service-and-alwayson.md)  
* [<span data-ttu-id="c6597-318">AlwaysOn 可用性グループ (SQL Server) の概要</span><span class="sxs-lookup"><span data-stu-id="c6597-318">Overview of AlwaysOn Availability Groups (SQL Server)</span></span>](https://msdn.microsoft.com/library/ff877884.aspx)  
* [<span data-ttu-id="c6597-319">データベース ミラーリングまたは AlwaysOn 可用性グループ (SQL Server) のデータベースにまたがるトランザクションのサポート</span><span class="sxs-lookup"><span data-stu-id="c6597-319">Cross-Database Transactions Support For Database Mirroring or AlwaysOn Availability Groups (SQL Server)</span></span>](https://msdn.microsoft.com/library/ms366279.aspx)  
* [<span data-ttu-id="c6597-320">SQL Server Windows Server 2012 R2 での MSDTC からトランザクションの結果を受信すると、reenlist を呼び出すことができません。</span><span class="sxs-lookup"><span data-stu-id="c6597-320">Reenlist can't be called when SQL Server receives transaction outcome from MSDTC in Windows Server 2012 R2</span></span>](https://support.microsoft.com/kb/3090973)  
* [<span data-ttu-id="c6597-321">BizTalk Server データベースのバックアップと復元</span><span class="sxs-lookup"><span data-stu-id="c6597-321">Backing Up and Restoring BizTalk Server Databases</span></span>](../core/backing-up-and-restoring-biztalk-server-databases.md)  
* [<span data-ttu-id="c6597-322">BizTalk Server データベースを移動する方法</span><span class="sxs-lookup"><span data-stu-id="c6597-322">How to Move the BizTalk Server Databases</span></span>](../core/how-to-move-the-biztalk-server-databases.md)  
* [<span data-ttu-id="c6597-323">データベースを復元する方法</span><span class="sxs-lookup"><span data-stu-id="c6597-323">How to Restore Your Databases</span></span>](../core/how-to-restore-your-databases.md)   
* [<span data-ttu-id="c6597-324">マルチ サブネット可用性グループ内の接続のタイムアウト</span><span class="sxs-lookup"><span data-stu-id="c6597-324">Connection Timeouts in Multi-subnet Availability Group</span></span>](https://blogs.msdn.microsoft.com/alwaysonpro/2014/06/03/connection-timeouts-in-multi-subnet-availability-group/)  
 
## <a name="known-limitations"></a><span data-ttu-id="c6597-325">既知の制限事項</span><span class="sxs-lookup"><span data-stu-id="c6597-325">Known limitations</span></span> 

<span data-ttu-id="c6597-326">これらの制限は BizTalk Server、SQL Server AlwaysOn 可用性グループ、および Azure の仮想マシンです。</span><span class="sxs-lookup"><span data-stu-id="c6597-326">These limitations are for BizTalk Server, SQL Server AlwaysOn Availability Group, and Azure Virtual Machines.</span></span> <span data-ttu-id="c6597-327">これらの制限は、後で対処を取得しない場合があります。</span><span class="sxs-lookup"><span data-stu-id="c6597-327">These limitations may or may not get addressed in future.</span></span> 

* <span data-ttu-id="c6597-328">可用性グループ内では、ログイン、SQL エージェント ジョブ、SQL DB のメール プロファイル、およびアカウントが管理されていません。</span><span class="sxs-lookup"><span data-stu-id="c6597-328">Logins, SQL Agent Jobs, the SQL DB Mail profile, and accounts are not managed within Availability Groups.</span></span> <span data-ttu-id="c6597-329">これには、プライマリ レプリカに対して実行するかどうかを確認するジョブを手動で変更が必要です。</span><span class="sxs-lookup"><span data-stu-id="c6597-329">This requires manual modification in Jobs to make sure they run against the primary replica.</span></span> 
* <span data-ttu-id="c6597-330">SQL Server Analysis Services と SQL Server Integration Services は、可用性グループに参加しません。</span><span class="sxs-lookup"><span data-stu-id="c6597-330">SQL Server Analysis Services and SQL Server Integration Services do not participate in Availability Groups.</span></span> <span data-ttu-id="c6597-331">SQL Server からのこのサポートがない場合は、これらの Azure Virtual Machines での HA ソリューションはありません。</span><span class="sxs-lookup"><span data-stu-id="c6597-331">Without this support from SQL Server, there is no HA solution for these in Azure Virtual Machines.</span></span> <span data-ttu-id="c6597-332">BizTalk Server の BAM 機能では、これらのサービスに依存します。</span><span class="sxs-lookup"><span data-stu-id="c6597-332">BizTalk Server’s BAM capabilities are dependent on these services.</span></span> 
* <span data-ttu-id="c6597-333">SQL Server 2016 SP2 では、前に、可用性グループは、同じ SQL インスタンス上のデータベース間で MSDTC をサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="c6597-333">Prior to SQL Server 2016 SP2, Availability Groups don't support MSDTC between databases on the same SQL instance.</span></span> <span data-ttu-id="c6597-334">そのため、最小 8 SQL インスタンスでは、BizTalk を構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c6597-334">Therefore, a minimum 8 SQL instances are required to configure BizTalk.</span></span> 

  <span data-ttu-id="c6597-335">SQL Server 2016 SP2 以降では*と*BizTalk Server 2016 [CU5](https://support.microsoft.com/help/2555976/service-pack-and-cumulative-update-list-for-biztalk-server)、BizTalk データベースが同じ SQL Server インスタンスを使用できます。</span><span class="sxs-lookup"><span data-stu-id="c6597-335">Starting with SQL Server 2016 SP2 *and* BizTalk Server 2016 [CU5](https://support.microsoft.com/help/2555976/service-pack-and-cumulative-update-list-for-biztalk-server), the BizTalk databases can use the same SQL Server instance.</span></span> 

* <span data-ttu-id="c6597-336">MSDTC に対処するには、2 つのサーバーをホストしている 4 つの SQL インスタンスごとの最小値を使用して可用性グループ、BizTalk データベースの制限を構成できます。</span><span class="sxs-lookup"><span data-stu-id="c6597-336">To address MSDTC limitations with Availability Groups, BizTalk databases can be configured using a minimum of two servers hosting four SQL instances each.</span></span> <span data-ttu-id="c6597-337">使用することも[Azure Load Balancer の複数の IP アドレス](https://docs.microsoft.com/azure/load-balancer/load-balancer-multivip-overview)します。</span><span class="sxs-lookup"><span data-stu-id="c6597-337">You can also use [multiple IP addresses with the Azure Load Balancer](https://docs.microsoft.com/azure/load-balancer/load-balancer-multivip-overview).</span></span> <span data-ttu-id="c6597-338">1 台のサーバー上のポート 1433 で 4 つの既定の SQL インスタンスを使用する場合は、4 つの IP アドレスが必要です。</span><span class="sxs-lookup"><span data-stu-id="c6597-338">So if you want to use four default SQL instances on port 1433 on a single server, you need four IP addresses.</span></span> <span data-ttu-id="c6597-339">1 つの IP アドレスに制限されている場合、同じサーバー上の複数の SQL インスタンスをホストする SQL インスタンスごとにカスタム ポートを使用することを確認になります。</span><span class="sxs-lookup"><span data-stu-id="c6597-339">If you are restricted to one IP address, and you want to host multiple SQL instances on the same server, then be sure to use a custom port for each SQL instance.</span></span> 

  <span data-ttu-id="c6597-340">SQL Server 2016 SP2 以降では*と*BizTalk Server 2016 [CU5](https://support.microsoft.com/help/2555976/service-pack-and-cumulative-update-list-for-biztalk-server)、BizTalk Server データベースが同じ SQL Server インスタンスを使用できます。</span><span class="sxs-lookup"><span data-stu-id="c6597-340">Starting with SQL Server 2016 SP2 *and* BizTalk Server 2016 [CU5](https://support.microsoft.com/help/2555976/service-pack-and-cumulative-update-list-for-biztalk-server), the BizTalk Server databases can use the same SQL Server instance.</span></span> 

* <span data-ttu-id="c6597-341">BizTalk Server では、読み取り専用ルーティングを使用できません。</span><span class="sxs-lookup"><span data-stu-id="c6597-341">BizTalk Server cannot use Read-Only Routing.</span></span> 
* <span data-ttu-id="c6597-342">BizTalk Server が設定されていない、`MultiSubnetFailover`接続プロパティです。</span><span class="sxs-lookup"><span data-stu-id="c6597-342">BizTalk Server does not set the `MultiSubnetFailover` connection property.</span></span> 
* <span data-ttu-id="c6597-343">ログ配布を使用して BizTalk バックアップ ジョブは、可用性グループの設定、バックアップの設定に関係なく、プライマリ レプリカを常に対象とします。</span><span class="sxs-lookup"><span data-stu-id="c6597-343">BizTalk Backup Jobs using Log Shipping will always target the primary replica irrespective of the backup preference set on the Availability Group.</span></span> 
* <span data-ttu-id="c6597-344">SQL Server 2016 Standard は、各 SQL AlwaysOn 可用性グループの 1 つのデータベースを 1 つだけをサポートします。</span><span class="sxs-lookup"><span data-stu-id="c6597-344">SQL Server 2016 Standard supports only one single database in each SQL AlwaysOn AG.</span></span> <span data-ttu-id="c6597-345">BizTalk では、多数のデータベースを使用するための SQL Server Enterprise edition は通常お勧めします。</span><span class="sxs-lookup"><span data-stu-id="c6597-345">Since BizTalk uses many databases, SQL Server Enterprise edition is typically recommended.</span></span>
* <span data-ttu-id="c6597-346">Azure Vm を使用する場合、専用に使用する推奨が、MSDTC の固定 TCP/IP ポート。</span><span class="sxs-lookup"><span data-stu-id="c6597-346">If using Azure VMs, it's recommended to use a dedicated fixed TCP/IP port for MSDTC.</span></span> <span data-ttu-id="c6597-347">以前のオペレーティング システムで通常使用される、RPC ポートの範囲を制限することは、固定 TCP/IP ポートを使用する場合ファイアウォールを簡素化し、ロード バランサー規則をそのします。</span><span class="sxs-lookup"><span data-stu-id="c6597-347">When using a fixed TCP/IP port, you aren't limiting your RPC port range typically used with older operating systems; and it helps simplify your firewall and load balancer rules.</span></span> <span data-ttu-id="c6597-348">下の既知のポートとの競合を避けるためより高い固定ポートを使用してを検討してください (など > 20000)。</span><span class="sxs-lookup"><span data-stu-id="c6597-348">To avoid conflicts with known lower ports, consider using a higher fixed port (such as >20000).</span></span> <span data-ttu-id="c6597-349">[1 つのポートのサポートの DTC を構成する](https://msdn.microsoft.com/library/windows/desktop/dd573191(v=vs.85).aspx)について説明します、`ServerTcpPort`レジストリ キー。</span><span class="sxs-lookup"><span data-stu-id="c6597-349">[Configuring DTC Single Port Support](https://msdn.microsoft.com/library/windows/desktop/dd573191(v=vs.85).aspx) describes the `ServerTcpPort` registry key.</span></span> <span data-ttu-id="c6597-350">MSDTC の固定ポートに加え、メインの RPC ポート 135 も使用されます。</span><span class="sxs-lookup"><span data-stu-id="c6597-350">In addition to the fixed port for MSDTC, the main RPC port 135 is also used.</span></span> 
