---
title: 永続性とオーケストレーション エンジン |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- orchestration engine, persistence
- persistence
- orchestration engine, serialization
ms.assetid: 088230ef-13b3-440b-9875-6449f29dd5c6
caps.latest.revision: 11
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: c322c000002360e7637db3971721aa53e9225c5b
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/07/2019
ms.locfileid: "65314525"
---
# <a name="persistence-and-the-orchestration-engine"></a>永続性とオーケストレーション エンジン
状態の永続化、管理および復元は、オーケストレーション エンジンの基本的な機能の多くの基礎を形成します。 具体的には、永続化が正しく機能するが重要です。  
  
- 退避と復元  
  
- マシンに依存しない実行と復元  
  
- 補正モデル  
  
- 管理されたシステムのシャット ダウン  
  
- 復旧  
  
  オーケストレーション エンジンは、永続的ストレージに全体の状態を保存さまざまなポイントで実行中のオーケストレーション インスタンスを復元するため、インスタンスは後で完全にメモリ内。 状態は次のとおりです。  
  
- 現在の進行状況を含む、エンジンの内部状態。  
  
- 状態情報を保持し、オーケストレーションで使用されているすべての .NET コンポーネントの状態。  
  
- メッセージと変数の値。  
  
## <a name="persistence-points"></a>永続化ポイント  
 オーケストレーション エンジンは、さまざまな時点で実行中のオーケストレーション インスタンスの状態を保存します。 オーケストレーション インスタンスにリハイド レートで、制御されたシャット ダウンから起動するか、または予期しないシャット ダウンから回復する必要がある場合、最後の永続性ポイントからオーケストレーション インスタンスを実行して、何が発生した場合と同様にされます。 たとえば、メッセージを受信する状態を保存する前に、予期しないシャット ダウンがある場合、エンジンは記録されませんが、メッセージを受信し、受信、もう一度再起動時にこと。 エンジンは、次の状況でオーケストレーションの状態を保存します。  
  
-   トランザクション スコープの末尾に到達します。  
  
    -   エンジンは、補正を実行する正しくに応じてようにし、オーケストレーションを再開するポイントが明確に定義されているように、トランザクション スコープの最後の状態を保存します。  
  
    -   永続化が成功した場合、スコープの最後から実行するオーケストレーションが引き続きそれ以外の場合、適切な例外ハンドラーが呼び出されます。  
  
    -   スコープがトランザクションでアトミックの場合、エンジンは、コミット時にアトミックのスコープの最後の状態を保存します。  
  
    -   スコープがトランザクションで実行時間の長い場合は、エンジンが新しいトランザクションを生成し、スコープが完了すると、ランタイムの完全な状態を永続化します。  
  
-   デバッグのブレークポイントに到達します。  
  
-   メッセージが送信されます。 唯一の例外は、アトミック トランザクション スコープ内から送信されたメッセージです。  
  
-   オーケストレーションが別のオーケストレーションを非同期的に起動と同様、**オーケストレーションの開始**図形。  
  
-   オーケストレーション インスタンスが中断されます。  
  
-   オーケストレーション エンジンがシャット ダウンしようとして、再び開始するときに実行を再開できるように制御情報だけでなく、実行中のすべてのオーケストレーション インスタンスの現在の状態を保存するとは。 エンジンが現在の状態の保存に失敗した場合は、シャット ダウンする前に発生した最後の永続性ポイントからオーケストレーション インスタンスが再開されます。 これは、異常終了と同様に制御された条件下でシステムのシャット ダウンに適用されます。  
  
-   エンジンは、インスタンスが退避があることを決定します。  
  
-   オーケストレーション インスタンスが完了しました。  
  
## <a name="serialization"></a>シリアル化  
 オーケストレーションが直接または間接的に参照するすべてのオブジェクト インスタンス (別のオブジェクトを同様に)、オーケストレーションの状態を永続化するためにシリアル化する必要があります。 2 つの例外があります。  
  
-   シリアル化できないオブジェクトがアトミックのトランザクション内で宣言されていることができます。 アトミックのスコープに永続化ポイントが含まれていないために、これを行うことができます。  
  
-   System.Xml.XmlDocument はシリアル化可能なクラスではありません。特殊なケースとして処理され、どこでも使用できます。  
  
> [!CAUTION]
>  永続化する .NET オブジェクトの順序である必要がありますマークする必要がシリアル化可能として。  
  
> [!NOTE]
>  標準的な .NET シリアル化の手順を使用して、COM オブジェクトを保存できません。 アトミックのトランザクションの外部で COM オブジェクトを呼び出す場合は、シリアル化可能な .NET は、永続化および COM オブジェクトの状態を復元する方法を認識する .NET オブジェクトで COM オブジェクトをラップする必要があります。  
  
## <a name="system-shutdown"></a>システムのシャット ダウン  
 オーケストレーション エンジンがシャット ダウンしようとして、再び開始するときに実行を再開できるように制御情報だけでなく、実行中のすべてのオーケストレーション インスタンスの現在の状態を保存するとは。 エンジンが現在の状態の保存に失敗した場合は、シャット ダウンする前に発生した最後の永続性ポイントからオーケストレーション インスタンスが再開されます。 これは、異常終了と同様に制御された条件下でシステムのシャット ダウンに適用されます。  
  
## <a name="recovery"></a>復旧  
 エンジンは定期的に保存します永続的ストレージに、オーケストレーション インスタンスの状態情報と、システムのシャット ダウンが発生した場合の状態も保存します。  
  
 オーケストレーション インスタンスには、異常何らかの理由が失敗した場合、インスタンスは、最後の永続化状態から回復できるし、中断がなかったかのように実行を続けることです。 これは、インスタンスの実行元のサーバーがいくつかの理由のサービス外になる場合でも当てはまりますインスタンスは、別のコンピューターで実行されている単純に再開できます。 このマルチ サーバーの復旧モデルであるためが不要になったクラスター化します。  
  
## <a name="see-also"></a>参照  
 [オーケストレーションの退避と復元](../core/orchestration-dehydration-and-rehydration.md)