---
title: 'WCF アダプターに関する FAQ: メッセージ フローとマッピング |Microsoft Docs'
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 907e5c6a-a095-4b3a-9362-506832b6bc8c
caps.latest.revision: 4
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: ae55b6447923e9618a3e4776284659d48a2b25a9
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/27/2018
ms.locfileid: "36968179"
---
# <a name="wcf-adapter-faq-message-flow-and-mapping"></a><span data-ttu-id="90efa-102">WCF アダプターに関する FAQ: メッセージ フローとマッピング</span><span class="sxs-lookup"><span data-stu-id="90efa-102">WCF Adapter FAQ: Message Flow and Mapping</span></span>
## <a name="what-is-the-message-flow-within-the-wcf-and-biztalk-systems"></a><span data-ttu-id="90efa-103">WCF と BizTalk システム内のメッセージ フローとはどのようなものですか。</span><span class="sxs-lookup"><span data-stu-id="90efa-103">What is the message flow within the WCF and BizTalk systems?</span></span>  
 <span data-ttu-id="90efa-104">次に、受信 WCF メッセージから BizTalk Server へのフローについて説明します。</span><span class="sxs-lookup"><span data-stu-id="90efa-104">Here is a description of the flow of an incoming WCF message to BizTalk Server:</span></span>  
  
1. <span data-ttu-id="90efa-105">WCF メッセージは受信場所で受信され、BizTalk Server はホストされた WCF サービスをインスタンス化します。</span><span class="sxs-lookup"><span data-stu-id="90efa-105">A WCF message arrives at a receive location, and BizTalk Server instantiates a hosted WCF service.</span></span>  
  
2. <span data-ttu-id="90efa-106">WCF ランタイムはサービスのチャネル スタックとそのチャネル リスナーをインスタンス化します。</span><span class="sxs-lookup"><span data-stu-id="90efa-106">The WCF runtime instantiates the service’s channel stack and its channel listeners.</span></span> <span data-ttu-id="90efa-107">チャネル スタックは異なる処理タスクを処理する一連のステージです。</span><span class="sxs-lookup"><span data-stu-id="90efa-107">A channel stack is a sequence of stages that handle differing processing tasks.</span></span> <span data-ttu-id="90efa-108">各チャネル スタックは少なくとも 1 つのトランスポート チャネル、多くの場合は 1 つのメッセージ エンコーダー、および 0 個以上のプロトコル チャネルから構成されます。</span><span class="sxs-lookup"><span data-stu-id="90efa-108">Each channel stack consists of at least a transport channel, most often a message encoder, and zero or more protocol channels.</span></span> <span data-ttu-id="90efa-109">トランスポート チャネルでは受信メッセージ ストリームを受信時に読み取ります。</span><span class="sxs-lookup"><span data-stu-id="90efa-109">The transport channel reads the incoming message stream upon arrival.</span></span> <span data-ttu-id="90efa-110">トランスポート チャネルではエンコーダーを呼び出してメッセージを解釈し、WCF メッセージ オブジェクトを生成します。</span><span class="sxs-lookup"><span data-stu-id="90efa-110">It invokes an encoder to interpret the message and to produce a WCF Message object.</span></span> <span data-ttu-id="90efa-111">この時点で、各プロトコル チャネルでは順に WCF メッセージを操作する機会があります。</span><span class="sxs-lookup"><span data-stu-id="90efa-111">At this point each protocol channel will have an opportunity to operate on the WCF message in order.</span></span>  
  
3. <span data-ttu-id="90efa-112">WCF メッセージはリスナーにより受信され、構成済みの WCF チャネル スタックを介して転送され、適切なサービス インスタンスにディスパッチされます。</span><span class="sxs-lookup"><span data-stu-id="90efa-112">The WCF message is received by a listener that forwards it through the configured WCF channel stack and dispatches it to the proper service instance.</span></span> <span data-ttu-id="90efa-113">この時点で、WCF メッセージは BizTalk メッセージに変換 (マップ) されます。</span><span class="sxs-lookup"><span data-stu-id="90efa-113">At this point the WCF message is converted (mapped) to a BizTalk message.</span></span> <span data-ttu-id="90efa-114">簡単に説明すると、WCF メッセージ ヘッダーは BizTalk メッセージ コンテキストに書き込まれ、WCF メッセージ本文は BizTalk メッセージのボディ部に書き込まれます。</span><span class="sxs-lookup"><span data-stu-id="90efa-114">Briefly stated, the WCF message headers are written into the BizTalk message context, and the WCF message body is written into the  BizTalk message body part.</span></span> <span data-ttu-id="90efa-115">マッピングの制御、WCF メッセージのどの部分が BizTalk メッセージ本文: エンベロープ、本文、またはサブ要素です。</span><span class="sxs-lookup"><span data-stu-id="90efa-115">Mapping controls what part of the WCF message becomes the BizTalk message body: Envelope, body, or sub-element.</span></span>  
  
4. <span data-ttu-id="90efa-116">受信場所に構成されたパイプライン コンポーネントで BizTalk メッセージが処理されます。</span><span class="sxs-lookup"><span data-stu-id="90efa-116">Any pipeline components configured in the receive location processes the BizTalk message.</span></span>  
  
5. <span data-ttu-id="90efa-117">BizTalk メッセージはメッセージ ボックス データベースに保存されます。</span><span class="sxs-lookup"><span data-stu-id="90efa-117">The BizTalk message is stored in the MessageBox database.</span></span>  
  
   <span data-ttu-id="90efa-118">次に、BizTalk Server から送信 WCF メッセージへのフローについて説明します。</span><span class="sxs-lookup"><span data-stu-id="90efa-118">Here is a description of the flow of an outgoing WCF message from BizTalk Server:</span></span>  
  
6. <span data-ttu-id="90efa-119">BizTalk メッセージはサブスクリプションに従って送信ポートで受信されます。</span><span class="sxs-lookup"><span data-stu-id="90efa-119">A BizTalk message is received by a send port according to its subscription.</span></span>  
  
7. <span data-ttu-id="90efa-120">送信ポートに構成されたパイプライン コンポーネントで BizTalk メッセージが処理されます。</span><span class="sxs-lookup"><span data-stu-id="90efa-120">Any pipeline components configured in the send port process the BizTalk message.</span></span>  
  
8. <span data-ttu-id="90efa-121">WCF チャネル スタックはインスタンス化され、BizTalk メッセージはサービスの外部表示コントラクトに基づいて変換 (マップ) されます。</span><span class="sxs-lookup"><span data-stu-id="90efa-121">A WCF channel stack is instantiated, and the BizTalk message is converted (mapped) into a WCF message based upon the service’s external visible contract.</span></span>  
  
9. <span data-ttu-id="90efa-122">WCF チャネル スタックにより WCF メッセージは外部 WCF サービスに送信されます。</span><span class="sxs-lookup"><span data-stu-id="90efa-122">The WCF channel stack transmits the WCF message to the external WCF service.</span></span>  
  
## <a name="how-is-a-wcf-message-converted-mapped-into-a-biztalk-message"></a><span data-ttu-id="90efa-123">WCF メッセージはどのように BizTalk メッセージに変換 (マップ) されますか。</span><span class="sxs-lookup"><span data-stu-id="90efa-123">How is a WCF message converted (mapped) into a BizTalk message?</span></span>  
 <span data-ttu-id="90efa-124">マッピングを理解するには、WCF メッセージと BizTalk メッセージの構造を調べる必要があります。</span><span class="sxs-lookup"><span data-stu-id="90efa-124">In order to understand the mapping, we need to look at the structure of a WCF message and a BizTalk message.</span></span>  
  
 <span data-ttu-id="90efa-125">WCF メッセージは SOAP メッセージ構造をモデルとして作成されており、メッセージ プロパティ、メッセージ ヘッダー、および 1 つのメッセージ本文から構成されます。</span><span class="sxs-lookup"><span data-stu-id="90efa-125">A WCF message is modeled on the SOAP message structure and consists of message properties, message headers, and a single message body.</span></span>  
  
- <span data-ttu-id="90efa-126">**メッセージ プロパティ**メッセージ オブジェクトにアタッチされている共通言語ランタイム (CLR) オブジェクトします。</span><span class="sxs-lookup"><span data-stu-id="90efa-126">The **message properties** are Common Language Runtime (CLR) objects that are attached to the Message object.</span></span> <span data-ttu-id="90efa-127">プロパティは通信の両端にある WCF スタックとユーザーのアプリケーションの内部にあり、</span><span class="sxs-lookup"><span data-stu-id="90efa-127">Properties are internal to the WCF stack and the user’s application at each end of the communication.</span></span> <span data-ttu-id="90efa-128">クライアントとサーバー間で直接転送されることはありません。</span><span class="sxs-lookup"><span data-stu-id="90efa-128">They are never directly transferred between client and server.</span></span>  
  
- <span data-ttu-id="90efa-129">**メッセージ ヘッダー**、ただし、クライアントとサーバー間で転送されます。</span><span class="sxs-lookup"><span data-stu-id="90efa-129">**Message headers**, however, are transferred between client and server.</span></span> <span data-ttu-id="90efa-130">1 つのメッセージで複数のヘッダーを使用できますが、メッセージ本文は 1 つだけです。ヘッダーと異なり、メッセージ本文はストリーム化されます。</span><span class="sxs-lookup"><span data-stu-id="90efa-130">There can be many headers on a message, but there is only one message body, and unlike the headers the message body is streamed.</span></span> <span data-ttu-id="90efa-131">メッセージ ヘッダーとメッセージ本文は XML Infoset として定義されます。</span><span class="sxs-lookup"><span data-stu-id="90efa-131">Both the message headers and the message body are defined as an XML Infoset.</span></span>  
  
- <span data-ttu-id="90efa-132">**本文**WCF メッセージは、メッセージのプロパティとヘッダーの詳細情報の主要な内容。</span><span class="sxs-lookup"><span data-stu-id="90efa-132">The **body** of a WCF message is the main content of the message for which the properties and headers provide more information.</span></span>  
  
  <span data-ttu-id="90efa-133">BizTalk メッセージの構造は異なります。</span><span class="sxs-lookup"><span data-stu-id="90efa-133">A BizTalk message has a different structure.</span></span>  
  
- <span data-ttu-id="90efa-134">各メッセージには 1 組のコンテキスト プロパティがあります。</span><span class="sxs-lookup"><span data-stu-id="90efa-134">There is a single set of context properties on each message.</span></span> <span data-ttu-id="90efa-135">各コンテキスト プロパティは名前空間名と値のペアから構成されます。</span><span class="sxs-lookup"><span data-stu-id="90efa-135">Each context property consists of a namespace name/value pair.</span></span> <span data-ttu-id="90efa-136">コンテキスト プロパティは昇格または書き込みが可能です。</span><span class="sxs-lookup"><span data-stu-id="90efa-136">Context properties can be either promoted or written.</span></span> <span data-ttu-id="90efa-137">昇格させると、BizTalk Server 内で実行されるルーティング ルールに加えることができます。</span><span class="sxs-lookup"><span data-stu-id="90efa-137">If they are promoted, they can take part in the routing rules that execute within BizTalk Server.</span></span>  
  
- <span data-ttu-id="90efa-138">BizTalk Server のメッセージのデータは複数のストリームで構成することができます。</span><span class="sxs-lookup"><span data-stu-id="90efa-138">The data of a message in BizTalk Server can consist of multiple streams.</span></span> <span data-ttu-id="90efa-139">各ストリームは独立して読み取ることができるため、BizTalk メッセージはマルチパートです。</span><span class="sxs-lookup"><span data-stu-id="90efa-139">A BizTalk message is multipart because each stream can be read independently.</span></span> <span data-ttu-id="90efa-140">メッセージ部の 1 つは特別であり、ボディ部と呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="90efa-140">One of the message parts is special and it is referred to as the body part.</span></span>  
  
  <span data-ttu-id="90efa-141">通信は双方向になることがあるため、WCF アダプターを使用すると、メッセージ交換の送信と受信の両方向に特定の変換またはマッピングを構成できます。</span><span class="sxs-lookup"><span data-stu-id="90efa-141">Because the communication can sometimes be two-way, the WCF adapter allows the particular translation or mapping to be configured for both inbound and outbound directions of message exchange.</span></span> <span data-ttu-id="90efa-142">この構成は、BizTalk Server 内の受信場所と送信ポートの両方に行うことができます。</span><span class="sxs-lookup"><span data-stu-id="90efa-142">This can be done for both the receive locations and send ports within BizTalk Server.</span></span>  
  
  <span data-ttu-id="90efa-143">BizTalk WCF アダプターでは、これら 2 つのメッセージ構造間の実行時変換について、さまざまな組み合わせをサポートしています。</span><span class="sxs-lookup"><span data-stu-id="90efa-143">The BizTalk WCF adapters support a number of permutations of translating at run time between these two message structures.</span></span> <span data-ttu-id="90efa-144">マッピングはによって制御されます、**メッセージ** タブで、**トランスポートのプロパティ**WCF アダプターのダイアログ ボックス。</span><span class="sxs-lookup"><span data-stu-id="90efa-144">Mapping is controlled through the **Messages** tab in the **Transport Properties** dialog box for a WCF adapter.</span></span> <span data-ttu-id="90efa-145">たとえば、最も基本的な変換 (既定値) は、受信 WCF メッセージの本文が BizTalk メッセージの本文になるときです。</span><span class="sxs-lookup"><span data-stu-id="90efa-145">For example, the most obvious translation, and the default, is when the body of an inbound WCF message becomes the body of the BizTalk message.</span></span> <span data-ttu-id="90efa-146">マップ モードの詳細については、次を参照してください。 [ http://go.microsoft.com/fwlink/?LinkID=119792](http://go.microsoft.com/fwlink/?LinkID=119792)します。</span><span class="sxs-lookup"><span data-stu-id="90efa-146">For more information about mapping modes, see [http://go.microsoft.com/fwlink/?LinkID=119792](http://go.microsoft.com/fwlink/?LinkID=119792).</span></span>  
  
## <a name="how-can-you-preserve-the-complete-incoming-wcf-message-inside-the-biztalk-message"></a><span data-ttu-id="90efa-147">受信 WCF メッセージ全体を BizTalk メッセージ内に保存する方法</span><span class="sxs-lookup"><span data-stu-id="90efa-147">How can you preserve the complete incoming WCF message inside the BizTalk message?</span></span>  
 <span data-ttu-id="90efa-148">受信 BizTalk メッセージ本文オプションの 1 つ、**エンベロープ**オプション。</span><span class="sxs-lookup"><span data-stu-id="90efa-148">One of the inbound BizTalk message body options is the **Envelope** option.</span></span> <span data-ttu-id="90efa-149">このオプションを選択すると、soap:Envelope 要素内に含まれている SOAP メッセージ全体が受信 BizTalk メッセージ本文に入ります。</span><span class="sxs-lookup"><span data-stu-id="90efa-149">Choosing this option takes the entire SOAP message contained within the soap:Envelope element into the incoming BizTalk message body.</span></span> <span data-ttu-id="90efa-150">生成される BizTalk メッセージにはエンベロープ タグ、すべてのヘッダー、および本文が含まれます。</span><span class="sxs-lookup"><span data-stu-id="90efa-150">The resulting BizTalk message contains the Envelope tags, all the headers, and the body.</span></span>  
  
## <a name="how-can-you-extract-specific-elements-of-the-incoming-wcf-message-into-a-biztalk-message-or-map-elements-of-an-outgoing-biztalk-message-to-an-outgoing-wcf-message"></a><span data-ttu-id="90efa-151">受信 WCF メッセージの特定要素を BizTalk メッセージに抽出するか、送信 BizTalk メッセージの要素を送信 WCF メッセージにマップする方法</span><span class="sxs-lookup"><span data-stu-id="90efa-151">How can you extract specific elements of the incoming WCF message into a BizTalk message, or map elements of an outgoing BizTalk message to an outgoing WCF message?</span></span>  
 <span data-ttu-id="90efa-152">WCF または BizTalk のメッセージ本文の一部をマップするには、パスまたはテンプレート オプションを使用します。</span><span class="sxs-lookup"><span data-stu-id="90efa-152">To map a section of a WCF or BizTalk message body, use the Path or Template option.</span></span> <span data-ttu-id="90efa-153">XPath 式を入力して、メッセージ本文の特定部分を抽出できます。</span><span class="sxs-lookup"><span data-stu-id="90efa-153">This allows you to enter an XPath expression to extract specific parts of the message body.</span></span> <span data-ttu-id="90efa-154">この場合、XPath 構文全体はサポートされていません。これは、抽出がストリーム化されており、したがってリーダーは常に前進する必要があるためです。</span><span class="sxs-lookup"><span data-stu-id="90efa-154">Full XPath syntax is not supported in this situation as the extraction is streamed and the reader must therefore always walk forward.</span></span> <span data-ttu-id="90efa-155">その理由には、**メッセージ** タブの パス--本文のパスで見つかったコンテンツ"XPath--本文のパスで見つかったコンテンツ"の代わりに呼び出されます</span><span class="sxs-lookup"><span data-stu-id="90efa-155">This is why in the **Messages** tab it is called “Path – content located by body path” instead of “XPath – content located by body path.”</span></span>  
  
 <span data-ttu-id="90efa-156">受信側では、WCF メッセージからデータを読み取る方法を示すパス式を使用します。</span><span class="sxs-lookup"><span data-stu-id="90efa-156">On the receive side, use a Path expression that dictates how data is to be read from the WCF message.</span></span> <span data-ttu-id="90efa-157">受信メッセージの場合、Path ステートメントにより抽出される特定要素は BizTalk メッセージのコンテンツの代わりとして使用されます。</span><span class="sxs-lookup"><span data-stu-id="90efa-157">For an inbound message, the specific element extracted by the Path statement gets substituted for the content of the BizTalk message.</span></span> <span data-ttu-id="90efa-158">アダプターではこのパス式を使用して BizTalk メッセージの必要なデータを検索し、抽出します。</span><span class="sxs-lookup"><span data-stu-id="90efa-158">The adapter uses this Path expression to locate and extract the desired data for the BizTalk message.</span></span>  
  
 <span data-ttu-id="90efa-159">送信側では、テンプレートを使用して BizTalk メッセージから WCF メッセージを作成します。</span><span class="sxs-lookup"><span data-stu-id="90efa-159">On the send side, use a template to create a WCF message from the BizTalk message.</span></span> <span data-ttu-id="90efa-160">送信メッセージのテンプレート オプションは XPath オプションの正反対のことを可能にするよう設計されています。</span><span class="sxs-lookup"><span data-stu-id="90efa-160">The template option for outbound messages is designed to allow the exact opposite of the XPath option.</span></span> <span data-ttu-id="90efa-161">WCF アダプター構成で、XML のスニペットは送信メッセージの構造の基本部分として使用されます。</span><span class="sxs-lookup"><span data-stu-id="90efa-161">In the WCF adapter configuration, the snippet of XML is used as the basis for the structure of the outbound message.</span></span> <span data-ttu-id="90efa-162">BizTalk メッセージのコンテンツは実行時にこの構造に挿入されます。</span><span class="sxs-lookup"><span data-stu-id="90efa-162">The content of the BizTalk message is inserted at run time into this structure.</span></span>  
  
 <span data-ttu-id="90efa-163">また、送信メッセージの場合、ノード エンコード設定を使用して書き込む要素の種類を XML、Base64、文字列、16 進のうちから選択する必要もあります。</span><span class="sxs-lookup"><span data-stu-id="90efa-163">For an outgoing message, you must also choose the type of the element written by using the Node Encoding setting from XML, Base64, String, or Hexadecimal.</span></span> <span data-ttu-id="90efa-164">WCF メッセージに含まれたバイナリ データ ストリームを抽出する場合、このオプションは役立ちます。</span><span class="sxs-lookup"><span data-stu-id="90efa-164">This option is very useful when you want to extract a binary data stream contained in a WCF message.</span></span> <span data-ttu-id="90efa-165">この機能を使用すると、WCF アダプターは WCF メッセージの本文リーダーに ReadContextAsBase64 呼び出しを使用するよう指示されます。</span><span class="sxs-lookup"><span data-stu-id="90efa-165">Using this feature instructs the WCF Adapter to use the ReadContextAsBase64 calls on the body Reader of the WCF Message.</span></span> <span data-ttu-id="90efa-166">この呼び出しではバイナリ データは XmlReader API を介して直接読み取ることができるため、この機能を使用すると、バイナリ データを WCF トランスポートから BizTalk メッセージボックス データベースに直接移動できます。</span><span class="sxs-lookup"><span data-stu-id="90efa-166">This call allows binary data to be read directly through the XmlReader API, so using this feature binary data can be moved directly from the WCF Transport into the BizTalk MessageBox database.</span></span> <span data-ttu-id="90efa-167">バイナリ データが入ったノードへのパスを書き込むことで、バイナリ データを取り出し、BizTalk メッセージに入れることができます。</span><span class="sxs-lookup"><span data-stu-id="90efa-167">By writing a path to the node containing the binary data you can pull it out and place it into the BizTalk message.</span></span>  
  
## <a name="how-do-you-access-wcf-message-properties-within-an-incoming-wcf-message"></a><span data-ttu-id="90efa-168">受信 WCF メッセージ内の WCF メッセージ プロパティにアクセスする方法</span><span class="sxs-lookup"><span data-stu-id="90efa-168">How do you access WCF message properties within an incoming WCF message?</span></span>  
 <span data-ttu-id="90efa-169">受信 WCF メッセージが BizTalk メッセージに変換される前に WCF メッセージ内のプロパティにアクセスする場合、WCF ビヘイビアーでカスタム WCF チャネル コンポーネントまたはサービス モデル機能拡張ポイントを使用できます。</span><span class="sxs-lookup"><span data-stu-id="90efa-169">To access properties within an incoming WCF message before it is transformed into a BizTalk message, you can use a custom WCF channel component or a service model extensibility point with a WCF behavior.</span></span> <span data-ttu-id="90efa-170">たとえば、 **IDispatchMessageInspector**オブジェクト。</span><span class="sxs-lookup"><span data-stu-id="90efa-170">For example, an **IDispatchMessageInspector** object.</span></span> <span data-ttu-id="90efa-171">BizTalk Wcf-custom および Wcf-customisolated アダプターは、アプリケーションを使用して WCF 動作の電源に接続するためのシンプルな手段を提供、**動作** タブで、**トランスポートのプロパティ**のダイアログ ボックスこれらのアダプター。</span><span class="sxs-lookup"><span data-stu-id="90efa-171">The BizTalk WCF-Custom and WCF-CustomIsolated adapters provide a simple way for your application to plug into the power of WCF behaviors using the **Behavior** tab in the **Transport Properties** dialog for those adapters.</span></span>  
  
 <span data-ttu-id="90efa-172">WCF メッセージのプロパティが WCF アダプターで利用できるようにするには、最初にこれらのプロパティをメッセージ本文またはヘッダーのコンテンツとして書き込む必要があります。</span><span class="sxs-lookup"><span data-stu-id="90efa-172">To allow the properties of a WCF message to be available to the WCF adapter, those properties first have to be written into the message body or header as content.</span></span> <span data-ttu-id="90efa-173">ヘッダーは自動的に BizTalk メッセージ コンテキストにコピーされます。</span><span class="sxs-lookup"><span data-stu-id="90efa-173">The headers are copied into the BizTalk message context automatically for you.</span></span> <span data-ttu-id="90efa-174">BizTalk メッセージ コンテキストに内から WCF メッセージのプロパティを昇格させるカスタム BizTalk パイプライン コンポーネントを使用するには昇格されたプロパティ値を設定する場合、 **IComponent: 実行**メソッド。</span><span class="sxs-lookup"><span data-stu-id="90efa-174">If you want a property value promoted, you can use a custom BizTalk pipeline component to promote the WCF message property into the BizTalk message context from within the **IComponent:Execute** method.</span></span> <span data-ttu-id="90efa-175">WCF カスタム アダプターと共にカスタム WCF ビヘイビアーを使用すると、WCF と BizTalk の拡張機能を利用してより高性能で柔軟性の高いソリューションを作成できます。</span><span class="sxs-lookup"><span data-stu-id="90efa-175">Using custom WCF behaviors with the WCF custom adapters allows you to take advantage of both WCF and BizTalk extensibility to make your solution more powerful and flexible.</span></span> <span data-ttu-id="90efa-176">WCF アダプターを使用すると、既存の BizTalk と WCF の拡張機能を組み合わせて問題を解決できます。</span><span class="sxs-lookup"><span data-stu-id="90efa-176">The WCF adapter allows you to combine existing BizTalk and WCF extensibilities to solve your problem.</span></span>  
  
 <span data-ttu-id="90efa-177">一般的なプロパティの場合、WCF アダプターには簡単な方法があります。</span><span class="sxs-lookup"><span data-stu-id="90efa-177">The good news is that there is a shortcut in the WCF adapter for this common property case.</span></span> <span data-ttu-id="90efa-178">両方の拡張機能に書き込む代わりに、WCF 拡張機能により WCF アダプターで認識される新しい "既知の" プロパティを作成できます。</span><span class="sxs-lookup"><span data-stu-id="90efa-178">Rather than writing to both extensibility stories, you can simply have the WCF extension create a new “well known” property that is understood by the WCF adapter.</span></span>  
  
 <span data-ttu-id="90efa-179">SOAP ヘッダー値を BizTalk メッセージ コンテキストに書き込むか昇格させるには、プロパティ名と名前空間から構成される値ペアのコレクションが WCF メッセージに含まれている必要があります。</span><span class="sxs-lookup"><span data-stu-id="90efa-179">In order to write or promote SOAP header values into the BizTalk message context, the WCF message must contain a collection of value pairs that consist of property names and namespaces.</span></span> <span data-ttu-id="90efa-180">これによって、WCF アダプターではヘッダー値が書き込まれるか昇格されるかを認識できます。</span><span class="sxs-lookup"><span data-stu-id="90efa-180">This allows the WCF adapters to recognize that the header values are to be written or promoted.</span></span>  
  
 <span data-ttu-id="90efa-181">WCF アダプターで SOAP ヘッダーの値を BizTalk メッセージ コンテキストに書き込む、または昇格させるには、WCF メッセージで次のメッセージ プロパティを指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="90efa-181">A WCF adapter expects the following message properties in the WCF messages for writing or promoting SOAP header values to the BizTalk message context:</span></span>  
  
-   <span data-ttu-id="90efa-182">BizTalk メッセージ コンテキストに SOAP ヘッダーの値を昇格するには、WCF アダプターを検索して、キーのペアを**http://schemas.microsoft.com/BizTalk/2006/01/Adapters/WCF-properties/Promote**と値**一覧 < KeyValuePair\<XmlQualifiedName、オブジェクト\>>**.</span><span class="sxs-lookup"><span data-stu-id="90efa-182">To promote the SOAP header values to the BizTalk message context, WCF adapters are looking for the pair of key **http://schemas.microsoft.com/BizTalk/2006/01/Adapters/WCF-properties/Promote** and value **List<KeyValuePair\<XmlQualifiedName, object\>>**.</span></span> <span data-ttu-id="90efa-183">このペアを使用して、WCF アダプタを名前空間、名前、および値から、 **XmlQualifiedName**オブジェクトし、ヘッダーの値を昇格する場合に使用します。</span><span class="sxs-lookup"><span data-stu-id="90efa-183">Using this pair, WCF adapters take the namespace, name, and value from the **XmlQualifiedName** object and use them for promoting the header values.</span></span>  
  
-   <span data-ttu-id="90efa-184">キーのペアを WCF アダプタの検索になりますが、SOAP ヘッダーの値を BizTalk メッセージ コンテキストに昇格しません**http://schemas.microsoft.com/BizTalk/2006/01/Adapters/WCF-properties/WriteToContext**と値**一覧 < KeyValuePair\<XmlQualifiedName、オブジェクト\>>。**</span><span class="sxs-lookup"><span data-stu-id="90efa-184">To write, but not promote, the SOAP header values into the BizTalk message context, WCF adapters are looking for the pair of key **http://schemas.microsoft.com/BizTalk/2006/01/Adapters/WCF-properties/WriteToContext** and value **List<KeyValuePair\<XmlQualifiedName, object\>>.**</span></span> <span data-ttu-id="90efa-185">WCF アダプターは、このペアを使用して、値をメッセージ コンテキストに書き込みます。</span><span class="sxs-lookup"><span data-stu-id="90efa-185">Using this pair, WCF adapters write the values to the message context.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="90efa-186">昇格されたプロパティは、BizTalk ランタイムで受け付けられるようにするため、BizTalk プロパティ スキーマにも指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="90efa-186">Promoted properties must also be specified in a BizTalk property schema in order to be accepted by the BizTalk runtime.</span></span>  
  
## <a name="you-have-an-existing-orchestration-or-send-port-etc-that-expects-a-biztalk-multipart-message-how-can-you-get-a-multipart-message-in-the-wcf-scenario"></a><span data-ttu-id="90efa-187">BizTalk マルチパート メッセージを想定している既存のオーケストレーション (または送信ポートなど) があります。</span><span class="sxs-lookup"><span data-stu-id="90efa-187">You have an existing orchestration (or send port, etc.) that expects a BizTalk multipart message.</span></span> <span data-ttu-id="90efa-188">どのようにすれば WCF シナリオでマルチパート メッセージを取得できますか。</span><span class="sxs-lookup"><span data-stu-id="90efa-188">How can you get a multipart message in the WCF scenario?</span></span>  
 <span data-ttu-id="90efa-189">BizTalk マルチパート メッセージは 1 つ以上のメッセージ部分から構成されます。</span><span class="sxs-lookup"><span data-stu-id="90efa-189">A BizTalk multipart message is composed of one or more message parts.</span></span> <span data-ttu-id="90efa-190">しかし、WCF にはマルチパート メッセージの概念がありません。</span><span class="sxs-lookup"><span data-stu-id="90efa-190">However, WCF has no concept of a multipart message.</span></span> <span data-ttu-id="90efa-191">WCF ではマルチパート メッセージを使用しないため、BizTalk WCF アダプターでもマルチパート メッセージを使用しません。</span><span class="sxs-lookup"><span data-stu-id="90efa-191">Because WCF does not use multipart messages, the BizTalk WCF adapters also do not use them.</span></span> <span data-ttu-id="90efa-192">問題は、マルチパート メッセージを作成するか使用するよう書かれた既存の BizTalk オーケストレーションまたはパイプラインがある場合です。</span><span class="sxs-lookup"><span data-stu-id="90efa-192">The problem is that you may have an existing BizTalk orchestration or pipeline that is written to produce or consume multipart messages.</span></span>  
  
 <span data-ttu-id="90efa-193">受信 WCF メッセージと WCF アダプターを使用してマルチパート メッセージを BizTalk Server で取得する必要がある場合、WCF メッセージではマルチパート データを XML にします。</span><span class="sxs-lookup"><span data-stu-id="90efa-193">If you need to get a multipart message into BizTalk Server by using an incoming WCF message and the WCF adapters, render your multipart data as XML in your WCF message.</span></span> <span data-ttu-id="90efa-194">受信 XML ストリーム (WCF メッセージ) を処理し、アプリケーションに適した BizTalk マルチパート メッセージを作成するカスタム BizTalk パイプライン コンポーネントを開発します。</span><span class="sxs-lookup"><span data-stu-id="90efa-194">Develop a custom BizTalk pipeline component to process the incoming XML stream (WCF message) and create the appropriate BizTalk multipart message for your application.</span></span> <span data-ttu-id="90efa-195">必要に応じて、送信側でこの手順を逆にして行うことができます。</span><span class="sxs-lookup"><span data-stu-id="90efa-195">These steps can be done in reverse for the Send side if required.</span></span>