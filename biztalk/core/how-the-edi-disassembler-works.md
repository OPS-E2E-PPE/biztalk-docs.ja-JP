---
title: EDI 逆アセンブラーの動作 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 8da91ba4-e1c9-4e6b-bbd1-fe71ea880118
caps.latest.revision: 43
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: b22bf118bbf63db8775c85f6962e8f6d10d55e43
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/07/2019
ms.locfileid: "65387431"
---
# <a name="how-the-edi-disassembler-works"></a>EDI 逆アセンブラーの動作
[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] では、EDI 受信パイプライン (`Microsoft.BizTalk.DefaultPipelines.EDIReceivePipeline`) において、受信した EDI エンコード インターチェンジの処理の大部分を行います。 このパイプラインには、次の処理を行う EDI 逆アセンブラ パイプライン コンポーネントが含まれています。  
  
- 1 つのメッセージ内の複数のインターチェンジを別々のインターチェンジに分割します (受信場所の "DetectMID" パイプライン プロパティが True に設定されている場合)。 EDI 逆アセンブラは、インターチェンジ制御トレーラ (IEA または UNZ) が発生した後でも、インターチェンジ制御ヘッダー (ISA、UNA、または UNB) を検索してこの処理を行います。  
  
- エンベロープを検証します。  
  
- インターチェンジを逆アセンブルします。  
  
- HIPAA インターチェンジのトリガー フィールドを処理します。  
  
- EDI およびパートナー固有のプロパティを必要に応じて検証します。 これには、EDI スキーマ検証、X12 エンコード メッセージ (構成されている場合) のクロスフィールド検証、EDI 構造検証、および拡張スキーマ検証 (非 EDI データ型を持つノードでスキーマがカスタマイズされている場合) が含まれます。 詳細については、次を参照してください。[受信 EDI メッセージの検証](../core/validation-of-received-edi-messages.md)です。  
  
- チェックが有効になっている場合、インターチェンジ、グループ、およびトランザクション セット制御番号が同じではないことを確認します、**検証**ページ ([**インターチェンジの設定**) 双方向のアグリーメント タブの**アグリーメントのプロパティ**] ダイアログ ボックス。 インターチェンジ制御番号を、以前に受信したインターチェンジと比較して確認します。 グループ制御番号を、インターチェンジの他のグループ制御番号と比較して確認します。 トランザクション セット制御番号を、そのグループの他のトランザクション セット制御番号と比較して確認します。 重複が見つかった場合は、重複レコードが存在することが状態レポートに記載されます。  
  
- トランザクション セットごとに XML ドキュメントを生成します。 各 XML ファイルで BTS.MessageType のコンテキスト プロパティを昇格させ、名前空間を持つスキーマ名に設定します。  
  
- 場合は、インターチェンジ全体を XML に変換します。、**受信バッチ処理オプション**プロパティが 2 つのいずれかに設定**インターチェンジの保存**値。 このプロパティに設定されて、**ローカル ホストの設定**ページ**インターチェンジの設定**双方向のアグリーメント タブの**アグリーメントのプロパティ** ダイアログ ボックス。 受信パイプラインは、インターチェンジを保存済みとして識別するために、プロパティ ReuseEnvelope を昇格させます。  
  
- 技術確認または機能確認を生成します (構成されている場合)。 これには確認のバッチ処理も含まれます (構成されている場合)。 BTS のコンテキスト プロパティを昇格させます。MessageType を設定することで制御スキーマと等しく、 http://schemas.microsoft.com/EDI/\<X12 または EDIFACT\>名前空間 (たとえば、997 受信確認の x12_997_root など)。 また、EDI.DestinationPartyName コンテキスト プロパティを昇格させて、送信時に確認が確実に取得されるようにします。 詳細については、次を参照してください。 [EDI 受信確認を送信する](../core/sending-an-edi-acknowledgment.md)します。  
  
- 必要に応じて、HIPAA 276/277 (バージョン 5010 のみ) 834、835 (バージョン 4010 のみ)、および 837 ドキュメントの分割を実行します。  
  
- プロパティをメッセージ コンテキストに昇格させるか、または書き込みます (次のセクションを参照)。  
  
## <a name="promoting-or-writing-properties-to-the-context"></a>コンテキストへのプロパティの昇格または書き込み  
 EDI 逆アセンブラが受信メッセージを処理する場合、次のプロパティがメッセージ コンテキストに昇格されるか、または書き込まれます。  
  
- X12 エンコードのバッチ処理されていないメッセージのエンベロープから、次のプロパティを昇格します。ISA06、ISA08、ISA15、GS01、GS02、GS03、GS08、ST03、および ST01 します。  
  
  > [!NOTE]
  >  受信した HIPAA 837 インターチェンジ、 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 3 つの HIPAA 837 スキーマをサポートしています。Claim-dental_837d、claim-institutional_837i、および claim-professional_837p です。 これらのそれぞれの ST01 は「837」です。これら 3 つのスキーマ バージョン 5010 で GS08 の異なる値を設定します。"005010X223A1"837I、"005010X224A1"の 837 d、および 837 P. の「222 X 005010」 スキーマは、GS08 のバージョン 4010 で異なる値を持ちます。"004010X096A1"837I、837 d、"004010X097A1"と"004010X098A1"837 P. の  
  
- EDIFACT エンコードのバッチ処理されていないメッセージのエンベロープから、次のプロパティを昇格します。UNB2.1、UNB2.3、UNB3.1、UNB11、UNG1、UNG2.1、UNG3.1;UNH2.1、UNH2.2、UNH2.3 します。  
  
- バッチ処理されたインターチェンジが分割されている場合は、X12 でエンコードされたメッセージのコンテキストに ISA_Segment と GS_Segment が書き込まれ、EDIFACT でエンコードされたメッセージのコンテキストに UNA_Segment、UNB_Segment、および UNG_Segment が書き込まれます。  
  
  > [!NOTE]
  >  上記のセグメントはコンテキストに書き込まれます。 コンテキストへの昇格は行われません。 ただし、メッセージ強化サンプルを使用して、これらのセグメントをトランザクション セットに追加することは可能です。 または、サンプルを付加するコードを使用して、カスタム パイプライン コンポーネントに追加することもできます。 詳細については、次を参照してください。[メッセージ強化サンプル (BizTalk Server サンプル)](../core/message-enrichment-sample-biztalk-server-sample.md)します。  
  
  > [!NOTE]
  >  昇格された ISA_Segment プロパティには、情報の漏えいにつながる可能性のあるセキュリティ/認証情報 (ISA02 の認証情報と ISA04 のセキュリティ情報) が含まれています。 使用することができます、**コンテキスト プロパティの プロパティのセキュリティ/認証/パスワード情報をマスク**(で**ローカル ホスト設定**ページ**インターチェンジの設定**の双方向アグリーメントのプロパティ) に、ISA02 フィールドと ISA04 フィールドの各文字を '#' 文字に置き換えます。 これは、一方向の処理: '#' 文字を実際の文字に変換できません。  
  
- X12 でエンコードされたメッセージと EDIFACT でエンコードされたメッセージでは、ReuseEnvelope が昇格されます。これは、バッチ処理されたインターチェンジを分割するか保存するかを示します。  
  
- バッチ インターチェンジが保持される場合は、次のプロパティを昇格します。  
  
  -   InboundTransportatLocation  
  
  -   InboundTransportType  
  
  -   ISA05  
  
  -   ISA07  
  
  -   ISA06  
  
  -   ISA08  
  
  -   ISA15  
  
  -   LastInterchangeMessage = {True&#124;False}  
  
  -   [MessageType]  
  
  -   ReceivePortID  
  
  -   ReceivePortName  
  
  -   ReuseEnvelope  
  
## <a name="parsing-the-envelope"></a>エンベロープの解析  
 EDI 受信パイプラインは、ヘッダー制御スキーマを使用して、受信した EDI メッセージのエンベロープを解析し、EDI ドキュメント スキーマを使用して、インターチェンジのトランザクション セット/メッセージを解析します。  
  
 EDIINT/AS2 でエンコードされたメッセージを HTTP/HTTPS トランスポート経由で受信した場合、EDI 逆アセンブラはコンテキスト プロパティ BTS.MessageDestination を調査します。 このプロパティが SuspendQueue に設定されている、つまり AS2 処理でエラーが発生したときにメッセージが保留にされる場合、EDI 逆アセンブラはパススルー パイプライン コンポーネントとして機能し、メッセージ ボックスへのメッセージを保留にします。  
  
 EDIFACT インターチェンジの解析時、EDI 受信パイプラインは文字のエスケープに使用されるリリース インジケータを削除します。 リリース インジケータは EDI 検証には含まれません。 長さの制限を計算するときには、EDI 受信パイプラインにリリース インジケータは含まれません。  
  
 **文字セット**  
  
 X12 インターチェンジの場合、パイプライン コンポーネント プロパティによって、インターチェンジの処理時に EDI 逆アセンブラが使用する文字セットが決まります。 [基本]、[拡張]、[UTF8/Unicode] のいずれかを使用できます。 既定値は UTF8 です。EDIFACT インターチェンジの場合、UNB1.1 フィールドによって文字セットが決まります。  
  
 **動的区切り記号の検出**  
  
 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] で EDI インターチェンジを受信した場合、インターチェンジの区切り記号を指定するアグリーメント プロパティはありません。 代わりに、EDI 逆アセンブラが実行時に (X12 または EDIFACT の) 区切り記号を検出します。  
  
 X12 メッセージでは、EDI 逆アセンブラはインターチェンジ内の次の文字を使用します。  
  
|[区切り記号]|文字|  
|---------------|---------------|  
|データ要素区切り記号|ISA の 4 番目の文字|  
|コンポーネント要素区切り記号|ISA16|  
|セグメント区切り記号|ISA の 106 番目の文字|  
|セグメント終端記号のサフィックス|ISA セグメントと GS セグメント間の文字<br /><br /> **値:** なし、CR、LF、または CRLF**に注意してください。** 区切り記号は、上記の値のみを実行できます。|  
|繰り返し区切り記号または標準識別子<br /><br /> (上の「ISA11 の使用法」アグリーメント プロパティに応じて、**エンベロープ**双方向のアグリーメント タブのページ)|ISA11|  
  
 EDIFACT インターチェンジでは、EDI 逆アセンブラはインターチェンジの区切り記号を定義する UNA セグメントを確認します。 インターチェンジに UNA セグメント (省略可能) がない場合、逆アセンブラはパイプライン コンポーネント プロパティで定義された既定値を使用します。  
  
|[区切り記号]|UNA の文字|  
|---------------|----------------------|  
|コンポーネント要素区切り記号|4 番目|  
|データ要素区切り記号|5 番目|  
|小数点表記|6 番目|  
|リリース文字|7 番目|  
|繰り返し文字|8 番目|  
|セグメント区切り記号|9 番目|  
|セグメント区切り記号のサフィックス|UNA セグメントと UNB セグメント間の文字<br /><br /> **値:** なし、CR、LF、または CRLF**に注意してください。** 区切り記号は、上記の値のみを実行できます。|  
  
 UNA 文字列は省略可能です。 UNA 文字列がある場合、ファイルのすべての区切り記号が定義されます。 文字列がない場合、EDI 逆アセンブラは EfactDelimiters パイプライン コンポーネント プロパティを使用して区切り文字を決定します。 詳細については、次を参照してください。 [EDI パイプライン プロパティを設定する](../core/configuring-edi-pipeline-properties.md)します。  
  
 **エラーの送信**  
  
 EDI 逆アセンブラーで EDI 処理エラーが発生すると、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] では次の 2 つのエラーがイベント ビューアーに送信されます (送信が有効になっている場合)。  
  
- メッセージを保留にしたときに送信元の [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] によって記録されたエラー。 これは [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] の処理に関連する必須のエラーです。  
  
- 送信元の [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] EDI によって記録された、トランザクション セットの問題を報告するエラー。 このエラーは EDI 固有です。  
  
## <a name="using-agreement-properties"></a>アグリーメント プロパティの使用  
 アグリーメントを特定できる場合に、EDI 逆アセンブラーがアグリーメントのプロパティを使用 (を参照してください[アグリーメントの解決、スキーマ探索、および EDI メッセージの受信を承認](../core/agreement-resolution-schema-discovery-and-authorization-for-received-edi.md))。 一致するアグリーメントが見つからないこと、対応する値は、フォールバック アグリーメントでも利用可能な場合は、EDI 逆アセンブラー プロパティ設定、**プロパティ**Visual Studio のウィンドウが使用されます。 ただし、このフォールバックは発生しません受信ポートのプロパティで認証が必要な場合 (いずれか**認証が失敗した場合は、メッセージをドロップ**または**認証が失敗した場合は、メッセージを保持する**が選択されています。). この場合、アグリーメントを構成する必要があります。構成しないと、インターチェンジは中断されます。  
  
 EDI 逆アセンブラーがアグリーメント プロパティを使用する場合、次のアグリーメント プロパティが設定されている必要があります。  
  
|プロパティ|アグリーメントのプロパティ ページ|  
|--------------|-------------------------------|  
|繰り返し区切り記号|**エンベロープ**ページ (**インターチェンジの設定**) 双方向アグリーメント タブ|  
|EDI のデータ型検証の実行|**検証**ページ**トランザクション セットの設定**双方向アグリーメント タブ (X12 および EDIFACT アグリーメントの場合) の|  
|拡張された検証|**検証**ページ**トランザクション セットの設定**双方向アグリーメント タブ (X12 および EDIFACT アグリーメントの場合) の|  
|[先頭および末尾のゼロおよび空白を許可する]|**検証**ページ**トランザクション セットの設定**双方向アグリーメント タブ (X12 および EDIFACT アグリーメントの場合) の|  
|末尾の区切り記号が使用できる場合に空の XML タグを作成する|**ローカル ホスト設定**ページ**トランザクション セットの設定**双方向アグリーメント タブ (X12 および EDIFACT アグリーメントの場合) の|  
|受信バッチ処理オプション|**ローカル ホスト設定**ページ (**インターチェンジの設定**) (X12 および EDIFACT アグリーメントの場合) の双方向アグリーメント タブ|  
|既定の EDIFACT 区切り記号|-|  
|セキュリティ/認証/パスワードの情報をマスクする|**ローカル ホスト設定**ページ (**インターチェンジの設定**) (X12 および EDIFACT アグリーメントの場合) の双方向アグリーメント タブ|  
|暗黙的に指定された 10 進形式 Nn を底 10 の数値に変換する|**ローカル ホスト設定**ページ**トランザクション セットの設定**双方向アグリーメント タブ (x12 契約)|  
|要求 - 応答の受信ポートでの送信パイプラインへの確認のルーティング|**ローカル ホスト設定**ページ (**受信者の設定**セクション) で**インターチェンジの設定**(X12 および EDIFACT アグリーメントの場合) の双方向アグリーメント タブ|  
|X12 文字セット|X12 インターチェンジのエンベロープの生成**に注意してください。** この設定は、アグリーメント プロパティに入力した値の検証にのみ使用されます。 実行時処理に使用される X12 文字セットは、パイプライン プロパティで選択されます。 詳細については、次を参照してください。 [EDI 文字セット](../core/edi-character-sets.md)します。|  
  
## <a name="using-hipaa-trigger-fields"></a>HIPAA トリガー フィールドの使用  
 多くの場合、EDI セグメントには、セグメントの意味を変更する修飾子の値が含まれています。 たとえば、N1 セグメントには "請求先名" を示す "BT" の修飾要素が含まれていたり、"出荷先名" を示す "ST" の修飾要素が含まれていることがあります。 通常これらのフィールドを解釈する方法を決定するビジネス ロジックに任されており、逆アセンブラー N1 セグメントのすべてのインスタンスを同じ XML レコード名に解決します。ただし、BizTalk Server に付属の HIPAA スキーマが EDI 逆アセンブラーで修飾値の存在に基づいて一意の XML レコードの作成を許可する注釈を含める (を参照してください[HIPAA スキーマのトリガー フィールドの注釈](../core/hipaa-schema-trigger-field-annotations.md))。  
  
 HIPAA トランザクション セットの受信時に、トリガー フィールドが入ったセグメントがあると、逆アセンブラーではトリガー情報を使用して、そのセグメントとトリガーの組み合わせに固有の XML レコードを生成します。  
  
 次の表に、N101 の値に基づいて N1 セグメントを XML レコードに変換する方法を示します。  
  
|N1 セグメント|生成される XML データ|  
|----------------|------------------------|  
|N1 * PR\*Contoso\*される\*0000000 ~|`<ns0:TS835W1_1000A_Loop>  <N1_PayerIdentification_TS835W1_1000A>   <N101__EntityIdentifierCode>PR</N101__EntityIdentifierCode>    <N102__PayerName>Contoso</N102__PayerName>    <N103__IdentificationCodeQualifier>XV</N103__IdentificationCodeQualifier>    <N104__PayerIdentifier>0000000</N104__PayerIdentifier>   </N1_PayerIdentification_TS835W1_1000A>`|  
|N1 * PE\*Fabrikam\*FI\*9999999 ~|`<TS835W1_1000B_Loop>   <N1_PayeeIdentification_TS835W1_1000B>    <N101__EntityIdentifierCode>PE</N101__EntityIdentifierCode>    <N102__PayeeName>Fabrikam</N102__PayeeName>    <N103__IdentificationCodeQualifier>FI</N103__IdentificationCodeQualifier>    <N104__PayeeIdentificationCode>9999999</N104__PayeeIdentificationCode>   </N1_PayeeIdentification_TS835W1_1000B>`|  
  
## <a name="see-also"></a>参照  
 [BizTalk Server が EDI メッセージを受信する方法](../core/how-biztalk-server-receives-edi-messages.md)