---
title: アクティビティ データのストレージ |Microsoft ドキュメント
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- performance, BAM
- databases [BAM], performance
- activities [BAM], peformance
- databases [BAM], partitioning
- BAM, performance
ms.assetid: 1f736599-3d16-496e-a459-8b0507d57fcb
caps.latest.revision: 6
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 0139e76512eb9ca60089cb3c5f1e71b4f5524690
ms.sourcegitcommit: 5abd0ed3f9e4858ffaaec5481bfa8878595e95f7
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/28/2017
ms.locfileid: "25967024"
---
# <a name="activity-data-storage"></a><span data-ttu-id="fd4b4-102">アクティビティ データのストレージ</span><span class="sxs-lookup"><span data-stu-id="fd4b4-102">Activity Data Storage</span></span>
<span data-ttu-id="fd4b4-103">このトピックでは、アクティビティ データのストレージ、および時間の経過と共に拡張されたアクティビティ テーブルが原因で発生するパフォーマンス関連の問題について説明します。また、実行中のアクティビティと完了したアクティビティ用のテーブルを分離することで、これらのパフォーマンスに関する問題を BAM で解決する方法についても説明します。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-103">This topic describes activity data storage, the performance problems caused by the growth of activity tables over time, and how BAM solves these performance problems with separate tables for activities in progress and completed activities.</span></span> <span data-ttu-id="fd4b4-104">さらに、データのクエリ用のオンライン時間帯と、BAM のパーティション分割を使用してパフォーマンスを向上する方法についても説明します。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-104">This topic also describes the online window for querying data, and how you can use partitioning in BAM for higher performance.</span></span>  
  
 <span data-ttu-id="fd4b4-105">アクティビティ データのストレージでは、原則的には、アクティビティの種類ごとに異なるテーブルを保持します。これらのテーブルでは、各レコードがそれぞれ異なるアクティビティ インスタンス (実行中または完了済みなど) を表します。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-105">The basic idea of activity data storage is to have a separate table for each activity type, in which each record represents a different activity instance (for example, in-progress or completed).</span></span>  
  
 <span data-ttu-id="fd4b4-106">次の例は、アクティビティが注文書の場合のテーブルを示しています。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-106">In this example, if the activity were Purchase Order the table would look as follows:</span></span>  
  
|<span data-ttu-id="fd4b4-107">発注番号</span><span class="sxs-lookup"><span data-stu-id="fd4b4-107">PO#</span></span>|<span data-ttu-id="fd4b4-108">受け取り時間</span><span class="sxs-lookup"><span data-stu-id="fd4b4-108">RecvTime</span></span>|<span data-ttu-id="fd4b4-109">City</span><span class="sxs-lookup"><span data-stu-id="fd4b4-109">City</span></span>|<span data-ttu-id="fd4b4-110">Quantity</span><span class="sxs-lookup"><span data-stu-id="fd4b4-110">Quantity</span></span>|<span data-ttu-id="fd4b4-111">出荷時間</span><span class="sxs-lookup"><span data-stu-id="fd4b4-111">ShipTime</span></span>|<span data-ttu-id="fd4b4-112">納品時間</span><span class="sxs-lookup"><span data-stu-id="fd4b4-112">DeliveryTime</span></span>|  
|----------|--------------|----------|--------------|--------------|------------------|  
|<span data-ttu-id="fd4b4-113">123</span><span class="sxs-lookup"><span data-stu-id="fd4b4-113">123</span></span>|<span data-ttu-id="fd4b4-114">8時 00分 am</span><span class="sxs-lookup"><span data-stu-id="fd4b4-114">8:00am</span></span>|<span data-ttu-id="fd4b4-115">Seattle</span><span class="sxs-lookup"><span data-stu-id="fd4b4-115">Seattle</span></span>|<span data-ttu-id="fd4b4-116">150</span><span class="sxs-lookup"><span data-stu-id="fd4b4-116">150</span></span>|<span data-ttu-id="fd4b4-117">8時 24分 am</span><span class="sxs-lookup"><span data-stu-id="fd4b4-117">8:24am</span></span>|<span data-ttu-id="fd4b4-118">12:45pm</span><span class="sxs-lookup"><span data-stu-id="fd4b4-118">12:45pm</span></span>|  
|<span data-ttu-id="fd4b4-119">124</span><span class="sxs-lookup"><span data-stu-id="fd4b4-119">124</span></span>|<span data-ttu-id="fd4b4-120">午前 8 時 30 分</span><span class="sxs-lookup"><span data-stu-id="fd4b4-120">8:30am</span></span>|<span data-ttu-id="fd4b4-121">Seattle</span><span class="sxs-lookup"><span data-stu-id="fd4b4-121">Seattle</span></span>|<span data-ttu-id="fd4b4-122">234</span><span class="sxs-lookup"><span data-stu-id="fd4b4-122">234</span></span>|<span data-ttu-id="fd4b4-123">午前 8 時 45 分</span><span class="sxs-lookup"><span data-stu-id="fd4b4-123">8:45am</span></span>|<span data-ttu-id="fd4b4-124">午後 1 時 20 分</span><span class="sxs-lookup"><span data-stu-id="fd4b4-124">1:20pm</span></span>|  
|<span data-ttu-id="fd4b4-125">125</span><span class="sxs-lookup"><span data-stu-id="fd4b4-125">125</span></span>|<span data-ttu-id="fd4b4-126">午前 8時 35分</span><span class="sxs-lookup"><span data-stu-id="fd4b4-126">8:35am</span></span>|<span data-ttu-id="fd4b4-127">Redmond</span><span class="sxs-lookup"><span data-stu-id="fd4b4-127">Redmond</span></span>|<span data-ttu-id="fd4b4-128">87</span><span class="sxs-lookup"><span data-stu-id="fd4b4-128">87</span></span>|<span data-ttu-id="fd4b4-129">9時 05分 am</span><span class="sxs-lookup"><span data-stu-id="fd4b4-129">9:05am</span></span>|<span data-ttu-id="fd4b4-130">2時 30分 pm</span><span class="sxs-lookup"><span data-stu-id="fd4b4-130">2:30pm</span></span>|  
|<span data-ttu-id="fd4b4-131">126</span><span class="sxs-lookup"><span data-stu-id="fd4b4-131">126</span></span>|<span data-ttu-id="fd4b4-132">午前 8 時 45 分</span><span class="sxs-lookup"><span data-stu-id="fd4b4-132">8:45am</span></span>|<span data-ttu-id="fd4b4-133">Seattle</span><span class="sxs-lookup"><span data-stu-id="fd4b4-133">Seattle</span></span>|<span data-ttu-id="fd4b4-134">450</span><span class="sxs-lookup"><span data-stu-id="fd4b4-134">450</span></span>|<span data-ttu-id="fd4b4-135">9時 20分 am</span><span class="sxs-lookup"><span data-stu-id="fd4b4-135">9:20am</span></span>|<span data-ttu-id="fd4b4-136">3時 10分 pm</span><span class="sxs-lookup"><span data-stu-id="fd4b4-136">3:10pm</span></span>|  
|<span data-ttu-id="fd4b4-137">127</span><span class="sxs-lookup"><span data-stu-id="fd4b4-137">127</span></span>|<span data-ttu-id="fd4b4-138">午前 8時 55分</span><span class="sxs-lookup"><span data-stu-id="fd4b4-138">8:55am</span></span>|<span data-ttu-id="fd4b4-139">Redmond</span><span class="sxs-lookup"><span data-stu-id="fd4b4-139">Redmond</span></span>|<span data-ttu-id="fd4b4-140">200</span><span class="sxs-lookup"><span data-stu-id="fd4b4-140">200</span></span>|<span data-ttu-id="fd4b4-141">午前 9 時 30 分</span><span class="sxs-lookup"><span data-stu-id="fd4b4-141">9:30am</span></span>|<span data-ttu-id="fd4b4-142">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="fd4b4-142">\<NULL\></span></span>|  
|<span data-ttu-id="fd4b4-143">128</span><span class="sxs-lookup"><span data-stu-id="fd4b4-143">128</span></span>|<span data-ttu-id="fd4b4-144">8:57am</span><span class="sxs-lookup"><span data-stu-id="fd4b4-144">8:57am</span></span>|<span data-ttu-id="fd4b4-145">Seattle</span><span class="sxs-lookup"><span data-stu-id="fd4b4-145">Seattle</span></span>|<span data-ttu-id="fd4b4-146">340</span><span class="sxs-lookup"><span data-stu-id="fd4b4-146">340</span></span>|<span data-ttu-id="fd4b4-147">9時 20分 am</span><span class="sxs-lookup"><span data-stu-id="fd4b4-147">9:20am</span></span>|<span data-ttu-id="fd4b4-148">3時 05分 pm</span><span class="sxs-lookup"><span data-stu-id="fd4b4-148">3:05pm</span></span>|  
|<span data-ttu-id="fd4b4-149">129</span><span class="sxs-lookup"><span data-stu-id="fd4b4-149">129</span></span>|<span data-ttu-id="fd4b4-150">9時 12分 am</span><span class="sxs-lookup"><span data-stu-id="fd4b4-150">9:12am</span></span>|<span data-ttu-id="fd4b4-151">Seattle</span><span class="sxs-lookup"><span data-stu-id="fd4b4-151">Seattle</span></span>|<span data-ttu-id="fd4b4-152">120</span><span class="sxs-lookup"><span data-stu-id="fd4b4-152">120</span></span>|<span data-ttu-id="fd4b4-153">午前 9 時 45 分</span><span class="sxs-lookup"><span data-stu-id="fd4b4-153">9:45am</span></span>|<span data-ttu-id="fd4b4-154">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="fd4b4-154">\<NULL\></span></span>|  
|<span data-ttu-id="fd4b4-155">130</span><span class="sxs-lookup"><span data-stu-id="fd4b4-155">130</span></span>|<span data-ttu-id="fd4b4-156">午前 9 時 30 分</span><span class="sxs-lookup"><span data-stu-id="fd4b4-156">9:30am</span></span>|<span data-ttu-id="fd4b4-157">Redmond</span><span class="sxs-lookup"><span data-stu-id="fd4b4-157">Redmond</span></span>|<span data-ttu-id="fd4b4-158">25</span><span class="sxs-lookup"><span data-stu-id="fd4b4-158">25</span></span>|<span data-ttu-id="fd4b4-159">午前 10時 15分</span><span class="sxs-lookup"><span data-stu-id="fd4b4-159">10:15am</span></span>|<span data-ttu-id="fd4b4-160">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="fd4b4-160">\<NULL\></span></span>|  
|<span data-ttu-id="fd4b4-161">131</span><span class="sxs-lookup"><span data-stu-id="fd4b4-161">131</span></span>|<span data-ttu-id="fd4b4-162">9:45</span><span class="sxs-lookup"><span data-stu-id="fd4b4-162">9:45</span></span>|<span data-ttu-id="fd4b4-163">Seattle</span><span class="sxs-lookup"><span data-stu-id="fd4b4-163">Seattle</span></span>|<span data-ttu-id="fd4b4-164">250</span><span class="sxs-lookup"><span data-stu-id="fd4b4-164">250</span></span>|<span data-ttu-id="fd4b4-165">午前 10 時 35 分</span><span class="sxs-lookup"><span data-stu-id="fd4b4-165">10:35am</span></span>|<span data-ttu-id="fd4b4-166">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="fd4b4-166">\<NULL\></span></span>|  
|<span data-ttu-id="fd4b4-167">132</span><span class="sxs-lookup"><span data-stu-id="fd4b4-167">132</span></span>|<span data-ttu-id="fd4b4-168">午前 10時 00分</span><span class="sxs-lookup"><span data-stu-id="fd4b4-168">10:00am</span></span>|<span data-ttu-id="fd4b4-169">Redmond</span><span class="sxs-lookup"><span data-stu-id="fd4b4-169">Redmond</span></span>|<span data-ttu-id="fd4b4-170">100</span><span class="sxs-lookup"><span data-stu-id="fd4b4-170">100</span></span>|<span data-ttu-id="fd4b4-171">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="fd4b4-171">\<NULL\></span></span>|<span data-ttu-id="fd4b4-172">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="fd4b4-172">\<NULL\></span></span>|  
|<span data-ttu-id="fd4b4-173">133</span><span class="sxs-lookup"><span data-stu-id="fd4b4-173">133</span></span>|<span data-ttu-id="fd4b4-174">午前 10時 15分</span><span class="sxs-lookup"><span data-stu-id="fd4b4-174">10:15am</span></span>|<span data-ttu-id="fd4b4-175">Seattle</span><span class="sxs-lookup"><span data-stu-id="fd4b4-175">Seattle</span></span>|<span data-ttu-id="fd4b4-176">230</span><span class="sxs-lookup"><span data-stu-id="fd4b4-176">230</span></span>|<span data-ttu-id="fd4b4-177">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="fd4b4-177">\<NULL\></span></span>|<span data-ttu-id="fd4b4-178">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="fd4b4-178">\<NULL\></span></span>|  
|<span data-ttu-id="fd4b4-179">134</span><span class="sxs-lookup"><span data-stu-id="fd4b4-179">134</span></span>|<span data-ttu-id="fd4b4-180">午前 10 時 25 分</span><span class="sxs-lookup"><span data-stu-id="fd4b4-180">10:25am</span></span>|<span data-ttu-id="fd4b4-181">Redmond</span><span class="sxs-lookup"><span data-stu-id="fd4b4-181">Redmond</span></span>|<span data-ttu-id="fd4b4-182">45</span><span class="sxs-lookup"><span data-stu-id="fd4b4-182">45</span></span>|<span data-ttu-id="fd4b4-183">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="fd4b4-183">\<NULL\></span></span>|<span data-ttu-id="fd4b4-184">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="fd4b4-184">\<NULL\></span></span>|  
  
 <span data-ttu-id="fd4b4-185">このテーブルでは、BAM によって新しい注文書が受け取られると、新しい行が挿入され、いくつかの列 (受け取り時間、市、数量など) に Null 以外の値が設定されます。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-185">In this table, when BAM receives a new purchase order, it inserts a new row and some sets some of the columns to non-null values (RecvTime, City, Quantity, and so on).</span></span> <span data-ttu-id="fd4b4-186">その後、この注文書を承認して出荷すると、出荷時間が Null 以外の値に設定されます。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-186">Later, when you approve and ship this purchase order, BAM sets ShipTime to a non-null value.</span></span> <span data-ttu-id="fd4b4-187">最後に、出荷情報を受け取って確認すると、納品時間が Null 以外の値に設定されます。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-187">Finally, when you receive and confirm the shipment, BAM sets DeliveryTime to a non-null value.</span></span>  
  
 <span data-ttu-id="fd4b4-188">この簡単な実装のパフォーマンスは、時間と共に急速に低下します。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-188">The performance of this simplistic implementation quickly degrades over time.</span></span> <span data-ttu-id="fd4b4-189">最初のパフォーマンスは、SQL Server で実行できるトランザクションの数 (基本的に CPU によって決まります) によって制限されますが、しばらくすると急速に低下します。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-189">In the beginning, the performance is limited by the number of the transactions the SQL server can perform (essentially CPU bound), but after some time, it drops drastically.</span></span> <span data-ttu-id="fd4b4-190">同時に、ディスク IO に対するキューの長さの平均値も、許容制限値を超えて増加します。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-190">At the same time, the average queue length for disk IO increases beyond the acceptable limits:</span></span>  
  
 <span data-ttu-id="fd4b4-191">![](../core/media/ebiz-prog-bam-data-maint-fig4.gif "ebiz_prog_bam_data_maint_fig4")</span><span class="sxs-lookup"><span data-stu-id="fd4b4-191">![](../core/media/ebiz-prog-bam-data-maint-fig4.gif "ebiz_prog_bam_data_maint_fig4")</span></span>  
<span data-ttu-id="fd4b4-192">BAM の書き込みパフォーマンスとディスク キューの長さ</span><span class="sxs-lookup"><span data-stu-id="fd4b4-192">BAM Write Performance versus Disk Queue Length</span></span>  
  
 <span data-ttu-id="fd4b4-193">このパフォーマンス低下の原因は、完了したビジネス プロセスのインスタンスの数が増加するにつれて、テーブルのサイズが増加するためです。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-193">The reason for this is that the size of the table grows as more instances of the business process complete.</span></span> <span data-ttu-id="fd4b4-194">たとえば、最初はストアド プロシージャの UPDATE ステートメントで、クラスター化インデックスを使って注文書番号が検索され、ページの一部がメモリに読み取られます。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-194">For example, the first time, the UPDATE statement of the stored procedure causes a search on the clustered index for purchase order number and reads some pages in memory.</span></span> <span data-ttu-id="fd4b4-195">注文処理のインスタンスは独立している (処理にかかる時間がそれぞれ異なる) ため、次のストアド プロシージャの呼び出しでは、注文処理の他のインスタンスが処理される場合があります。その場合、別のデータ ページをメモリに読み取る必要があります。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-195">Since the instances of the purchase order process are independent (some take a long time, but some are short), the next call to the stored procedure may be for some other purchase order instance and therefore will require reading of different data pages in memory.</span></span> <span data-ttu-id="fd4b4-196">注文書レコードの合計数が少ない場合であれば、SQL Server では、すべてのデータ ページがメモリにキャッシュされます。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-196">As long as the total number of purchase order records is small, SQL Server will cache all data pages in memory.</span></span> <span data-ttu-id="fd4b4-197">レコード数が非常に多くなると、キャッシュ ヒット率が低下し、操作ごとに物理ディスクの読み取りが必要になります。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-197">When the number of the records grows large enough, the cache-hit ratio decreases and each operation requires a physical disk read.</span></span> <span data-ttu-id="fd4b4-198">レコード数が多くなるような状況では、テーブルに対するクエリ アクティビティのパフォーマンスが低下する可能性は非常に高くなります。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-198">Apparently, in this situation no query activity against the table is possible.</span></span>  
  
## <a name="bam-tables"></a><span data-ttu-id="fd4b4-199">BAM テーブル</span><span class="sxs-lookup"><span data-stu-id="fd4b4-199">BAM tables</span></span>  
 <span data-ttu-id="fd4b4-200">この問題を回避するために、BAM では 2 つの異なるテーブルを使用します。次の図のように、1 つは実行中のアクティビティ用に使用し、もう 1 つは完了したアクティビティ用に使用します。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-200">To avoid this problem BAM uses two separate tables – one for the activities still in progress, and another for the completed ones in the following figure:</span></span>  
  
 <span data-ttu-id="fd4b4-201">![](../core/media/ebiz-prog-bam-data-maint-fig5.gif "ebiz_prog_bam_data_maint_fig5")</span><span class="sxs-lookup"><span data-stu-id="fd4b4-201">![](../core/media/ebiz-prog-bam-data-maint-fig5.gif "ebiz_prog_bam_data_maint_fig5")</span></span>  
<span data-ttu-id="fd4b4-202">BAM テーブル</span><span class="sxs-lookup"><span data-stu-id="fd4b4-202">BAM Tables</span></span>  
  
 <span data-ttu-id="fd4b4-203">この図の考え方は、更新が行われる比較的小さなテーブルと、アクセス (INSERT のみ) 数が増加し、徐々に拡張されるもう 1 つのテーブルを管理することです。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-203">In this figure, the idea is to keep a relatively small table that updates occur in and another that grows large, but is incrementally accessed (INSERTs only).</span></span> <span data-ttu-id="fd4b4-204">上記の例では、現在処理中の注文書のみがアクティブ テーブルに格納され、既に配送が完了したすべての注文書が完了済みテーブルに格納されます。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-204">In the example, only the orders being processed at the moment will be in the active table, while all orders that were already delivered will go to the completed table.</span></span>  
  
 <span data-ttu-id="fd4b4-205">このテーブルの構造では、トリガーが原因で最初のうち 1 つのテーブルの INSERT と UPDATE の速度が遅くなりますが、書き込みのパフォーマンスは時間がたっても安定した状態に保たれます。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-205">Because of the trigger, this structure of tables is slower than an INSERT/UPDATE of a single table at the beginning, but maintains stable write performance over time.</span></span>  
  
## <a name="online-window-for-activity-data"></a><span data-ttu-id="fd4b4-206">アクティビティ データ用のオンライン時間帯</span><span class="sxs-lookup"><span data-stu-id="fd4b4-206">Online Window for activity data</span></span>  
 <span data-ttu-id="fd4b4-207">アクティビティのストレージでは、主に現在のアクティビティや最近完了したアクティビティをクエリします。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-207">Activity storage primarily handles queries for current or recently completed activities.</span></span> <span data-ttu-id="fd4b4-208">BAM では、古くなった完了済みのアクティビティをアーカイブし、BAM プライマリ インポート データベースから削除します。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-208">BAM archives and then purges very old, completed activities from the BAM Primary Import database.</span></span> <span data-ttu-id="fd4b4-209">したがって、アクティビティ データが BAM 経由で流れるので、構成可能なオンライン時間帯の期間内はクエリに使用できます。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-209">Thus the activity data flows through BAM and is available for queries during a configurable Online Window.</span></span>  
  
## <a name="bam-partitioning"></a><span data-ttu-id="fd4b4-210">BAM のパーティション分割</span><span class="sxs-lookup"><span data-stu-id="fd4b4-210">BAM partitioning</span></span>  
 <span data-ttu-id="fd4b4-211">アクティビティ ストレージでは、パフォーマンスを向上し、ダウンタイムを避けるために、アクティビティの完了時のタイムスタンプに基づくパーティション分割を使用します。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-211">To allow for higher performance and avoid downtime, activity storage uses partitioning based on the time stamp when the activity was completed.</span></span> <span data-ttu-id="fd4b4-212">BAM では、完了したテーブルを、同一フォーマットの空のテーブルと定期的に交換することにより、この機能を実現します。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-212">BAM achieves this by regular swapping of the completed table with another empty table of exactly the same format.</span></span> <span data-ttu-id="fd4b4-213">BAM によってこの処理が実行されると、次の図のように、その後に完了したアクティビティが新しいテーブルに格納され、古いアクティビティはクエリのためだけに保持されます。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-213">Once BAM does this, the further completed activities go into the new table, while BAM keeps the old one only for queries, as in the following figure:</span></span>  
  
 <span data-ttu-id="fd4b4-214">![](../core/media/ebiz-prog-bam-data-maint-fig8.gif "ebiz_prog_bam_data_maint_fig8")</span><span class="sxs-lookup"><span data-stu-id="fd4b4-214">![](../core/media/ebiz-prog-bam-data-maint-fig8.gif "ebiz_prog_bam_data_maint_fig8")</span></span>  
<span data-ttu-id="fd4b4-215">BAM のパーティション交換</span><span class="sxs-lookup"><span data-stu-id="fd4b4-215">BAM Partition Swapping</span></span>  
  
 <span data-ttu-id="fd4b4-216">オンライン時間帯の期間を完全に過ぎたパーティションは、BAM によってアーカイブされ、削除されます。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-216">Once a partition is completely outside the online window, BAM archives and then drops it.</span></span> <span data-ttu-id="fd4b4-217">ユーザー操作が複雑にならないように、次のコードを使用して、フォームのパーティション ビューを管理します。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-217">To minimize this complexity from the user, BAM also maintains a partitioned view of the form:</span></span>  
  
```  
SELECT * FROM Active   
UNION ALL   
SELECT * FROM Completed   
UNION ALL  
  
```  
  
 <span data-ttu-id="fd4b4-218">BAM では、パーティションを作成または削除するたびにこのビューを自動的に再作成します。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-218">BAM automatically re-creates this view each time it creates or drops a partition.</span></span>  
  
 <span data-ttu-id="fd4b4-219">BAM のパーティション分割に関する注意事項を次に示します。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-219">Note the following about BAM partitioning:</span></span>  
  
-   <span data-ttu-id="fd4b4-220">パーティション ビューの名前は**bam _\<ActivityName\>_AllInstances**です。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-220">The name of the partitioned view is **bam_\<ActivityName\>_AllInstances**.</span></span> <span data-ttu-id="fd4b4-221">このビューは、直接クエリを実行するためのビューではありませんが、BAM の構成のトラブルシューティングに役立つ場合があります。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-221">This view is not meant for direct queries, but may be useful when troubleshooting the BAM instrumentation.</span></span> <span data-ttu-id="fd4b4-222">クエリによるデータの取得は、このビューの上部に作成するビジネス ユーザーのカテゴリごとの特定のビューに対して実行してください。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-222">You should query the data from the specific views for each category of business users that you create on top of this view.</span></span> <span data-ttu-id="fd4b4-223">詳細については、次を参照してください。[インスタンス データのクエリを実行する](../core/querying-instance-data.md)です。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-223">For more information, see [Querying Instance Data](../core/querying-instance-data.md).</span></span>  
  
-   <span data-ttu-id="fd4b4-224">値を変更することにより、オンライン時間帯を設定する**OnlineWindowTimeUnit**と**OnlineWindowLength**の表に、現在のアクティビティのレコードの**bam_Metadata_Activities**プライマリ インポート データベースにします。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-224">You set the online window by modifying the values for **OnlineWindowTimeUnit** and **OnlineWindowLength** in the record for the current activity in the table **bam_Metadata_Activities** in the Primary Import database.</span></span>  
  
-   <span data-ttu-id="fd4b4-225">DTS パッケージ**bam_dm _\<ActivityName\>** パーティション分割を行い、アーカイブや削除します。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-225">The DTS package, **BAM_DM_\<ActivityName\>**, performs the partitioning and archiving/purging.</span></span> <span data-ttu-id="fd4b4-226">このパッケージが実行されるたびに、別のパーティションを切り捨て、オンライン時間帯の期間を過ぎたすべてのパーティションをアーカイブおよび削除します。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-226">Each time this package runs, it truncates another partition and archives/drops all partitions that are outside the online window.</span></span>  
  
-   <span data-ttu-id="fd4b4-227">アーカイブ データベースを構成していない場合、BAM は古いデータをアーカイブしないで削除します。</span><span class="sxs-lookup"><span data-stu-id="fd4b4-227">If you do not have Archiving Database configured, then BAM drops the aged activity data without archiving.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="fd4b4-228">参照</span><span class="sxs-lookup"><span data-stu-id="fd4b4-228">See Also</span></span>  
 [<span data-ttu-id="fd4b4-229">BAM 動的インフラストラクチャ</span><span class="sxs-lookup"><span data-stu-id="fd4b4-229">BAM Dynamic Infrastructure</span></span>](../core/bam-dynamic-infrastructure.md)