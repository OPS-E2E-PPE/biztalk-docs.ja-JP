---
title: アクティビティ データのストレージ |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- performance, BAM
- databases [BAM], performance
- activities [BAM], peformance
- databases [BAM], partitioning
- BAM, performance
ms.assetid: 1f736599-3d16-496e-a459-8b0507d57fcb
caps.latest.revision: 6
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: cd0a4744f5022bfdc466460a25def23ea362d7b6
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/07/2019
ms.locfileid: "65361687"
---
# <a name="activity-data-storage"></a><span data-ttu-id="afc3e-102">アクティビティ データのストレージ</span><span class="sxs-lookup"><span data-stu-id="afc3e-102">Activity Data Storage</span></span>
<span data-ttu-id="afc3e-103">このトピックでは、アクティビティ データ ストレージ、時間の経過と共にアクティビティ テーブルの増加率および BAM が進行中のアクティビティと完了したアクティビティの別個のテーブルでこれらのパフォーマンス問題を解決する方法に起因するパフォーマンスの問題について説明します。</span><span class="sxs-lookup"><span data-stu-id="afc3e-103">This topic describes activity data storage, the performance problems caused by the growth of activity tables over time, and how BAM solves these performance problems with separate tables for activities in progress and completed activities.</span></span> <span data-ttu-id="afc3e-104">このトピックでは、データ、およびパフォーマンスの向上、BAM でパーティション分割を使用する方法を照会するためのオンライン時間帯にも説明します。</span><span class="sxs-lookup"><span data-stu-id="afc3e-104">This topic also describes the online window for querying data, and how you can use partitioning in BAM for higher performance.</span></span>  
  
 <span data-ttu-id="afc3e-105">アクティビティ データのストレージの基本的な考え方では、各レコードは、さまざまなアクティビティのインスタンス (たとえば、進行中または完了) を表します。 各アクティビティの種類に個別のテーブルです。</span><span class="sxs-lookup"><span data-stu-id="afc3e-105">The basic idea of activity data storage is to have a separate table for each activity type, in which each record represents a different activity instance (for example, in-progress or completed).</span></span>  
  
 <span data-ttu-id="afc3e-106">この例では、アクティビティが注文書と、テーブルは、次のようになります。</span><span class="sxs-lookup"><span data-stu-id="afc3e-106">In this example, if the activity were Purchase Order the table would look as follows:</span></span>  
  
|<span data-ttu-id="afc3e-107">PO #</span><span class="sxs-lookup"><span data-stu-id="afc3e-107">PO#</span></span>|<span data-ttu-id="afc3e-108">受け取ら</span><span class="sxs-lookup"><span data-stu-id="afc3e-108">RecvTime</span></span>|<span data-ttu-id="afc3e-109">City</span><span class="sxs-lookup"><span data-stu-id="afc3e-109">City</span></span>|<span data-ttu-id="afc3e-110">Quantity</span><span class="sxs-lookup"><span data-stu-id="afc3e-110">Quantity</span></span>|<span data-ttu-id="afc3e-111">時間</span><span class="sxs-lookup"><span data-stu-id="afc3e-111">ShipTime</span></span>|<span data-ttu-id="afc3e-112">DeliveryTime</span><span class="sxs-lookup"><span data-stu-id="afc3e-112">DeliveryTime</span></span>|  
|----------|--------------|----------|--------------|--------------|------------------|  
|<span data-ttu-id="afc3e-113">123</span><span class="sxs-lookup"><span data-stu-id="afc3e-113">123</span></span>|<span data-ttu-id="afc3e-114">8時 00分 am</span><span class="sxs-lookup"><span data-stu-id="afc3e-114">8:00am</span></span>|<span data-ttu-id="afc3e-115">Seattle</span><span class="sxs-lookup"><span data-stu-id="afc3e-115">Seattle</span></span>|<span data-ttu-id="afc3e-116">150</span><span class="sxs-lookup"><span data-stu-id="afc3e-116">150</span></span>|<span data-ttu-id="afc3e-117">8時 24分 am</span><span class="sxs-lookup"><span data-stu-id="afc3e-117">8:24am</span></span>|<span data-ttu-id="afc3e-118">12時 45分 pm</span><span class="sxs-lookup"><span data-stu-id="afc3e-118">12:45pm</span></span>|  
|<span data-ttu-id="afc3e-119">124</span><span class="sxs-lookup"><span data-stu-id="afc3e-119">124</span></span>|<span data-ttu-id="afc3e-120">8時 30分 am</span><span class="sxs-lookup"><span data-stu-id="afc3e-120">8:30am</span></span>|<span data-ttu-id="afc3e-121">Seattle</span><span class="sxs-lookup"><span data-stu-id="afc3e-121">Seattle</span></span>|<span data-ttu-id="afc3e-122">234</span><span class="sxs-lookup"><span data-stu-id="afc3e-122">234</span></span>|<span data-ttu-id="afc3e-123">8時 45分 am</span><span class="sxs-lookup"><span data-stu-id="afc3e-123">8:45am</span></span>|<span data-ttu-id="afc3e-124">午後 1時 20分</span><span class="sxs-lookup"><span data-stu-id="afc3e-124">1:20pm</span></span>|  
|<span data-ttu-id="afc3e-125">125</span><span class="sxs-lookup"><span data-stu-id="afc3e-125">125</span></span>|<span data-ttu-id="afc3e-126">午前 8時 35分</span><span class="sxs-lookup"><span data-stu-id="afc3e-126">8:35am</span></span>|<span data-ttu-id="afc3e-127">Redmond</span><span class="sxs-lookup"><span data-stu-id="afc3e-127">Redmond</span></span>|<span data-ttu-id="afc3e-128">87</span><span class="sxs-lookup"><span data-stu-id="afc3e-128">87</span></span>|<span data-ttu-id="afc3e-129">9時 05分 am</span><span class="sxs-lookup"><span data-stu-id="afc3e-129">9:05am</span></span>|<span data-ttu-id="afc3e-130">2時 30分 pm</span><span class="sxs-lookup"><span data-stu-id="afc3e-130">2:30pm</span></span>|  
|<span data-ttu-id="afc3e-131">126</span><span class="sxs-lookup"><span data-stu-id="afc3e-131">126</span></span>|<span data-ttu-id="afc3e-132">8時 45分 am</span><span class="sxs-lookup"><span data-stu-id="afc3e-132">8:45am</span></span>|<span data-ttu-id="afc3e-133">Seattle</span><span class="sxs-lookup"><span data-stu-id="afc3e-133">Seattle</span></span>|<span data-ttu-id="afc3e-134">450</span><span class="sxs-lookup"><span data-stu-id="afc3e-134">450</span></span>|<span data-ttu-id="afc3e-135">9時 20分 am</span><span class="sxs-lookup"><span data-stu-id="afc3e-135">9:20am</span></span>|<span data-ttu-id="afc3e-136">3時 10分 pm</span><span class="sxs-lookup"><span data-stu-id="afc3e-136">3:10pm</span></span>|  
|<span data-ttu-id="afc3e-137">127</span><span class="sxs-lookup"><span data-stu-id="afc3e-137">127</span></span>|<span data-ttu-id="afc3e-138">午前 8 時 55</span><span class="sxs-lookup"><span data-stu-id="afc3e-138">8:55am</span></span>|<span data-ttu-id="afc3e-139">Redmond</span><span class="sxs-lookup"><span data-stu-id="afc3e-139">Redmond</span></span>|<span data-ttu-id="afc3e-140">200</span><span class="sxs-lookup"><span data-stu-id="afc3e-140">200</span></span>|<span data-ttu-id="afc3e-141">午前 9時 30分</span><span class="sxs-lookup"><span data-stu-id="afc3e-141">9:30am</span></span>|<span data-ttu-id="afc3e-142">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="afc3e-142">\<NULL\></span></span>|  
|<span data-ttu-id="afc3e-143">128</span><span class="sxs-lookup"><span data-stu-id="afc3e-143">128</span></span>|<span data-ttu-id="afc3e-144">午前 8時 57分</span><span class="sxs-lookup"><span data-stu-id="afc3e-144">8:57am</span></span>|<span data-ttu-id="afc3e-145">Seattle</span><span class="sxs-lookup"><span data-stu-id="afc3e-145">Seattle</span></span>|<span data-ttu-id="afc3e-146">340</span><span class="sxs-lookup"><span data-stu-id="afc3e-146">340</span></span>|<span data-ttu-id="afc3e-147">9時 20分 am</span><span class="sxs-lookup"><span data-stu-id="afc3e-147">9:20am</span></span>|<span data-ttu-id="afc3e-148">3時 05分 pm</span><span class="sxs-lookup"><span data-stu-id="afc3e-148">3:05pm</span></span>|  
|<span data-ttu-id="afc3e-149">129</span><span class="sxs-lookup"><span data-stu-id="afc3e-149">129</span></span>|<span data-ttu-id="afc3e-150">午前 9時 12分</span><span class="sxs-lookup"><span data-stu-id="afc3e-150">9:12am</span></span>|<span data-ttu-id="afc3e-151">Seattle</span><span class="sxs-lookup"><span data-stu-id="afc3e-151">Seattle</span></span>|<span data-ttu-id="afc3e-152">120</span><span class="sxs-lookup"><span data-stu-id="afc3e-152">120</span></span>|<span data-ttu-id="afc3e-153">9時 45分 am</span><span class="sxs-lookup"><span data-stu-id="afc3e-153">9:45am</span></span>|<span data-ttu-id="afc3e-154">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="afc3e-154">\<NULL\></span></span>|  
|<span data-ttu-id="afc3e-155">130</span><span class="sxs-lookup"><span data-stu-id="afc3e-155">130</span></span>|<span data-ttu-id="afc3e-156">午前 9時 30分</span><span class="sxs-lookup"><span data-stu-id="afc3e-156">9:30am</span></span>|<span data-ttu-id="afc3e-157">Redmond</span><span class="sxs-lookup"><span data-stu-id="afc3e-157">Redmond</span></span>|<span data-ttu-id="afc3e-158">25</span><span class="sxs-lookup"><span data-stu-id="afc3e-158">25</span></span>|<span data-ttu-id="afc3e-159">10時 15分 am</span><span class="sxs-lookup"><span data-stu-id="afc3e-159">10:15am</span></span>|<span data-ttu-id="afc3e-160">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="afc3e-160">\<NULL\></span></span>|  
|<span data-ttu-id="afc3e-161">131</span><span class="sxs-lookup"><span data-stu-id="afc3e-161">131</span></span>|<span data-ttu-id="afc3e-162">9:45</span><span class="sxs-lookup"><span data-stu-id="afc3e-162">9:45</span></span>|<span data-ttu-id="afc3e-163">Seattle</span><span class="sxs-lookup"><span data-stu-id="afc3e-163">Seattle</span></span>|<span data-ttu-id="afc3e-164">250</span><span class="sxs-lookup"><span data-stu-id="afc3e-164">250</span></span>|<span data-ttu-id="afc3e-165">午前 10時 35分</span><span class="sxs-lookup"><span data-stu-id="afc3e-165">10:35am</span></span>|<span data-ttu-id="afc3e-166">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="afc3e-166">\<NULL\></span></span>|  
|<span data-ttu-id="afc3e-167">132</span><span class="sxs-lookup"><span data-stu-id="afc3e-167">132</span></span>|<span data-ttu-id="afc3e-168">午前 10時 00分</span><span class="sxs-lookup"><span data-stu-id="afc3e-168">10:00am</span></span>|<span data-ttu-id="afc3e-169">Redmond</span><span class="sxs-lookup"><span data-stu-id="afc3e-169">Redmond</span></span>|<span data-ttu-id="afc3e-170">100</span><span class="sxs-lookup"><span data-stu-id="afc3e-170">100</span></span>|<span data-ttu-id="afc3e-171">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="afc3e-171">\<NULL\></span></span>|<span data-ttu-id="afc3e-172">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="afc3e-172">\<NULL\></span></span>|  
|<span data-ttu-id="afc3e-173">133</span><span class="sxs-lookup"><span data-stu-id="afc3e-173">133</span></span>|<span data-ttu-id="afc3e-174">10時 15分 am</span><span class="sxs-lookup"><span data-stu-id="afc3e-174">10:15am</span></span>|<span data-ttu-id="afc3e-175">Seattle</span><span class="sxs-lookup"><span data-stu-id="afc3e-175">Seattle</span></span>|<span data-ttu-id="afc3e-176">230</span><span class="sxs-lookup"><span data-stu-id="afc3e-176">230</span></span>|<span data-ttu-id="afc3e-177">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="afc3e-177">\<NULL\></span></span>|<span data-ttu-id="afc3e-178">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="afc3e-178">\<NULL\></span></span>|  
|<span data-ttu-id="afc3e-179">134</span><span class="sxs-lookup"><span data-stu-id="afc3e-179">134</span></span>|<span data-ttu-id="afc3e-180">10時 25分 am</span><span class="sxs-lookup"><span data-stu-id="afc3e-180">10:25am</span></span>|<span data-ttu-id="afc3e-181">Redmond</span><span class="sxs-lookup"><span data-stu-id="afc3e-181">Redmond</span></span>|<span data-ttu-id="afc3e-182">45</span><span class="sxs-lookup"><span data-stu-id="afc3e-182">45</span></span>|<span data-ttu-id="afc3e-183">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="afc3e-183">\<NULL\></span></span>|<span data-ttu-id="afc3e-184">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="afc3e-184">\<NULL\></span></span>|  
  
 <span data-ttu-id="afc3e-185">このテーブルでは、新しい行を挿入 BAM では、新しい注文を受信するとされ、一部の列が null 以外の値 (受け取ら、市、数量、およびなど) に設定します。</span><span class="sxs-lookup"><span data-stu-id="afc3e-185">In this table, when BAM receives a new purchase order, it inserts a new row and some sets some of the columns to non-null values (RecvTime, City, Quantity, and so on).</span></span> <span data-ttu-id="afc3e-186">後で、承認し、この注文の出荷すると、BAM は時間を null 以外の値に設定します。</span><span class="sxs-lookup"><span data-stu-id="afc3e-186">Later, when you approve and ship this purchase order, BAM sets ShipTime to a non-null value.</span></span> <span data-ttu-id="afc3e-187">最後に、受信、収録されていることを確認すると、BAM は DeliveryTime を null 以外の値に設定します。</span><span class="sxs-lookup"><span data-stu-id="afc3e-187">Finally, when you receive and confirm the shipment, BAM sets DeliveryTime to a non-null value.</span></span>  
  
 <span data-ttu-id="afc3e-188">この簡単な実装のパフォーマンスは、すぐに、時間の経過と共に低下します。</span><span class="sxs-lookup"><span data-stu-id="afc3e-188">The performance of this simplistic implementation quickly degrades over time.</span></span> <span data-ttu-id="afc3e-189">最初は、パフォーマンスによって制限されます (基本的にバインドされている CPU) を実行できる SQL server トランザクションの数がいくつかの時間、急速に低下します。</span><span class="sxs-lookup"><span data-stu-id="afc3e-189">In the beginning, the performance is limited by the number of the transactions the SQL server can perform (essentially CPU bound), but after some time, it drops drastically.</span></span> <span data-ttu-id="afc3e-190">同時に、ディスク IO のキューの平均の長さが許容される上限を超えて増加します。</span><span class="sxs-lookup"><span data-stu-id="afc3e-190">At the same time, the average queue length for disk IO increases beyond the acceptable limits:</span></span>  
  
 <span data-ttu-id="afc3e-191">![](../core/media/ebiz-prog-bam-data-maint-fig4.gif "ebiz_prog_bam_data_maint_fig4")</span><span class="sxs-lookup"><span data-stu-id="afc3e-191">![](../core/media/ebiz-prog-bam-data-maint-fig4.gif "ebiz_prog_bam_data_maint_fig4")</span></span>  
<span data-ttu-id="afc3e-192">BAM の書き込みのパフォーマンスとディスク キューの長さ</span><span class="sxs-lookup"><span data-stu-id="afc3e-192">BAM Write Performance versus Disk Queue Length</span></span>  
  
 <span data-ttu-id="afc3e-193">この理由は、テーブルのサイズ拡張するビジネス プロセスのインスタンス完了です。</span><span class="sxs-lookup"><span data-stu-id="afc3e-193">The reason for this is that the size of the table grows as more instances of the business process complete.</span></span> <span data-ttu-id="afc3e-194">など、最初にストアド プロシージャが発生したため、UPDATE ステートメントのクラスター化インデックスで検索を発注書番号とメモリの一部のページを読み取ります。</span><span class="sxs-lookup"><span data-stu-id="afc3e-194">For example, the first time, the UPDATE statement of the stored procedure causes a search on the clustered index for purchase order number and reads some pages in memory.</span></span> <span data-ttu-id="afc3e-195">発注プロセスのインスタンスは独立したので (、時間がかかるものがいくつか短い) ストアド プロシージャを次に呼び出した他のいくつかの注文書インスタンスの場合があり、そのため、メモリ内の別のデータ ページの読み取りが必要です。</span><span class="sxs-lookup"><span data-stu-id="afc3e-195">Since the instances of the purchase order process are independent (some take a long time, but some are short), the next call to the stored procedure may be for some other purchase order instance and therefore will require reading of different data pages in memory.</span></span> <span data-ttu-id="afc3e-196">注文書レコードの合計数が小さい場合に限り、SQL Server はメモリ内のすべてのデータ ページをキャッシュします。</span><span class="sxs-lookup"><span data-stu-id="afc3e-196">As long as the total number of purchase order records is small, SQL Server will cache all data pages in memory.</span></span> <span data-ttu-id="afc3e-197">レコードの数が十分な大きさが増加するとは、キャッシュ ヒット率が低下し、各操作には、物理ディスクの読み取りが必要です。</span><span class="sxs-lookup"><span data-stu-id="afc3e-197">When the number of the records grows large enough, the cache-hit ratio decreases and each operation requires a physical disk read.</span></span> <span data-ttu-id="afc3e-198">どうやらこれは、このような状況で、テーブルに対するクエリ アクティビティはありません。</span><span class="sxs-lookup"><span data-stu-id="afc3e-198">Apparently, in this situation no query activity against the table is possible.</span></span>  
  
## <a name="bam-tables"></a><span data-ttu-id="afc3e-199">BAM テーブル</span><span class="sxs-lookup"><span data-stu-id="afc3e-199">BAM tables</span></span>  
 <span data-ttu-id="afc3e-200">BAM この問題を回避するには、次の図に完了したものに – 実行中、アクティビティのいずれかのもう 1 つの 2 つの独立したテーブルを使用します。</span><span class="sxs-lookup"><span data-stu-id="afc3e-200">To avoid this problem BAM uses two separate tables – one for the activities still in progress, and another for the completed ones in the following figure:</span></span>  
  
 <span data-ttu-id="afc3e-201">![](../core/media/ebiz-prog-bam-data-maint-fig5.gif "ebiz_prog_bam_data_maint_fig5")</span><span class="sxs-lookup"><span data-stu-id="afc3e-201">![](../core/media/ebiz-prog-bam-data-maint-fig5.gif "ebiz_prog_bam_data_maint_fig5")</span></span>  
<span data-ttu-id="afc3e-202">BAM テーブル</span><span class="sxs-lookup"><span data-stu-id="afc3e-202">BAM Tables</span></span>  
  
 <span data-ttu-id="afc3e-203">この図では、考え方は、比較的小さなテーブルで発生する更新プログラムを維持して、大きくが段階的に、別のアクセス (Insert のみ)。</span><span class="sxs-lookup"><span data-stu-id="afc3e-203">In this figure, the idea is to keep a relatively small table that updates occur in and another that grows large, but is incrementally accessed (INSERTs only).</span></span> <span data-ttu-id="afc3e-204">例では、現時点で処理される注文のみ既に配信されているすべての注文は、完了したテーブルに移動中に作業中のテーブル内になります。</span><span class="sxs-lookup"><span data-stu-id="afc3e-204">In the example, only the orders being processed at the moment will be in the active table, while all orders that were already delivered will go to the completed table.</span></span>  
  
 <span data-ttu-id="afc3e-205">トリガーによりこのテーブルの構造は開始時に、1 つのテーブルの挿入/更新よりも遅くなりますが、時間の経過と共に、安定した書き込みパフォーマンスを維持します。</span><span class="sxs-lookup"><span data-stu-id="afc3e-205">Because of the trigger, this structure of tables is slower than an INSERT/UPDATE of a single table at the beginning, but maintains stable write performance over time.</span></span>  
  
## <a name="online-window-for-activity-data"></a><span data-ttu-id="afc3e-206">アクティビティ データのオンライン ウィンドウ</span><span class="sxs-lookup"><span data-stu-id="afc3e-206">Online Window for activity data</span></span>  
 <span data-ttu-id="afc3e-207">アクティビティのストレージは、主に、現在または最近完了したアクティビティのクエリを処理します。</span><span class="sxs-lookup"><span data-stu-id="afc3e-207">Activity storage primarily handles queries for current or recently completed activities.</span></span> <span data-ttu-id="afc3e-208">BAM をアーカイブして、BAM プライマリ インポート データベースから非常に古い、完了したアクティビティを削除します。</span><span class="sxs-lookup"><span data-stu-id="afc3e-208">BAM archives and then purges very old, completed activities from the BAM Primary Import database.</span></span> <span data-ttu-id="afc3e-209">したがって、アクティビティ データは BAM 経由で流れるし、は構成可能なオンライン時間帯の中にクエリで使用できます。</span><span class="sxs-lookup"><span data-stu-id="afc3e-209">Thus the activity data flows through BAM and is available for queries during a configurable Online Window.</span></span>  
  
## <a name="bam-partitioning"></a><span data-ttu-id="afc3e-210">BAM のパーティション分割</span><span class="sxs-lookup"><span data-stu-id="afc3e-210">BAM partitioning</span></span>  
 <span data-ttu-id="afc3e-211">ダウンタイムを回避してパフォーマンスを向上できるように、アクティビティのストレージは、アクティビティが完了したときに、タイムスタンプに基づくパーティション分割を使用します。</span><span class="sxs-lookup"><span data-stu-id="afc3e-211">To allow for higher performance and avoid downtime, activity storage uses partitioning based on the time stamp when the activity was completed.</span></span> <span data-ttu-id="afc3e-212">BAM は、これが完了したテーブルを同一フォーマットの空のテーブルとの定期的に交換を実現します。</span><span class="sxs-lookup"><span data-stu-id="afc3e-212">BAM achieves this by regular swapping of the completed table with another empty table of exactly the same format.</span></span> <span data-ttu-id="afc3e-213">BAM がこの後、古いパスワードを次の図のように、クエリのためだけに保持されます、新しいテーブルにさらに完了した活動が移動します。</span><span class="sxs-lookup"><span data-stu-id="afc3e-213">Once BAM does this, the further completed activities go into the new table, while BAM keeps the old one only for queries, as in the following figure:</span></span>  
  
 <span data-ttu-id="afc3e-214">![](../core/media/ebiz-prog-bam-data-maint-fig8.gif "ebiz_prog_bam_data_maint_fig8")</span><span class="sxs-lookup"><span data-stu-id="afc3e-214">![](../core/media/ebiz-prog-bam-data-maint-fig8.gif "ebiz_prog_bam_data_maint_fig8")</span></span>  
<span data-ttu-id="afc3e-215">BAM のパーティション交換</span><span class="sxs-lookup"><span data-stu-id="afc3e-215">BAM Partition Swapping</span></span>  
  
 <span data-ttu-id="afc3e-216">パーティションは、オンライン時間帯の外部完全には、BAM アーカイブして、それを削除します。</span><span class="sxs-lookup"><span data-stu-id="afc3e-216">Once a partition is completely outside the online window, BAM archives and then drops it.</span></span> <span data-ttu-id="afc3e-217">BAM には、ユーザーからこのような複雑さを最小限に抑えるには、フォームのパーティション分割されたビューも保持されます。</span><span class="sxs-lookup"><span data-stu-id="afc3e-217">To minimize this complexity from the user, BAM also maintains a partitioned view of the form:</span></span>  
  
```  
SELECT * FROM Active   
UNION ALL   
SELECT * FROM Completed   
UNION ALL  
  
```  
  
 <span data-ttu-id="afc3e-218">BAM に自動的に再作成このビューを作成またはパーティションを削除するたびにします。</span><span class="sxs-lookup"><span data-stu-id="afc3e-218">BAM automatically re-creates this view each time it creates or drops a partition.</span></span>  
  
 <span data-ttu-id="afc3e-219">BAM のパーティション分割については、次に注意してください。</span><span class="sxs-lookup"><span data-stu-id="afc3e-219">Note the following about BAM partitioning:</span></span>  
  
-   <span data-ttu-id="afc3e-220">パーティション ビューの名前は**bam _\<ActivityName\>_AllInstances**します。</span><span class="sxs-lookup"><span data-stu-id="afc3e-220">The name of the partitioned view is **bam_\<ActivityName\>_AllInstances**.</span></span> <span data-ttu-id="afc3e-221">このビューは、直接クエリでは、ものではありませんが、BAM の構成のトラブルシューティングを行う際に役立つ可能性があります。</span><span class="sxs-lookup"><span data-stu-id="afc3e-221">This view is not meant for direct queries, but may be useful when troubleshooting the BAM instrumentation.</span></span> <span data-ttu-id="afc3e-222">このビューの上部に作成するビジネス ユーザーの各カテゴリの特定のビューからデータを照会する必要があります。</span><span class="sxs-lookup"><span data-stu-id="afc3e-222">You should query the data from the specific views for each category of business users that you create on top of this view.</span></span> <span data-ttu-id="afc3e-223">詳細については、次を参照してください。[インスタンス データのクエリを実行する](../core/querying-instance-data.md)します。</span><span class="sxs-lookup"><span data-stu-id="afc3e-223">For more information, see [Querying Instance Data](../core/querying-instance-data.md).</span></span>  
  
-   <span data-ttu-id="afc3e-224">値を変更することにより、オンライン時間帯を設定する**OnlineWindowTimeUnit**と**OnlineWindowLength**テーブルの現在のアクティビティのレコードの**bam_Metadata_Activities**プライマリ インポート データベースにします。</span><span class="sxs-lookup"><span data-stu-id="afc3e-224">You set the online window by modifying the values for **OnlineWindowTimeUnit** and **OnlineWindowLength** in the record for the current activity in the table **bam_Metadata_Activities** in the Primary Import database.</span></span>  
  
-   <span data-ttu-id="afc3e-225">DTS パッケージ、 **bam_dm _\<ActivityName\>** アーカイブや削除、パーティション分割を実行します。</span><span class="sxs-lookup"><span data-stu-id="afc3e-225">The DTS package, **BAM_DM_\<ActivityName\>**, performs the partitioning and archiving/purging.</span></span> <span data-ttu-id="afc3e-226">このパッケージが実行されるたびに、別のパーティションを切り捨てます、外部のオンライン時間帯にあるすべてのパーティションのアーカイブおよび削除します。</span><span class="sxs-lookup"><span data-stu-id="afc3e-226">Each time this package runs, it truncates another partition and archives/drops all partitions that are outside the online window.</span></span>  
  
-   <span data-ttu-id="afc3e-227">アーカイブ データベースを構成しない場合、BAM はアーカイブしないで、期限切れのアクティビティ データを削除します。</span><span class="sxs-lookup"><span data-stu-id="afc3e-227">If you do not have Archiving Database configured, then BAM drops the aged activity data without archiving.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="afc3e-228">参照</span><span class="sxs-lookup"><span data-stu-id="afc3e-228">See Also</span></span>  
 [<span data-ttu-id="afc3e-229">BAM 動的インフラストラクチャ</span><span class="sxs-lookup"><span data-stu-id="afc3e-229">BAM Dynamic Infrastructure</span></span>](../core/bam-dynamic-infrastructure.md)