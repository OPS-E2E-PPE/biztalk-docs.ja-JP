---
title: DTA 追跡の MST を測定するためのテスト シナリオ |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 303dc1d8-baac-4b54-92c8-95c0ce640a76
caps.latest.revision: 12
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: cbf1c372f19232848396b610d248e98f8248a7cb
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/07/2019
ms.locfileid: "65299442"
---
# <a name="test-scenarios-for-measuring-mst-of-dta-tracking"></a>DTA 追跡の MST を測定するためのテスト シナリオ
これらが実際にはどのように機能するのかを示すために、および追跡における維持可能な最大スループット (MST) を測定する簡単な手法を紹介するために、ここでは、追跡の MST が測定されているテスト シナリオを提供します。 関連する手法が提供されるだけでなく、示されるデータを基に他のシステムの追跡パフォーマンスを測定することもできます。  
  
> [!IMPORTANT]
>  読者は、このトピックに含まれる情報が発行日の時点で扱われた問題に関するマイクロソフトの現在の見解を示していることに注意する必要があります。 市場の状況とテクノロジの変化に対応する必要があるため、マイクロソフトでは、発行日以降に示された情報の正確性は保証できません。  
  
## <a name="test-scenario-topology-and-configuration"></a>テスト シナリオのトポロジと構成  
 テスト シナリオのトポロジと構成を次の図に示します。  ここでは、4 つのメッセージ ボックス データベース サーバー、1 つの専用 BizTalkDTADb データベース サーバー、および [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] を実行する合計 7 つのサーバーでビルドアウトされており、サイズ変更が可能です。 図に描かれている BAM サーバーは、このテスト シナリオでは使用されなかったことに注意してください。  
  
 **BizTalkDTADb の維持可能なスループット**  
  
 ![追跡パフォーマンス トポロジ](../core/media/trackingperformancetopology.gif "TrackingPerformanceTopology")  
  
 **ハードウェア仕様 (BizTalk Server)**  
  
- CPU:デュアル 3 GHz (キャッシュ。L2:512 KB/L3:1 MB)  
  
- メモリ:2 GB の RAM  
  
- HDD:2 X 32 GB/15 K  
  
  **ハードウェア仕様 (SQL Server)**  
  
- CPU:クアッド 2 GHz (L2:512 KB/L3:1 MB)  
  
- メモリ:4 GB の RAM  
  
- HDD:2 X 32 GB/15 K 台 + SAN  
  
  次の図は、テスト シナリオ アーキテクチャの概要を示しており、その要素を以下に示します。  
  
- **TP** = 追跡ポイントは、いくつかの要素をイベントなど、追跡またはメッセージ プロパティ。  
  
- **MB** = メッセージ本文、メッセージ本文を追跡するポイント。  
  
  次のソリューション アーキテクチャは、以下の 3 つの主な構成コンポーネントでの追跡構成を示しています。  
  
- **既定の DTA 追跡**します。 図中のイベント追跡ポイントは、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] のインストール時に、既定ですべて有効になっています。  
  
- **メッセージ プロパティ**します。 受信パイプラインの逆アセンブラー (DA) コンポーネントに関連付けられている追跡ポイントは、受信メッセージの 10 プロパティの追跡を表しています。 追跡のプロパティを昇格する方法の詳細については、次を参照してください。[プロパティの昇格](../core/promoting-properties.md)します。  
  
- **メッセージ本文**します。 図中の 2 つのメッセージ本文 (MB) ポイントは、メッセージ本文を追跡するポイントを表しています。 メッセージ本文の追跡を設定する方法の詳細については、次を参照してください。 [、BizTalk Server 管理コンソールを使用した追跡構成](http://msdn.microsoft.com/49b7f9d3-60b5-41bd-ba8b-029253926bef)します。  
  
  **テスト シナリオのアーキテクチャ**  
  
  ![パフォーマンス シナリオ](../core/media/performancescenarios.gif "PerformanceScenarios")  
  
## <a name="test-techniques"></a>テスト手法  
 ファイル アダプターは送受信の両方で使用しました。 負荷生成ツール LoadGen 2007 を使用して、メッセージを受信ファイル共有に配信しました。 特定のレートでファイルを配信するように LoadGen ツールを構成することで、追跡 MST レベルの調査中に負荷を変更できるようにしました。 LoadGen ツールの詳細については、次を参照してください。 [Microsoft BizTalk LoadGen 2007 ツールを使用して](../core/using-the-microsoft-biztalk-loadgen-2007-tool.md)します。  
  
 このテストでは、BizTalkDTADb データベースでの 24 時間保持の要件を前提としました。 したがって、24 時間を経過したデータはすべてデータベースから削除されました。 アーカイブと削除を行う SQL ジョブは、アーカイブしたデータのみを削除するように設計されているので、このプロセスの間に失われるデータは一切ありません。  
  
 この要件でシステムについて十分なテストを行うには、最低でも 25 時間の負荷を実行して、アーカイブと削除のサイクルが少なくとも 1 回は含まれるようにする必要がありました。 システムが維持可能であることを確かめるために、48 時間継続で負荷を実行して最初のアーカイブ後にシステムを 24 時間監視することを選択しました。 最初の 24 時間は、定常状態のシミュレートを目的とするアーカイブ (24 時間ごと) の対象になる経過時間のデータを形成するために使われました。 次の 24 時間では、システムを監視してすべてのプロセス (たとえば、TDDS、アーカイブ、および削除) でスループットが維持できているかどうかを判断しました。  
  
 追跡動作についての理解から、持続性を判断するために監視する必要がある主要業績評価指標 (KPI) は、通常、次のごくわずかであることがわかります。  
  
- **BizTalkDTADb データベース データ ファイルのアイドル時間の物理的なディスク**します。 物理的なディスク アイドル時間が 0 に近ければ、BizTalkDTADb データベースに追跡データの流入、アーカイブ アクティビティ、削除アクティビティのいずれかまたはすべてが浸透していることを示す望ましい状態です。  
  
- **Trackingdata テーブルの深さ**します。 trackingdata テーブルが単調拡大を始めた場合、つまり、無制限に大きくなり続ける場合は、現在のスループット レートでは、TDDS で BizTalkDTADb データベースにデータを持続可能な速さで挿入できないことを明示しています。  
  
- **スプールの深さ**します。 スプールの増大につながる可能性のある要因はいくつかあります。 スプールの増大を招く可能性のある状況の 1 つは、追跡メッセージの本文をメッセージ ボックス データベースから BizTalkDTADb データベースにコピーする SQL ジョブが遅延している場合です。 追跡する必要があるメッセージは、BizTalkDTADb データベースに正常にコピーされるまでメッセージ ボックス データベースから削除する (メッセージ ボックスのクリーンアップ ジョブによる) ことができないので、コピー ジョブが遅延すると、スプールの増大を招くことになります。  
  
  ほとんどのシステムでは、負荷状況下でこの 3 つの業績評価指標のみを監視すれば、負荷が維持可能かどうかを判断する十分な情報を得られます。  
  
  **維持可能な負荷の下で主要業績評価指標**  
  
  ![追跡データベースのパフォーマンス監視](../core/media/perf-monitor-tracking-db.gif "Perf_Monitor_Tracking_db")  
  
  サンプル シナリオを使用して毎秒 20 メッセージが受信される負荷の下で、生成されたパフォーマンス グラフに示されているように、48 時間分の主要業績評価指標を得ました。 このグラフから、持続性を示す以下の傾向がわかります。  
  
- **Biztalkdtadb データの深さ (黒い線)** します。 3 つの公開メッセージ ボックス データベースでは、24 時間の時点での最初のアーカイブの後も、trackingdata テーブルの深さは安定し、上昇傾向が続いていないことがわかります。  
  
- **スプールの深さ (青い線)** します。 スプールの深さはこの実行をとおしてとても安定しており、アーカイブと削除によりリソースが使用されていても、追跡メッセージ (各メッセージのサイズは 10 KB) が BizTalkDTADb データベースに遅延することなくコピーされていることが示されています。  
  
- **BizTalkDTADb データベース データ ファイルの物理のディスク アイドル時間 (赤い線)** します。 最初の 24 時間は、アーカイブと削除が実行されることはなく、BizTalkDTADb データベースにデータが蓄積されるにつれて TDDS によるデータの挿入などディスク I/O が増加します。 これは、物理的なディスク アイドル時間の安定した低下としてはっきりと示されています。  
  
   実行に 24 時間で I/O アイドル時間クリアな低下が見られる、アーカイブと削除の作業を行いますが初めてと一致します。 最初のアーカイブ、消去がほぼゼロで (ただし、まだ、システム上の負荷がある)、24 時間よりも古いデータを削除する 1 分ごとに行う作業のアイドル時間。  
  
   ここで重要な点は、最初のアーカイブが行われると後、は、システムが最初に「ライブ BizTalkDTADb データベース データの保存」ウィンドウを渡されると、ディスクのアイドル時間なります非常にゼロに近いシステムの MST に近いときです。 これは、BizTalkDTADb データベースのボトルネックが、ほとんどの場合ディスク I/O サブシステムの速度であるためです。  
  
  システムのベースラインとして追跡を無効にして MST を測定することは、多くの場合で有益です。 このテストでの例として、追跡をすべて無効にした状態での MST は毎秒 290 メッセージで、これは上記の機能や DTA データ保有期間で追跡を有効にしたシステムの MST の何倍にもなります。 このことから、追跡を有効にしたシステムは、あまり活用されていないことがわかります。 つまり、毎秒 20 メッセージの MST の追跡のサポートだけが必要な場合は、毎秒 290 メッセージの処理が可能なシステムを構築する必要はありません。言い換えれば、BizTalkDTADb データベースのハードウェアを変更しない場合は、毎秒 20 メッセージのスループットを実現するのに必要とされる BizTalk データベース サーバーとメッセージ ボックス データベース サーバーの数は、このシナリオのものよりはるかに少ないと考えられます。  
  
## <a name="searching-for-maximum-sustainable-throughput"></a>維持可能な最大スループットの調査  
 これで、MST で実行されているシステムの KPI がどのようなものであるかがわかったので、サンプル シナリオの毎秒 20 メッセージ の MST に至った過程を確認して検討しましょう。 その過程は単純な繰り返しで、以下に示すような "バイナリ サーチ" アプローチです。  
  
- **開始ポイントを選択**します。 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] でのパフォーマンス テストの経験がまだなければ、他のシステムで得られていることに関する利用可能な情報を活用する必要があります。  
  
   たとえば、このトピックのサンプル シナリオのハードウェア、構成、ソリューションについてのアーキテクチャはすべて提供してきました。 そのアーキテクチャと有効にした追跡の種類 (既定 + 10 プロパティ + 10 KB のメッセージ本文) や 24 時間の DTA データ保有期間で得られた MST (毎秒20 メッセージ) を使用して、アーキテクチャとセットアップや要件を比較します。  
  
   少なくとも、ソリューションの MST が、このテストで得られた値より高くなるか低くなるかを見積もる必要があります。 使用するシステムとの比較に、さまざまなテクニカル ケース スタディを利用できる場合もあります。 例については、BizTalk Server のデベロッパー センターで使用可能なケース スタディを参照してください。 ある[ http://go.microsoft.com/fwlink/?LinkId=49339](http://go.microsoft.com/fwlink/?LinkId=49339)します。  
  
- **推定 MST の負荷の下でシステムを実行して、KPI の監視**します。 通常、推定 MST の高い側から開始することで、MST を見つけるためにかかる時間を短縮できます。 高い値からの開始により、MST を下回っていることがわかるのにかかる時間 (つまり、少なくとも 1 つのデータ保有期間の満了) よりも早く KPI が飽和状態 (特に ディスク I/O) に達します。  
  
- **MST の推定値と繰り返し調整**します。 テストの実行結果を見て、MST の推定値を調整し、新しい推定値で再度テストします。  
  
## <a name="see-also"></a>参照  
 [維持可能な最大の追跡スループットの測定](../core/measuring-maximum-sustainable-tracking-throughput.md)   
 [DTA 追跡のパフォーマンス特性を理解します。](../core/understanding-dta-tracking-performance-behavior.md)   
 [DTA 追跡の MST を特定のヒントし、テクニック](../core/tips-and-tricks-for-finding-mst-of-dta-tracking.md)   
 [追跡データベースのサイズに関するガイドライン](../core/tracking-database-sizing-guidelines.md)
