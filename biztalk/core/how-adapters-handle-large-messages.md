---
title: アダプターによるサイズの大きいメッセージの処理 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: c48671fd-b6cf-4507-92b4-35a4cd135714
caps.latest.revision: 15
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 131d757e1df910b33d92bbc7b02a576edad8efcd
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/07/2019
ms.locfileid: "65344246"
---
# <a name="how-adapters-handle-large-messages"></a>アダプターがサイズの大きいメッセージを処理する方法
BizTalk メッセージング エンジンは、非常に大きなメッセージを処理できるし、メッセージの最大サイズに制限はありません。 ただし、最適なパフォーマンスとリソース管理を維持するためにメッセージのサイズに制限を考慮する必要があります。 メッセージとしては、サイズは、2 つ目の減少ごとに処理されたメッセージの数を増加します。 メッセージの平均サイズ、メッセージの種類とによって処理されるメッセージの数を検討してください[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]ときに、シナリオを設計し、容量を計画します。  
  
## <a name="stream-based-processing"></a>Stream ベースの処理  
 留意するサイズの大きいメッセージの処理のアダプターを開発する際に重要です。 サイズに関係なくメモリへのデータ ストリーム全体の読み込みはこれ、BizTalk Server プロセスを停止する可能性があります可能性があるためにお勧めします。 サイズと、エンジンは、特定の時点で処理されているメッセージの数、に応じて仮想メモリの不足が問題になる可能性があります。 代わりに、メッセージがするように処理ストリーミング方式で。  
  
- **メッセージを受信します。** 受信メッセージのネットワーク ストリームは、「抽出」のストリームを BizTalk メッセージング エンジンに、受信アダプターによって、BizTalk メッセージにアタッチされます。  
  
- **送信メッセージ。** 送信メッセージの場合、アダプタは、ストリームの抽出責任を負います。 メッセージ ボックス データベースからストリームを効果的にはこれを送信パイプラインを介してします。 アダプターでは、ストリーミング方式でネットワーク経由でデータを送信する必要があります。  
  
  次の図は、ストリーム ベースのメッセージング エンジンの受信側で処理を示します。  
  
  ![](../core/media/streambasedprocessing.gif "Streambasedprocessing")  
  
  アダプターからエンジンにメッセージを送信するときをデータ ストリームを BizTalk メッセージにアタッチします。 一部のアダプターのネットワーク ストリームの実装があります。 メッセージが送信されたときに、エンジンは、受信パイプラインを実行します。 パイプラインの実行中は、データを変更するパイプライン コンポーネントは、メッセージは、前のメッセージのストリームに、新しいメッセージのストリームを配線を複製します。 パイプラインが実行された後、メッセージング エンジンは、パイプラインからのメッセージを取得し、そのメッセージのストリームを読み取るループを実行します。 この読み取り、ストリームのでは、さらにネットワーク ストリームに戻る で、前のストリームで読み取りを呼び出す前のストリームの読み取りを呼び出します。 エンジンは、フラット メモリ モデルを維持するために、メッセージ ボックスに、データを定期的にフラッシュします。  
  
  **トラブルシューティングのヒント。** 送信側では、アダプタは、ストリームの読み取りを行うです。 送信アダプターがメッセージの昇格または送信パイプラインで記述されるコンテキスト プロパティを読み取るには、ストリーム全体が読み取られるまでこれらのプロパティは書き込まれません。 ストリームが完全に読み取られた場合にのみ、アダプターできます実行が完了のパイプライン コンポーネントをすべて確認してください。  
  
## <a name="locating-a-specific-byte-in-the-stream"></a>特定のバイト数を Stream で検索します。  
 アダプターが中断する必要がある失敗したメッセージを処理するために先頭に戻り、ストリームを検索する必要がありますシナリオがあります。 この例では、チャンク エンコードを使用して、送信請求-応答の組み合わせで応答メッセージを送信するデータを受信する HTTP アダプターです。  
  
 ただし、多くのシナリオでないことができます、データ ストリームをトレースします。 たとえば、チャンク エンコードを使用してデータを受信する HTTP アダプターがあるとします。 アダプターがデータ ストリームの失敗したメッセージを検索できるように設計するには、読み取られると、メモリまたはディスクにデータをキャッシュする必要があります。 明らかにこれが最適でないと、その他のリソースが必要です。 さらに、ボックスのパイプライン コンポーネントの多くは順方向専用のストリーミング方式で動作します。 SDK の BaseAdapter をこれらのシナリオと呼ばれるヘルパー クラスを使用して**VirtualStream**します。 この機能を含むファイルは VirtualStream.cs という名前です。  
  
> [!NOTE]
>  VirtualStream.cs ファイルは、パイプラインの SDK サンプルの 2 つの場所にある — \samples\pipelines\arbitraryxpathpropertyhandler および \samples\pipelines\schemaresolvercomponent\schemaresolverflatfiledasm します。  
  
 仮想ストリームの背後にある考え方では、ディスク上のセキュリティで保護された場所にデータをオーバーフローするしきい値に達するまで、メモリ ストリームに、ストリーム内のデータをキャッシュすることです。 ストリームが閉じた後、ディスク ファイルが自動的に削除します。 この方法では、順方向専用ストリームを設計できます。