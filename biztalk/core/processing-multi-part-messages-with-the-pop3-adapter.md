---
title: "POP3 アダプターでメッセージの処理のマルチパート |Microsoft ドキュメント"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 56ad041f-f155-4c1c-ab87-1405c80d9b68
caps.latest.revision: "6"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 26aff4569414103ad8c4f37a9e4699a85874e481
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/20/2017
---
# <a name="processing-multi-part-messages-with-the-pop3-adapter"></a><span data-ttu-id="9d4fe-102">POP3 アダプタでのマルチパート メッセージの処理</span><span class="sxs-lookup"><span data-stu-id="9d4fe-102">Processing Multi Part Messages with the POP3 Adapter</span></span>
<span data-ttu-id="9d4fe-103">POP3 アダプターに記載された IETF 標準に準拠する MIME でエンコードされたメッセージを処理できる[RFC 2045](http://go.microsoft.com/fwlink/?LinkId=58810)、 [RFC 2046](http://go.microsoft.com/fwlink/?LinkId=58811)、および[RFC 2047](http://go.microsoft.com/fwlink/?LinkId=58812)です。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-103">The POP3 Adapter can process MIME-encoded messages that conform to the IETF standards documented in [RFC 2045](http://go.microsoft.com/fwlink/?LinkId=58810), [RFC 2046](http://go.microsoft.com/fwlink/?LinkId=58811), and [RFC 2047](http://go.microsoft.com/fwlink/?LinkId=58812).</span></span> <span data-ttu-id="9d4fe-104">MIME エンコード メッセージは、コンテンツの種類が異なる 1 つ以上の部分を含めることができます。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-104">MIME encoded messages can have from one to many parts with different content types.</span></span> <span data-ttu-id="9d4fe-105">このトピックでは、POP3 アダプタがマルチパートの MIME エンコード メッセージを処理する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-105">This topic discusses the how the POP3 adapter processes multi part MIME encoded messages.</span></span>  
  
## <a name="receiving-multi-part-messages-with-the-pop3-adapter"></a><span data-ttu-id="9d4fe-106">POP3 アダプタでのマルチパート メッセージの受信</span><span class="sxs-lookup"><span data-stu-id="9d4fe-106">Receiving Multi part Messages with the POP3 Adapter</span></span>  
 <span data-ttu-id="9d4fe-107">POP3 アダプターを使用する受信場所がいるかどうか、 **MIME デコードの適用**オプションに設定**True** MIME エンコード メッセージを受信するときに、POP3 アダプターが、次の操作を実行します。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-107">If a receive location that uses the POP3 adapter has the **Apply MIME Decoding** option set to **True** then the POP3 adapter performs the following actions when receiving a MIME-encoded message:</span></span>  
  
1.  <span data-ttu-id="9d4fe-108">受信した MIME エンコード メッセージの部分から、マルチパート BizTalk メッセージを作成します。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-108">Creates a multi part BizTalk message from the parts of the MIME encoded message that it receives.</span></span> <span data-ttu-id="9d4fe-109">このマルチパート メッセージには、1 つ以上の部分を含めることができます。含まれる部分の数は、受信した MIME エンコード メッセージの部分の数と同じになります。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-109">This multi part message can contain from 1 to many parts and will contain the same number of parts as the MIME encoded message that is received.</span></span>  
  
2.  <span data-ttu-id="9d4fe-110">MIME エンコード メッセージのヘッダーをスキャンします。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-110">Scans the headers of the MIME encoded message.</span></span> <span data-ttu-id="9d4fe-111">かどうか、任意のヘッダーは、トピックに記載されているプロパティの一覧を一致[POP3 アダプタ プロパティ スキーマおよびプロパティ](../core/pop3-adapter-property-schema-and-properties.md)し、これらのヘッダーは、コンテキスト プロパティとしてマルチパート BizTalk メッセージに昇格されます。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-111">If any headers match the list of properties documented in the topic [POP3 Adapter Property Schema and Properties](../core/pop3-adapter-property-schema-and-properties.md) then these headers are promoted to the multi part BizTalk message as context properties.</span></span>  
  
3.  <span data-ttu-id="9d4fe-112">構成可能なアルゴリズムを使用して、MIME エンコード メッセージの部分の 1 つを BizTalk メッセージのボディ部として指定します。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-112">Uses a configurable algorithm to designate one of the parts of the MIME encoded message as the BizTalk message body part.</span></span> <span data-ttu-id="9d4fe-113">BizTalk メッセージのボディ部にどのメッセージ部分を決定するためのアルゴリズムは、以下のセクションで説明されて**本文部分選択アルゴリズム使用 POP3 アダプターによって**です。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-113">The algorithm used to determine which message part will be the BizTalk message body part is described below in the section **Body Part Selection Algorithm Used by the POP3 Adapter**.</span></span>  
  
4.  <span data-ttu-id="9d4fe-114">マルチパート BizTalk メッセージをメッセージ ボックスに公開します。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-114">Publishes the multi part BizTalk message to the MessageBox.</span></span>  
  
## <a name="body-part-selection-algorithm-used-by-the-pop3-adapter"></a><span data-ttu-id="9d4fe-115">POP3 アダプタで使用されるボディ部の選択アルゴリズム</span><span class="sxs-lookup"><span data-stu-id="9d4fe-115">Body Part Selection Algorithm Used by the POP3 Adapter</span></span>  
 <span data-ttu-id="9d4fe-116">POP3 アダプタは、受信した MIME エンコード メッセージの部分からマルチパート BizTalk メッセージを作成するときに、メッセージ部分の 1 つを、BizTalk メッセージのボディ部として選択します。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-116">When the POP3 adapter creates a multipart BizTalk message from the parts of the MIME-encoded message that it receives, it selects one of the message parts as the BizTalk message body part.</span></span> <span data-ttu-id="9d4fe-117">BizTalk メッセージのボディ部は、BizTalk Server でのメッセージ検証、マッピング、プロパティの昇格、フラット ファイル アセンブリなどの操作に使用されます。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-117">The BizTalk message body part is used by BizTalk Server for things such as message validation, mapping, property promotion, flat file assembly and other operations.</span></span> <span data-ttu-id="9d4fe-118">マルチパート BizTalk メッセージのサブスクライバはすべてのメッセージ部分を受信しますが、マルチパート メッセージを理解できるオーケストレーション、カスタム パイプライン、またはアダプタを使用する場合を除いて、BizTalk メッセージの指定されたボディ部だけを処理します。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-118">Subscribers to a multi part BizTalk message receive all of the message parts but will only consume the designated BizTalk message body part unless using an orchestration, a custom pipeline, or an adapter that can understand multi part messages.</span></span> <span data-ttu-id="9d4fe-119">たとえば、マルチパート メッセージのすべての部分を読み取るようにオーケストレーションを構成できます。また、SMTP アダプタは、マルチパート メッセージのすべての部分を読み取ることができます。MIME/SMIME エンコーダ パイプライン コンポーネントを使用するようにカスタム パイプラインを構成することもできます。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-119">For example, you can configure an orchestration to read all parts of multi part message; the SMTP adapter can read all of the parts of a multi part message, and a custom pipeline can be configured to use the MIME/SMIME encoder pipeline component.</span></span> <span data-ttu-id="9d4fe-120">オーケストレーションを使用して、マルチパート メッセージを使用する方法の詳細については、以下のセクションを参照してください**マルチパート メッセージの処理オーケストレーションで**です。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-120">For more information about using an orchestration to consume a multi part message see the section below, **Processing Multi Part Messages in Orchestrations**.</span></span>  
  
 <span data-ttu-id="9d4fe-121">POP3 アダプターの指定された値に基づいて使用可能なボディ部から BizTalk メッセージのボディ部の選択、**ボディ部のインデックス**と**ボディ パーツのコンテンツ タイプ**です。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-121">The POP3 adapter selects the BizTalk message body part from the available body parts based upon the values supplied for the **Body Part Index** and the **Body Part Content Type**.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="9d4fe-122">POP3 アダプターは、ボディ パーツ コンテンツの種類で定義されているを認識するように設計されています[RFC 2046](http://go.microsoft.com/fwlink/?LinkId=119569)です。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-122">The POP3 adapter is designed to recognize the Body Part Content Types that are defined in [RFC 2046](http://go.microsoft.com/fwlink/?LinkId=119569).</span></span>  
  
 <span data-ttu-id="9d4fe-123">電子メールの BizTalk メッセージのボディ部を選択するために使用されるアルゴリズムを次に示します。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-123">The algorithm that is used to select the BizTalk message body part of an e-mail is described below:</span></span>  
  
1.  <span data-ttu-id="9d4fe-124">場合、**ボディ部のインデックス**0 に設定されていると、**ボディ パーツのコンテンツの種類**次のアルゴリズムの使用を BizTalk メッセージのボディ部を選択し、空白であります。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-124">If the **Body Part Index** is set to 0 and the **Body Part Content Type** is blank then the following algorithm is used to select the BizTalk message body part:</span></span>  
  
    -   <span data-ttu-id="9d4fe-125">Content-Description ヘッダーが "body" に設定されている、最初の MIME 部分を使用します。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-125">Use the first MIME part with the Content-Description header set to "body".</span></span>  
  
    -   <span data-ttu-id="9d4fe-126">それ以外の場合は、Content-Type ヘッダーが "text/xml" に設定されている、最初の MIME 部分を使用します。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-126">Otherwise use the first MIME part with the Content-Type header set to "text/xml".</span></span>  
  
    -   <span data-ttu-id="9d4fe-127">それ以外の場合は、Content-Type ヘッダーが "text/plain" に設定されている、最初の MIME 部分を使用します。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-127">Otherwise use the first MIME part with the Content-Type header set to "text/plain".</span></span>  
  
    -   <span data-ttu-id="9d4fe-128">それ以外の場合は、Content-Type ヘッダーが "text/" に設定されている、最初の MIME 部分を使用します。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-128">Otherwise use the first MIME part with the Content-Type header set to "text/".</span></span>  
  
    -   <span data-ttu-id="9d4fe-129">それ以外の場合は、最初の MIME 部分を使用します。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-129">Otherwise use the first MIME part.</span></span>  
  
2.  <span data-ttu-id="9d4fe-130">それ以外では、**ボディ部のインデックス**0 に設定されていると、**ボディ パーツのコンテンツの種類**セットを指定された一致する受信メッセージの最初のボディ部**ボディ パーツのコンテンツの種類**が BizTalk メッセージのボディ部として選択します。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-130">Otherwise if the **Body Part Index** is set to 0 and the **Body Part Content Type** is set, then the first body part of the incoming message that matches the specified **Body Part Content Type** is selected as the BizTalk message body part.</span></span> <span data-ttu-id="9d4fe-131">コンテンツの種類が一致する部分がない場合、メッセージは中断されます。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-131">If there are no parts with a matching content type then the message is suspended.</span></span>  
  
3.  <span data-ttu-id="9d4fe-132">それ以外では、**ボディ部のインデックス**0 より大きい値に設定されて、**ボディ パーツのコンテンツの種類**が空白に指定したインデックスのボディ部が BizTalk メッセージのボディ部として選択されています。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-132">Otherwise if the **Body Part Index** is set to a value greater than 0 and the **Body Part Content Type** is blank, then the body part with the specified index is selected as the BizTalk message body part.</span></span> <span data-ttu-id="9d4fe-133">指定されたインデックスがボディ部の数より大きい場合、メッセージは中断されます。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-133">If the specified index is greater than the number of body parts then the message is suspended.</span></span>  
  
4.  <span data-ttu-id="9d4fe-134">それ以外では、**ボディ部のインデックス**0 より大きい値に設定されて、**ボディ パーツのコンテンツ タイプ**が設定されている、**ボディ部のインデックス**のみに適用に本文はパーツを指定された一致**ボディ パーツのコンテンツの種類**対応するボディ部が BizTalk メッセージのボディ部として選択されているとします。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-134">Otherwise if the **Body Part Index** is set to a value greater than 0 and the **Body Part Content Type** is set, then the **Body Part Index** is only applied to those body parts that match the specified **Body Part Content Type** and the corresponding body part is selected as the BizTalk message body part.</span></span> <span data-ttu-id="9d4fe-135">指定されたインデックスが、コンテンツの種類が一致する部分の数より大きい場合、メッセージは中断されます。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-135">If the specified index is greater than the number of parts with a matching content type then the message is suspended.</span></span> <span data-ttu-id="9d4fe-136">コンテンツの種類が一致する部分がない場合、メッセージは中断されます。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-136">If there are no parts with a matching content type then the message is suspended.</span></span>  
  
5.  <span data-ttu-id="9d4fe-137">BizTalk メッセージのボディ部として選択された部分が、メッセージ ボックスに公開されるマルチパート BizTalk メッセージの最初の部分になり、メッセージの残りの部分は、元の MIME エンコード メッセージ内での順序のまま維持されます。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-137">The part that is selected as the BizTalk message body part becomes the first part of the multi part BizTalk message that is published to the MessageBox, the remaining parts of the message maintain the order that they had in the original MIME encoded message.</span></span>  
  
## <a name="processing-multi-part-messages-in-orchestrations"></a><span data-ttu-id="9d4fe-138">オーケストレーションでのマルチパート メッセージの処理</span><span class="sxs-lookup"><span data-stu-id="9d4fe-138">Processing Multi Part Messages in Orchestrations</span></span>  
 <span data-ttu-id="9d4fe-139">POP3 アダプタが受信した MIME エンコード メッセージからマルチパート BizTalk メッセージを作成するときは、1 つの部分だけが BizTalk メッセージのボディ部として指定されていても、すべての部分がメッセージ ボックス データベースに公開されます。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-139">When the POP3 adapter creates a multi part BizTalk message from a MIME encoded message that it receives, all of the parts are published to the MessageBox database even though only one of the parts is designated as the BizTalk message body part.</span></span> <span data-ttu-id="9d4fe-140">その後、マルチパート メッセージをサブスクライブするオーケストレーションで、これらの部分を処理できます。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-140">These parts can be subsequently consumed by an orchestration that subscribes to the multi part message.</span></span> <span data-ttu-id="9d4fe-141">ここでは、オーケストレーションでマルチパート メッセージを処理する際の考慮事項について説明します。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-141">This section documents some considerations when processing multi part messages in an orchestration.</span></span>  
  
### <a name="processing-multi-part-messages-with-a-known-number-of-parts-and-known-part-types"></a><span data-ttu-id="9d4fe-142">部分の数と部分の種類が設定されているマルチパート メッセージの処理</span><span class="sxs-lookup"><span data-stu-id="9d4fe-142">Processing multi part messages with a known number of parts and known part types</span></span>  
 <span data-ttu-id="9d4fe-143">オーケストレーションで部分の数と部分の種類が設定されているマルチパート メッセージを受信する場合は、オーケストレーション内でマルチパート メッセージを宣言し、部分の数と部分の種類をデザイン時に設定できます。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-143">If your orchestration is receiving a multi part message with a known number of parts and known part types then you can declare a multi part message in the orchestration and set the number of parts and part types at design time.</span></span>  
  
### <a name="processing-multi-part-messages-with-unknown-part-types"></a><span data-ttu-id="9d4fe-144">部分の種類が不明なマルチパート メッセージの処理</span><span class="sxs-lookup"><span data-stu-id="9d4fe-144">Processing multi part messages with unknown part types</span></span>  
 <span data-ttu-id="9d4fe-145">かどうかは、オーケストレーションが不明な部分の種類とマルチパート メッセージを受信し、使用してオーケストレーションでマルチパート メッセージを宣言することができます、 **XmlDocument**対象の型が不明な要素別の型。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-145">If your orchestration is receiving a multi part message with unknown part types then you can declare a multi part message in the orchestration and use the **XmlDocument** type for each of the parts for which the type is unknown.</span></span>  
  
### <a name="processing-multi-part-messages-with-an-unknown-number-of-parts-and-all-of-the-part-types-are-unknown"></a><span data-ttu-id="9d4fe-146">部分の数とすべての部分の種類が不明なマルチパート メッセージの処理</span><span class="sxs-lookup"><span data-stu-id="9d4fe-146">Processing multi part messages with an unknown number of parts and all of the part types are unknown</span></span>  
 <span data-ttu-id="9d4fe-147">かどうか、オーケストレーションがパーツ数が不明なマルチパート メッセージを受信し、1 つの部分でマルチパート メッセージを宣言することができます、 **XmlDocument**メッセージを受信するオーケストレーションの種類。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-147">If your orchestration is receiving a multi part message with an unknown number of parts then you can declare a multi part message with a single part of the **XmlDocument** type in the orchestration to receive the message.</span></span> <span data-ttu-id="9d4fe-148">宣言された部分の数よりも大きい値を含むマルチパート メッセージを受信する場合、オーケストレーション エンジン読み取りの数の部分がありますが、メッセージに作成で宣言されたメッセージ部分の数に一致する部分の適切な部分の種類型と、コンストラクト**XmlDocument**残りの部分の部分です。</span><span class="sxs-lookup"><span data-stu-id="9d4fe-148">If a multi part message that contains greater than the number of declared parts is received, the orchestration engine reads how many parts there are in the message, then constructs the proper part types for the parts that match the number of parts in the declared message type and then constructs **XmlDocument** parts for the remaining parts.</span></span>