---
title: MSMQT アダプターから MSMQ アダプターへの移行 |Microsoft Docs
ms.custom: ''
ms.date: 12/07/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 97126f70-0be5-4a2f-bcba-173fd932b6de
caps.latest.revision: 30
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 345247a39a3226d3e51b7c73f12be177adf01a3d
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/07/2019
ms.locfileid: "65324831"
---
# <a name="migrate-from-the-msmqt-adapter-to-the-msmq-adapter"></a>MSMQT アダプターから MSMQ アダプターへの移行します。
このトピックでは、エンド ツー エンドの順次配送、に関して考慮すべき点を説明トランザクションの一貫性、高可用性、およびスケーラビリティを移行する前に、メッセージ キュー (MSMQ) アダプタを BizTalk メッセージ キュー (MSMQT) アダプターからのソリューションです。 このトピックでは順次配送のために、トランザクションの一貫性、高可用性、およびスケーラビリティように定義します。  
  
-   **順次配送します。** 受信した順序と同じ順序でメッセージを BizTalk server が送信されることを保証します。  
  
-   **トランザクションの一貫性。** メッセージが処理中には保証の消失やハードウェア、ソフトウェア、またはネットワーク障害により重複します。  
  
-   **高可用性。** 処理可能な常にメッセージを処理するために使用するサービスを保証します。  
  
-   **スケーラビリティです。** 既存のメッセージ処理能力を向上する機能。  
  
## <a name="end-to-end-ordered-delivery"></a>エンド ツー エンドの順次配送  
 MSMQT アダプターでは、メッセージのエンド ツー エンドの順次配送をようにします。 つまり、MSMQ アプリケーションでは、これらのメッセージをオーケストレーションに配信されるか、送信ポートを BizTalk Server に同じ順序で、MSMQT アダプタにバインドされている受信場所に 1、2、および 3 のメッセージを送信する場合。1, 2, 3. この機能の用途の 1 つは、送信および受信される順序と同じ順序で実行する必要がありますある株式市場取引を含めることができます。  
  
 MSMQT でエンド ツー エンド順次配信では、多くのコンポーネントが連携する必要があります。 次の一連のイベントは、MSMQT アダプターでこれを行う方法を示しています。  
  
1. リモート コンピューター上の MSMQ API では、順序で 1、2、および 3 のメッセージを受信し、同じ順序でトランザクションのローカル キューにプッシュします。1, 2, 3.  
  
2. リモート コンピューターの MSMQ クライアントは、キューからメッセージを受け取りの順に MSMQT キューに送信します。1, 2, 3.  
  
3. MSMQT アダプターでは、注文 1、2、3 のメッセージを受信し、同じ順序で BizTalk メッセージ エージェント コンポーネントに渡します。1, 2, 3.  
  
4. BizTalk メッセージ エージェント コンポーネントの順序でメッセージ ボックスに、メッセージが送信されることを保証します。1, 2, 3.  
  
5. メッセージ ボックスは、メッセージをルーティングし、により、オーケストレーションまたは送信ポートの同じインスタンスにルーティングされる場合と同じ順序では、このインスタンスに配信されること。1, 2, 3.  
  
   MSMQT アダプターのみを終了することを保証できるが、BizTalk Server 2004 で順次配送を終了します。 手順 3 ~ 5 が上記のメッセージの順序を変更すべて、その他の統合 BizTalk アダプターのことができます可能性があります。 他の統合アダプターのほとんどは、として、エンド ポイント マネージャー、本質的にマルチ スレッドの順序を保持されませんと呼ばれるコンポーネントを使用して手順 3 を完了します。 BizTalk Server 2004 の MSMQ アダプターは、手順 3. の順序を保持する「シリアル処理」機能を使用しますが、ので、メッセージをオーケストレーションにルーティングされる可能性がありますまたは送信ポートを順不同の今後の順序を保持するメッセージ エージェントが、要求はしません。  
  
   **エンド ツー エンドの MSMQ アダプターで順次配送**  
  
   エンド ツー エンドの MSMQ アダプターで順次配送を実現するために次の手順に従います。  
  
6. 有効にする、**順次配送**受信側のプロパティは、サブスクライブを行うオーケストレーションのポートまたは送信ポート。 BizTalk server のオーケストレーションでポートを受信および送信ポートが設定されて、**順次配送**構成オプション。 このオプションが有効になっている場合、オーケストレーションの受信ポートまたは、送信ポートは、メッセージ ボックスに送信された順序と同じ順序でメッセージを配信するメッセージ ボックスを確認します。  
  
7. 設定、**順次処理**に MSMQ アダプターにバインドされている受信場所のプロパティ`True`します。 BizTalk Server で、これが有効な場合は、メッセージが受信された順序と同じ順序でメッセージ ボックスに送信されることにより、順次処理を使用する、MSMQ トランスポートの使用を構成する場所が表示されます。  
  
8. 設定、**トランザクション**に MSMQ アダプターにバインドされている受信場所のプロパティ`True`します。  
  
9. MSMQ によって監視されている MSMQ のキューが受信場所であることを確認します「トランザクション」とマークされます。 このプロパティは、キューにメッセージの順次配送を確実に設定する必要があります。  
  
> [!NOTE]
>  順次配送は、場所は/は 1 台のコンピューターによって処理される MSMQ キューまたは BizTalk によって監視されているキューが表示される場合にのみ保証されます。 これは、により、以下に示すよう、スケーラビリティの問題が発生することができます。  
  
## <a name="transaction-usage-when-processing-messages-with-the-msmqt-adapter-vs-the-msmq-adapter"></a>MSMQ アダプターと MSMQT アダプターでメッセージを処理するときに、トランザクションの使用  
 トランザクションの使用に関して、MSMQT アダプターと MSMQ アダプターがメッセージを処理する方法の主な違いがあります。  
  
 MSMQT アダプターを使用する場合、ネットワークからメッセージを受信して、BizTalk Server による処理のプロセスは、単一のトランザクションで処理されます。 MSMQT アダプターを使用する場合、メッセージが受信され、BizTalk Server によって正常に処理されたことを示していますが、ACK メッセージの送信者に対して生成します。  
  
 MSMQ アダプターを使用する場合から BizTalk Server では、ネットワークと処理メッセージの受信のプロセスは、ネットワークから受信するため、BizTalk Server で処理するための 2 つの個別のトランザクションを処理します。 MSMQ アダプターを使用する場合、メッセージが BizTalk Server によって正常に処理されていないネットワークからメッセージが正常に受信されたことを示すものは ACK メッセージの送信者に対して生成されました。 送信者は、メッセージがネットワークからの受信し、BizTalk Server がインストールされているかどうかに関係なく、ローカルの MSMQ キューに永続化、Microsoft メッセージ キュー サーバーから ACK を受信します。 メッセージは MSMQ キューに永続化した後、BizTalk MSMQ アダプターは、ピックアップする、処理、およびメッセージ ボックス データベースに公開します。 このプロセスが失敗した場合、メッセージが BizTalk 保留キューに送信されるか、ローカルの MSMQ キュー (トランザクション処理を使用) する場合のままにし、送信者がメッセージに BizTalk Server での処理が失敗したことを示す値を持たない。  
  
 Ack を受信、メッセージが BizTalk Server によって正常に処理されるときに、アーキテクチャを必要とする場合、MSMQT アダプターから MSMQ アダプターに移行する場合は、アプリケーション レベルの Ack を追加する必要があります。 オーケストレーションや送信元アプリケーション アプリケーション レベルの Ack を実装するために更新する必要があります。  
  
## <a name="high-availability-transactional-in-order"></a>高可用性 (トランザクション、順次)  
 MSMQT アダプターの高可用性を実現するには、受信ホストに複数のコンピューターを追加し、フォールト トレランスのためのネットワーク負荷分散 (NLB) の構成または既定の BizTalk ホストをクラスター化することができます。 1 つのサーバーの他のサーバーがダウンした場合、NLB を組み合わせて、MSMQT アダプターを実行している場合は、負荷を処理します。 1 つのホスト ノードが失敗した場合は、クラスター化されたホストで MSMQT アダプター ハンドラーを実行している場合、クラスター ソフトウェアは、その他のノードにクラスター化されたホストをフェールオーバーします。 MSMQ アダプターを使用する場合、MSMQ アダプターが中間ストレージにローカルの MSMQ キューを使用するためのデータ損失なしでトランザクション処理する必要がある場合は、NLB は機能しません。 このシナリオでメッセージがローカルの MSMQ キューに配信されたが、MSMQ アダプターによって処理されていない場合、メッセージは失われます、コンピューターが失敗した場合。  
  
 MSMQ アダプターを使用した高可用性とトランザクションの一貫性を提供するには、次の操作を行う必要があります。  
  
1. Microsoft メッセージ キュー (MSMQ) は、BizTalk server の Windows Server クラスター グループのクラスター化リソースとして構成します。  
  
2. MSMQ アダプターを構成するクラスター化された MSMQ リソースと同じクラスター グループ内のクラスター リソースとして構成されている BizTalk ホスト インスタンスで受信するハンドラー。  
  
3. クラスター化された MSMQ リソースへの依存関係が維持されるため、BizTalk ホスト インスタンスのクラスター リソースを構成します。  
  
   このアーキテクチャで順次配送を実装するには、「--エンドツー エンドで順次配送を MSMQ アダプターを」前に示した手順に従います  
  
## <a name="high-availability-nontransactional-not-in-order"></a>高可用性 (非トランザクション、順序ではなく)  
 高可用性を必要がありますが、トランザクションは不要である場合、処理することができます MSMQ アダプターで NLB を実装して、MSMQ 送信で構成されているホストのインスタンスを実行してこれを実現し、受信ハンドラー NLB の背後にある複数の BizTalk server で。 MSMQ で NLB を実装するときに Microsoft サポート技術情報の記事に記載されているベスト プラクティスを従う必要があります[899611。どのようにメッセージ キュー機能ネットワーク負荷分散 (NLB) 経由で](https://support.microsoft.com/help/899611/how-message-queuing-can-function-over-network-load-balancing-nlb)します。 このシナリオで BizTalk サーバーのいずれかに失敗した場合で実行されているホスト インスタンスで、BizTalk server は使用できません、BizTalk server までメッセージが復元します。 この構成は、NLB が他の BizTalk server に要求をルーティングする場合は、BizTalk server のいずれかが利用できないために、高可用性を提供します。  
  
## <a name="scalability-nontransactional-not-in-order"></a>スケーラビリティ (非トランザクション、順序ではなく)  
 高可用性 (非トランザクション) のためのガイドラインに従うと、ホスト インスタンスを追加してスケーラビリティを実現できます。 このアーキテクチャでは、高速な配信とスケーラビリティを提供しますが、順次配送を行いません。  
  
## <a name="scalability-transactional-not-in-order"></a>スケーラビリティ (トランザクション、順序ではなく)  
 配信順序を問わないメッセージのトランザクション配信は、MSMQ および Windows クラスタ リングと NLB の使用を結合できます。 このアーキテクチャでは、Windows クラスターごとに次の「高可用性 (トランザクション順序で)」セクションの手順 2 つの独立した Windows クラスター環境では、少なくとも 2 つのクラスター グループを構成することが必要です。 NLB クラスター グループ間で負荷分散を実装します。 Windows NLB では、Windows クラスター上で実行することはできません、ために、このシナリオにはハードウェア NLB ソリューションが必要です。 次の図に、このアーキテクチャを示します。  
  
 ![クラスター グループ間の負荷分散](../core/media/scaleclusteredmsmqwithnlb.gif "ScaleClusteredMSMQwithNLB")  
  
> [!NOTE]
>  このアーキテクチャでは、順次配送は提供されません。  
  
## <a name="scalability-transactional-in-order"></a>スケーラビリティ (トランザクション、順次)  
 スケール アウト高可用性、トランザクションの一貫性、および順次配送を提供するアーキテクチャは、またはそれ以前の MSMQ 3.0 を使用するときに問題が発生しない限り、リモート トランザクションの読み込みがサポートされていないため、両方の BizTalk Server コンピューターと、リモートの MSMQ サーバーは、MSMQ 4.0 を実行しています。 MSMQ 3.0 以前を使用する場合、複数のローカルの MSMQ キューを使用してスケール アウトを実現する必要があります。 さらに、このシナリオで、NLB を MSMQ セッションの TCP/IP 接続が切断された場合、可能性がありますによって復元メッセージが NLB の不同配信可能性がある別のコンピューターにします。  
  
 この制限を 1 つの考えられる回避策は、別のコンピューターへの送信先キューに割り当てることによって、分散メッセージ配信を手動で読み込むには。 特定の MSMQ キューにインスタンス固有の BizTalk ホストに結び付けることでこのようにできます。 たとえば、特定の 1 つの取引先パートナーから多数のドキュメントを受信する場合は、別のホストを作成し、その取引先パートナーだけに対して、特定の BizTalk サーバー上のキューを受信します。  
  
 可能であれば、リモート トランザクションの読み込みと負荷分散の両方が必要な場合は、リモート コンピューターで MSMQ 4.0 を実行します。  
  
## <a name="summary"></a>まとめ  
 次の表は、特定の機能に対応するために実装できるアーキテクチャをまとめたものです。  
  
|**機能**|**NLB とクラスターのどちらも**|**NLB**|**Cluster**|**NLB とクラスター**|  
|-----------------------|---------------------------------|-------------|-----------------|-------------------------|  
|エンド ツー エンドの順次配送|はい|いいえ|はい|構成を手動で実現可能な|  
|トランザクションの一貫性|いいえ (メッセージは紛失やサービスのエラーが発生した場合に重複しています)|いいえ|はい|はい|  
|高可用性|いいえ|はい|[はい]|はい|  
|スケーラブルです|いいえ|はい|いいえ|はい|  
  
## <a name="see-also"></a>参照  
 [Windows Server クラスターを使用して BizTalk Server Hosts2 の高可用性を実現するには](../core/use-windows-cluster-to-provide-high-availability-for-biztalk-hosts.md)