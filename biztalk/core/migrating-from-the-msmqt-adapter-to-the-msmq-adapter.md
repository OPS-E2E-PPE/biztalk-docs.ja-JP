---
title: "MSMQT アダプターから MSMQ アダプターへの移行 |Microsoft ドキュメント"
ms.custom: 
ms.date: 2015-12-07
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- performance, MSMQT adapters
- scaling, MSMQT adapters
- reliability, MSMQT adapters
- MSMQT adapters, transactional consistency
- migrating, MSMQT adapters
- MSMQT adapters, ordered delivery
- MSMQT adapters, migrating to MSMQ adapters
- MSMQT adapters, scaling
- MSMQT adapters, reliability
- MSMQ adapters, migrating MSMQT adapters
- high availability, MSMQT adapters
- MSMQT adapters, performance
- MSMQT adapters, availability
ms.assetid: 97126f70-0be5-4a2f-bcba-173fd932b6de
caps.latest.revision: "30"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 2b1fce448788a8c6c5721403dbb7e4e58609a31a
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/20/2017
---
# <a name="migrating-from-the-msmqt-adapter-to-the-msmq-adapter"></a><span data-ttu-id="2db31-102">MSMQT アダプターから MSMQ アダプターへの移行</span><span class="sxs-lookup"><span data-stu-id="2db31-102">Migrating from the MSMQT Adapter to the MSMQ Adapter</span></span>
<span data-ttu-id="2db31-103">このトピックでは、ソリューションを BizTalk メッセージ キュー (MSMQT) アダプターからメッセージ キュー (MSMQ) アダプターに移行する前に、エンド ツー エンドの順次配送、トランザクションの一貫性、高可用性、およびスケーラビリティに関して考慮すべき事項について説明します。</span><span class="sxs-lookup"><span data-stu-id="2db31-103">This topic discusses points to consider regarding end-to-end ordered delivery, transactional consistency, high availability, and scalability before migrating solutions from the BizTalk Message Queuing (MSMQT) adapter to the Message Queuing (MSMQ) adapter.</span></span> <span data-ttu-id="2db31-104">このトピックでは、順次配送、トランザクションの一貫性、高可用性、およびスケーラビリティを次のように定義しています。</span><span class="sxs-lookup"><span data-stu-id="2db31-104">For purposes of this topic ordered delivery, transactional consistency, high availability, and scalability are defined as follows:</span></span>  
  
-   <span data-ttu-id="2db31-105">**順次配送します。**</span><span class="sxs-lookup"><span data-stu-id="2db31-105">**Ordered delivery.**</span></span> <span data-ttu-id="2db31-106">受信時と同じ順序で BizTalk Server からメッセージが送信されるようにすること。</span><span class="sxs-lookup"><span data-stu-id="2db31-106">Guarantee that messages are sent out of BizTalk Server in the same order that they are received.</span></span>  
  
-   <span data-ttu-id="2db31-107">**トランザクションの一貫性。**</span><span class="sxs-lookup"><span data-stu-id="2db31-107">**Transactional consistency.**</span></span> <span data-ttu-id="2db31-108">処理中のメッセージが、ハードウェア、ソフトウェア、またはネットワークの障害によって、損失したり重複しないようにすること。</span><span class="sxs-lookup"><span data-stu-id="2db31-108">Guarantee that messages being processed are not lost or duplicated due to hardware, software, or network failure.</span></span>  
  
-   <span data-ttu-id="2db31-109">**高可用性です。**</span><span class="sxs-lookup"><span data-stu-id="2db31-109">**High availability.**</span></span> <span data-ttu-id="2db31-110">メッセージの処理に必要なサービスが常時利用できるようにすること。</span><span class="sxs-lookup"><span data-stu-id="2db31-110">Guarantee that services used to process messages are always available for processing.</span></span>  
  
-   <span data-ttu-id="2db31-111">**スケーラビリティです。**</span><span class="sxs-lookup"><span data-stu-id="2db31-111">**Scalability.**</span></span> <span data-ttu-id="2db31-112">既存のメッセージ処理能力を拡大できること。</span><span class="sxs-lookup"><span data-stu-id="2db31-112">Ability to increase existing message-processing capacity.</span></span>  
  
## <a name="end-to-end-ordered-delivery"></a><span data-ttu-id="2db31-113">エンド ツー エンドの順次配送</span><span class="sxs-lookup"><span data-stu-id="2db31-113">End-to-End Ordered Delivery</span></span>  
 <span data-ttu-id="2db31-114">MSMQT アダプターでは、メッセージのエンド ツー エンドの順次配送が保証されます。</span><span class="sxs-lookup"><span data-stu-id="2db31-114">The MSMQT adapter ensures end-to-end ordered delivery of messages.</span></span> <span data-ttu-id="2db31-115">つまり、MSMQ アプリケーションは、MSMQT アダプターにバインドされた受信場所に 1、2、および 3 のメッセージを送信する場合、これらのメッセージをオーケストレーションに配信されるまたは送信ポートを同じ順序で BizTalk Server に: 1、2、3 つです。</span><span class="sxs-lookup"><span data-stu-id="2db31-115">This means that if an MSMQ application sends messages 1, 2, and 3 to a receive location bound to the MSMQT adapter, then these messages are delivered to an orchestration or send port in BizTalk Server in the same order: 1, 2, 3.</span></span> <span data-ttu-id="2db31-116">この機能は、受信されたとき同じ順序で送信および実行する必要がある、株式市場の取り引きなどに使用できます。</span><span class="sxs-lookup"><span data-stu-id="2db31-116">One use of this functionality might include stock market trades that must be submitted and executed in the same order that they are received.</span></span>  
  
 <span data-ttu-id="2db31-117">MSMQT アダプターによるエンド ツー エンドの順次配送では、多数のコンポーネントが連動する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2db31-117">End-to-end in-order delivery with MSMQT requires many components to be working together.</span></span> <span data-ttu-id="2db31-118">MSMQT アダプターでは、順次配送を実現するために次のような一連のイベントが発生します。</span><span class="sxs-lookup"><span data-stu-id="2db31-118">The following sequence of events illustrates how this is done with the MSMQT adapter:</span></span>  
  
1.  <span data-ttu-id="2db31-119">リモート コンピューターの MSMQ API では、メッセージをメッセージ 1、メッセージ 2、メッセージ 3 の順で受信し、これらのメッセージをローカルのトランザクション キューに同じ順序 (1、2、3 の順) でプッシュします。</span><span class="sxs-lookup"><span data-stu-id="2db31-119">The MSMQ API on a remote computer receives messages 1, 2, and 3 in order and pushes them into a transactional, local queue in the same order: 1, 2, 3.</span></span>  
  
2.  <span data-ttu-id="2db31-120">リモート コンピューターの MSMQ クライアントでは、キューからメッセージを取得し、MSMQT キューに 1、2、3 の順で送信します。</span><span class="sxs-lookup"><span data-stu-id="2db31-120">An MSMQ client on the remote computer takes the messages from the queue and sends them to the MSMQT queue in order: 1, 2, 3.</span></span>  
  
3.  <span data-ttu-id="2db31-121">MSMQT アダプターでは、1、2、3 の順でメッセージを受信し、BizTalk メッセージ エージェント コンポーネントに同じ順序で渡します。</span><span class="sxs-lookup"><span data-stu-id="2db31-121">The MSMQT adapter receives the messages in order 1, 2, 3 and hands them to the BizTalk MessageAgent component in the same order: 1, 2, 3.</span></span>  
  
4.  <span data-ttu-id="2db31-122">BizTalk メッセージ エージェント コンポーネントでは、メッセージを 1、2、3 の順でメッセージ ボックス データベースに送信します。</span><span class="sxs-lookup"><span data-stu-id="2db31-122">The BizTalk MessageAgent component ensures that the messages are sent to the MessageBox in order: 1, 2, 3.</span></span>  
  
5.  <span data-ttu-id="2db31-123">メッセージ ボックス データベースでは、メッセージをルーティングして、メッセージがオーケストレーションまたは送信ポートの同じインスタンスにルーティングされた場合に、メッセージが同じ順序 (1、2、3 の順) でインスタンスに配信されるようにします。</span><span class="sxs-lookup"><span data-stu-id="2db31-123">The MessageBox routes the messages and ensures that if they are routed to the same instance of an orchestration or a send port, that they are delivered to this instance in the same order: 1, 2, 3.</span></span>  
  
 <span data-ttu-id="2db31-124">[!INCLUDE[btsBizTalkServer2004](../includes/btsbiztalkserver2004-md.md)] では、MSMQT アダプターでのみエンド ツー エンドの順次配送が保証されます。</span><span class="sxs-lookup"><span data-stu-id="2db31-124">In [!INCLUDE[btsBizTalkServer2004](../includes/btsbiztalkserver2004-md.md)], MSMQT is the only adapter capable of guaranteeing end-to end ordered delivery.</span></span> <span data-ttu-id="2db31-125">他の統合 BizTalk アダプターでは、上記の手順 3. ～ 5. でメッセージの順序が入れ替わる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="2db31-125">All of the other integrated BizTalk adapters can potentially change the order of the messages in steps 3 through 5 listed above.</span></span> <span data-ttu-id="2db31-126">他の多くの統合アダプターでは、手順 3. でエンド ポイント マネージャーという名前のコンポーネントが使用されますが、このコンポーネントは、マルチスレッド化されているので、メッセージの順序が維持されません。</span><span class="sxs-lookup"><span data-stu-id="2db31-126">Most of the other integrated adapters complete step 3 by the use of a component known as the End Point Manager, which is inherently multithreaded and therefore does not preserve order.</span></span> <span data-ttu-id="2db31-127">[!INCLUDE[btsBizTalkServer2004](../includes/btsbiztalkserver2004-md.md)] の MSMQ アダプターでは、"シリアル処理" 機能を使用して手順 3. のメッセージの順序を維持することはできますが、メッセージ エージェント コンポーネントに送信するメッセージの順序を維持するように指示しないため、メッセージがオーケストレーションまたは送信ポートに同じ順序でルーティングされない場合があります。</span><span class="sxs-lookup"><span data-stu-id="2db31-127">The MSMQ adapter for [!INCLUDE[btsBizTalkServer2004](../includes/btsbiztalkserver2004-md.md)] can use a "Serial Processing" feature that preserves order for step 3, but it does not then ask the MessageAgent to preserve order going forward, so the messages may be routed to an orchestration or send port out of order.</span></span>  
  
 <span data-ttu-id="2db31-128">**エンド ツー エンドの MSMQ アダプターで順次配送**</span><span class="sxs-lookup"><span data-stu-id="2db31-128">**End-to-end ordered delivery with the MSMQ adapter**</span></span>  
  
 <span data-ttu-id="2db31-129">エンド ツー エンドの MSMQ アダプターで順次配送を実現するためには、次の手順を実行します。</span><span class="sxs-lookup"><span data-stu-id="2db31-129">To achieve end-to-end ordered delivery with the MSMQ adapter, follow these steps:</span></span>  
  
1.  <span data-ttu-id="2db31-130">有効にする、**順次配送**受信側のプロパティは、サブスクライブするオーケストレーションのポートまたは送信ポート。</span><span class="sxs-lookup"><span data-stu-id="2db31-130">Enable the **Ordered Delivery** property on the receive port for the subscribing orchestration or send port.</span></span> <span data-ttu-id="2db31-131">[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]オーケストレーションの受信ポートと送信ポートが設定されて、**順次配送**構成オプション。</span><span class="sxs-lookup"><span data-stu-id="2db31-131">In [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] receive ports in orchestrations and send ports have an **Ordered Delivery** configuration option.</span></span> <span data-ttu-id="2db31-132">このオプションを有効にすると、オーケストレーションの受信ポートまたは送信ポートでは、メッセージ ボックス データベースに対して、データベースで受信したときと同じ順序でメッセージを配信するように指定することができます。</span><span class="sxs-lookup"><span data-stu-id="2db31-132">If this option is enabled, then the orchestration receive port or the send port asks the MessageBox to deliver messages to it in the same order they were submitted into the MessageBox.</span></span>  
  
2.  <span data-ttu-id="2db31-133">設定、**順次処理**MSMQ アダプターにバインドされている受信場所のプロパティ`True`です。</span><span class="sxs-lookup"><span data-stu-id="2db31-133">Set the **Ordered Processing** property for the receive location that is bound to the MSMQ adapter to `True`.</span></span> <span data-ttu-id="2db31-134">[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] では、MSMQ トランスポートを使用する受信場所で順次処理が使用されるように構成することができます。このオプションを有効にすると、メッセージ ボックス データベースには、受信時と同じ順序でメッセージが配信されます。</span><span class="sxs-lookup"><span data-stu-id="2db31-134">In [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)], receive locations that use the MSMQ transport can be configured to use Ordered Processing which, if enabled, ensures that messages are sent to the MessageBox in the same order that they were received.</span></span>  
  
3.  <span data-ttu-id="2db31-135">設定、**トランザクション**MSMQ アダプターにバインドされている受信場所のプロパティ`True`です。</span><span class="sxs-lookup"><span data-stu-id="2db31-135">Set the **Transactional** property for the receive location that is bound to the MSMQ adapter to `True`.</span></span>  
  
4.  <span data-ttu-id="2db31-136">MSMQ 受信場所で監視されている MSMQ キューが "トランザクション" とマークされていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="2db31-136">Ensure that any MSMQ queues that are being monitored by the MSMQ receive locations are marked as "Transactional".</span></span> <span data-ttu-id="2db31-137">メッセージの順次配送を実現するには、このプロパティが MSMQ キューに設定されている必要があります。</span><span class="sxs-lookup"><span data-stu-id="2db31-137">This property must be set on the queues to ensure ordered delivery of messages.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="2db31-138">順次配送は、BizTalk 受信場所で監視されている MSMQ キューが 1 台のコンピューターで処理されている場合にのみ保証されます。</span><span class="sxs-lookup"><span data-stu-id="2db31-138">Ordered delivery is guaranteed only if the MSMQ queue or queues that are being monitored by BizTalk receive locations is/are serviced by only one computer.</span></span> <span data-ttu-id="2db31-139">このことは、このトピックの後半で説明するように、スケーラビリティの問題となることがあります。</span><span class="sxs-lookup"><span data-stu-id="2db31-139">This can present problems for scalability, as described below.</span></span>  
  
## <a name="transaction-usage-when-processing-messages-with-the-msmqt-adapter-vs-the-msmq-adapter"></a><span data-ttu-id="2db31-140">MSMQT アダプターと MSMQ アダプターの、メッセージ処理におけるトランザクション使用の比較</span><span class="sxs-lookup"><span data-stu-id="2db31-140">Transaction Usage When Processing Messages with the MSMQT Adapter vs. the MSMQ Adapter</span></span>  
 <span data-ttu-id="2db31-141">MSMQT アダプターと MSMQ アダプターによるメッセージの処理方法は、トランザクションの使用に関して大きく異なります。</span><span class="sxs-lookup"><span data-stu-id="2db31-141">With regard to transaction usage, there is a key difference between how the MSMQT and MSMQ adapters process messages.</span></span>  
  
 <span data-ttu-id="2db31-142">MSMQT アダプターを使用すると、ネットワークから受信したメッセージの処理と、受信したメッセージの BizTalk Server による処理は単一のトランザクションで行われます。</span><span class="sxs-lookup"><span data-stu-id="2db31-142">When using the MSMQT adapter, the process of receiving a message from the network and processing it with BizTalk Server is handled under a single transaction.</span></span> <span data-ttu-id="2db31-143">また、BizTalk Server により、送信者に対して ACK メッセージが生成され、メッセージが受信され正常に処理されたことが通知されます。</span><span class="sxs-lookup"><span data-stu-id="2db31-143">When using the MSMQT adapter, ACK messages generated for the sender are an indication that the message has been received and has been successfully processed by BizTalk Server.</span></span>  
  
 <span data-ttu-id="2db31-144">MSMQ アダプターを使用すると、ネットワークから受信したメッセージの処理と、受信したメッセージの BizTalk Server による処理は個別の 2 つのトランザクションで行われます。1 つのトランザクションではネットワークから受信したメッセージを処理し、もう 1 つのトランザクションでは、BizTalk Server によるメッセージの処理が行われます。</span><span class="sxs-lookup"><span data-stu-id="2db31-144">When using the MSMQ adapter, the processes of receiving a message from the network and processing it with BizTalk Server are handled under two separate transactions, one for receiving from the network and one for processing it with BizTalk Server.</span></span> <span data-ttu-id="2db31-145">また、送信者に対して ACK メッセージが生成されますが、これはネットワークからメッセージを正常に受け取ったことを示すもので、メッセージが BizTalk Server によって正常に処理されたことを示すものではありません。</span><span class="sxs-lookup"><span data-stu-id="2db31-145">When using the MSMQ adapter, ACK messages generated for the sender are only an indication that the message has been successfully received from the network, not that the message has been successfully processed by BizTalk Server.</span></span> <span data-ttu-id="2db31-146">Microsoft メッセージ キュー サーバーでは、BizTalk Server がインストールされているかどうかに関係なく、ネットワークからメッセージを受信し、ローカルの MSMQ キューにメッセージを保存すると、送信者に ACK メッセージを送信します。</span><span class="sxs-lookup"><span data-stu-id="2db31-146">The sender receives an ACK from the Microsoft Message Queuing server when the message is received from the network and persisted into the local MSMQ queue regardless of whether BizTalk Server is installed.</span></span> <span data-ttu-id="2db31-147">メッセージが MSMQ キューに保存されると、BizTalk MSMQ アダプターではメッセージを取得して処理し、メッセージ ボックス データベースに公開します。</span><span class="sxs-lookup"><span data-stu-id="2db31-147">After the message has been persisted to the MSMQ queue, the BizTalk MSMQ adapter picks it up, processes it, and publishes it to the MessageBox.</span></span> <span data-ttu-id="2db31-148">この処理でエラーが発生すると、メッセージは BizTalk Server の保留キューに送信されるか、(トランザクション処理を使用している場合は) ローカルの MSMQ キューに残ったままになり、送信者には BizTalk Server でのメッセージ処理に失敗したことは通知されません。</span><span class="sxs-lookup"><span data-stu-id="2db31-148">If this process fails, the message is either sent to the BizTalk suspended queue or left in the local MSMQ queue (when using transactional processing), and the sender has no indication that the message failed processing in BizTalk Server.</span></span>  
  
 <span data-ttu-id="2db31-149">BizTalk Server でメッセージが正常に処理されたときに ACK を受信する必要がある場合、MSMQT アダプターから MSMQ アダプターに移行する際にはアプリケーション レベルの ACK を追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2db31-149">If your architecture requires that you receive ACKs when your messages are successfully processed by BizTalk Server, then you must add application-level ACKs if you are migrating from the MSMQT adapter to the MSMQ adapter.</span></span> <span data-ttu-id="2db31-150">また、オーケストレーションとメッセージを送信するアプリケーションを更新して、アプリケーション レベルの ACK を実装する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2db31-150">You will need to update your orchestration and sending application to implement application-level ACKs.</span></span>  
  
## <a name="high-availability-transactional-in-order"></a><span data-ttu-id="2db31-151">高可用性 (トランザクション、順次)</span><span class="sxs-lookup"><span data-stu-id="2db31-151">High Availability (Transactional, in Order)</span></span>  
 <span data-ttu-id="2db31-152">MSMQT アダプターの高可用性を実現するには、受信ホストに複数のコンピューターを追加し、フォールト トレランスのネットワーク負荷分散 (NLB) を構成または既定の BizTalk ホストをクラスター化することができます。</span><span class="sxs-lookup"><span data-stu-id="2db31-152">To provide high availability for the MSMQT adapter you can either add multiple computers to the receive host and configure Network Load Balancing (NLB) for fault tolerance or you can cluster the default BizTalk Host.</span></span> <span data-ttu-id="2db31-153">NLB を構成した環境で MSMQT アダプターを実行している場合、1 台のサーバーがダウンしても、そのサーバーの負荷は残りのサーバーで処理されます。</span><span class="sxs-lookup"><span data-stu-id="2db31-153">If you are running the MSMQT adapter in conjunction with NLB, if one server goes down the other servers handle the load.</span></span> <span data-ttu-id="2db31-154">クラスター化したホストで MSMQT アダプター ハンドラーを実行している場合、いずれかのホスト ノードで障害が発生しても、クラスター化されたホストは、クラスター ソフトウェアにより他のノードにフェールオーバーされます。</span><span class="sxs-lookup"><span data-stu-id="2db31-154">If you are running the MSMQT adapter handlers on a clustered host, if one host node fails, cluster software fails over the clustered host to the other node.</span></span> <span data-ttu-id="2db31-155">MSMQ アダプターを使用している場合、MSMQ アダプターでは中間ストレージとしてローカルの MSMQ キューが使用されるため、データ損失が発生しないトランザクション処理が必要な場合、NLB は機能しません。</span><span class="sxs-lookup"><span data-stu-id="2db31-155">When using the MSMQ adapter, NLB does not work if you need transactional processing with no data loss because the MSMQ adapter uses local MSMQ queues for intermediate storage.</span></span> <span data-ttu-id="2db31-156">このシナリオでは、コンピューターで障害が発生すると、ローカルの MSMQ キューに配信されていて、MSMQ アダプターで処理されていないメッセージは失われます。</span><span class="sxs-lookup"><span data-stu-id="2db31-156">In this scenario, if a message has been delivered to the local MSMQ queue but has not been consumed by the MSMQ adapter, the message is lost if the computer fails.</span></span>  
  
 <span data-ttu-id="2db31-157">MSMQ アダプターで高可用性とトランザクションの一貫性を提供するには、次の操作を行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="2db31-157">To provide high availability and transactional consistency with the MSMQ adapter, you should do the following:</span></span>  
  
1.  <span data-ttu-id="2db31-158">BizTalk Server の Windows Server クラスター グループのクラスター化されたリソースとして、Microsoft メッセージ キュー (MSMQ) を構成します。</span><span class="sxs-lookup"><span data-stu-id="2db31-158">Configure Microsoft Message Queuing (MSMQ) as a clustered resource in a Windows Server cluster group on your BizTalk servers.</span></span>  
  
2.  <span data-ttu-id="2db31-159">クラスター化された MSMQ リソースと同じクラスター グループ内のクラスター リソースとして構成されている BizTalk ホスト インスタンスで、MSMQ アダプターの受信ハンドラーを構成します。</span><span class="sxs-lookup"><span data-stu-id="2db31-159">Configure the MSMQ adapter receive handler in a BizTalk Host instance that has been configured as a cluster resource in the same cluster group as the clustered MSMQ resource.</span></span>  
  
3.  <span data-ttu-id="2db31-160">クラスター化された MSMQ リソースで依存関係が維持されるように、BizTalk ホスト インスタンスのクラスター リソースを構成します。</span><span class="sxs-lookup"><span data-stu-id="2db31-160">Configure the cluster resource for the BizTalk Host instance so that it maintains a dependency on the clustered MSMQ resource.</span></span>  
  
 <span data-ttu-id="2db31-161">このアーキテクチャで順次配送を実装するには、「--エンドツー エンド MSMQ アダプターで順次配送します」前に示した手順に従います</span><span class="sxs-lookup"><span data-stu-id="2db31-161">To implement ordered delivery with this architecture, follow the steps presented earlier under "End-to-end ordered delivery with the MSMQ adapter."</span></span>  
  
## <a name="high-availability-nontransactional-not-in-order"></a><span data-ttu-id="2db31-162">高可用性 (非トランザクション、非順次)</span><span class="sxs-lookup"><span data-stu-id="2db31-162">High Availability (Nontransactional, Not in Order)</span></span>  
 <span data-ttu-id="2db31-163">高可用性が必要でも、トランザクション処理を必要としない場合があります。このような場合には、MSMQ アダプターを使用し、NLB を実装して、NLB に含まれる複数の BizTalk Server コンピューターで MSMQ 送信ハンドラーと受信ハンドラーを構成したホスト インスタンスを実行することによって高可用性を実現できます。</span><span class="sxs-lookup"><span data-stu-id="2db31-163">If you need high availability but do not need transactional processing, you can achieve this with the MSMQ adapter by implementing NLB and running instances of a host configured with the MSMQ send and receive handlers on multiple BizTalk servers behind NLB.</span></span> <span data-ttu-id="2db31-164">MSMQ で NLB を実装するときにする必要がありますベスト プラクティスに従って Microsoft サポート技術情報の資料 899611 に記載されている"ネットワーク経由でメッセージ キューが機能する方法の負荷分散 (NLB)"で使用可能な[http://go.microsoft.com/fwlink/?LinkId = 57510](http://go.microsoft.com/fwlink/?LinkId=57510)です。</span><span class="sxs-lookup"><span data-stu-id="2db31-164">When implementing NLB with MSMQ you should follow best practices as documented in Microsoft Knowledge Base article 899611, "How Message Queuing can function over Network Load Balancing (NLB)" available at [http://go.microsoft.com/fwlink/?LinkId=57510](http://go.microsoft.com/fwlink/?LinkId=57510).</span></span> <span data-ttu-id="2db31-165">このシナリオでは、いずれかの BizTalk Server コンピューターで障害が発生すると、その BizTalk Server のホスト インスタンスで実行されているメッセージは、BizTalk Server コンピューターが復旧するまで利用できません。</span><span class="sxs-lookup"><span data-stu-id="2db31-165">In this scenario, if one of the BizTalk servers fails, the messages that are running in the host instance on that BizTalk server will be unavailable until the BizTalk server is recovered.</span></span> <span data-ttu-id="2db31-166">この構成では、利用できない BizTalk Server コンピューターがあると、NLB により要求が他の BizTalk Server コンピューターにルーティングされるので、高可用性を実現できます。</span><span class="sxs-lookup"><span data-stu-id="2db31-166">This configuration provides high availability because if one of the BizTalk servers is not available, NLB routes requests to the other BizTalk server.</span></span>  
  
## <a name="scalability-nontransactional-not-in-order"></a><span data-ttu-id="2db31-167">スケーラビリティ (非トランザクション、非順次)</span><span class="sxs-lookup"><span data-stu-id="2db31-167">Scalability (Nontransactional, Not in Order)</span></span>  
 <span data-ttu-id="2db31-168">スケーラビリティは、高可用性 (非トランザクション) のガイドラインに従い、ホスト インスタンスを追加することで実現できます。</span><span class="sxs-lookup"><span data-stu-id="2db31-168">You can achieve scalability by following the guidelines for high availability (nontransactional) and adding additional host instances.</span></span> <span data-ttu-id="2db31-169">このアーキテクチャでは、高速な配信とスケーラビリティを実現できますが、順次配送は実現できません。</span><span class="sxs-lookup"><span data-stu-id="2db31-169">This architecture provides fast delivery as well as scalability, but does not provide ordered delivery.</span></span>  
  
## <a name="scalability-transactional-not-in-order"></a><span data-ttu-id="2db31-170">スケーラビリティ (トランザクション、非順次)</span><span class="sxs-lookup"><span data-stu-id="2db31-170">Scalability (Transactional, Not in Order)</span></span>  
 <span data-ttu-id="2db31-171">配信順序を問わないメッセージのトランザクション配信を実現するには、NLB を MSMQ および Windows クラスタリングと組み合わせて使用できます。</span><span class="sxs-lookup"><span data-stu-id="2db31-171">For transactional delivery of messages without ordered delivery, you can combine the use of NLB with MSMQ and Windows clustering.</span></span> <span data-ttu-id="2db31-172">このアーキテクチャでは、Windows クラスターごとに「高可用性 (トランザクション、順次)」の手順に従って、2 つの個別の Windows クラスター環境に、少なくとも 2 つのクラスター グループを構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2db31-172">This architecture requires that you configure at least two cluster groups on two separate Windows Cluster environments following the steps under "High Availability (Transactional, in Order)" for each Windows Cluster.</span></span> <span data-ttu-id="2db31-173">その後、NLB を実装すると、クラスター グループ間で負荷を分散できるようになります。</span><span class="sxs-lookup"><span data-stu-id="2db31-173">You then implement NLB to distribute load between the cluster groups.</span></span> <span data-ttu-id="2db31-174">Windows NLB は Windows クラスターでの実行がサポートされていないため、このシナリオではハードウェア NLB ソリューションが必要です。</span><span class="sxs-lookup"><span data-stu-id="2db31-174">Because Windows NLB is not supported running on a Windows Cluster, this scenario requires a hardware NLB solution.</span></span> <span data-ttu-id="2db31-175">次の図に、このアーキテクチャを示します。</span><span class="sxs-lookup"><span data-stu-id="2db31-175">The following diagram illustrates this architecture.</span></span>  
  
 <span data-ttu-id="2db31-176">![クラスター グループ間の負荷分散](../core/media/scaleclusteredmsmqwithnlb.gif "ScaleClusteredMSMQwithNLB")</span><span class="sxs-lookup"><span data-stu-id="2db31-176">![Load balancing between cluster groups](../core/media/scaleclusteredmsmqwithnlb.gif "ScaleClusteredMSMQwithNLB")</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="2db31-177">このアーキテクチャでは順次配送は実現されません。</span><span class="sxs-lookup"><span data-stu-id="2db31-177">This architecture does not provide ordered delivery.</span></span>  
  
## <a name="scalability-transactional-in-order"></a><span data-ttu-id="2db31-178">スケーラビリティ (トランザクション、順次)</span><span class="sxs-lookup"><span data-stu-id="2db31-178">Scalability (Transactional, in Order)</span></span>  
 <span data-ttu-id="2db31-179">MSMQ 3.0 以前を使用している場合、高可用性、トランザクションの一貫性、および順次配送を提供するアーキテクチャのスケール アウトには問題があります。これは、BizTalk Server コンピューターとリモート MSMQ サーバーの両方で MSMQ 4.0 を実行していない限り、リモートのトランザクションの読み込みがサポートされていないためです。</span><span class="sxs-lookup"><span data-stu-id="2db31-179">Scaling out an architecture that provides high availability, transactional consistency, and ordered delivery is problematic when using MSMQ 3.0 or earlier because remote transactional reads are not supported unless both the BizTalk Server computer and the remote MSMQ server are running MSMQ 4.0.</span></span> <span data-ttu-id="2db31-180">MSMQ 3.0 以前を使用する場合、スケール アウトは複数のローカル MSMQ キューを使用して行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="2db31-180">When using MSMQ 3.0 or earlier, scale out must be achieved using multiple local MSMQ queues.</span></span> <span data-ttu-id="2db31-181">さらに、このシナリオでは、NLB への MSMQ セッションの TCP/IP 接続が切断されると、NLB によって別のコンピューターに復元されることがあり、このことが原因でメッセージが正しい順序で配信されなくなることがあります。</span><span class="sxs-lookup"><span data-stu-id="2db31-181">Furthermore, in this scenario, if the TCP/IP connection for the MSMQ session to the NLB is broken, it may subsequently be restored by NLB to a different computer, which can cause out-of-order delivery.</span></span>  
  
 <span data-ttu-id="2db31-182">この制限を回避する手段の 1 つとしては、送信先キューを別のコンピューターに割り当てることによって、メッセージ配信の負荷分散を手動で行う方法があります。</span><span class="sxs-lookup"><span data-stu-id="2db31-182">One possible workaround to this limitation is to manually load balance message delivery by allocating destination queues to different computers.</span></span> <span data-ttu-id="2db31-183">これは、特定の BizTalk ホスト インスタンスを特定の MSMQ キューに関連付けることによって行えます。</span><span class="sxs-lookup"><span data-stu-id="2db31-183">You can so this by tying specific BizTalk Host instances to specific MSMQ queues.</span></span> <span data-ttu-id="2db31-184">たとえば、ある特定の取り引き先から大量のドキュメントを受信する場合、特定の BizTalk Server コンピューターに、この取引先専用の個別のホストと受信キューを作成します。</span><span class="sxs-lookup"><span data-stu-id="2db31-184">So for example, if you receive a large number of documents from one particular trading partner, create a separate host and receive queue on a particular BizTalk server for just that trading partner.</span></span>  
  
 <span data-ttu-id="2db31-185">可能ならば、リモート トランザクションの読み込みと負荷分散が必要な場合は、リモート コンピューターで MSMQ 4.0 を実行します。</span><span class="sxs-lookup"><span data-stu-id="2db31-185">If possible, run MSMQ 4.0 on remote computers when both remote transactional reads and load balancing are required.</span></span>  
  
## <a name="summary"></a><span data-ttu-id="2db31-186">概要</span><span class="sxs-lookup"><span data-stu-id="2db31-186">Summary</span></span>  
 <span data-ttu-id="2db31-187">次の表に、特定の機能を実現するために実装するアーキテクチャの概要を示します。</span><span class="sxs-lookup"><span data-stu-id="2db31-187">The following table summarizes the architectures that you can implement to accommodate specific functionality.</span></span>  
  
|<span data-ttu-id="2db31-188">**機能**</span><span class="sxs-lookup"><span data-stu-id="2db31-188">**Functionality**</span></span>|<span data-ttu-id="2db31-189">**NLB でもクラスター**</span><span class="sxs-lookup"><span data-stu-id="2db31-189">**Neither NLB nor cluster**</span></span>|<span data-ttu-id="2db31-190">**NLB**</span><span class="sxs-lookup"><span data-stu-id="2db31-190">**NLB**</span></span>|<span data-ttu-id="2db31-191">**Cluster**</span><span class="sxs-lookup"><span data-stu-id="2db31-191">**Cluster**</span></span>|<span data-ttu-id="2db31-192">**NLB とクラスター**</span><span class="sxs-lookup"><span data-stu-id="2db31-192">**NLB and cluster**</span></span>|  
|-----------------------|---------------------------------|-------------|-----------------|-------------------------|  
|<span data-ttu-id="2db31-193">エンド ツー エンドの順次配送</span><span class="sxs-lookup"><span data-stu-id="2db31-193">End-to-end ordered delivery</span></span>|<span data-ttu-id="2db31-194">はい</span><span class="sxs-lookup"><span data-stu-id="2db31-194">Yes</span></span>|<span data-ttu-id="2db31-195">いいえ</span><span class="sxs-lookup"><span data-stu-id="2db31-195">No</span></span>|<span data-ttu-id="2db31-196">はい</span><span class="sxs-lookup"><span data-stu-id="2db31-196">Yes</span></span>|<span data-ttu-id="2db31-197">可 (手動による構成が必要です)</span><span class="sxs-lookup"><span data-stu-id="2db31-197">Possible with manual configuration</span></span>|  
|<span data-ttu-id="2db31-198">トランザクションの一貫性</span><span class="sxs-lookup"><span data-stu-id="2db31-198">Transactional consistency</span></span>|<span data-ttu-id="2db31-199">不可 (サービスでエラーが発生すると、メッセージが損失または重複することがあります)</span><span class="sxs-lookup"><span data-stu-id="2db31-199">No (messages can be lost or duplicated if service failure occurs)</span></span>|<span data-ttu-id="2db31-200">不可</span><span class="sxs-lookup"><span data-stu-id="2db31-200">No</span></span>|<span data-ttu-id="2db31-201">はい</span><span class="sxs-lookup"><span data-stu-id="2db31-201">Yes</span></span>|<span data-ttu-id="2db31-202">はい</span><span class="sxs-lookup"><span data-stu-id="2db31-202">Yes</span></span>|  
|<span data-ttu-id="2db31-203">高可用性</span><span class="sxs-lookup"><span data-stu-id="2db31-203">Highly available</span></span>|<span data-ttu-id="2db31-204">不可</span><span class="sxs-lookup"><span data-stu-id="2db31-204">No</span></span>|<span data-ttu-id="2db31-205">はい</span><span class="sxs-lookup"><span data-stu-id="2db31-205">Yes</span></span>|<span data-ttu-id="2db31-206">可</span><span class="sxs-lookup"><span data-stu-id="2db31-206">Yes</span></span>|<span data-ttu-id="2db31-207">はい</span><span class="sxs-lookup"><span data-stu-id="2db31-207">Yes</span></span>|  
|<span data-ttu-id="2db31-208">スケーラブルです</span><span class="sxs-lookup"><span data-stu-id="2db31-208">Scalable</span></span>|<span data-ttu-id="2db31-209">不可</span><span class="sxs-lookup"><span data-stu-id="2db31-209">No</span></span>|<span data-ttu-id="2db31-210">可</span><span class="sxs-lookup"><span data-stu-id="2db31-210">Yes</span></span>|<span data-ttu-id="2db31-211">いいえ</span><span class="sxs-lookup"><span data-stu-id="2db31-211">No</span></span>|<span data-ttu-id="2db31-212">はい</span><span class="sxs-lookup"><span data-stu-id="2db31-212">Yes</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="2db31-213">参照</span><span class="sxs-lookup"><span data-stu-id="2db31-213">See Also</span></span>  
 [<span data-ttu-id="2db31-214">Windows Server クラスターを使用して BizTalk Server Hosts2 の高可用性を実現するには</span><span class="sxs-lookup"><span data-stu-id="2db31-214">Using Windows Server Cluster to Provide High Availability for BizTalk Server Hosts2</span></span>](../core/use-windows-cluster-to-provide-high-availability-for-biztalk-hosts.md)