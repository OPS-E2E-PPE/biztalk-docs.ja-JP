---
title: アトミック トランザクション |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- atomic transactions
- scopes, examples
- transactions, orchestrations
- orchestrations, transactions
- transactions, isolation levels
- transactions, ACID concept
- transactions, examples
- transactions, atomic
- scopes, transactions
- scopes
ms.assetid: 5030e1fd-943f-42bc-9296-4f315bd5f733
caps.latest.revision: 12
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 79512ead7a9ec91fe1558643fa66747e6674eee6
ms.sourcegitcommit: d27732e569b0897361dfaebca8352aa97bb7efe1
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/10/2019
ms.locfileid: "65530690"
---
# <a name="atomic-transactions"></a>アトミック トランザクション
トランザクションの従来の 'ACID' の概念に従って個別の個々 の作業を実行する BizTalk オーケストレーションを設計できます。 これらの作業を実行すると、不連続であるかアトミック単位は、ビジネス プロセスを 1 つの一貫性のある状態から他の作業単位から分離された新しい、一貫性および持続性のある状態に移動します。 使用してこれは、通常、**スコープ**コンストラクトをトランザクション セマンティクスで作業単位をカプセル化します。 オーケストレーション全体のスコープを使用せず、アトミック トランザクションとしても定義できます。 スコープ、ただし、マークできません、オーケストレーション自体が長時間またはアトミックのトランザクションの種類としてマークされていない限り、トランザクション。 アトミック トランザクションを部分的な更新は自動的にロールバック エラーが発生した場合、トランザクションの更新中に、トランザクションの効果を消去することを保証 (で行われた .NET 呼び出しの効果を除いて、トランザクションの場合)。 BizTalk オーケストレーションのアトミック トランザクションは、一般的に時間が短くおよび 4 つの"ACID"属性 (原子性、一貫性、分離、および持続性) は、分散トランザクション コーディネーター (DTC) トランザクションに似ています。  
  
- **原子性**  
  
   トランザクションは、作業のアトミック単位を表します。 トランザクション内のすべての変更が実行されるか、変更を何も実行されません。  
  
- **一貫性**  
  
   、コミットされたときにトランザクションは、システム内のデータの整合性を維持する必要があります。 トランザクションは、トランザクションの開始前に内部に矛盾していたデータベースのデータ変更を実行する場合、データベースする必要があります内部的に一貫性のあるトランザクションがコミットされるとき。 このプロパティの確保は、ほぼアプリケーション開発者の責任です。  
  
- **分離性**  
  
   同時実行トランザクションによって加えられた変更は、その他の同時実行トランザクションによって加えられた変更から分離する必要があります。 同時に実行される分離レベルのトランザクションでは、トランザクションが順番に実行された場合とまったく同様に内部データベースの一貫性を保つように変更を実行します。  
  
- **持続性**  
  
   トランザクションがコミットされると、すべての変更が完全に既定では、システムでします。 変更は、システム障害が発生した場合でも永続化します。  
  
  BizTalk オーケストレーションで使用されるアトミック トランザクションでは、次の分離レベルがサポートされています。  
  
- **Read Committed**  
  
   ダーティ リードを回避するために、データの読み込みは、反復不能読み取りやファントム データがその結果、トランザクションが終了する前に、データを変更することができますが、共有ロックが保持されます。  
  
- **Repeatable Read**  
  
   ロックは、他のユーザーがデータを更新するを防止、クエリで使用されているすべてのデータに配置されます。 これにより、反復不能読み取りが、ファントム行は引き続き可能です。  
  
- **SERIALIZABLE**  
  
   範囲ロックを配置するには、ほかのユーザーは、トランザクションが完了するまで、データベースに行を挿入したり、更新されます。  
  
  BizTalk Server では、アトミック トランザクション内の状態の変更-変数、メッセージ、およびオブジェクトの変更など、トランザクションのコミット時にのみアトミック トランザクションのスコープ外に表示されます。 中間状態の変更は、オーケストレーションの他の部分から分離されます。  
  
> [!NOTE]
>  アトミックのトランザクションが含まれている場合、**受信**、図形、**送信**図形、または**オーケストレーションの開始**図形を対応するアクションは行われませんまで、トランザクションがコミットされます。  
  
 データの完全な ACID プロパティが必要な場合: たとえば、ときに、データがあります他のトランザクションから分離-アトミック トランザクションを排他的に使用する必要があります。  
  
 アトミックのトランザクションが失敗したときに、オーケストレーション インスタンスがスコープに入る場合、すべての状態がリセットされます。 ルール BizTalk にアトミック トランザクションはすべての変数 (しないだけローカル スコープに) がトランザクションに参加します。 シリアル化できるすべての変数およびメッセージがアトミックのトランザクションで使用する必要があります方は、スコープに対してローカルに宣言します。コンパイラは、それ以外の場合、"変数... シリアル化可能としてマークされていない"エラー。 すべてのアトミックのスコープは「同期」と見なされ、オーケストレーション コンパイラは、実際にアトミックのスコープには、同期済みのキーワードが使用する場合、冗長な使用量は、警告は提供します。 共有データの同期を (スコープの最後に状態の永続化を含む) のスコープが正常に完了するまでのスコープの先頭から拡張または (エラー) の場合、例外ハンドラーの完了にします。 同期ドメインは、補正ハンドラーには適用されません。  
  
 アトミック トランザクションは、オーケストレーションは、トランザクションとインスタンスを停止するポイントを中断する位置のタイムアウト値を関連付けることができます。 受信図形、送信図形、またはオーケストレーションの開始図形がアトミックのトランザクションが含まれる場合、対応するアクションは行われません、トランザクションがコミットされるまでです。  
  
 アトミック トランザクションの再試行、ユーザーが意図的に例外をスロー、 **RetryTransactionException**場合や、 **PersistenceException**がアトミックのトランザクションがコミットを試行する時に発生します。 たとえば、アトミック トランザクションの一部であった、DTC トランザクションを分散し、その他のいくつかの参加者トランザクションがトランザクションを停止している場合、この、後者でした発生します。 同様に、トランザクションがコミットしようとした時点でデータベース接続の問題があった場合にも、 **PersistenceException**発生します。 アトミックのスコープを持つのこのような場合**再試行 = True**、21 回まで再試行されます。 各再試行間の遅延が既定では 2 秒 (ただし、変更可能です)。 トランザクションがコミットすることができない場合、21 の再試行が終了は後、は、オーケストレーション インスタンス全体が中断されます。 手動で再開し、問題が発生したアトミックのスコープの先頭からの新しいカウンターでもう一度、経由で始まります。  
  
> [!NOTE]
>  のみ、 **RetryTransactionException**と**PersistenceException**アトミックのスコープが再試行が発生することができます。 アトミックのスコープで発生したその他の例外が発生することはできません、再試行は、場合でも、**再試行**プロパティに設定されて**True**します。 それぞれ 2 つの連続する再試行間隔の 2 秒間の既定のパブリック プロパティを使用してオーバーライドできます**RetryTransactionException** (かどうかある再試行の発生に使用されている例外)。  
  
 アトミックのスコープが他のトランザクションを入れ子にやを含めることができない他のトランザクションの入れ子に関する制限がある**例外のキャッチ**ブロックします。  
  
## <a name="dtc-transactions"></a>DTC トランザクション  
 アトミック トランザクションは DTC トランザクションのような動作でない明示的に既定の DTC トランザクション。 させることができますに明示的に DTC トランザクションにトランザクションで使用されているすべてのオブジェクトは、System.EnterpriseServices.ServicedComponents から派生した COM + オブジェクト、分離レベルがトランザクション コンポーネント間に同意します。  
  
> [!NOTE]
>  例外ハンドラーを含めることも、アトミック トランザクション内で、他のトランザクションを含めることはできません。  
  
> [!NOTE]
>  アトミックのトランザクションが一致する送信を含むことはできず、受信アクション-は、要求-応答の組み合わせまたは送信を受信する同じ関連付けセットを使用します。  
  
## <a name="non-serializable-objects"></a>非シリアル化可能なオブジェクト  
 オーケストレーション内でシリアル化できないオブジェクトを使用する場合は、アトミック トランザクション内でのみ使用する必要があります。 このような使用オブジェクトをアトミック トランザクションの外部でデータ損失のリスク、エンジンによってオーケストレーションが永続化されるたびにします。  
  
> [!CAUTION]
>  各アトミックのスコープを表す、永続化ポイントとどのようなことを意味は、オーケストレーションの状態が永続化の各ポイントでデータベースに保存されます。 アトミックのスコープの広範な使用には、オーケストレーションでの待機時間が増加します。 しないため、静的メソッドの呼び出しを使用する非シリアル化可能なオブジェクトを作成するためにアトミックのスコープを使用する代わりに、永続化ポイントの必要があるので、アトミックのスコープを必要とします。  
  
## <a name="see-also"></a>参照  
 [アトミック トランザクションの使用シナリオ](../core/scenarios-using-atomic-transactions.md)   
 [長時間トランザクション](../core/long-running-transactions.md)