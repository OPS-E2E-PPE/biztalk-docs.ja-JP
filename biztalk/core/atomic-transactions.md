---
title: アトミック トランザクション |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- atomic transactions
- scopes, examples
- transactions, orchestrations
- orchestrations, transactions
- transactions, isolation levels
- transactions, ACID concept
- transactions, examples
- transactions, atomic
- scopes, transactions
- scopes
ms.assetid: 5030e1fd-943f-42bc-9296-4f315bd5f733
caps.latest.revision: 12
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 79512ead7a9ec91fe1558643fa66747e6674eee6
ms.sourcegitcommit: d27732e569b0897361dfaebca8352aa97bb7efe1
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/10/2019
ms.locfileid: "65530690"
---
# <a name="atomic-transactions"></a><span data-ttu-id="33b0e-102">アトミック トランザクション</span><span class="sxs-lookup"><span data-stu-id="33b0e-102">Atomic Transactions</span></span>
<span data-ttu-id="33b0e-103">トランザクションの従来の 'ACID' の概念に従って個別の個々 の作業を実行する BizTalk オーケストレーションを設計できます。</span><span class="sxs-lookup"><span data-stu-id="33b0e-103">BizTalk orchestrations can be designed to run discrete pieces of work, following the classic 'ACID' concept of a transaction.</span></span> <span data-ttu-id="33b0e-104">これらの作業を実行すると、不連続であるかアトミック単位は、ビジネス プロセスを 1 つの一貫性のある状態から他の作業単位から分離された新しい、一貫性および持続性のある状態に移動します。</span><span class="sxs-lookup"><span data-stu-id="33b0e-104">These discrete or atomic units of work, when performed, move the business process from one consistent state to a new, consistent and durable state that is isolated from other units of work.</span></span> <span data-ttu-id="33b0e-105">使用してこれは、通常、**スコープ**コンストラクトをトランザクション セマンティクスで作業単位をカプセル化します。</span><span class="sxs-lookup"><span data-stu-id="33b0e-105">This is typically done by using the **Scope** construct that encapsulates the units of work with the transactional semantics.</span></span> <span data-ttu-id="33b0e-106">オーケストレーション全体のスコープを使用せず、アトミック トランザクションとしても定義できます。</span><span class="sxs-lookup"><span data-stu-id="33b0e-106">The entire orchestration can also be defined as an atomic transaction without the use of scopes.</span></span> <span data-ttu-id="33b0e-107">スコープ、ただし、マークできません、オーケストレーション自体が長時間またはアトミックのトランザクションの種類としてマークされていない限り、トランザクション。</span><span class="sxs-lookup"><span data-stu-id="33b0e-107">The scopes, however, cannot be marked as transactional unless the orchestration itself is marked as a long running or atomic transaction type.</span></span> <span data-ttu-id="33b0e-108">アトミック トランザクションを部分的な更新は自動的にロールバック エラーが発生した場合、トランザクションの更新中に、トランザクションの効果を消去することを保証 (で行われた .NET 呼び出しの効果を除いて、トランザクションの場合)。</span><span class="sxs-lookup"><span data-stu-id="33b0e-108">Atomic transactions guarantee that any partial updates are rolled back automatically in the event of a failure during the transactional update, and that the effects of the transaction are erased (except for the effects of any .NET calls that are made in the transaction).</span></span> <span data-ttu-id="33b0e-109">BizTalk オーケストレーションのアトミック トランザクションは、一般的に時間が短くおよび 4 つの"ACID"属性 (原子性、一貫性、分離、および持続性) は、分散トランザクション コーディネーター (DTC) トランザクションに似ています。</span><span class="sxs-lookup"><span data-stu-id="33b0e-109">Atomic transactions in BizTalk orchestrations are similar to distributed transaction coordinator (DTC) transactions in that they are generally short-lived and have the four "ACID" attributes (atomicity, consistency, isolation, and durability):</span></span>  
  
- <span data-ttu-id="33b0e-110">**原子性**</span><span class="sxs-lookup"><span data-stu-id="33b0e-110">**Atomicity**</span></span>  
  
   <span data-ttu-id="33b0e-111">トランザクションは、作業のアトミック単位を表します。</span><span class="sxs-lookup"><span data-stu-id="33b0e-111">A transaction represents an atomic unit of work.</span></span> <span data-ttu-id="33b0e-112">トランザクション内のすべての変更が実行されるか、変更を何も実行されません。</span><span class="sxs-lookup"><span data-stu-id="33b0e-112">Either all modifications within a transaction are performed, or none of the modifications are performed.</span></span>  
  
- <span data-ttu-id="33b0e-113">**一貫性**</span><span class="sxs-lookup"><span data-stu-id="33b0e-113">**Consistency**</span></span>  
  
   <span data-ttu-id="33b0e-114">、コミットされたときにトランザクションは、システム内のデータの整合性を維持する必要があります。</span><span class="sxs-lookup"><span data-stu-id="33b0e-114">When committed, a transaction must preserve the integrity of the data within the system.</span></span> <span data-ttu-id="33b0e-115">トランザクションは、トランザクションの開始前に内部に矛盾していたデータベースのデータ変更を実行する場合、データベースする必要があります内部的に一貫性のあるトランザクションがコミットされるとき。</span><span class="sxs-lookup"><span data-stu-id="33b0e-115">If a transaction performs a data modification on a database that was internally consistent before the transaction started, the database must still be internally consistent when the transaction is committed.</span></span> <span data-ttu-id="33b0e-116">このプロパティの確保は、ほぼアプリケーション開発者の責任です。</span><span class="sxs-lookup"><span data-stu-id="33b0e-116">Ensuring this property is largely the responsibility of the application developer.</span></span>  
  
- <span data-ttu-id="33b0e-117">**分離性**</span><span class="sxs-lookup"><span data-stu-id="33b0e-117">**Isolation**</span></span>  
  
   <span data-ttu-id="33b0e-118">同時実行トランザクションによって加えられた変更は、その他の同時実行トランザクションによって加えられた変更から分離する必要があります。</span><span class="sxs-lookup"><span data-stu-id="33b0e-118">Modifications made by concurrent transactions must be isolated from the modifications made by other concurrent transactions.</span></span> <span data-ttu-id="33b0e-119">同時に実行される分離レベルのトランザクションでは、トランザクションが順番に実行された場合とまったく同様に内部データベースの一貫性を保つように変更を実行します。</span><span class="sxs-lookup"><span data-stu-id="33b0e-119">Isolated transactions that run concurrently perform modifications that preserve internal database consistency exactly as they would if the transactions were run serially.</span></span>  
  
- <span data-ttu-id="33b0e-120">**持続性**</span><span class="sxs-lookup"><span data-stu-id="33b0e-120">**Durability**</span></span>  
  
   <span data-ttu-id="33b0e-121">トランザクションがコミットされると、すべての変更が完全に既定では、システムでします。</span><span class="sxs-lookup"><span data-stu-id="33b0e-121">After a transaction is committed, all modifications are permanently in place in the system by default.</span></span> <span data-ttu-id="33b0e-122">変更は、システム障害が発生した場合でも永続化します。</span><span class="sxs-lookup"><span data-stu-id="33b0e-122">The modifications persist even if a system failure occurs.</span></span>  
  
  <span data-ttu-id="33b0e-123">BizTalk オーケストレーションで使用されるアトミック トランザクションでは、次の分離レベルがサポートされています。</span><span class="sxs-lookup"><span data-stu-id="33b0e-123">The following isolation levels are supported by the atomic transactions used in BizTalk Orchestrations:</span></span>  
  
- <span data-ttu-id="33b0e-124">**Read Committed**</span><span class="sxs-lookup"><span data-stu-id="33b0e-124">**Read Committed**</span></span>  
  
   <span data-ttu-id="33b0e-125">ダーティ リードを回避するために、データの読み込みは、反復不能読み取りやファントム データがその結果、トランザクションが終了する前に、データを変更することができますが、共有ロックが保持されます。</span><span class="sxs-lookup"><span data-stu-id="33b0e-125">Shared locks are held while the data is being read to avoid dirty reads, but the data can be changed before the end of the transaction, resulting in non-repeatable reads or phantom data.</span></span>  
  
- <span data-ttu-id="33b0e-126">**Repeatable Read**</span><span class="sxs-lookup"><span data-stu-id="33b0e-126">**Repeatable Read**</span></span>  
  
   <span data-ttu-id="33b0e-127">ロックは、他のユーザーがデータを更新するを防止、クエリで使用されているすべてのデータに配置されます。</span><span class="sxs-lookup"><span data-stu-id="33b0e-127">Locks are placed on all data that is used in a query, preventing other users from updating the data.</span></span> <span data-ttu-id="33b0e-128">これにより、反復不能読み取りが、ファントム行は引き続き可能です。</span><span class="sxs-lookup"><span data-stu-id="33b0e-128">This prevents non-repeatable reads, but phantom rows are still possible.</span></span>  
  
- <span data-ttu-id="33b0e-129">**SERIALIZABLE**</span><span class="sxs-lookup"><span data-stu-id="33b0e-129">**Serializable**</span></span>  
  
   <span data-ttu-id="33b0e-130">範囲ロックを配置するには、ほかのユーザーは、トランザクションが完了するまで、データベースに行を挿入したり、更新されます。</span><span class="sxs-lookup"><span data-stu-id="33b0e-130">A range lock is placed preventing other users from updating or inserting rows into the database until the transaction is complete.</span></span>  
  
  <span data-ttu-id="33b0e-131">BizTalk Server では、アトミック トランザクション内の状態の変更-変数、メッセージ、およびオブジェクトの変更など、トランザクションのコミット時にのみアトミック トランザクションのスコープ外に表示されます。</span><span class="sxs-lookup"><span data-stu-id="33b0e-131">BizTalk Server ensures that state changes within an atomic transaction—such as modifications to variables, messages, and objects—are visible outside the scope of the atomic transaction only upon commitment of the transaction.</span></span> <span data-ttu-id="33b0e-132">中間状態の変更は、オーケストレーションの他の部分から分離されます。</span><span class="sxs-lookup"><span data-stu-id="33b0e-132">The intermediate state changes are isolated from other parts of an orchestration.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="33b0e-133">アトミックのトランザクションが含まれている場合、**受信**、図形、**送信**図形、または**オーケストレーションの開始**図形を対応するアクションは行われませんまで、トランザクションがコミットされます。</span><span class="sxs-lookup"><span data-stu-id="33b0e-133">If an atomic transaction contains a **Receive** shape, a **Send** shape, or a **Start Orchestration** shape, the corresponding actions will not take place until the transaction has committed.</span></span>  
  
 <span data-ttu-id="33b0e-134">データの完全な ACID プロパティが必要な場合: たとえば、ときに、データがあります他のトランザクションから分離-アトミック トランザクションを排他的に使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="33b0e-134">If you require full ACID properties on the data—for example, when the data must be isolated from other transactions—you must use atomic transactions exclusively.</span></span>  
  
 <span data-ttu-id="33b0e-135">アトミックのトランザクションが失敗したときに、オーケストレーション インスタンスがスコープに入る場合、すべての状態がリセットされます。</span><span class="sxs-lookup"><span data-stu-id="33b0e-135">When an atomic transaction fails, all states are reset as if the orchestration instance never entered the scope.</span></span> <span data-ttu-id="33b0e-136">ルール BizTalk にアトミック トランザクションはすべての変数 (しないだけローカル スコープに) がトランザクションに参加します。</span><span class="sxs-lookup"><span data-stu-id="33b0e-136">The rule BizTalk has for atomic transactions is that all variables (not just local to the scope) participate in the transaction.</span></span> <span data-ttu-id="33b0e-137">シリアル化できるすべての変数およびメッセージがアトミックのトランザクションで使用する必要があります方は、スコープに対してローカルに宣言します。コンパイラは、それ以外の場合、"変数... シリアル化可能としてマークされていない"エラー。</span><span class="sxs-lookup"><span data-stu-id="33b0e-137">All non-serializable variables and messages used in an atomic transaction should be declared local to the scope; otherwise, the compiler will give the "variable….is not marked as serializable" error.</span></span> <span data-ttu-id="33b0e-138">すべてのアトミックのスコープは「同期」と見なされ、オーケストレーション コンパイラは、実際にアトミックのスコープには、同期済みのキーワードが使用する場合、冗長な使用量は、警告は提供します。</span><span class="sxs-lookup"><span data-stu-id="33b0e-138">All atomic scopes are assumed to be "synchronized" and the orchestration compiler will provide a warning for redundant usage, if indeed the synchronized keyword is used for atomic scopes.</span></span> <span data-ttu-id="33b0e-139">共有データの同期を (スコープの最後に状態の永続化を含む) のスコープが正常に完了するまでのスコープの先頭から拡張または (エラー) の場合、例外ハンドラーの完了にします。</span><span class="sxs-lookup"><span data-stu-id="33b0e-139">The synchronization for the shared data extends from the beginning of the scope until the successful completion of the scope (including the state persistence at the end of the scope) or to the completion of the exception handler (in case of errors).</span></span> <span data-ttu-id="33b0e-140">同期ドメインは、補正ハンドラーには適用されません。</span><span class="sxs-lookup"><span data-stu-id="33b0e-140">The synchronization domain does not extend to the compensation handler.</span></span>  
  
 <span data-ttu-id="33b0e-141">アトミック トランザクションは、オーケストレーションは、トランザクションとインスタンスを停止するポイントを中断する位置のタイムアウト値を関連付けることができます。</span><span class="sxs-lookup"><span data-stu-id="33b0e-141">Atomic transactions can be associated with timeout values at which point the orchestration will stop the transaction and the instance will be suspended.</span></span> <span data-ttu-id="33b0e-142">受信図形、送信図形、またはオーケストレーションの開始図形がアトミックのトランザクションが含まれる場合、対応するアクションは行われません、トランザクションがコミットされるまでです。</span><span class="sxs-lookup"><span data-stu-id="33b0e-142">If an atomic transaction contains a Receive shape, a Send shape, or a Start Orchestration shape, the corresponding actions will not take place until the transaction has committed.</span></span>  
  
 <span data-ttu-id="33b0e-143">アトミック トランザクションの再試行、ユーザーが意図的に例外をスロー、 **RetryTransactionException**場合や、 **PersistenceException**がアトミックのトランザクションがコミットを試行する時に発生します。</span><span class="sxs-lookup"><span data-stu-id="33b0e-143">An atomic transaction retries when the user deliberately throws a **RetryTransactionException** or if a **PersistenceException** is raised at the time that the atomic transaction tries to commit.</span></span> <span data-ttu-id="33b0e-144">たとえば、アトミック トランザクションの一部であった、DTC トランザクションを分散し、その他のいくつかの参加者トランザクションがトランザクションを停止している場合、この、後者でした発生します。</span><span class="sxs-lookup"><span data-stu-id="33b0e-144">The latter could happen if for instance, the atomic transaction was part of a distributed DTC transaction and some other participant in that transaction stopped the transaction.</span></span> <span data-ttu-id="33b0e-145">同様に、トランザクションがコミットしようとした時点でデータベース接続の問題があった場合にも、 **PersistenceException**発生します。</span><span class="sxs-lookup"><span data-stu-id="33b0e-145">Likewise, if there were database connectivity problems at the time when the transaction was trying to commit, there would also be a **PersistenceException** raised.</span></span> <span data-ttu-id="33b0e-146">アトミックのスコープを持つのこのような場合**再試行 = True**、21 回まで再試行されます。</span><span class="sxs-lookup"><span data-stu-id="33b0e-146">If this happens for an atomic scope that has **Retry=True**, then it will retry up to 21 times.</span></span> <span data-ttu-id="33b0e-147">各再試行間の遅延が既定では 2 秒 (ただし、変更可能です)。</span><span class="sxs-lookup"><span data-stu-id="33b0e-147">The delay between each retry is two seconds by default (but that is modifiable).</span></span> <span data-ttu-id="33b0e-148">トランザクションがコミットすることができない場合、21 の再試行が終了は後、は、オーケストレーション インスタンス全体が中断されます。</span><span class="sxs-lookup"><span data-stu-id="33b0e-148">After 21 retries are exhausted, if the transaction is still unable to commit, the whole orchestration instance is suspended.</span></span> <span data-ttu-id="33b0e-149">手動で再開し、問題が発生したアトミックのスコープの先頭からの新しいカウンターでもう一度、経由で始まります。</span><span class="sxs-lookup"><span data-stu-id="33b0e-149">It can be manually resumed and it will start over again, with a fresh counter, from the beginning of the offending atomic scope.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="33b0e-150">のみ、 **RetryTransactionException**と**PersistenceException**アトミックのスコープが再試行が発生することができます。</span><span class="sxs-lookup"><span data-stu-id="33b0e-150">Only the **RetryTransactionException** and **PersistenceException** can cause an atomic scope to retry.</span></span> <span data-ttu-id="33b0e-151">アトミックのスコープで発生したその他の例外が発生することはできません、再試行は、場合でも、**再試行**プロパティに設定されて**True**します。</span><span class="sxs-lookup"><span data-stu-id="33b0e-151">Any other exception raised in an atomic scope cannot cause it to retry, even if the **Retry** property is set to **True**.</span></span> <span data-ttu-id="33b0e-152">それぞれ 2 つの連続する再試行間隔の 2 秒間の既定のパブリック プロパティを使用してオーバーライドできます**RetryTransactionException** (かどうかある再試行の発生に使用されている例外)。</span><span class="sxs-lookup"><span data-stu-id="33b0e-152">The two-second default delay between each two consecutive retries can be overridden by using a public property on **RetryTransactionException** (if that is the exception that is being used to cause the retries).</span></span>  
  
 <span data-ttu-id="33b0e-153">アトミックのスコープが他のトランザクションを入れ子にやを含めることができない他のトランザクションの入れ子に関する制限がある**例外のキャッチ**ブロックします。</span><span class="sxs-lookup"><span data-stu-id="33b0e-153">The atomic scopes have restrictions on nesting other transactions that cannot nest other transactions or include **Catch - Exception** blocks.</span></span>  
  
## <a name="dtc-transactions"></a><span data-ttu-id="33b0e-154">DTC トランザクション</span><span class="sxs-lookup"><span data-stu-id="33b0e-154">DTC transactions</span></span>  
 <span data-ttu-id="33b0e-155">アトミック トランザクションは DTC トランザクションのような動作でない明示的に既定の DTC トランザクション。</span><span class="sxs-lookup"><span data-stu-id="33b0e-155">While atomic transactions behave like DTC transactions, they are not explicitly DTC transactions by default.</span></span> <span data-ttu-id="33b0e-156">させることができますに明示的に DTC トランザクションにトランザクションで使用されているすべてのオブジェクトは、System.EnterpriseServices.ServicedComponents から派生した COM + オブジェクト、分離レベルがトランザクション コンポーネント間に同意します。</span><span class="sxs-lookup"><span data-stu-id="33b0e-156">You can explicitly make them DTC transactions, provided that any objects being used in the transaction are COM+ objects derived from System.EnterpriseServices.ServicedComponents, and that isolation levels agree between transaction components.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="33b0e-157">例外ハンドラーを含めることも、アトミック トランザクション内で、他のトランザクションを含めることはできません。</span><span class="sxs-lookup"><span data-stu-id="33b0e-157">An atomic transaction cannot contain any other transactions within it, nor can it contain exception handlers.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="33b0e-158">アトミックのトランザクションが一致する送信を含むことはできず、受信アクション-は、要求-応答の組み合わせまたは送信を受信する同じ関連付けセットを使用します。</span><span class="sxs-lookup"><span data-stu-id="33b0e-158">An atomic transaction cannot contain matching send and receive actions—that is, a request-response pair or a send and receive that use the same correlation set.</span></span>  
  
## <a name="non-serializable-objects"></a><span data-ttu-id="33b0e-159">非シリアル化可能なオブジェクト</span><span class="sxs-lookup"><span data-stu-id="33b0e-159">Non-serializable objects</span></span>  
 <span data-ttu-id="33b0e-160">オーケストレーション内でシリアル化できないオブジェクトを使用する場合は、アトミック トランザクション内でのみ使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="33b0e-160">If you want to use a non-serializable object within an orchestration, you must use it only within an atomic transaction.</span></span> <span data-ttu-id="33b0e-161">このような使用オブジェクトをアトミック トランザクションの外部でデータ損失のリスク、エンジンによってオーケストレーションが永続化されるたびにします。</span><span class="sxs-lookup"><span data-stu-id="33b0e-161">Any use of such an object outside of an atomic transaction risks data loss whenever the orchestration is persisted by the engine.</span></span>  
  
> [!CAUTION]
>  <span data-ttu-id="33b0e-162">各アトミックのスコープを表す、永続化ポイントとどのようなことを意味は、オーケストレーションの状態が永続化の各ポイントでデータベースに保存されます。</span><span class="sxs-lookup"><span data-stu-id="33b0e-162">Each Atomic scope represents a persistence point and what that means is the state of the orchestration is saved to the database at each persistence point.</span></span> <span data-ttu-id="33b0e-163">アトミックのスコープの広範な使用には、オーケストレーションでの待機時間が増加します。</span><span class="sxs-lookup"><span data-stu-id="33b0e-163">Extensive use of Atomic scope will increase the latency in the orchestration.</span></span> <span data-ttu-id="33b0e-164">しないため、静的メソッドの呼び出しを使用する非シリアル化可能なオブジェクトを作成するためにアトミックのスコープを使用する代わりに、永続化ポイントの必要があるので、アトミックのスコープを必要とします。</span><span class="sxs-lookup"><span data-stu-id="33b0e-164">Instead of using Atomic scope for the purpose of creating non-serializable objects, you can use Static method calls which they don not require Atomic scopes, thus eliminating the need for the persistence points.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="33b0e-165">参照</span><span class="sxs-lookup"><span data-stu-id="33b0e-165">See Also</span></span>  
 <span data-ttu-id="33b0e-166">[アトミック トランザクションの使用シナリオ](../core/scenarios-using-atomic-transactions.md) </span><span class="sxs-lookup"><span data-stu-id="33b0e-166">[Scenarios Using Atomic Transactions](../core/scenarios-using-atomic-transactions.md) </span></span>  
 [<span data-ttu-id="33b0e-167">長時間トランザクション</span><span class="sxs-lookup"><span data-stu-id="33b0e-167">Long-Running Transactions</span></span>](../core/long-running-transactions.md)