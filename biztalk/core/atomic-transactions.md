---
title: "アトミック トランザクション |Microsoft ドキュメント"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- atomic transactions
- scopes, examples
- transactions, orchestrations
- orchestrations, transactions
- transactions, isolation levels
- transactions, ACID concept
- transactions, examples
- transactions, atomic
- scopes, transactions
- scopes
ms.assetid: 5030e1fd-943f-42bc-9296-4f315bd5f733
caps.latest.revision: "12"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: bc07f379c1f7aa1c846b2c20c19cbfb3393e8174
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/20/2017
---
# <a name="atomic-transactions"></a><span data-ttu-id="b88b7-102">アトミック トランザクション</span><span class="sxs-lookup"><span data-stu-id="b88b7-102">Atomic Transactions</span></span>
<span data-ttu-id="b88b7-103">BizTalk オーケストレーションは、トランザクションに関する標準的な 'ACID' の概念に従って個別の作業を実行するように設計できます。</span><span class="sxs-lookup"><span data-stu-id="b88b7-103">BizTalk orchestrations can be designed to run discrete pieces of work, following the classic 'ACID' concept of a transaction.</span></span> <span data-ttu-id="b88b7-104">このような個別 (アトミック) の作業単位が実行されると、ビジネス プロセスは一貫性のある 1 つの状態から一貫性と持続性のある新しい状態に移行し、他の作業単位から分離された状態になります。</span><span class="sxs-lookup"><span data-stu-id="b88b7-104">These discrete or atomic units of work, when performed, move the business process from one consistent state to a new, consistent and durable state that is isolated from other units of work.</span></span> <span data-ttu-id="b88b7-105">使用してこれは、通常、**スコープ**トランザクション セマンティクスで作業単位をカプセル化するコンストラクトです。</span><span class="sxs-lookup"><span data-stu-id="b88b7-105">This is typically done by using the **Scope** construct that encapsulates the units of work with the transactional semantics.</span></span> <span data-ttu-id="b88b7-106">スコープを使用せずに、オーケストレーション全体をアトミック トランザクションとして定義することもできます。</span><span class="sxs-lookup"><span data-stu-id="b88b7-106">The entire orchestration can also be defined as an atomic transaction without the use of scopes.</span></span> <span data-ttu-id="b88b7-107">一方、オーケストレーション自体の設定でトランザクションの種類が長時間トランザクションまたはアトミックに設定されていない限り、スコープをトランザクション スコープとして設定することはできません。</span><span class="sxs-lookup"><span data-stu-id="b88b7-107">The scopes, however, cannot be marked as transactional unless the orchestration itself is marked as a long running or atomic transaction type.</span></span> <span data-ttu-id="b88b7-108">アトミック トランザクションでは、トランザクション更新中にエラーが発生すると部分的な更新は自動的にロールバックされ、トランザクションの影響が除去されます。ただし、トランザクションで行われた .NET 呼び出しの影響は除去されません。</span><span class="sxs-lookup"><span data-stu-id="b88b7-108">Atomic transactions guarantee that any partial updates are rolled back automatically in the event of a failure during the transactional update, and that the effects of the transaction are erased (except for the effects of any .NET calls that are made in the transaction).</span></span> <span data-ttu-id="b88b7-109">BizTalk オーケストレーションのアトミック トランザクションは、一般に期間が短く、4 つの "ACID" 属性 (原子性、一貫性、分離性、および持続性) を備えている点で、分散トランザクション コーディネーター (DTC) トランザクションに似ています。</span><span class="sxs-lookup"><span data-stu-id="b88b7-109">Atomic transactions in BizTalk orchestrations are similar to distributed transaction coordinator (DTC) transactions in that they are generally short-lived and have the four "ACID" attributes (atomicity, consistency, isolation, and durability):</span></span>  
  
-   <span data-ttu-id="b88b7-110">**原子性**</span><span class="sxs-lookup"><span data-stu-id="b88b7-110">**Atomicity**</span></span>  
  
     <span data-ttu-id="b88b7-111">トランザクションはアトミックな作業単位を表します。</span><span class="sxs-lookup"><span data-stu-id="b88b7-111">A transaction represents an atomic unit of work.</span></span> <span data-ttu-id="b88b7-112">トランザクション内の変更は、すべて実行されるか、まったく実行されないかのどちらかになります。</span><span class="sxs-lookup"><span data-stu-id="b88b7-112">Either all modifications within a transaction are performed, or none of the modifications are performed.</span></span>  
  
-   <span data-ttu-id="b88b7-113">**整合性**</span><span class="sxs-lookup"><span data-stu-id="b88b7-113">**Consistency**</span></span>  
  
     <span data-ttu-id="b88b7-114">トランザクションがコミットされたときにシステム内のデータの整合性が失われないようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="b88b7-114">When committed, a transaction must preserve the integrity of the data within the system.</span></span> <span data-ttu-id="b88b7-115">トランザクションで実行されるデータ変更の対象となるデータベースがトランザクションの開始前に内部的な一貫性を有していた場合は、トランザクションのコミット時も内部的な一貫性が保たれなければなりません。</span><span class="sxs-lookup"><span data-stu-id="b88b7-115">If a transaction performs a data modification on a database that was internally consistent before the transaction started, the database must still be internally consistent when the transaction is committed.</span></span> <span data-ttu-id="b88b7-116">このプロパティの確保を担うのは、主にアプリケーション開発者です。</span><span class="sxs-lookup"><span data-stu-id="b88b7-116">Ensuring this property is largely the responsibility of the application developer.</span></span>  
  
-   <span data-ttu-id="b88b7-117">**分離性**</span><span class="sxs-lookup"><span data-stu-id="b88b7-117">**Isolation**</span></span>  
  
     <span data-ttu-id="b88b7-118">同時実行トランザクションによって加えられた変更は、その他の同時実行トランザクションによって加えられた変更から分離する必要があります。</span><span class="sxs-lookup"><span data-stu-id="b88b7-118">Modifications made by concurrent transactions must be isolated from the modifications made by other concurrent transactions.</span></span> <span data-ttu-id="b88b7-119">独立したトランザクションが複数同時に実行された場合、データベースの内部的な一貫性が損なわれることはありません。これは、トランザクションが順番に実行された場合とまったく同じです。</span><span class="sxs-lookup"><span data-stu-id="b88b7-119">Isolated transactions that run concurrently perform modifications that preserve internal database consistency exactly as they would if the transactions were run serially.</span></span>  
  
-   <span data-ttu-id="b88b7-120">**持続性**</span><span class="sxs-lookup"><span data-stu-id="b88b7-120">**Durability**</span></span>  
  
     <span data-ttu-id="b88b7-121">トランザクションのコミット後、既定では、すべての変更結果がシステム内で持続されます。</span><span class="sxs-lookup"><span data-stu-id="b88b7-121">After a transaction is committed, all modifications are permanently in place in the system by default.</span></span> <span data-ttu-id="b88b7-122">システム障害が発生しても、変更結果は保持されます。</span><span class="sxs-lookup"><span data-stu-id="b88b7-122">The modifications persist even if a system failure occurs.</span></span>  
  
 <span data-ttu-id="b88b7-123">BizTalk オーケストレーションで使用されるアトミック トランザクションでは、次に示す分離レベルがサポートされます。</span><span class="sxs-lookup"><span data-stu-id="b88b7-123">The following isolation levels are supported by the atomic transactions used in BizTalk Orchestrations:</span></span>  
  
-   <span data-ttu-id="b88b7-124">**Read Committed**</span><span class="sxs-lookup"><span data-stu-id="b88b7-124">**Read Committed**</span></span>  
  
     <span data-ttu-id="b88b7-125">データの読み取り中は、ダーティ リードを避けるために、共有ロックが設定されます。しかし、トランザクションの終了前にデータが変更されることもあるため、繰り返し不能な読み取りやファントム データが発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="b88b7-125">Shared locks are held while the data is being read to avoid dirty reads, but the data can be changed before the end of the transaction, resulting in non-repeatable reads or phantom data.</span></span>  
  
-   <span data-ttu-id="b88b7-126">**Repeatable Read**</span><span class="sxs-lookup"><span data-stu-id="b88b7-126">**Repeatable Read**</span></span>  
  
     <span data-ttu-id="b88b7-127">他のユーザーがデータを更新できないようにするために、クエリで使用するすべてのデータをロックします。</span><span class="sxs-lookup"><span data-stu-id="b88b7-127">Locks are placed on all data that is used in a query, preventing other users from updating the data.</span></span> <span data-ttu-id="b88b7-128">繰り返し不能な読み取りは回避できますが、ファントム行が発生する可能性はあります。</span><span class="sxs-lookup"><span data-stu-id="b88b7-128">This prevents non-repeatable reads, but phantom rows are still possible.</span></span>  
  
-   <span data-ttu-id="b88b7-129">**シリアル化可能です**</span><span class="sxs-lookup"><span data-stu-id="b88b7-129">**Serializable**</span></span>  
  
     <span data-ttu-id="b88b7-130">範囲ロックが設定され、トランザクションが完了するまで、他のユーザーがデータベースの行の更新や挿入を行うことはできなくなります。</span><span class="sxs-lookup"><span data-stu-id="b88b7-130">A range lock is placed preventing other users from updating or inserting rows into the database until the transaction is complete.</span></span>  
  
 <span data-ttu-id="b88b7-131">BizTalk Server では、アトミック トランザクション内の状態の変更-変数、メッセージ、およびオブジェクトへの変更など — トランザクションのコミット時にのみアトミック トランザクションのスコープ外に表示されます。</span><span class="sxs-lookup"><span data-stu-id="b88b7-131">BizTalk Server ensures that state changes within an atomic transaction—such as modifications to variables, messages, and objects—are visible outside the scope of the atomic transaction only upon commitment of the transaction.</span></span> <span data-ttu-id="b88b7-132">中間的な状態変更は、オーケストレーションの他の部分から分離されます。</span><span class="sxs-lookup"><span data-stu-id="b88b7-132">The intermediate state changes are isolated from other parts of an orchestration.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="b88b7-133">アトミック トランザクションが含まれている場合、**受信**図形、**送信**図形、または**オーケストレーションの開始**図形、対応するアクションは行われませんまで、トランザクションがコミットされたとします。</span><span class="sxs-lookup"><span data-stu-id="b88b7-133">If an atomic transaction contains a **Receive** shape, a **Send** shape, or a **Start Orchestration** shape, the corresponding actions will not take place until the transaction has committed.</span></span>  
  
 <span data-ttu-id="b88b7-134">データの完全な ACID プロパティが必要な場合などのとき、データがあります他のトランザクションから分離 — アトミック トランザクションのみを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="b88b7-134">If you require full ACID properties on the data—for example, when the data must be isolated from other transactions—you must use atomic transactions exclusively.</span></span>  
  
 <span data-ttu-id="b88b7-135">アトミック トランザクションが失敗すると、すべての状態がリセットされ、オーケストレーション インスタンスがスコープに入る前の状態に戻ります。</span><span class="sxs-lookup"><span data-stu-id="b88b7-135">When an atomic transaction fails, all states are reset as if the orchestration instance never entered the scope.</span></span> <span data-ttu-id="b88b7-136">アトミック トランザクションに関して、BizTalk には、(スコープのローカル変数に限らず) すべての変数がトランザクションに参加するというルールがあります。</span><span class="sxs-lookup"><span data-stu-id="b88b7-136">The rule BizTalk has for atomic transactions is that all variables (not just local to the scope) participate in the transaction.</span></span> <span data-ttu-id="b88b7-137">アトミックなトランザクションで使用されるシリアル化できない変数やメッセージはすべてスコープのローカルで宣言する必要があります。ローカルで宣言されていない場合は、コンパイル時に "変数... はシリアル化可能として設定されていません。" というエラーが発生します。</span><span class="sxs-lookup"><span data-stu-id="b88b7-137">All non-serializable variables and messages used in an atomic transaction should be declared local to the scope; otherwise, the compiler will give the "variable….is not marked as serializable" error.</span></span> <span data-ttu-id="b88b7-138">すべてのアトミックのスコープは「同期」と見なされ、オーケストレーション コンパイラは、実際にアトミックのスコープには、同期済みのキーワードが使用する場合、冗長な使用法に関する警告が指定します。</span><span class="sxs-lookup"><span data-stu-id="b88b7-138">All atomic scopes are assumed to be "synchronized" and the orchestration compiler will provide a warning for redundant usage, if indeed the synchronized keyword is used for atomic scopes.</span></span> <span data-ttu-id="b88b7-139">共有データの同期は、スコープの先頭からスコープが正常に完了するまで (スコープの末尾における状態の永続化を含む)、または例外ハンドラーの処理が完了するまで (エラーの場合)、継続されます。</span><span class="sxs-lookup"><span data-stu-id="b88b7-139">The synchronization for the shared data extends from the beginning of the scope until the successful completion of the scope (including the state persistence at the end of the scope) or to the completion of the exception handler (in case of errors).</span></span> <span data-ttu-id="b88b7-140">補正ハンドラーは同期ドメインには含まれません。</span><span class="sxs-lookup"><span data-stu-id="b88b7-140">The synchronization domain does not extend to the compensation handler.</span></span>  
  
 <span data-ttu-id="b88b7-141">アトミック トランザクションは、タイムアウト値に関連付けることができます。タイムアウト値に達すると、オーケストレーションによってトランザクションが停止され、インスタンスが中断されます。</span><span class="sxs-lookup"><span data-stu-id="b88b7-141">Atomic transactions can be associated with timeout values at which point the orchestration will stop the transaction and the instance will be suspended.</span></span> <span data-ttu-id="b88b7-142">アトミック トランザクションに受信図形、送信図形、またはオーケストレーションの開始図形が含まれている場合、対応するアクションはトランザクションがコミットされるまで実行されません。</span><span class="sxs-lookup"><span data-stu-id="b88b7-142">If an atomic transaction contains a Receive shape, a Send shape, or a Start Orchestration shape, the corresponding actions will not take place until the transaction has committed.</span></span>  
  
 <span data-ttu-id="b88b7-143">アトミック トランザクションの再試行、ユーザーが意図的をスローするとき、 **RetryTransactionException**場合や、 **PersistenceException**がアトミックのトランザクションがコミットを試行する時に発生します。</span><span class="sxs-lookup"><span data-stu-id="b88b7-143">An atomic transaction retries when the user deliberately throws a **RetryTransactionException** or if a **PersistenceException** is raised at the time that the atomic transaction tries to commit.</span></span> <span data-ttu-id="b88b7-144">後者は、アトミック トランザクションが分散 DTC トランザクションの一部であり、そのトランザクションの他の参加要素によってトランザクションが停止された場合などに発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="b88b7-144">The latter could happen if for instance, the atomic transaction was part of a distributed DTC transaction and some other participant in that transaction stopped the transaction.</span></span> <span data-ttu-id="b88b7-145">同様に、トランザクションがコミットしようとした時にデータベース接続の問題があった場合も用意してあります、 **PersistenceException**発生します。</span><span class="sxs-lookup"><span data-stu-id="b88b7-145">Likewise, if there were database connectivity problems at the time when the transaction was trying to commit, there would also be a **PersistenceException** raised.</span></span> <span data-ttu-id="b88b7-146">これには、アトミックのスコープを持つ場合**を再試行してください = True**、再試行されます 21 回までです。</span><span class="sxs-lookup"><span data-stu-id="b88b7-146">If this happens for an atomic scope that has **Retry=True**, then it will retry up to 21 times.</span></span> <span data-ttu-id="b88b7-147">再試行の間隔は、既定では 2 秒になっています (この間隔は変更できます)。</span><span class="sxs-lookup"><span data-stu-id="b88b7-147">The delay between each retry is two seconds by default (but that is modifiable).</span></span> <span data-ttu-id="b88b7-148">21 再試行が終了して、トランザクションがコミットすることができない場合後、は、オーケストレーション インスタンス全体が中断されます。</span><span class="sxs-lookup"><span data-stu-id="b88b7-148">After 21 retries are exhausted, if the transaction is still unable to commit, the whole orchestration instance is suspended.</span></span> <span data-ttu-id="b88b7-149">中断されたオーケストレーション インスタンスは手動で再開できます。カウンターはリセットされ、問題が発生したアトミックのスコープの先頭から再実行されます。</span><span class="sxs-lookup"><span data-stu-id="b88b7-149">It can be manually resumed and it will start over again, with a fresh counter, from the beginning of the offending atomic scope.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="b88b7-150">のみ、 **RetryTransactionException**と**PersistenceException**アトミックのスコープを再試行する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="b88b7-150">Only the **RetryTransactionException** and **PersistenceException** can cause an atomic scope to retry.</span></span> <span data-ttu-id="b88b7-151">アトミックのスコープで発生したその他の例外が原因では、再試行する場合でも、**を再試行してください**プロパティに設定されている**True**です。</span><span class="sxs-lookup"><span data-stu-id="b88b7-151">Any other exception raised in an atomic scope cannot cause it to retry, even if the **Retry** property is set to **True**.</span></span> <span data-ttu-id="b88b7-152">パブリック プロパティを使用して、それぞれ 2 つの連続する再試行の間の 2 秒間の既定の遅延をオーバーライドできます**RetryTransactionException** (かどうかは例外となる再試行に使用されている)。</span><span class="sxs-lookup"><span data-stu-id="b88b7-152">The two-second default delay between each two consecutive retries can be overridden by using a public property on **RetryTransactionException** (if that is the exception that is being used to cause the retries).</span></span>  
  
 <span data-ttu-id="b88b7-153">アトミックのスコープがあるその他のトランザクションを入れ子やを含めることができない他のトランザクションの入れ子に関する制限**例外のキャッチ**ブロックします。</span><span class="sxs-lookup"><span data-stu-id="b88b7-153">The atomic scopes have restrictions on nesting other transactions that cannot nest other transactions or include **Catch - Exception** blocks.</span></span>  
  
## <a name="dtc-transactions"></a><span data-ttu-id="b88b7-154">DTC トランザクション</span><span class="sxs-lookup"><span data-stu-id="b88b7-154">DTC transactions</span></span>  
 <span data-ttu-id="b88b7-155">アトミック トランザクションは DTC トランザクションと同じように動作しますが、既定では明示的な DTC トランザクションではありません。</span><span class="sxs-lookup"><span data-stu-id="b88b7-155">While atomic transactions behave like DTC transactions, they are not explicitly DTC transactions by default.</span></span> <span data-ttu-id="b88b7-156">トランザクション内で使用されているオブジェクトが System.EnterpriseServices.ServicedComponents から派生した COM+ オブジェクトであり、分離レベルがトランザクション コンポーネント間で一致している場合は、明示的に DTC トランザクションにすることができます。</span><span class="sxs-lookup"><span data-stu-id="b88b7-156">You can explicitly make them DTC transactions, provided that any objects being used in the transaction are COM+ objects derived from System.EnterpriseServices.ServicedComponents, and that isolation levels agree between transaction components.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="b88b7-157">アトミック トランザクションに他のトランザクションを含めたり、例外ハンドラーを含めたりすることはできません。</span><span class="sxs-lookup"><span data-stu-id="b88b7-157">An atomic transaction cannot contain any other transactions within it, nor can it contain exception handlers.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="b88b7-158">アトミック トランザクションが一致する送信が含まれてことはできず、受信アクション — を要求-応答の組み合わせや、送信および受信を同じ関連付けセットを使用します。</span><span class="sxs-lookup"><span data-stu-id="b88b7-158">An atomic transaction cannot contain matching send and receive actions—that is, a request-response pair or a send and receive that use the same correlation set.</span></span>  
  
## <a name="non-serializable-objects"></a><span data-ttu-id="b88b7-159">非シリアル化できるオブジェクト</span><span class="sxs-lookup"><span data-stu-id="b88b7-159">Non-serializable objects</span></span>  
 <span data-ttu-id="b88b7-160">オーケストレーション内でシリアル化できないオブジェクトを使用する場合は、必ずアトミック トランザクション内で使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="b88b7-160">If you want to use a non-serializable object within an orchestration, you must use it only within an atomic transaction.</span></span> <span data-ttu-id="b88b7-161">シリアル化できないオブジェクトをアトミック トランザクションの外部で使用すると、オーケストレーションがエンジンによって永続化されるたびにデータ損失のリスクが発生します。</span><span class="sxs-lookup"><span data-stu-id="b88b7-161">Any use of such an object outside of an atomic transaction risks data loss whenever the orchestration is persisted by the engine.</span></span>  
  
> [!CAUTION]
>  <span data-ttu-id="b88b7-162">アトミックのスコープはそれぞれ永続化ポイントを表します。これは、永続化ポイントに達するたびにオーケストレーションの状態がデータベースに保存されることを意味します。</span><span class="sxs-lookup"><span data-stu-id="b88b7-162">Each Atomic scope represents a persistence point and what that means is the state of the orchestration is saved to the database at each persistence point.</span></span> <span data-ttu-id="b88b7-163">アトミックのスコープを幅広く使用には、オーケストレーションでの待機時間が増加します。</span><span class="sxs-lookup"><span data-stu-id="b88b7-163">Extensive use of Atomic scope will increase the latency in the orchestration.</span></span> <span data-ttu-id="b88b7-164">シリアル化できないオブジェクトの作成には、アトミックのスコープの代わりに静的なメソッド呼び出しを使用できます。静的なメソッド呼び出しはアトミックのスコープを必要としないため、永続化ポイントは不要になります。</span><span class="sxs-lookup"><span data-stu-id="b88b7-164">Instead of using Atomic scope for the purpose of creating non-serializable objects, you can use Static method calls which they don not require Atomic scopes, thus eliminating the need for the persistence points.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="b88b7-165">参照</span><span class="sxs-lookup"><span data-stu-id="b88b7-165">See Also</span></span>  
 <span data-ttu-id="b88b7-166">[アトミック トランザクションの使用シナリオ](../core/scenarios-using-atomic-transactions.md) </span><span class="sxs-lookup"><span data-stu-id="b88b7-166">[Scenarios Using Atomic Transactions](../core/scenarios-using-atomic-transactions.md) </span></span>  
 [<span data-ttu-id="b88b7-167">実行時間の長いトランザクション</span><span class="sxs-lookup"><span data-stu-id="b88b7-167">Long-Running Transactions</span></span>](../core/long-running-transactions.md)