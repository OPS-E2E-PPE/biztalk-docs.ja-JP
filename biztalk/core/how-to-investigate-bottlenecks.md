---
title: ボトルネックを調査する方法 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 7ca22d07-d5fe-4dfb-8b52-3be3a95b0d6f
caps.latest.revision: 4
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 643c64401cc5d8f68d407efc37020391b9467a6b
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/07/2019
ms.locfileid: "65384890"
---
# <a name="how-to-investigate-bottlenecks"></a><span data-ttu-id="10bb8-102">ボトルネックを調査する方法</span><span class="sxs-lookup"><span data-stu-id="10bb8-102">How to Investigate Bottlenecks</span></span>
<span data-ttu-id="10bb8-103">このトピックでは、ボトルネックを調査する方法の推奨プロセスについて説明します。</span><span class="sxs-lookup"><span data-stu-id="10bb8-103">This topic describes a recommended process for how to investigate bottlenecks.</span></span>  
  
## <a name="what-is-the-source-of-the-problem"></a><span data-ttu-id="10bb8-104">問題の原因は何ですか。</span><span class="sxs-lookup"><span data-stu-id="10bb8-104">What is the Source of the Problem?</span></span>  
 <span data-ttu-id="10bb8-105">問題の原因は、ハードウェアまたは関連するソフトウェアです。</span><span class="sxs-lookup"><span data-stu-id="10bb8-105">The source of the problem could be hardware or software related.</span></span> <span data-ttu-id="10bb8-106">リソースは過小使用されたときにこれは通常のボトルネックを示す値どこかで、システムです。</span><span class="sxs-lookup"><span data-stu-id="10bb8-106">When resources are underutilized it is usually an indication of a bottleneck somewhere in the system.</span></span> <span data-ttu-id="10bb8-107">ボトルネックは、ハードウェアの制限、または非効率的なソフトウェアの構成またはその両方のために発生することができます。</span><span class="sxs-lookup"><span data-stu-id="10bb8-107">Bottlenecks can be caused either due to hardware limitations or due to inefficient software configurations or both.</span></span>  
  
 <span data-ttu-id="10bb8-108">という 1 つのボトルネックを軽減する可能性が次の 1 つの探索段階的なプロセスは、ボトルネックを特定します。</span><span class="sxs-lookup"><span data-stu-id="10bb8-108">Identifying bottlenecks is an incremental process whereby alleviating one bottleneck can lead to the discovery of the next one.</span></span> <span data-ttu-id="10bb8-109">識別して、これらのボトルネックを緩和の技術は、このトピックの目的です。</span><span class="sxs-lookup"><span data-stu-id="10bb8-109">The science of identifying and alleviating these bottlenecks is the objective of this topic.</span></span> <span data-ttu-id="10bb8-110">短時間のピーク時に実行するシステムのことができます。</span><span class="sxs-lookup"><span data-stu-id="10bb8-110">It is possible for a system to perform at peaks for short periods of time.</span></span> <span data-ttu-id="10bb8-111">ただし、維持可能なスループットのシステムのみを処理できます速度の遅いコンポーネント。</span><span class="sxs-lookup"><span data-stu-id="10bb8-111">However, for sustainable throughput a system can only process as fast as its slowest performing component.</span></span>  
  
## <a name="using-a-serial-approach"></a><span data-ttu-id="10bb8-112">連続的アプローチを使用します。</span><span class="sxs-lookup"><span data-stu-id="10bb8-112">Using a Serial Approach</span></span>  
 <span data-ttu-id="10bb8-113">エンドポイント (入り口/出口)、システムのまたは中央 (オーケストレーション/データベース) のどこかでボトルネックが発生することができます。</span><span class="sxs-lookup"><span data-stu-id="10bb8-113">Bottlenecks can occur at the endpoints (entry/exit) of the system or somewhere in the middle (orchestration/database).</span></span> <span data-ttu-id="10bb8-114">ボトルネックの場所を特定した後、ソースを識別するために構造化されたアプローチを行うことができます。</span><span class="sxs-lookup"><span data-stu-id="10bb8-114">After the location of the bottleneck has been isolated a structured approach can be undertaken to identify the source.</span></span> <span data-ttu-id="10bb8-115">ボトルネックが解消されている新たなボトルネックが導入されていない別の場所の行をさらにシステムのことを確認するには、もう一度パフォーマンスを測定するために不可欠なります。</span><span class="sxs-lookup"><span data-stu-id="10bb8-115">After the bottlenecks have been alleviated it is essential to measure performance again to ensure that a new bottleneck has not been introduced elsewhere in the system further down the line.</span></span>  
  
 <span data-ttu-id="10bb8-116">これにより、一度に 1 つだけのパラメーターを変更する必要があり、パフォーマンスを測定するその 1 つの変更の影響を確認する、シリアル方式では、特定し、ボトルネックを解決するプロセスを行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="10bb8-116">The process of identifying and fixing bottlenecks should be done in a serial manner whereby only one parameter at a time should be varied and then performance measured to verify the impact of that single change.</span></span> <span data-ttu-id="10bb8-117">一度に 1 つ以上のパラメーターをさまざまな変更の効果を非表示でした。</span><span class="sxs-lookup"><span data-stu-id="10bb8-117">Varying more than one parameter at a time could conceal the effect of the change.</span></span>  
  
 <span data-ttu-id="10bb8-118">たとえば、パラメーター 1 を変更するただしにパフォーマンスを向上させることが、パラメーター 1 が 0 の効果を net に先行するための変更の利点を否定有害な影響を与える可能性がありますパラメーター 1 の変更を組み合わせて 2 番目のパラメーターを変更します。</span><span class="sxs-lookup"><span data-stu-id="10bb8-118">For example, changing parameter 1 could improve performance however, changing parameter 2 in conjunction with changing parameter 1 could have a detrimental effect negating the benefits of changing parameter 1 thus leading to a net zero effect.</span></span> <span data-ttu-id="10bb8-119">ただし、その結果、さまざまなパラメーター 1 の効果が偽陰性、およびさまざまなパラメーター 2 の影響の偽陽性です。</span><span class="sxs-lookup"><span data-stu-id="10bb8-119">However, this results in a false negative on the effect of varying parameter 1 and a false positive on the effect of varying parameter 2.</span></span>  
  
## <a name="testing-consistency"></a><span data-ttu-id="10bb8-120">テストの一貫性</span><span class="sxs-lookup"><span data-stu-id="10bb8-120">Testing Consistency</span></span>  
 <span data-ttu-id="10bb8-121">パフォーマンス特性を測定する設定を変更した後は、変更の結果を検証する必要があります。</span><span class="sxs-lookup"><span data-stu-id="10bb8-121">Measuring performance characteristics after changing settings is imperative to validate the effect of the change.</span></span>  
  
-   <span data-ttu-id="10bb8-122">ハードウェア :使用として、ハードウェアのさまざまな一貫性のあるハードウェアが一貫性のない動作を誤るなどの結果を表示できますが、ラップトップを使用しないでください。</span><span class="sxs-lookup"><span data-stu-id="10bb8-122">Hardware: It is important to use consistent hardware as varying the hardware can display inconsistent behavior producing misleading results e.g. do not use a laptop.</span></span>  
  
-   <span data-ttu-id="10bb8-123">テスト実行の継続時間:結果が実際に維持可能なであることを確認する固定の最小期間とピーク時だけでなくパフォーマンスの測定に重要です。</span><span class="sxs-lookup"><span data-stu-id="10bb8-123">Test Run Duration: It is also important to measure performance for a fixed minimum period to ensure that the results are indeed sustainable and not simply peaks.</span></span> <span data-ttu-id="10bb8-124">長期にわたってテストを実行する別の理由は、システムになったこと、すべてのキャッシュが設定されます、データベース テーブルが予想される数に到達したおよび調整が指定された期間の初期のウォーム/傾斜を十分なことを確認するまでの時間に開始および制御定義済みのしきい値に達するのスループット。</span><span class="sxs-lookup"><span data-stu-id="10bb8-124">Another reason to run tests for longer periods is to ensure that the system has gone through the initial warm/ramp up period where all caches are populated, database tables have reached expected counts and throttling is given sufficient time to kick in and regulate throughput once predefined thresholds are hit.</span></span> <span data-ttu-id="10bb8-125">このアプローチでは、最適なスループットを検出するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="10bb8-125">This approach will help discover optimal sustainable throughput.</span></span>  
  
-   <span data-ttu-id="10bb8-126">パラメーターをテストします。テストのテストのテスト実行のパラメーターの実行に変わらないことにもできます。</span><span class="sxs-lookup"><span data-stu-id="10bb8-126">Test Parameters: It is also imperative to not vary test parameters from test run to test run.</span></span> <span data-ttu-id="10bb8-127">たとえば、マップの複雑さやドキュメントのサイズをさまざまな異なるスループットと待機時間の結果を生成できます。</span><span class="sxs-lookup"><span data-stu-id="10bb8-127">For example, varying map complexity and/or document sizes can produce different throughput and latency results.</span></span>  
  
-   <span data-ttu-id="10bb8-128">クリーンな状態:テストが完了すると、実行、次のテストを実行する前にすべての状態をクリーンアップするには重要です。</span><span class="sxs-lookup"><span data-stu-id="10bb8-128">Clean State: Once a test is complete it is important to cleanup all state before running the next test run.</span></span> <span data-ttu-id="10bb8-129">たとえば、履歴データには、実行時のスループットに影響を与える、データベースに蓄積されたことができます。</span><span class="sxs-lookup"><span data-stu-id="10bb8-129">For example, historical data can buildup in the database impacting runtime throughput.</span></span> <span data-ttu-id="10bb8-130">メモリ、データベース接続、スレッドのようにキャッシュされたリソースを解放するサービス インスタンスのヘルプをリサイクルします。</span><span class="sxs-lookup"><span data-stu-id="10bb8-130">Recycling the service instances help to release cached resources like memory, database connections and threads.</span></span>  
  
## <a name="expectations-throughput-versus-latency"></a><span data-ttu-id="10bb8-131">予測:スループットと待機時間</span><span class="sxs-lookup"><span data-stu-id="10bb8-131">Expectations: Throughput versus Latency</span></span>  
 <span data-ttu-id="10bb8-132">一定量のスループットや待機時間、デプロイされたシステムからの予測になります。</span><span class="sxs-lookup"><span data-stu-id="10bb8-132">It is reasonable to expect a certain amount of throughput and/or latency from the deployed system.</span></span> <span data-ttu-id="10bb8-133">しようとして、高スループットが両方と低待機時間は 2 つの方向を引くと。</span><span class="sxs-lookup"><span data-stu-id="10bb8-133">Attempting to have both high throughput & low latency is like pulling in two different directions.</span></span> <span data-ttu-id="10bb8-134">ただしは現実的では妥当な待機時間の最適なスループットを期待します。</span><span class="sxs-lookup"><span data-stu-id="10bb8-134">However it is realistic to expect optimal throughput with reasonable latency.</span></span> <span data-ttu-id="10bb8-135">スループット向上の負荷 (CPU 消費率が高くより高いディスク IO の競合、メモリ不足、ロックの競合) の向上と待機時間に悪影響を及ぼすことができるシステムに配置されます。</span><span class="sxs-lookup"><span data-stu-id="10bb8-135">As throughput improves increased stress (higher CPU consumption, higher disk-IO contention, memory pressure, greater lock contention) is placed on the system which can have a negative impact on latency.</span></span> <span data-ttu-id="10bb8-136">システムの最適な容量を検出するには、特定し、すべてのボトルネックを緩和する必要があります。</span><span class="sxs-lookup"><span data-stu-id="10bb8-136">To discover optimal capacity of a system it is imperative to identify and alleviate any and all bottlenecks.</span></span>  
  
 <span data-ttu-id="10bb8-137">ボトルネックは、クリーンアップされずに、データベースに存在する従来のデータ (完了したインスタンス) によることができます。これが発生したときのパフォーマンスが低下することができます。</span><span class="sxs-lookup"><span data-stu-id="10bb8-137">Bottlenecks can be caused by legacy data (completed instances) residing in the database not cleaned out. When this occurs performance can degrade.</span></span> <span data-ttu-id="10bb8-138">システムのための十分な時間をドレインするまでに与えた問題を軽減できます。</span><span class="sxs-lookup"><span data-stu-id="10bb8-138">Giving the system sufficient time to drain can help alleviate the problem.</span></span> <span data-ttu-id="10bb8-139">ただし、バックログが蓄積された原因を特定し、問題を解決することが重要です。</span><span class="sxs-lookup"><span data-stu-id="10bb8-139">However, discovering the cause of the backlog buildup and helping alleviate the issue is important.</span></span>  
  
 <span data-ttu-id="10bb8-140">バックログの原因を検出するには、履歴データを分析、(を使用状況のパターンを検出し、バックログの原因の診断) パフォーマンス モニター カウンターを監視する重要なは。</span><span class="sxs-lookup"><span data-stu-id="10bb8-140">To discover the cause of the backlog, it is important to analyze historical data, monitor Performance Monitor counters (to discover usage patterns, and diagnose the source of the backlog).</span></span> <span data-ttu-id="10bb8-141">これは、一般的な状況を毎晩バッチ方式で大量のデータを処理する場所です。</span><span class="sxs-lookup"><span data-stu-id="10bb8-141">This is a common situation where large volumes of data are processed in a batched manner on a nightly basis.</span></span> <span data-ttu-id="10bb8-142">システムとのバックログから回復するには、その機能の性能は予想外のピーク スループットを処理するために、システム内に対応する overdrive シナリオとバッファーの大きさを処理するためのハードウェア要件を見積もる際の役に立ちます.</span><span class="sxs-lookup"><span data-stu-id="10bb8-142">Discovering the capacity of the system and its ability to recover from a backlog can be useful in estimating hardware requirements for handling overdrive scenarios and the amount of buffer room to accommodate within a system to handle unforeseen spikes in throughput.</span></span>  
  
 <span data-ttu-id="10bb8-143">最適なスループットの詳細に必要です、システムをチューニングのアプリケーションのデプロイ、長所と短所、特定のシナリオ、システムと使用状況のパターンを理解します。</span><span class="sxs-lookup"><span data-stu-id="10bb8-143">Tuning the system for optimal sustainable throughput requires an in depth understanding of the application being deployed, the strengths and weaknesses of the system and usage patterns of the specific scenario.</span></span> <span data-ttu-id="10bb8-144">ボトルネックを特定しするものに近いトポロジで徹底的なテストを明確に最適なスループットを予測する唯一の方法は、実稼働環境で使用されます。</span><span class="sxs-lookup"><span data-stu-id="10bb8-144">The only way to discover bottlenecks and predict optimal sustainable throughput with certainty is through thorough testing on a topology that closely matches what will be used in production.</span></span>  
  
 <span data-ttu-id="10bb8-145">このセクションの他のトピックでは、そのトポロジを定義するプロセスを案内して、ボトルネックを緩和し、最初にボトルネックを回避するのに役立つ方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="10bb8-145">Other topics in this section guides you through the process of defining that topology, and provides guidance on how to alleviate bottlenecks and hopefully help to avoid bottlenecks in the first place.</span></span>  
  
## <a name="scaling"></a><span data-ttu-id="10bb8-146">スケーリング</span><span class="sxs-lookup"><span data-stu-id="10bb8-146">Scaling</span></span>  
 <span data-ttu-id="10bb8-147">展開されたトポロジのさまざまな段階でボトルネックが発生することができます。</span><span class="sxs-lookup"><span data-stu-id="10bb8-147">Bottlenecks can occur at various stages of the deployed topology.</span></span> <span data-ttu-id="10bb8-148">いくつかのボトルネックは、ハードウェアをアップグレードすることでアドレス指定できます。</span><span class="sxs-lookup"><span data-stu-id="10bb8-148">Some bottlenecks can be addressed by upgrading hardware.</span></span> <span data-ttu-id="10bb8-149">スケール アップ (複数の CPU、メモリまたはキャッシュ) またはスケール アウト (サーバーの追加) のいずれか、ハードウェアをアップグレードできます。</span><span class="sxs-lookup"><span data-stu-id="10bb8-149">Hardware can be upgraded either by scaling-up (more CPU’s, memory or cache) or by scaling-out (additional servers).</span></span> <span data-ttu-id="10bb8-150">スケール アップ/スケール アウトするかどうかは、発生したボトルネックの種類と構成対象のアプリケーションに依存します。</span><span class="sxs-lookup"><span data-stu-id="10bb8-150">The decision to scale up/out depends on the type of bottleneck encountered and the application being configured.</span></span> <span data-ttu-id="10bb8-151">次は、発生したボトルネックに基づいてハードウェア展開トポロジを変更する方法のガイダンスに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="10bb8-151">The following will help with guidance on how to change hardware deployment topologies based on bottlenecks encountered.</span></span> <span data-ttu-id="10bb8-152">アプリケーションは、スケール アップ/スケール アウトを活用できるゼロから構築する必要があります。以下に例を示します。</span><span class="sxs-lookup"><span data-stu-id="10bb8-152">An application needs to be built from the ground up to be capable of taking advantage of scaling up/out. For example:</span></span>  
  
-   <span data-ttu-id="10bb8-153">追加のサーバーのスケール アップ CPU やメモリも役に立ちませんアプリケーションがシリアル化と実行の 1 つのスレッドに依存する場合は、問題を軽減します。</span><span class="sxs-lookup"><span data-stu-id="10bb8-153">Scaling up a server with additional CPU’s and/or memory may not help alleviate the problem if the application is serialized and dependent on a single thread of execution.</span></span>  
  
-   <span data-ttu-id="10bb8-154">スケール アウト システムで追加のサーバーも役に立ちません場合、その他のサーバーも拡張不可能な一般的なリソースの競合を追加するだけです。</span><span class="sxs-lookup"><span data-stu-id="10bb8-154">Scaling out a system with additional servers may not help if the additional servers simply add contention on a common resource that cannot be scaled.</span></span> <span data-ttu-id="10bb8-155">ただし、スケール アウトは、その他の特典を提供します。</span><span class="sxs-lookup"><span data-stu-id="10bb8-155">However, scaling-out provides additional benefits.</span></span> <span data-ttu-id="10bb8-156">1 つのクアッド プロセッサ サーバーではなく 2 つのデュアル プロセッサ サーバーを展開すると、冗長サーバーを高可用性トポロジを示し、追加のスループットを処理するための拡張の目的を実現できます。</span><span class="sxs-lookup"><span data-stu-id="10bb8-156">Deploying two dual-proc servers instead of one quad-proc server helps provide a redundant server that serves the dual purpose of scaling to handle additional throughput and provides a highly available topology.</span></span>