---
title: AS2 セキュリティに関する既知の問題 |Microsoft ドキュメント
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: b291e000-630d-49a1-8e19-f76c4dfee294
caps.latest.revision: 10
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 1bb633e092ed568bb3817df7be788364934be446
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/20/2017
ms.locfileid: "22262402"
---
# <a name="known-issues-with-as2-security"></a><span data-ttu-id="da7ef-102">AS2 セキュリティに関する既知の問題</span><span class="sxs-lookup"><span data-stu-id="da7ef-102">Known Issues with AS2 Security</span></span>
<span data-ttu-id="da7ef-103">このトピックでは、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] AS2 ソリューションのセキュリティに関する既知の問題について説明します。</span><span class="sxs-lookup"><span data-stu-id="da7ef-103">This topic describes known issues with the security of [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] AS2 solutions.</span></span>  
  
## <a name="the-as2-decoder-will-not-validate-that-a-certificate-is-configured-on-the-host-or-for-the-destination-party"></a><span data-ttu-id="da7ef-104">AS2 デコーダーによって、ホストまたは送信先パーティで証明書が構成されていることが検証されない</span><span class="sxs-lookup"><span data-stu-id="da7ef-104">The AS2 Decoder Will Not Validate that a Certificate Is Configured on the Host or for the Destination Party</span></span>  
 <span data-ttu-id="da7ef-105">AS2 デコーダーは、メッセージのプライベート証明書が証明書ストアで構成されていれば、そのメッセージを解読します。</span><span class="sxs-lookup"><span data-stu-id="da7ef-105">The AS2 decoder will decrypt a message as long as the private certificate for that message is configured in the certificate store.</span></span> <span data-ttu-id="da7ef-106">ただし、AS2 デコーダーは、暗号化解除証明書がホストで構成されている証明書と同じであるかどうかは検証しません。</span><span class="sxs-lookup"><span data-stu-id="da7ef-106">However, the AS2 decoder will not validate that the decryption certificate is the same as the certificate configured on the host.</span></span> <span data-ttu-id="da7ef-107">受信したメッセージは、複数の証明書を使用して暗号化できます。</span><span class="sxs-lookup"><span data-stu-id="da7ef-107">The received message can be encrypted with more than one certificate.</span></span>  
  
## <a name="storing-as2-messages-in-wire-format-can-lead-to-a-security-issue"></a><span data-ttu-id="da7ef-108">AS2 メッセージをワイヤ形式で保存すると、セキュリティ上の問題が発生する</span><span class="sxs-lookup"><span data-stu-id="da7ef-108">Storing AS2 Messages in Wire Format Can Lead to a Security Issue</span></span>  
 <span data-ttu-id="da7ef-109">証明書が使用されない場合、AS2 メッセージをワイヤ形式で否認不可 (NRR) データベースに格納することはお勧めしません。</span><span class="sxs-lookup"><span data-stu-id="da7ef-109">When certificates are not used, storing AS2 messages in wire format in the non-repudiation receipt (NRR) database is not recommended.</span></span> <span data-ttu-id="da7ef-110">これを行うと、セキュリティ上の問題が発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="da7ef-110">Doing so could lead to a security issue.</span></span>  
  
## <a name="messages-or-mdns-to-be-stored-in-the-nrr-database-should-be-signed"></a><span data-ttu-id="da7ef-111">NRR データベースに保存されるメッセージまたは MDN に署名を付ける必要がある</span><span class="sxs-lookup"><span data-stu-id="da7ef-111">Messages or MDNs To Be Stored in the NRR Database Should Be Signed</span></span>  
 <span data-ttu-id="da7ef-112">受信の否認不可を確実に行うには、該当するメッセージの認証と整合性を確立する必要があります。</span><span class="sxs-lookup"><span data-stu-id="da7ef-112">To guarantee non-repudiation of receipt, you must establish the authentication and integrity of the applicable message.</span></span> <span data-ttu-id="da7ef-113">メッセージのデジタル署名を使用して認証と整合性を確立することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="da7ef-113">The recommended way of doing so is by using a digital signature on the message.</span></span> <span data-ttu-id="da7ef-114">この結果、メッセージまたは MDN を否認不可データベースに保存するように AS2 パーティのプロパティを構成した場合は、保存するメッセージまたは MDN に署名を付けるように AS2 プロパティを構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="da7ef-114">As a result, if you configure AS2 party properties to store messages or MDNs in the non-repudiation database, you should configure the AS2 properties to sign the messages or MDNs that you are going to store.</span></span>  
  
## <a name="biztalk-server-will-be-unable-to-decrypt-a-message-saved-in-wire-format-if-the-certificate-is-not-valid"></a><span data-ttu-id="da7ef-115">証明書が有効でない場合、BizTalk Server がワイヤ形式で保存されたメッセージを解読できない</span><span class="sxs-lookup"><span data-stu-id="da7ef-115">BizTalk Server Will Be Unable to Decrypt a Message Saved in Wire Format If the Certificate Is Not Valid</span></span>  
 <span data-ttu-id="da7ef-116">**現象**</span><span class="sxs-lookup"><span data-stu-id="da7ef-116">**Symptom**</span></span>  
  
 <span data-ttu-id="da7ef-117">BizTalk Server が、ワイヤ形式で否認不可データベースに保存された受信 AS2 メッセージを解読できません。</span><span class="sxs-lookup"><span data-stu-id="da7ef-117">BizTalk Server is unable to decrypt an inbound AS2 message that was saved in wire format in the non-repudiation database.</span></span>  
  
 <span data-ttu-id="da7ef-118">**考えられる原因**</span><span class="sxs-lookup"><span data-stu-id="da7ef-118">**Possible Cause**</span></span>  
  
 <span data-ttu-id="da7ef-119">メッセージの解読に必要な証明書の有効期限が切れているか、証明書が失効しています。</span><span class="sxs-lookup"><span data-stu-id="da7ef-119">The certificate required to decrypt the message has expired or been revoked.</span></span> <span data-ttu-id="da7ef-120">これは、AS2 メッセージが否認不可データベースに保存されてから一定期間が経過している場合に発生する傾向があります。</span><span class="sxs-lookup"><span data-stu-id="da7ef-120">This is more likely to occur if a certain period of time has elapsed since the AS2 message was saved in the non-repudiation database.</span></span> <span data-ttu-id="da7ef-121">この現象が発生した場合、メッセージの有効な証明書に直接アクセスする権限がない可能性があります。</span><span class="sxs-lookup"><span data-stu-id="da7ef-121">If this occurs, you may not have immediate access to a valid certificate for the message.</span></span>  
  
 <span data-ttu-id="da7ef-122">**解決策**</span><span class="sxs-lookup"><span data-stu-id="da7ef-122">**Resolution**</span></span>  
  
 <span data-ttu-id="da7ef-123">メッセージを解読するための有効な証明書を取得してください。</span><span class="sxs-lookup"><span data-stu-id="da7ef-123">Acquire a valid certificate for decrypting the message.</span></span>  
  
## <a name="the-inner-envelope-of-a-signed-as2-message-must-not-be-changed-after-the-signature-has-been-calculated"></a><span data-ttu-id="da7ef-124">署名が計算された後は、署名付きの AS2 メッセージの内部エンベロープを変更することはできません。</span><span class="sxs-lookup"><span data-stu-id="da7ef-124">The inner envelope of a signed AS2 message must not be changed after the signature has been calculated</span></span>  
 <span data-ttu-id="da7ef-125">AS2 メッセージに署名が付けられるとき、内部エンベロープのヘッダーおよびペイロードに基づいて署名が計算されます。</span><span class="sxs-lookup"><span data-stu-id="da7ef-125">When an AS2 message is signed, the signature is calculated based on the inner envelope headers and payload.</span></span> <span data-ttu-id="da7ef-126">署名の計算後に内部エンベロープを変更すると、署名が破損します。</span><span class="sxs-lookup"><span data-stu-id="da7ef-126">If the inner envelope is changed after the signature is calculated, the signature will be corrupted.</span></span> <span data-ttu-id="da7ef-127">境界ヘッダー、または境界ヘッダーの外側の要素は変更できますが、境界ヘッダー内のすべてを変更しないでください。</span><span class="sxs-lookup"><span data-stu-id="da7ef-127">The boundary headers, or anything outside the boundary headers, can be changed, but anything within the boundary headers must not be changed.</span></span>  
  
## <a name="use-the-same-logon-for-the-in-process-host-instance-and-the-isolated-host-instance-to-ensure-that-personal-store-is-recognized"></a><span data-ttu-id="da7ef-128">インプロセス ホスト インスタンスと分離ホスト インスタンスに同じログオンを使用して、個人証明書ストアが認識されるようにする</span><span class="sxs-lookup"><span data-stu-id="da7ef-128">Use the same logon for the in-process host instance and the isolated host instance to ensure that Personal store is recognized</span></span>  
 <span data-ttu-id="da7ef-129">個人証明書ストアは、ログオン資格情報がホスト インスタンスに関連付けられているユーザーのユーザー プロファイルが読み込まれた場合にのみ、メッセージ処理に使用できます。</span><span class="sxs-lookup"><span data-stu-id="da7ef-129">The Personal certificate store will be available for message processing only if the user profile is loaded for the user whose logon credentials are associated with the host instance.</span></span> <span data-ttu-id="da7ef-130">個人証明書ストアは、証明書 (ユーザー独自の秘密キー) の署名と解読に使用されます。</span><span class="sxs-lookup"><span data-stu-id="da7ef-130">The Personal store is used for signing and decryption certificates (the user's own private key).</span></span> <span data-ttu-id="da7ef-131">ユーザー プロファイルは、インプロセス ホスト インスタンスでは既定で読み込まれますが、分離ホスト インスタンスでは既定で読み込まれません。</span><span class="sxs-lookup"><span data-stu-id="da7ef-131">The user profile is loaded by default for the in-process host instance; however, the user profile is not loaded by default for the isolated host instance.</span></span> <span data-ttu-id="da7ef-132">分離ホストのユーザー プロファイルは、アプリケーションで読み込むことができます。</span><span class="sxs-lookup"><span data-stu-id="da7ef-132">You can have an application load the user profile for the isolated host.</span></span> <span data-ttu-id="da7ef-133">インプロセス ホスト インスタンスと分離ホスト インスタンスに同じログオンを使用することで、この問題を回避することもできます。</span><span class="sxs-lookup"><span data-stu-id="da7ef-133">Alternatively, you can work around this issue by using the same logon for the in-process host instance and the isolated host instance.</span></span>  
  
 <span data-ttu-id="da7ef-134">アプリケーションによってユーザー プロファイルを読み込む代わりに、プロファイルを読み込むための空のサービスを作成することもできます。</span><span class="sxs-lookup"><span data-stu-id="da7ef-134">Instead of having an application load the user profile, you can create an empty service to load the profile.</span></span> <span data-ttu-id="da7ef-135">空のサービスを作成する方法の詳細については、次を参照してください。[する方法: Windows サービスの作成](http://go.microsoft.com/fwlink/?LinkId=196492)です。</span><span class="sxs-lookup"><span data-stu-id="da7ef-135">For information about creating an empty service, see [How to: Create Windows Services](http://go.microsoft.com/fwlink/?LinkId=196492).</span></span> <span data-ttu-id="da7ef-136">サービスを作成した後、コンピューターの管理 ダイアログ ボックスが開き、サービスのプロパティ ダイアログ ボックスが開き、 をクリックして、**ログオン** タブで **アカウント**、使用するログオン名を入力してください、分離ホスト インスタンス、およびクリック**OK**です。</span><span class="sxs-lookup"><span data-stu-id="da7ef-136">After you have created the service, open the Computer Management dialog box, open the Properties dialog box for the service, click the **Log On** tab, select **This Account**, enter the logon name used for the isolated host instance, and then click **OK**.</span></span> <span data-ttu-id="da7ef-137">これにより、このログオン ユーザーのユーザー プロファイルを読み込むサービスを手動で開始できます。</span><span class="sxs-lookup"><span data-stu-id="da7ef-137">You can then manually start the service to load the user profile for that logon user.</span></span>  
  
## <a name="the-key-usage-attribute-of-a-certificate-must-match-the-certificates-use"></a><span data-ttu-id="da7ef-138">証明書のキーの使用法属性が、証明書の使用法に一致する必要がある</span><span class="sxs-lookup"><span data-stu-id="da7ef-138">The Key Usage attribute of a certificate must match the certificate's use</span></span>  
 <span data-ttu-id="da7ef-139">AS2 トランスポートに使用する証明書には、その使用目的に必要な属性が設定されている必要があります。</span><span class="sxs-lookup"><span data-stu-id="da7ef-139">Certificates used for AS2 transport must have the attributes required for their intended use.</span></span> <span data-ttu-id="da7ef-140">署名および署名の検証を行うには、証明書の [キーの使用法] 属性が [デジタル署名] である必要があります。</span><span class="sxs-lookup"><span data-stu-id="da7ef-140">For signing and signature verification, the Key Usage attribute of the certificate must be Digital Signature.</span></span> <span data-ttu-id="da7ef-141">暗号化および解読を行うには、証明書の [キーの使用法] 属性が [データの暗号化] または [キーの暗号化] である必要があります。</span><span class="sxs-lookup"><span data-stu-id="da7ef-141">For encryption and decryption, the Key Usage attribute of the certificate must be Data Encipherment or Key Encipherment.</span></span> <span data-ttu-id="da7ef-142">証明書をダブルクリックし、[証明書] ダイアログ ボックスの [詳細] タブをクリックして [キーの使用法] ボックスを参照することで、[キーの使用法] 属性を確認できます。</span><span class="sxs-lookup"><span data-stu-id="da7ef-142">You can verify the Key Usage attribute by double-clicking the certificate, clicking the Details tab in the Certificate dialog box, and checking the Key Usage field.</span></span>  
  
## <a name="the-certificate-resolution-list-will-be-verified-for-an-outgoing-mdn-if-the-as2-to-property-is-not-set-for-the-party"></a><span data-ttu-id="da7ef-143">AS2-To プロパティがパーティに対して設定されていない場合、送信 MDN に対して証明書解決の一覧が検証される</span><span class="sxs-lookup"><span data-stu-id="da7ef-143">The certificate resolution list will be verified for an outgoing MDN if the AS2-To property is not set for the party</span></span>  
 <span data-ttu-id="da7ef-144">送出 MDN の既定のアグリーメントでは、証明書解決の一覧の検証が実行されます。</span><span class="sxs-lookup"><span data-stu-id="da7ef-144">In the default agreement for an outgoing MDN, the certificate resolution list verification is performed.</span></span> <span data-ttu-id="da7ef-145">この検証を実行する必要がない場合は、受信側パーティを解決できるようにするため、およびパーティのプロパティを特定できるようにするために、正しい AS2-To パーティ プロパティが設定されていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="da7ef-145">If you do not want this verification to be performed, verify that the correct AS2-To party property is set, so the receiving party can be resolved and the party properties can be determined.</span></span> <span data-ttu-id="da7ef-146">これにより、証明書解決の一覧の検証を要求する既定のアグリーメントが使用されなくなります。</span><span class="sxs-lookup"><span data-stu-id="da7ef-146">If so, the default agreement that prompts verification of the certificate resolution list will not be used.</span></span> <span data-ttu-id="da7ef-147">また、AS2 パーティ プロパティの [全般] ページで、"証明書失効リストを確認する" プロパティを無効にする必要もあります。</span><span class="sxs-lookup"><span data-stu-id="da7ef-147">You will also need to disable the Check Certification Revocation List property on the General page of the AS2 party properties.</span></span>