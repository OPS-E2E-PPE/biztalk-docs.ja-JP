---
title: BizTalk Server がサイズの大きいメッセージを処理する方法 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 62c070be-dff5-4349-9e36-dd3a7caf1752
caps.latest.revision: 33
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 0e9d2d31163dcb49861b1cdb6331579502960b6e
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/07/2019
ms.locfileid: "65387490"
---
# <a name="how-biztalk-server-processes-large-messages"></a><span data-ttu-id="67bac-102">BizTalk Server がサイズの大きいメッセージを処理する方法</span><span class="sxs-lookup"><span data-stu-id="67bac-102">How BizTalk Server Processes Large Messages</span></span>
## <a name="what-is-a-large-message"></a><span data-ttu-id="67bac-103">サイズの大きいメッセージは何ですか。</span><span class="sxs-lookup"><span data-stu-id="67bac-103">What is a large message?</span></span>  
 <span data-ttu-id="67bac-104">残念ながら、この質問に対する回答のものではなく、特定のメッセージ サイズに直接結び付けられていない、microsoft の特定のボトルネックによって異なります[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]システム。</span><span class="sxs-lookup"><span data-stu-id="67bac-104">Unfortunately, the answer to this question isn't tied directly to a specific message size, but rather, depends on specific bottlenecks in your Microsoft [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] system.</span></span> <span data-ttu-id="67bac-105">サイズの大きいメッセージに関連する問題は、次のカテゴリに分類できます。</span><span class="sxs-lookup"><span data-stu-id="67bac-105">The problems associated with large messages can be divided into the following categories:</span></span>  
  
-   <span data-ttu-id="67bac-106">**メモリ不足エラー**特定種類のマッピング、検証、およびプロパティの昇格などのメッセージの処理がメモリにメッセージ全体を読み込みます。</span><span class="sxs-lookup"><span data-stu-id="67bac-106">**Out of memory errors** Certain types of message processing - such as mapping, validation, and property promotion - load the entire message into memory.</span></span> <span data-ttu-id="67bac-107">メモリ内のメッセージのサイズが使用可能なリソースを超えている場合は、メモリ エラーが発生します。</span><span class="sxs-lookup"><span data-stu-id="67bac-107">If the size of the message in memory exceeds available resources, then an out of memory error occurs.</span></span> <span data-ttu-id="67bac-108">このカテゴリに分類されるメッセージのサイズのしきい値は、メモリに読み込まれていないメッセージのサイズのしきい値よりはるかに劣ります。</span><span class="sxs-lookup"><span data-stu-id="67bac-108">The size threshold for messages that fall into this category is much lower than the size threshold for messages that are not loaded into memory.</span></span> <span data-ttu-id="67bac-109">たとえば、10 MB のフラット ファイルを XML に解析され、そのマップが 10 倍で拡張することがありますまたは解析または月を実際にマップされているは 100 MB の XML ドキュメントは、100 MB を超えるメモリを使用する詳細はありませんのみストリーミングされる際に 1 MB のメモリを消費します。メッセージ ボックス データベースです。</span><span class="sxs-lookup"><span data-stu-id="67bac-109">For example, a 10 MB flat file that is parsed into XML and then mapped may grow by a factor of 10 or more to consume over 100 MB of memory, whereas a 100 MB XML document that is not parsed or mapped may actually only consume 1 MB of memory as it is streamed to the MessageBox database.</span></span>  
  
-   <span data-ttu-id="67bac-110">**パフォーマンスの問題をメモリに読み込まれていないメッセージ**メモリに読み込まれる必要がないメッセージは、.NET XmlReader インターフェイスを使用して、メッセージ ボックス データベースにストリーム送信されます。</span><span class="sxs-lookup"><span data-stu-id="67bac-110">**Performance problems for messages that are not loaded into memory** Messages that are not required to be loaded into memory are streamed to the MessageBox database using the .NET XmlReader interface.</span></span> <span data-ttu-id="67bac-111">メモリに読み込む必要があるメッセージのサイズの制限が適用されていないときに BizTalk Server でのメッセージ ボックス データベースにストリーム配信されるメッセージの処理方法に影響を与えるいくつかの重要な要因があります。</span><span class="sxs-lookup"><span data-stu-id="67bac-111">While they are not subject to the size limitations on messages that must be loaded into memory, there are some important factors that impact how BizTalk Server processes messages that are streamed to the MessageBox database.</span></span>  
  
## <a name="factors-that-affect-the-processing-of-large-messages"></a><span data-ttu-id="67bac-112">サイズの大きいメッセージの処理に影響する要因</span><span class="sxs-lookup"><span data-stu-id="67bac-112">Factors that affect the processing of large messages</span></span>  
 <span data-ttu-id="67bac-113">元のメッセージ サイズ、メッセージの形式とすべてのメッセージ処理の種類は、BizTalk Server がサイズの大きいメッセージを処理する方法に影響します。</span><span class="sxs-lookup"><span data-stu-id="67bac-113">The original message size, message format, and type of message processing all affect how BizTalk Server processes large messages.</span></span>  
  
- <span data-ttu-id="67bac-114">**元のメッセージ サイズ**BizTalk Server で受信メッセージのサイズはの大きさ、メッセージが BizTalk Server によって処理されるときに、最も明確に示します。</span><span class="sxs-lookup"><span data-stu-id="67bac-114">**Original message size** The size of the message received by BizTalk Server is the most visible indication of how large the message will be when it is processed by BizTalk Server.</span></span> <span data-ttu-id="67bac-115">メッセージの元のサイズは、メッセージ全体が、メッセージをメッセージ ボックス データベースにストリーミングされている場合よりもメモリに読み込まれている場合、パフォーマンスに大きな影響が。</span><span class="sxs-lookup"><span data-stu-id="67bac-115">The original size of a message has a much greater impact on performance if the entire message is loaded into memory than if the message is streamed to the MessageBox database.</span></span>  
  
- <span data-ttu-id="67bac-116">**メッセージ形式**で 2 つの主な形式のいずれかの BizTalk Server にメッセージを受信します。XML ファイルまたはフラット ファイル。</span><span class="sxs-lookup"><span data-stu-id="67bac-116">**Message format** Messages are received into BizTalk Server in one of two primary formats: XML files or flat files.</span></span>  
  
  -   <span data-ttu-id="67bac-117">**XML ファイル**BizTalk Server でパススルー ルーティング以外のメッセージに対する処理を実行するためには、メッセージは、XML ファイル形式である必要があります。</span><span class="sxs-lookup"><span data-stu-id="67bac-117">**XML files** In order for BizTalk Server to perform any processing on a message other than pass through routing, the message must be in the XML file format.</span></span> <span data-ttu-id="67bac-118">処理するファイルは、ほとんどの場合、元のサイズが保存されますし、XML 形式で受信されます。 場合、</span><span class="sxs-lookup"><span data-stu-id="67bac-118">If the files to be processed are received in XML format then they will retain their original size for the most part.</span></span>  
  
  -   <span data-ttu-id="67bac-119">**フラット ファイル**フラット ファイルは、BizTalk Server でパススルー ルーティング以外の処理を行う前に、XML 形式に解析する必要があります。</span><span class="sxs-lookup"><span data-stu-id="67bac-119">**Flat files** Flat files must be parsed into an XML format before BizTalk Server can perform any processing other than pass through routing.</span></span> <span data-ttu-id="67bac-120">XML ファイルでフラット ファイルを解析すると、ファイルのサイズが非常に大きくなる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="67bac-120">Parsing a flat file into an XML file can greatly increase the size of the file.</span></span> <span data-ttu-id="67bac-121">フラット ファイルには、データに関する説明情報を持つ XML タグが含まれません。</span><span class="sxs-lookup"><span data-stu-id="67bac-121">Flat files do not contain XML tags with descriptive information about their data.</span></span> <span data-ttu-id="67bac-122">一方、XML ファイルは、説明的な XML タグにすべてのデータを格納します。</span><span class="sxs-lookup"><span data-stu-id="67bac-122">XML files, on the other hand, wrap all of their data in descriptive XML tags.</span></span> <span data-ttu-id="67bac-123">一部のシナリオで解析サイズを増やし、フラット ファイルのファイルの XML タグに 10 個以上、に応じてどの程度わかりやすいデータが含まれているの倍数で。</span><span class="sxs-lookup"><span data-stu-id="67bac-123">In some scenarios parsing can increase the size of a flat file by a factor of 10 or more, depending on how much descriptive data is contained in the XML tags for the file.</span></span>  
  
  -   <span data-ttu-id="67bac-124">**フラット ファイル ドキュメントの XML ドキュメントの単一の CDATA セクション ノードでラップ**この種類のドキュメントは XML とフラット ファイルの両方の組み合わせと BizTalk Server を使用して、ラップされたフラット ファイル ドキュメント全体を前に、メモリに読み込む必要がありますので、問題が発生することができますこれを処理します。</span><span class="sxs-lookup"><span data-stu-id="67bac-124">**Flat file documents wrapped in a single CDATA section node in an XML document** This type of document is a combination of both XML and flat file and can be problematic because BizTalk Server must load the entire wrapped flat file document into memory before processing it.</span></span>  
  
- <span data-ttu-id="67bac-125">**メッセージ処理の種類**BizTalk Server では、2 つの種類のメッセージの処理。ルーティングのみとマッピングを選択します。</span><span class="sxs-lookup"><span data-stu-id="67bac-125">**Type of message processing** In BizTalk Server, there are two types of message processing: Routing only and Mapping.</span></span> <span data-ttu-id="67bac-126">されるメッセージ処理の種類に関連付けられているパフォーマンス変数には、メッセージのサイズと、メッセージをメモリに読み込まれるかどうかを実行します。</span><span class="sxs-lookup"><span data-stu-id="67bac-126">The performance variables tied to the type of message processing that is performed are message size and whether the message is loaded into memory.</span></span>  
  
  - <span data-ttu-id="67bac-127">**ルーティングのみ**場合の BizTalk Server は、昇格させたメッセージ プロパティに基づいてメッセージをルーティングのみ使用し、メッセージは、.NET XmlReader インターフェイスを使用してメッセージ ボックス データベースにストリーミング メッセージ部分が個別にはできませんメモリに読み込まれます。</span><span class="sxs-lookup"><span data-stu-id="67bac-127">**Routing only** If BizTalk Server is only used only for routing messages based upon promoted message properties, then the message is streamed into the Messagebox database using the .NET XmlReader interface, and message parts are not individually loaded into memory.</span></span> <span data-ttu-id="67bac-128">このシナリオでメモリ不足エラーが問題とならないと、主要な考慮事項は、メッセージ ボックス データベースに非常に大きいメッセージ (100 MB を超える) の書き込みに必要な時間。</span><span class="sxs-lookup"><span data-stu-id="67bac-128">In this scenario, out of memory errors are not an issue and the primary consideration is the amount of time that is required to write very large messages (over 100 MB) into the Messagebox database.</span></span> <span data-ttu-id="67bac-129">開発チームの処理をテストして正常に BizTalk Server は、ルーティングのみを実行するときに、最大 1 GB のサイズをメッセージです。</span><span class="sxs-lookup"><span data-stu-id="67bac-129">The BizTalk Server development team has successfully tested the processing of messages up to 1 GB in size when performing routing only.</span></span>  
  
     <span data-ttu-id="67bac-130">このシナリオでパフォーマンスを決定する主な要因は、**サイズの大きいメッセージのフラグメント サイズ**データベースにデータを分割するために使用します。</span><span class="sxs-lookup"><span data-stu-id="67bac-130">The primary factor that determines performance in this scenario is the **Large message fragment size** used to fragment the data into the database.</span></span> <span data-ttu-id="67bac-131">**サイズの大きいメッセージのフラグメント サイズ**で構成可能なオプションは、 **BizTalk グループのプロパティ**構成 ページで 102,400 バイト (100 KB) の既定値。</span><span class="sxs-lookup"><span data-stu-id="67bac-131">The **Large message fragment size** is a configurable option on the **BizTalk Group Properties** configuration page and has a default value of 102400 bytes (100 KB).</span></span> <span data-ttu-id="67bac-132">この値を増やすと、メッセージ ボックス データベースにメッセージをストリーミングするために必要なラウンド トリップの回数が減少します。</span><span class="sxs-lookup"><span data-stu-id="67bac-132">Increasing this value reduces the number of round trips required to stream a message into the MessageBox database.</span></span>  
  
  - <span data-ttu-id="67bac-133">**マッピング**メモリを消費する操作は、マップでドキュメントを変換します。</span><span class="sxs-lookup"><span data-stu-id="67bac-133">**Mapping** Transforming a document with a map can be a memory-intensive operation.</span></span> <span data-ttu-id="67bac-134">BizTalk Server が、.Net にメッセージを渡すマップでドキュメントが変換されるときに XSLCompileTransform クラスは、XSL スタイル シートを読み込みます。</span><span class="sxs-lookup"><span data-stu-id="67bac-134">When a document is transformed by a map, BizTalk Server passes the message to the .Net XSLCompileTransform class, which loads the XSL style sheet.</span></span> <span data-ttu-id="67bac-135">Load メソッドが正常に完了した後、変換メソッドが複数のスレッドから同時に呼び出すことができます。</span><span class="sxs-lookup"><span data-stu-id="67bac-135">After the Load method completes successfully, the Transform method can be called simultaneously from multiple threads.</span></span> <span data-ttu-id="67bac-136">[XslCompiledTransform クラス](http://go.microsoft.com/fwlink/p/?LinkID=282683)XSLCompiledTransform クラスについて詳しく説明します。</span><span class="sxs-lookup"><span data-stu-id="67bac-136">[XslCompiledTransform Class](http://go.microsoft.com/fwlink/p/?LinkID=282683) provides more information on the XSLCompiledTransform class.</span></span>  
  
     [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] <span data-ttu-id="67bac-137">変換中にメモリにドキュメントを読み込むための構成可能なメッセージ サイズのしきい値を実装することで、サイズの大きいドキュメントのメモリ管理を大幅に向上します。</span><span class="sxs-lookup"><span data-stu-id="67bac-137">significantly improves memory management for large documents by implementing a configurable message size threshold for loading documents into memory during transforms.</span></span> <span data-ttu-id="67bac-138">このしきい値よりも小さいサイズのすべてのメッセージがメモリ内で処理されます。このしきい値を超えるサイズのすべてのメッセージは、メモリ要件を軽減するファイル システムにバッファリングされます。</span><span class="sxs-lookup"><span data-stu-id="67bac-138">Any message with a size below this threshold is handled in memory; any message with a size above this threshold is buffered to the file system to reduce memory requirements.</span></span> <span data-ttu-id="67bac-139">既定のメッセージ サイズのしきい値は、1 MB です。</span><span class="sxs-lookup"><span data-stu-id="67bac-139">The default message size threshold is 1 MB.</span></span>  
  
## <a name="guidelines-for-processing-large-messages"></a><span data-ttu-id="67bac-140">サイズの大きいメッセージを処理するためのガイドライン</span><span class="sxs-lookup"><span data-stu-id="67bac-140">Guidelines for processing large messages</span></span>  
 <span data-ttu-id="67bac-141">BizTalk Server でサイズの大きいメッセージを処理するときに、パフォーマンスを向上させるためにこれらのガイドラインに従います。</span><span class="sxs-lookup"><span data-stu-id="67bac-141">Follow these guidelines to improve performance when processing large messages in BizTalk Server:</span></span>  
  
1. <span data-ttu-id="67bac-142">これを超えるバッファリングされるドキュメント、ファイル システムにマッピング中に、メッセージ サイズのしきい値を調整します。</span><span class="sxs-lookup"><span data-stu-id="67bac-142">Adjust the message size threshold above which documents are buffered to the file system during mapping.</span></span> <span data-ttu-id="67bac-143">という名前の DWORD 値を作成、サイズのしきい値を変更する**TransformThreshold** BizTalk Server レジストリの次の場所。</span><span class="sxs-lookup"><span data-stu-id="67bac-143">To modify the size threshold, create a DWORD value named **TransformThreshold** at the following location in the BizTalk Server registry:</span></span>  
  
   ```  
   HKLM\Software\Microsoft\BizTalk Server\3.0\Administration\TransformThreshold  
   ```  
  
    <span data-ttu-id="67bac-144">この値を作成した後に新しいしきい値を設定するバイト数を 10 進値を入力します。</span><span class="sxs-lookup"><span data-stu-id="67bac-144">After you have created this value, enter a decimal value with the number of bytes to set the new threshold to.</span></span> <span data-ttu-id="67bac-145">たとえば、2097152 (1 MB の既定値) から 2 MB に、メッセージ サイズのしきい値を上げるための 10 進値を入力します。</span><span class="sxs-lookup"><span data-stu-id="67bac-145">For example, enter a decimal value of 2097152 to increase the message size threshold to 2 MB (from the default of 1 MB).</span></span> <span data-ttu-id="67bac-146">大量のスループットを向上させるために使用可能なメモリを備えたシステムでは、この値を増やします。</span><span class="sxs-lookup"><span data-stu-id="67bac-146">Increase this value on systems with a large amount of available memory to improve throughput.</span></span> <span data-ttu-id="67bac-147">ドキュメントをディスクにバッファリングすると、全体的なスループットのコストでメモリを節約できます。</span><span class="sxs-lookup"><span data-stu-id="67bac-147">Buffering documents to disk conserves memory at a cost to overall throughput.</span></span>  
  
   > [!NOTE]
   >  <span data-ttu-id="67bac-148">既定では、マッピング中に、ファイル システムにバッファリングされるドキュメントに書かれて、 *%temp%* BizTalk Server コンピューターのディレクトリ。</span><span class="sxs-lookup"><span data-stu-id="67bac-148">By default, documents that are buffered to the file system during mapping are written to the *%temp%* directory of the BizTalk Server computer.</span></span> <span data-ttu-id="67bac-149">設定を変更、 *%temp%* マッピング中に、ファイル システムに大量のメッセージをバッファリングする場合は、パフォーマンスを向上させるためにシステム以外のディスクに環境変数。</span><span class="sxs-lookup"><span data-stu-id="67bac-149">Change the setting for the *%temp%* environment variable to a non-system disk to improve performance when buffering large messages to the file system during mapping.</span></span>  
  
2. <span data-ttu-id="67bac-150">オーケストレーションでマップの使用を最小限に抑えます。</span><span class="sxs-lookup"><span data-stu-id="67bac-150">Minimize the use of maps in orchestrations:</span></span>  
  
   -   <span data-ttu-id="67bac-151">抽出または使用するプロパティを設定するマップを使用している場合、オーケストレーションでビジネス ロジックは識別フィールドを使用して、または代わりに、昇格させたプロパティ。</span><span class="sxs-lookup"><span data-stu-id="67bac-151">If you are using a map to extract or set properties used with business logic in an orchestration, use distinguished fields or promoted properties instead.</span></span> <span data-ttu-id="67bac-152">抽出またはマップで値を設定するときは、メモリにドキュメントが読み込まれます。</span><span class="sxs-lookup"><span data-stu-id="67bac-152">When extracting or setting values with a map the document is loaded into memory.</span></span> <span data-ttu-id="67bac-153">識別フィールドまたは昇格させたプロパティを使用して、オーケストレーション エンジンがメッセージ コンテキストにアクセスして、ドキュメントをメモリに読み込まれません。</span><span class="sxs-lookup"><span data-stu-id="67bac-153">When using distinguished fields or promoted properties, the Orchestration engine accesses the message context and does not load the document into memory.</span></span>  
  
   -   <span data-ttu-id="67bac-154">いくつかのフィールドを 1 つのフィールドに集計を識別フィールドを使用して、マップを使用して結果セットを蓄積するオーケストレーション変数のプロパティを昇格するか。</span><span class="sxs-lookup"><span data-stu-id="67bac-154">If you are using a map to aggregate several fields into one field, use distinguished fields or promoted properties with an orchestration variable to accumulate the result set.</span></span>  
  
   -   <span data-ttu-id="67bac-155">複数の入力が変換図形でオーケストレーションを構成しないでください。</span><span class="sxs-lookup"><span data-stu-id="67bac-155">Do not configure an orchestration with multiple inputs to transform shapes.</span></span> <span data-ttu-id="67bac-156">変換図形の複数の入力を含むオーケストレーションは、マッピング中にファイル システムにストリーム配信されません。</span><span class="sxs-lookup"><span data-stu-id="67bac-156">An orchestration that contains multiple inputs to transform shapes will not stream to the file system while mapping.</span></span> <span data-ttu-id="67bac-157">この制限には、ドキュメントのサイズが指定した TransformThreshold レジストリ値を超えた場合に、メモリに読み込むにマップされているドキュメントの全体が発生します。</span><span class="sxs-lookup"><span data-stu-id="67bac-157">This limitation will cause the entire document that is being mapped to load into memory if the document size exceeds the specified TransformThreshold registry value.</span></span> <span data-ttu-id="67bac-158">オーケストレーション受け入れない変換図形の 1 つの入力よりも多くするため、この問題を回避するには、適用するには 1 つは受信ポートのレベルでは変換します。</span><span class="sxs-lookup"><span data-stu-id="67bac-158">One possible workaround to this issue would be to apply transforms at the receive port level so that the orchestration never accepts more than a single input to transform shapes.</span></span>  
  
3. <span data-ttu-id="67bac-159">調整、**サイズの大きいメッセージのフラグメント サイズ**プロパティで公開されている、 **BizTalk グループのプロパティ**構成 ページ。</span><span class="sxs-lookup"><span data-stu-id="67bac-159">Adjust the **Large message fragment size** property exposed on the **BizTalk Group Properties** configuration page:</span></span>  
  
    <span data-ttu-id="67bac-160">受信したメッセージのメモリ内サイズが指定されたバイト数を超えた場合**サイズの大きいメッセージのフラグメント サイズ**メッセージは、指定されたサイズのフラグメントに分割し、フラグメントは、メッセージ ボックス データベースに書き込まれます、。次のように、Microsoft 分散トランザクション コーディネーター (MSDTC) トランザクションのコンテキスト:</span><span class="sxs-lookup"><span data-stu-id="67bac-160">If the in-memory size of a received message exceeds the number of bytes specified for **Large message fragment size** then the message is split into fragments of the specified size and the fragments are written into the MessageBox under the context of a Microsoft Distributed Transaction Coordinator (MSDTC) transaction as follows:</span></span>  
  
   1.  <span data-ttu-id="67bac-161">受信メッセージは、既存の MSDTC トランザクションのコンテキストで公開されているが場合、は、メッセージ ボックスに、メッセージのフラグメントを書き込むときにし、このトランザクションは使用されます。</span><span class="sxs-lookup"><span data-stu-id="67bac-161">If the incoming message is being published under the context of an existing MSDTC transaction, then this transaction is used when writing the message fragments to the MessageBox.</span></span> <span data-ttu-id="67bac-162">たとえば、受信メッセージは、既存のトランザクションは、メッセージの書き込み時に、使用は、トランザクションを要求するように構成されたトランザクション アダプターによって公開されている場合は、メッセージ ボックスにフラグメントします。</span><span class="sxs-lookup"><span data-stu-id="67bac-162">For example if the incoming message is being published by a transactional adapter configured to require transactions then the existing transaction would be used when writing the message fragments to the MessageBox.</span></span>  
  
   2.  <span data-ttu-id="67bac-163">受信メッセージが既存の MSDTC トランザクションのコンテキストで公開されていない場合は、メッセージのフラグメントを記述する、新しい MSDTC トランザクションが作成されます。</span><span class="sxs-lookup"><span data-stu-id="67bac-163">If the incoming message is not being published under the context of an existing MSDTC transaction, then a new MSDTC transaction is created to write the message fragments.</span></span>  
  
   -   <span data-ttu-id="67bac-164">値を大きく**サイズの大きいメッセージのフラグメント サイズ**がサイズの大きいメッセージが断片化しているし、関連付けられた MSDTC トランザクションの作成の頻度を減らすの頻度を減らします。</span><span class="sxs-lookup"><span data-stu-id="67bac-164">Increase the value for **Large message fragment size** to reduce the frequency with which large messages are fragmented and reduce the incidence of creating the associated MSDTC transactions.</span></span> <span data-ttu-id="67bac-165">MSDTC トランザクションを使いすぎるとパフォーマンスの観点で無駄が多いため、この操作を実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="67bac-165">This should be done because excessive use of MSDTC transactions is expensive from a performance standpoint.</span></span> <span data-ttu-id="67bac-166">この値を大きくすると使用できるメモリの量も増える可能性があるので注意してください。</span><span class="sxs-lookup"><span data-stu-id="67bac-166">Note that increasing this value may also increase the amount of available memory that is used.</span></span>  
  
   -   <span data-ttu-id="67bac-167">場合は、トランザクションがタイムアウトになる、エラーが発生し、メッセージの書き込みに失敗すると、メッセージ ボックスにメッセージを記述する 60 分間の許容される MSDTC トランザクションの最大タイムアウトより長くかかるしはロールバックされます。</span><span class="sxs-lookup"><span data-stu-id="67bac-167">If it takes longer than the maximum allowable MSDTC transaction timeout of 60 minutes to write a message to the MessageBox, then the transaction times out, an error results, and the attempt to write the message fails and is rolled back.</span></span> <span data-ttu-id="67bac-168">**サイズの大きいメッセージのフラグメント サイズ**値は非常に大きなメッセージを処理するときに、この問題を回避するために大ききます。</span><span class="sxs-lookup"><span data-stu-id="67bac-168">The **Large message fragment size** value should be increased enough to avoid this problem when processing very large messages.</span></span> <span data-ttu-id="67bac-169">使用できるメモリの量に応じて、この値を最大値 1000000 バイトに設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="67bac-169">Depending on available memory, this value should be increased up to a maximum value of 1000000 bytes.</span></span>  
  
   -   <span data-ttu-id="67bac-170">メッセージの各フラグメントは、メッセージ ボックス データベースに対して 1 つ以上の SQL Server データベース ロックを作成します。</span><span class="sxs-lookup"><span data-stu-id="67bac-170">Each message fragment in a message creates one or more SQL Server database locks against the MessageBox database.</span></span> <span data-ttu-id="67bac-171">ロックの数が数十万を超える場合は、"ロック"の範囲外のエラーを生成する SQL Server が起動することができます。</span><span class="sxs-lookup"><span data-stu-id="67bac-171">When the number of locks exceeds several hundred thousand, it is possible that SQL Server will start generating “out of lock” errors.</span></span> <span data-ttu-id="67bac-172">この問題が発生した場合の向上、**サイズの大きいメッセージのフラグメント サイズ**メッセージ ボックス データベースに対して行われた SQL Server データベース ロックの数を減らします。</span><span class="sxs-lookup"><span data-stu-id="67bac-172">If this problem occurs, increase the **Large message fragment size** to reduce the number of SQL Server database locks made against the MessageBox database.</span></span>  
  
4. <span data-ttu-id="67bac-173">"ロック"の範囲外のエラーが発生した場合、64 ビット バージョンの SQL Server でメッセージ ボックス データベースを格納していることを検討してください。</span><span class="sxs-lookup"><span data-stu-id="67bac-173">Consider housing your MessageBox database on a 64-bit version of SQL Server if you are experiencing "out of lock" errors.</span></span> <span data-ttu-id="67bac-174">使用可能なロックの数は、64 ビット バージョンの SQL Server で大幅に高くなっています。</span><span class="sxs-lookup"><span data-stu-id="67bac-174">The number of available locks is significantly higher on the 64-bit version of SQL Server.</span></span>  
  
5. <span data-ttu-id="67bac-175">調整、**サイズの大きいメッセージのしきい値**プロパティで公開されている、 **BizTalk グループのプロパティ**構成 ページ。</span><span class="sxs-lookup"><span data-stu-id="67bac-175">Adjust the **Large message threshold** property exposed on the **BizTalk Group Properties** configuration page:</span></span>  
  
    <span data-ttu-id="67bac-176">メッセージ バッチのメモリ内サイズが指定されたバイト数に達した場合、メッセージとしてバッチが処理は**サイズの大きいメッセージのしきい値**が処理されたメッセージのバッチの部分が前に、メッセージ ボックス データベースに書き込まれますメッセージ バッチの残りの部分が処理されます。</span><span class="sxs-lookup"><span data-stu-id="67bac-176">As a message batch is processed, if the in-memory size of a message batch reaches the number of bytes specified for **Large message threshold** then the portion of the message batch that has been processed is written to the MessageBox before the remainder of the message batch is processed.</span></span> <span data-ttu-id="67bac-177">これは、MSDTC トランザクションのコンテキストで、次のように。</span><span class="sxs-lookup"><span data-stu-id="67bac-177">This is done under the context of an MSDTC transaction as follows:</span></span>  
  
   1. <span data-ttu-id="67bac-178">メッセージ バッチは、既存の MSDTC トランザクションのコンテキストで公開されているが場合、は、メッセージ バッチの処理部分をメッセージ ボックス データベースに書き込むときに、このトランザクションは使用されます。</span><span class="sxs-lookup"><span data-stu-id="67bac-178">If the message batch is being published under the context of an existing MSDTC transaction, then this transaction is used when writing the processed portion of the message batch to the MessageBox.</span></span> <span data-ttu-id="67bac-179">受信メッセージ バッチはトランザクションし、既存のトランザクションを要求するように構成されたトランザクション アダプターによって公開されている場合の例は、メッセージ ボックスに、メッセージ バッチの処理部分を記述するときに使用されます。</span><span class="sxs-lookup"><span data-stu-id="67bac-179">For example if the incoming message batch is being published by a transactional adapter configured to require transactions then the existing transaction would be used when writing the processed portion of the message batch to the MessageBox.</span></span>  
  
   2. <span data-ttu-id="67bac-180">メッセージ バッチが既存の MSDTC トランザクションのコンテキストで公開されていない場合、メッセージ ボックスに、メッセージ バッチの部分を記述する、新しい MSDTC トランザクションを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="67bac-180">If the message batch is not being published under the context of an existing MSDTC transaction, then a new MSDTC transaction must be created to write the portions of the message batch to the MessageBox.</span></span> <span data-ttu-id="67bac-181">MSDTC トランザクションを使用して、特定のメッセージ バッチの各部分のすべてが正常に書き込まれるように、メッセージ ボックス データベースにします。</span><span class="sxs-lookup"><span data-stu-id="67bac-181">The MSDTC transaction is used to ensure that all of the portions of a given message batch are successfully written to the MessageBox database.</span></span>  
  
      <span data-ttu-id="67bac-182">**サイズの大きいメッセージのしきい値**設定は、メッセージのバッチに直接適用できますが、メッセージ バッチは、1 つの値に設定することができます、**サイズの大きいメッセージのしきい値**設定解除することも直接個々 のメッセージに適用されます。</span><span class="sxs-lookup"><span data-stu-id="67bac-182">The **Large message threshold** setting is directly applicable to message batches but since a message batch can be set to a value of one, the **Large message threshold** setting can also be indirectly applicable to individual messages.</span></span> <span data-ttu-id="67bac-183">たとえば 1 つのメッセージのメッセージのバッチを超える場合、指定した**サイズの大きいメッセージのしきい値**パラメーター、**サイズの大きいメッセージのしきい値**バッチ内の 1 つのメッセージにのみ有効で適用されます。</span><span class="sxs-lookup"><span data-stu-id="67bac-183">For example when a message batch of one message exceeds the specified **Large message threshold** parameter then the **Large message threshold** in effect applies only to the single message in the batch.</span></span>  
  
   -   <span data-ttu-id="67bac-184">**サイズの大きいメッセージのしきい値**パラメーターは、メッセージ ボックスにメッセージのバッチを割り当てるために使用される MSDTC トランザクションの作成を軽減するために調整する必要があります。</span><span class="sxs-lookup"><span data-stu-id="67bac-184">The **Large message threshold** parameter should be adjusted to mitigate the creation of MSDTC transactions used to apportion message batches to the MessageBox.</span></span> <span data-ttu-id="67bac-185">MSDTC トランザクションの過剰な使用はパフォーマンスの観点からコストの高いために、これを実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="67bac-185">This should be done because the excessive use of MSDTC transactions is expensive from a performance standpoint.</span></span> <span data-ttu-id="67bac-186">最小値を決定する次の計算を使用して、**サイズの大きいメッセージのしきい値**設定は、MSDTC トランザクションを不必要に作成しないようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="67bac-186">Use the following calculation to determine what the minimum value for the **Large message threshold** setting should be to avoid unnecessarily creating MSDTC transactions:</span></span>  
  
       ```  
       Batch Size * Average size (in bytes) of each message in the batch after being processed by the receive pipeline < Large message threshold  
       ```  
  
        <span data-ttu-id="67bac-187">メッセージ バッチのバイト単位の合計サイズが指定された値を超えない限り、**サイズの大きいメッセージのしきい値**メッセージ ボックスに、メッセージ バッチを分配するために BizTalk で、MSDTC トランザクションを開始する必要はありませんデータベース。</span><span class="sxs-lookup"><span data-stu-id="67bac-187">As long as the total size in bytes of a message batch does not exceed the specified value for **Large message threshold** then there is no need for BizTalk to initiate an MSDTC transaction to apportion the message batch to the MessageBox database.</span></span>