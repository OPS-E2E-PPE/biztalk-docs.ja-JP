---
title: BizTalk Server がサイズの大きいメッセージを処理する方法 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 62c070be-dff5-4349-9e36-dd3a7caf1752
caps.latest.revision: 33
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: f17509983e7eab7b8743c8036c429c886b0b9265
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/27/2018
ms.locfileid: "37016529"
---
# <a name="how-biztalk-server-processes-large-messages"></a><span data-ttu-id="c0a1c-102">BizTalk Server がサイズの大きなメッセージを処理する方法</span><span class="sxs-lookup"><span data-stu-id="c0a1c-102">How BizTalk Server Processes Large Messages</span></span>
## <a name="what-is-a-large-message"></a><span data-ttu-id="c0a1c-103">サイズの大きなメッセージとは何ですか?</span><span class="sxs-lookup"><span data-stu-id="c0a1c-103">What is a large message?</span></span>  
 <span data-ttu-id="c0a1c-104">残念ながら、この質問に対しては、具体的なメッセージ サイズを直接回答することはできません。Microsoft [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] システムの個々のボトルネックによって回答は変わります。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-104">Unfortunately, the answer to this question isn't tied directly to a specific message size, but rather, depends on specific bottlenecks in your Microsoft [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] system.</span></span> <span data-ttu-id="c0a1c-105">サイズの大きなメッセージに関係する問題は、次のカテゴリに分類できます。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-105">The problems associated with large messages can be divided into the following categories:</span></span>  
  
-   <span data-ttu-id="c0a1c-106">**メモリ不足エラー**特定種類のマッピング、検証、およびプロパティの昇格などのメッセージの処理がメモリにメッセージ全体を読み込みます。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-106">**Out of memory errors** Certain types of message processing - such as mapping, validation, and property promotion - load the entire message into memory.</span></span> <span data-ttu-id="c0a1c-107">メモリのメッセージのサイズが使用できるリソースを超えると、メモリ不足のエラーが発生します。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-107">If the size of the message in memory exceeds available resources, then an out of memory error occurs.</span></span> <span data-ttu-id="c0a1c-108">このカテゴリに分類されるメッセージのサイズのしきい値は、メモリに読み込まれないメッセージのサイズのしきい値よりも大幅に小さくなります。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-108">The size threshold for messages that fall into this category is much lower than the size threshold for messages that are not loaded into memory.</span></span> <span data-ttu-id="c0a1c-109">たとえば、XML に解析されてマップされる 10 MB のフラット ファイルは、10 倍以上大きくなって 100 MB 以上のメモリを使用する場合があります。一方、解析されないでマップされる 100 MB の XML ドキュメントは、メッセージ ボックス データベースにストリーム送信される際に 1 MB のメモリのみ使用します。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-109">For example, a 10 MB flat file that is parsed into XML and then mapped may grow by a factor of 10 or more to consume over 100 MB of memory, whereas a 100 MB XML document that is not parsed or mapped may actually only consume 1 MB of memory as it is streamed to the MessageBox database.</span></span>  
  
-   <span data-ttu-id="c0a1c-110">**パフォーマンスの問題をメモリに読み込まれていないメッセージ**メモリに読み込まれる必要がないメッセージは、.NET XmlReader インターフェイスを使用して、メッセージ ボックス データベースにストリーム送信されます。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-110">**Performance problems for messages that are not loaded into memory** Messages that are not required to be loaded into memory are streamed to the MessageBox database using the .NET XmlReader interface.</span></span> <span data-ttu-id="c0a1c-111">メモリに読み込む必要のあるメッセージのようなサイズ制限はありません。その一方で、メッセージ ボックス データベースにストリーム送信されるメッセージを BizTalk Server が処理する方法に影響する重要な要因がいくつかあります。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-111">While they are not subject to the size limitations on messages that must be loaded into memory, there are some important factors that impact how BizTalk Server processes messages that are streamed to the MessageBox database.</span></span>  
  
## <a name="factors-that-affect-the-processing-of-large-messages"></a><span data-ttu-id="c0a1c-112">サイズの大きなメッセージの処理に影響を及ぼす要因</span><span class="sxs-lookup"><span data-stu-id="c0a1c-112">Factors that affect the processing of large messages</span></span>  
 <span data-ttu-id="c0a1c-113">元のメッセージのサイズ、メッセージ形式、およびメッセージ処理の種類は、すべて BizTalk Server がサイズの大きなメッセージを処理する方法に影響を与えます。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-113">The original message size, message format, and type of message processing all affect how BizTalk Server processes large messages.</span></span>  
  
- <span data-ttu-id="c0a1c-114">**元のメッセージ サイズ**BizTalk Server で受信メッセージのサイズはの大きさ、メッセージが BizTalk Server によって処理されるときに、最も明確に示します。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-114">**Original message size** The size of the message received by BizTalk Server is the most visible indication of how large the message will be when it is processed by BizTalk Server.</span></span> <span data-ttu-id="c0a1c-115">メッセージの元のサイズは、メッセージがメッセージ ボックス データベースにストリーム送信される場合よりもメッセージ全体がメモリに読み込まれる場合に、パフォーマンスに大きな影響を及ぼします。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-115">The original size of a message has a much greater impact on performance if the entire message is loaded into memory than if the message is streamed to the MessageBox database.</span></span>  
  
- <span data-ttu-id="c0a1c-116">**メッセージ形式**で 2 つの主な形式のいずれかの BizTalk Server にメッセージを受信する: XML ファイルまたはフラット ファイル。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-116">**Message format** Messages are received into BizTalk Server in one of two primary formats: XML files or flat files.</span></span>  
  
  -   <span data-ttu-id="c0a1c-117">**XML ファイル**BizTalk Server でパススルー ルーティング以外のメッセージに対する処理を実行するためには、メッセージは、XML ファイル形式である必要があります。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-117">**XML files** In order for BizTalk Server to perform any processing on a message other than pass through routing, the message must be in the XML file format.</span></span> <span data-ttu-id="c0a1c-118">処理対象のファイルを XML 形式で受信すると、ほとんどの場合、元のサイズが保存されます。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-118">If the files to be processed are received in XML format then they will retain their original size for the most part.</span></span>  
  
  -   <span data-ttu-id="c0a1c-119">**フラット ファイル**フラット ファイルは、BizTalk Server でパススルー ルーティング以外の処理を行う前に、XML 形式に解析する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-119">**Flat files** Flat files must be parsed into an XML format before BizTalk Server can perform any processing other than pass through routing.</span></span> <span data-ttu-id="c0a1c-120">XML ファイルでフラット ファイルを解析すると、ファイルのサイズが非常に大きくなる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-120">Parsing a flat file into an XML file can greatly increase the size of the file.</span></span> <span data-ttu-id="c0a1c-121">フラット ファイルには、データに関する説明情報を持つ XML タグが含まれません。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-121">Flat files do not contain XML tags with descriptive information about their data.</span></span> <span data-ttu-id="c0a1c-122">一方、XML ファイルは、説明的な XML タグにすべてのデータを格納します。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-122">XML files, on the other hand, wrap all of their data in descriptive XML tags.</span></span> <span data-ttu-id="c0a1c-123">一部のシナリオでは、解析を行うと、ファイルの XML タグに含まれる説明的なデータの量に応じて、フラット ファイルのサイズが 10 倍以上大きくなる場合があります。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-123">In some scenarios parsing can increase the size of a flat file by a factor of 10 or more, depending on how much descriptive data is contained in the XML tags for the file.</span></span>  
  
  -   <span data-ttu-id="c0a1c-124">**フラット ファイル ドキュメントの XML ドキュメントの単一の CDATA セクション ノードでラップ**この種類のドキュメントは XML とフラット ファイルの両方の組み合わせと BizTalk Server を使用して、ラップされたフラット ファイル ドキュメント全体を前に、メモリに読み込む必要がありますので、問題が発生することができますこれを処理します。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-124">**Flat file documents wrapped in a single CDATA section node in an XML document** This type of document is a combination of both XML and flat file and can be problematic because BizTalk Server must load the entire wrapped flat file document into memory before processing it.</span></span>  
  
- <span data-ttu-id="c0a1c-125">**メッセージ処理の種類**BizTalk Server では、2 つの種類のメッセージの処理: ルーティングのみとマッピングします。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-125">**Type of message processing** In BizTalk Server, there are two types of message processing: Routing only and Mapping.</span></span> <span data-ttu-id="c0a1c-126">実行されるメッセージ処理の種類に関連付けられるパフォーマンス変数は、メッセージのサイズとメッセージをメモリに読み込むかどうかです。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-126">The performance variables tied to the type of message processing that is performed are message size and whether the message is loaded into memory.</span></span>  
  
  - <span data-ttu-id="c0a1c-127">**ルーティングのみ**場合の BizTalk Server は、昇格させたメッセージ プロパティに基づいてメッセージをルーティングのみ使用し、メッセージは、.NET XmlReader インターフェイスを使用してメッセージ ボックス データベースにストリーミング メッセージ部分が個別にはできませんメモリに読み込まれます。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-127">**Routing only** If BizTalk Server is only used only for routing messages based upon promoted message properties, then the message is streamed into the Messagebox database using the .NET XmlReader interface, and message parts are not individually loaded into memory.</span></span> <span data-ttu-id="c0a1c-128">このシナリオでメモリ不足エラーが問題とならないと、主要な考慮事項は、メッセージ ボックス データベースに非常に大きいメッセージ (100 MB を超える) の書き込みに必要な時間。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-128">In this scenario, out of memory errors are not an issue and the primary consideration is the amount of time that is required to write very large messages (over 100 MB) into the Messagebox database.</span></span> <span data-ttu-id="c0a1c-129">BizTalk Server 開発チームでは、ルーティングのみを行う場合に、最大 1 GB までメッセージを処理できることを確認しています。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-129">The BizTalk Server development team has successfully tested the processing of messages up to 1 GB in size when performing routing only.</span></span>  
  
     <span data-ttu-id="c0a1c-130">このシナリオでパフォーマンスを決定する主な要因は、**サイズの大きいメッセージのフラグメント サイズ**データベースにデータを分割するために使用します。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-130">The primary factor that determines performance in this scenario is the **Large message fragment size** used to fragment the data into the database.</span></span> <span data-ttu-id="c0a1c-131">**サイズの大きいメッセージのフラグメント サイズ**で構成可能なオプションは、 **BizTalk グループのプロパティ**構成 ページで 102,400 バイト (100 KB) の既定値。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-131">The **Large message fragment size** is a configurable option on the **BizTalk Group Properties** configuration page and has a default value of 102400 bytes (100 KB).</span></span> <span data-ttu-id="c0a1c-132">この値を大きくすると、メッセージをメッセージ ボックス データベースにストリーム送信するために必要なラウンド トリップの回数が少なくなります。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-132">Increasing this value reduces the number of round trips required to stream a message into the MessageBox database.</span></span>  
  
  - <span data-ttu-id="c0a1c-133">**マッピング**メモリを消費する操作は、マップでドキュメントを変換します。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-133">**Mapping** Transforming a document with a map can be a memory-intensive operation.</span></span> <span data-ttu-id="c0a1c-134">マップでドキュメントを変換すると、BizTalk Server は、メッセージを .Net XSLCompileTransform クラスに渡します。このクラスは XSL スタイル シートを読み込みます。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-134">When a document is transformed by a map, BizTalk Server passes the message to the .Net XSLCompileTransform class, which loads the XSL style sheet.</span></span> <span data-ttu-id="c0a1c-135">Load メソッドが正常に完了すると、複数のスレッドから同時に Transform を呼び出すことができます。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-135">After the Load method completes successfully, the Transform method can be called simultaneously from multiple threads.</span></span> <span data-ttu-id="c0a1c-136">[XslCompiledTransform クラス](http://go.microsoft.com/fwlink/p/?LinkID=282683)XSLCompiledTransform クラスについて詳しく説明します。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-136">[XslCompiledTransform Class](http://go.microsoft.com/fwlink/p/?LinkID=282683) provides more information on the XSLCompiledTransform class.</span></span>  
  
     [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="c0a1c-137"> は、変換中にドキュメントをメモリに読み込むための構成可能なメッセージ サイズのしきい値を設定して、サイズの大きなドキュメントのメモリ管理を大幅に改善します。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-137"> significantly improves memory management for large documents by implementing a configurable message size threshold for loading documents into memory during transforms.</span></span> <span data-ttu-id="c0a1c-138">このしきい値よりも小さいサイズのメッセージは、メモリで処理されます。このしきい値よりも大きいサイズのメッセージは、メモリの要件を減らすためにファイル システムにバッファリングされます。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-138">Any message with a size below this threshold is handled in memory; any message with a size above this threshold is buffered to the file system to reduce memory requirements.</span></span> <span data-ttu-id="c0a1c-139">既定のメッセージ サイズのしきい値は 1 MB です。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-139">The default message size threshold is 1 MB.</span></span>  
  
## <a name="guidelines-for-processing-large-messages"></a><span data-ttu-id="c0a1c-140">サイズの大きなメッセージを処理するためのガイドライン</span><span class="sxs-lookup"><span data-stu-id="c0a1c-140">Guidelines for processing large messages</span></span>  
 <span data-ttu-id="c0a1c-141">BizTalk Server でサイズの大きなメッセージを処理する場合は、これらのガイドラインに従って、パフォーマンスを高めます。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-141">Follow these guidelines to improve performance when processing large messages in BizTalk Server:</span></span>  
  
1. <span data-ttu-id="c0a1c-142">マッピング中にファイル システムにバッファリングされるドキュメントのメッセージ サイズのしきい値を大きくします。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-142">Adjust the message size threshold above which documents are buffered to the file system during mapping.</span></span> <span data-ttu-id="c0a1c-143">という名前の DWORD 値を作成、サイズのしきい値を変更する**TransformThreshold** BizTalk Server レジストリの次の場所。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-143">To modify the size threshold, create a DWORD value named **TransformThreshold** at the following location in the BizTalk Server registry:</span></span>  
  
   ```  
   HKLM\Software\Microsoft\BizTalk Server\3.0\Administration\TransformThreshold  
   ```  
  
    <span data-ttu-id="c0a1c-144">この値を作成した後、バイト数を 10 進数で入力して、新しいしきい値を設定します。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-144">After you have created this value, enter a decimal value with the number of bytes to set the new threshold to.</span></span> <span data-ttu-id="c0a1c-145">たとえば、10 進数値 2097152 を入力して、メッセージ サイズのしきい値を既定値の 1 MB から 2 MB に増やします。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-145">For example, enter a decimal value of 2097152 to increase the message size threshold to 2 MB (from the default of 1 MB).</span></span> <span data-ttu-id="c0a1c-146">スループットを向上させるため、使用できるメモリ容量が大きいシステムではこの値を大きくしてください。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-146">Increase this value on systems with a large amount of available memory to improve throughput.</span></span> <span data-ttu-id="c0a1c-147">ドキュメントをディスクにバッファリングすると、全体のスループットに対してメモリが節約されます。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-147">Buffering documents to disk conserves memory at a cost to overall throughput.</span></span>  
  
   > [!NOTE]
   >  <span data-ttu-id="c0a1c-148">既定では、マッピング中に、ファイル システムにバッファリングされるドキュメントに書かれて、 *%temp%* BizTalk Server コンピューターのディレクトリ。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-148">By default, documents that are buffered to the file system during mapping are written to the *%temp%* directory of the BizTalk Server computer.</span></span> <span data-ttu-id="c0a1c-149">設定を変更、 *%temp%* マッピング中に、ファイル システムに大量のメッセージをバッファリングする場合は、パフォーマンスを向上させるためにシステム以外のディスクに環境変数。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-149">Change the setting for the *%temp%* environment variable to a non-system disk to improve performance when buffering large messages to the file system during mapping.</span></span>  
  
2. <span data-ttu-id="c0a1c-150">オーケストレーションでのマップの使用を最小限に抑えます。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-150">Minimize the use of maps in orchestrations:</span></span>  
  
   -   <span data-ttu-id="c0a1c-151">マップを使用して、オーケストレーションのビジネス ロジックで使用するプロパティの抽出または設定を行っている場合、識別フィールドまたは昇格させたプロパティを代わりに使用してください。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-151">If you are using a map to extract or set properties used with business logic in an orchestration, use distinguished fields or promoted properties instead.</span></span> <span data-ttu-id="c0a1c-152">マップで値を抽出または設定する場合、ドキュメントがメモリに読み込まれます。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-152">When extracting or setting values with a map the document is loaded into memory.</span></span> <span data-ttu-id="c0a1c-153">識別フィールドまたは昇格させたプロパティを使用すると、オーケストレーション エンジンは、メッセージ コンテキストにアクセスするので、ドキュメントはメモリに読み込まれません。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-153">When using distinguished fields or promoted properties, the Orchestration engine accesses the message context and does not load the document into memory.</span></span>  
  
   -   <span data-ttu-id="c0a1c-154">マップを使用して、複数のフィールドを 1 つのフィールドで集計している場合、識別フィールドまたはオーケストレーションの変数が設定されている昇格したプロパティを使用して、結果セットを累積してください。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-154">If you are using a map to aggregate several fields into one field, use distinguished fields or promoted properties with an orchestration variable to accumulate the result set.</span></span>  
  
   -   <span data-ttu-id="c0a1c-155">オーケストレーションの変換図形は、複数の入力を含めた構成にしないでください。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-155">Do not configure an orchestration with multiple inputs to transform shapes.</span></span> <span data-ttu-id="c0a1c-156">複数の入力が含まれているオーケストレーションの変換図形では、マッピング中にファイル システムへのストリーム送信が行われません。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-156">An orchestration that contains multiple inputs to transform shapes will not stream to the file system while mapping.</span></span> <span data-ttu-id="c0a1c-157">この制限により、ドキュメント サイズが指定した TransformThreshold レジストリ値を超えた場合に、ドキュメント全体がメモリに読み込むためにマップされている状態になります。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-157">This limitation will cause the entire document that is being mapped to load into memory if the document size exceeds the specified TransformThreshold registry value.</span></span> <span data-ttu-id="c0a1c-158">この問題を回避する手段の 1 つとしては、オーケストレーションの変換図形で複数の入力を受け入れないよう、変換を受信ポート レベル内で適用するという方法があります。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-158">One possible workaround to this issue would be to apply transforms at the receive port level so that the orchestration never accepts more than a single input to transform shapes.</span></span>  
  
3. <span data-ttu-id="c0a1c-159">調整、**サイズの大きいメッセージのフラグメント サイズ**プロパティで公開されている、 **BizTalk グループのプロパティ**構成 ページ。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-159">Adjust the **Large message fragment size** property exposed on the **BizTalk Group Properties** configuration page:</span></span>  
  
    <span data-ttu-id="c0a1c-160">受信したメッセージのメモリ内サイズが指定されたバイト数を超えた場合**サイズの大きいメッセージのフラグメント サイズ**メッセージは、指定されたサイズのフラグメントに分割し、フラグメントは、メッセージ ボックス データベースに書き込まれます、。次のように、Microsoft 分散トランザクション コーディネーター (MSDTC) トランザクションのコンテキスト:</span><span class="sxs-lookup"><span data-stu-id="c0a1c-160">If the in-memory size of a received message exceeds the number of bytes specified for **Large message fragment size** then the message is split into fragments of the specified size and the fragments are written into the MessageBox under the context of a Microsoft Distributed Transaction Coordinator (MSDTC) transaction as follows:</span></span>  
  
   1.  <span data-ttu-id="c0a1c-161">受信メッセージが既存の MSDTC トランザクションのコンテキストで公開されている場合、メッセージのフラグメントをメッセージ ボックス データベースに書き込む際、このトランザクションが使用されます。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-161">If the incoming message is being published under the context of an existing MSDTC transaction, then this transaction is used when writing the message fragments to the MessageBox.</span></span> <span data-ttu-id="c0a1c-162">たとえば、トランザクション処理のために構成されたトランザクション アダプターによって受信メッセージが公開されている場合、メッセージのフラグメントをメッセージ ボックス データベースに書き込む際、既存のトランザクションが使用されます。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-162">For example if the incoming message is being published by a transactional adapter configured to require transactions then the existing transaction would be used when writing the message fragments to the MessageBox.</span></span>  
  
   2.  <span data-ttu-id="c0a1c-163">受信メッセージが既存の MSDTC トランザクションのコンテキストで公開されていない場合、メッセージのフラグメントを書き込むため、新しい MSDTC トランザクションが作成されます。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-163">If the incoming message is not being published under the context of an existing MSDTC transaction, then a new MSDTC transaction is created to write the message fragments.</span></span>  
  
   -   <span data-ttu-id="c0a1c-164">値を大きく**サイズの大きいメッセージのフラグメント サイズ**がサイズの大きいメッセージが断片化しているし、関連付けられた MSDTC トランザクションの作成の頻度を減らすの頻度を減らします。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-164">Increase the value for **Large message fragment size** to reduce the frequency with which large messages are fragmented and reduce the incidence of creating the associated MSDTC transactions.</span></span> <span data-ttu-id="c0a1c-165">MSDTC トランザクションを使いすぎるとパフォーマンスの観点で無駄が多いため、この操作を実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-165">This should be done because excessive use of MSDTC transactions is expensive from a performance standpoint.</span></span> <span data-ttu-id="c0a1c-166">この値を大きくすると使用できるメモリの量も増える可能性があるので注意してください。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-166">Note that increasing this value may also increase the amount of available memory that is used.</span></span>  
  
   -   <span data-ttu-id="c0a1c-167">メッセージをメッセージ ボックス データベースに書き込む時間が MSDTC トランザクション タイムアウトの最大許容値の 60 分を超えると、トランザクションがタイムアウトになり、エラーが発生します。また、メッセージの書き込みが失敗し、ロールバックされます。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-167">If it takes longer than the maximum allowable MSDTC transaction timeout of 60 minutes to write a message to the MessageBox, then the transaction times out, an error results, and the attempt to write the message fails and is rolled back.</span></span> <span data-ttu-id="c0a1c-168">**サイズの大きいメッセージのフラグメント サイズ**値は非常に大きなメッセージを処理するときに、この問題を回避するために大ききます。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-168">The **Large message fragment size** value should be increased enough to avoid this problem when processing very large messages.</span></span> <span data-ttu-id="c0a1c-169">使用できるメモリの量に応じて、この値を最大値 1000000 バイトに設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-169">Depending on available memory, this value should be increased up to a maximum value of 1000000 bytes.</span></span>  
  
   -   <span data-ttu-id="c0a1c-170">メッセージの各フラグメントは、メッセージ ボックス データベースに対して 1 つ以上の SQL Server データベース ロックを作成します。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-170">Each message fragment in a message creates one or more SQL Server database locks against the MessageBox database.</span></span> <span data-ttu-id="c0a1c-171">ロックの数が数十万を超えると、SQL Server が "ロックの範囲外" エラーを生成する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-171">When the number of locks exceeds several hundred thousand, it is possible that SQL Server will start generating “out of lock” errors.</span></span> <span data-ttu-id="c0a1c-172">この問題が発生した場合の向上、**サイズの大きいメッセージのフラグメント サイズ**メッセージ ボックス データベースに対して行われた SQL Server データベース ロックの数を減らします。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-172">If this problem occurs, increase the **Large message fragment size** to reduce the number of SQL Server database locks made against the MessageBox database.</span></span>  
  
4. <span data-ttu-id="c0a1c-173">"ロックの範囲外" エラーが発生した場合、64 ビット バージョンの SQL Server でメッセージ ボックス データベースを使用することを検討してください。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-173">Consider housing your MessageBox database on a 64-bit version of SQL Server if you are experiencing "out of lock" errors.</span></span> <span data-ttu-id="c0a1c-174">64 ビット バージョンの SQL Server では、使用できるロックの数が大幅に増えます。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-174">The number of available locks is significantly higher on the 64-bit version of SQL Server.</span></span>  
  
5. <span data-ttu-id="c0a1c-175">調整、**サイズの大きいメッセージのしきい値**プロパティで公開されている、 **BizTalk グループのプロパティ**構成 ページ。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-175">Adjust the **Large message threshold** property exposed on the **BizTalk Group Properties** configuration page:</span></span>  
  
    <span data-ttu-id="c0a1c-176">メッセージ バッチのメモリ内サイズが指定されたバイト数に達した場合、メッセージとしてバッチが処理は**サイズの大きいメッセージのしきい値**が処理されたメッセージのバッチの部分が前に、メッセージ ボックス データベースに書き込まれますメッセージ バッチの残りの部分が処理されます。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-176">As a message batch is processed, if the in-memory size of a message batch reaches the number of bytes specified for **Large message threshold** then the portion of the message batch that has been processed is written to the MessageBox before the remainder of the message batch is processed.</span></span> <span data-ttu-id="c0a1c-177">次のように、MSDTC トランザクションのコンテキストでこの処理が実行されます。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-177">This is done under the context of an MSDTC transaction as follows:</span></span>  
  
   1. <span data-ttu-id="c0a1c-178">メッセージ バッチが既存の MSDTC トランザクションのコンテキストで公開されている場合、メッセージ バッチの処理部分をメッセージ ボックス データベースに書き込む際、このトランザクションが使用されます。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-178">If the message batch is being published under the context of an existing MSDTC transaction, then this transaction is used when writing the processed portion of the message batch to the MessageBox.</span></span> <span data-ttu-id="c0a1c-179">たとえば、トランザクション処理のために構成されたトランザクション アダプターによって受信メッセージ バッチが公開されている場合、メッセージ バッチの処理部分をメッセージ ボックス データベースに書き込む際、既存のトランザクションが使用されます。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-179">For example if the incoming message batch is being published by a transactional adapter configured to require transactions then the existing transaction would be used when writing the processed portion of the message batch to the MessageBox.</span></span>  
  
   2. <span data-ttu-id="c0a1c-180">メッセージ バッチが既存の MSDTC トランザクションのコンテキストで公開されていない場合、メッセージ バッチの部分をメッセージ ボックス データベースに書き込むため、新しい MSDTC トランザクションを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-180">If the message batch is not being published under the context of an existing MSDTC transaction, then a new MSDTC transaction must be created to write the portions of the message batch to the MessageBox.</span></span> <span data-ttu-id="c0a1c-181">MSDTC トランザクションを使用すると、特定のメッセージ バッチのすべての部分がメッセージ ボックス データベースに正常に書き込まれます。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-181">The MSDTC transaction is used to ensure that all of the portions of a given message batch are successfully written to the MessageBox database.</span></span>  
  
      <span data-ttu-id="c0a1c-182">**サイズの大きいメッセージのしきい値**設定は、メッセージのバッチに直接適用できますが、メッセージ バッチは、1 つの値に設定することができます、**サイズの大きいメッセージのしきい値**設定解除することも直接個々 のメッセージに適用されます。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-182">The **Large message threshold** setting is directly applicable to message batches but since a message batch can be set to a value of one, the **Large message threshold** setting can also be indirectly applicable to individual messages.</span></span> <span data-ttu-id="c0a1c-183">たとえば 1 つのメッセージのメッセージのバッチを超える場合、指定した**サイズの大きいメッセージのしきい値**パラメーター、**サイズの大きいメッセージのしきい値**バッチ内の 1 つのメッセージにのみ有効で適用されます。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-183">For example when a message batch of one message exceeds the specified **Large message threshold** parameter then the **Large message threshold** in effect applies only to the single message in the batch.</span></span>  
  
   -   <span data-ttu-id="c0a1c-184">**サイズの大きいメッセージのしきい値**パラメーターは、メッセージ ボックスにメッセージのバッチを割り当てるために使用される MSDTC トランザクションの作成を軽減するために調整する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-184">The **Large message threshold** parameter should be adjusted to mitigate the creation of MSDTC transactions used to apportion message batches to the MessageBox.</span></span> <span data-ttu-id="c0a1c-185">MSDTC トランザクションの過剰な使用はパフォーマンスの観点からコストの高いために、これを実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-185">This should be done because the excessive use of MSDTC transactions is expensive from a performance standpoint.</span></span> <span data-ttu-id="c0a1c-186">最小値を決定する次の計算を使用して、**サイズの大きいメッセージのしきい値**設定は、MSDTC トランザクションを不必要に作成しないようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-186">Use the following calculation to determine what the minimum value for the **Large message threshold** setting should be to avoid unnecessarily creating MSDTC transactions:</span></span>  
  
       ```  
       Batch Size * Average size (in bytes) of each message in the batch after being processed by the receive pipeline < Large message threshold  
       ```  
  
        <span data-ttu-id="c0a1c-187">メッセージ バッチのバイト単位の合計サイズが指定された値を超えない限り、**サイズの大きいメッセージのしきい値**メッセージ ボックスに、メッセージ バッチを分配するために BizTalk で、MSDTC トランザクションを開始する必要はありませんデータベース。</span><span class="sxs-lookup"><span data-stu-id="c0a1c-187">As long as the total size in bytes of a message batch does not exceed the specified value for **Large message threshold** then there is no need for BizTalk to initiate an MSDTC transaction to apportion the message batch to the MessageBox database.</span></span>