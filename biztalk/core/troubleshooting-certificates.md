---
title: "証明書のトラブルシューティング |Microsoft ドキュメント"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: b7013db6-ebf7-4294-a072-e9b5b0ad0de2
caps.latest.revision: "26"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 963dfdd55937fd3e41fa50a5e2a609dd591f728f
ms.sourcegitcommit: 5abd0ed3f9e4858ffaaec5481bfa8878595e95f7
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/28/2017
---
# <a name="troubleshooting-certificates"></a>証明書のトラブルシューティング
Microsoft [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] では、ドキュメントの暗号化と解読、ドキュメントの署名と検証 (否認不可)、およびパーティの解決のために、公開キー インフラストラクチャ (PKI) デジタル証明書を利用できます。 このトピックでは、証明書を使用するさまざまなシナリオと構成オプションについて説明し、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] でデジタル証明書を使用する場合の一般的なガイドラインを示します。  
  
## <a name="certificate-usage-scenarios-and-configuration-options"></a>証明書の使用シナリオと構成オプション  
 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] で証明書を使用している場合に発生する問題の多くは、不適切または不完全な構成が原因です。 たとえば、正しい証明書を誤った証明書ストアにインポートしたり、誤った証明書を正しい証明書ストアにインポートしたり、BizTalk 管理コンソールに不適切な情報を入力したりすると、証明書の使用中に実行時エラーが発生します。  
  
 証明書の使用シナリオと [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] で使用できる構成オプションについては、次の表を参照してください。  
  
|**証明書の使用**|**ユーザー コンテキスト**|**証明書ストアの場所**|**証明書の種類**|**使用されるパイプライン コンポーネント**|**BizTalk Server 管理コンソール内の構成パラメーター**|  
|---------------------------|----------------------|------------------------------------|--------------------------|---------------------------------|-------------------------------------------------------------------------------|  
|暗号化 (送信)|送信ハンドラーに関連付けられているホスト インスタンスが使用するアカウント|実行する各コンピューターにログオン[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]が S/MIME エンコーダー パイプラインをホストし、暗号化証明書をインポートする、**ローカル コンピューター \ その他のユーザー**を格納します。|取引先のパブリック証明書|MIME/SMIME エンコーダー|-暗号化証明書の値を指定する**共通名**と**拇印**上、**証明書**のページ、**送信ポートのプロパティ** ダイアログ ボックス。<br />パイプラインを指定して**エンコード**オプション、**パイプラインの構成** ダイアログ ボックス。 **パイプラインの構成** の横に、ボタンをクリックしてダイアログ ボックスが表示されます、**送信パイプライン**ドロップダウン リストで、**全般**のページ、**送信ポートのプロパティ** ダイアログ ボックス。|  
|解読 (受信)|受信ハンドラーに関連付けられているホスト インスタンスが使用するアカウント|実行する各コンピューターにログオン[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]各ホスト インスタンス サービス アカウントとして S/MIME デコーダー パイプラインをホストし、暗号化解除証明書をインポートするが、**現在のユーザー \ 個人用**を格納します。 **注:**を IIS 7.0 コンピューターで正常にパイプラインの復号化は、IIS アプリケーション プールのアカウントおよび受信ハンドラーに関連付けられているホスト インスタンスによって使用されるアカウントは、同じであると、このアカウントが、のメンバーであることを確認\<machineName\>\IIS_WPG グループ。 IIS 7.0 の IIS プロセス id の設定の詳細については、次を参照してください。 [IIS アクセス許可の問題を解決するためのガイドライン](../core/guidelines-for-resolving-iis-permissions-problems.md)です。 これらのプロセスは同じアカウントで実行する必要があります。これは、アカウント プロファイルが読み込まれ、それに続いてパイプラインで解読を実行するのに必要なレジストリ キーが読み込まれるようにするためです。 IIS 6.0 では、パフォーマンス上の理由のため、関連する w3wp.exe プロセスの開始時にアカウント プロファイルが読み込まれません。したがって、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] ホスト インスタンスを同じアカウントで構成し、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] がアカウント プロファイルとレジストリ キーを読み込むようにする必要があります。|独自のプライベート証明書|MIME/SMIME デコーダー|-暗号化解除証明書の値を指定する**共通名**と**拇印**上、**証明書**の各ページ**ホスト プロパティ** ダイアログ ボックス。<br />パイプラインを指定して**デコード**オプション、**パイプラインの構成** ダイアログ ボックス。 **パイプラインの構成** の横に、ボタンをクリックしてダイアログ ボックスが表示されます、**受信パイプライン**ドロップダウン リストで、**全般**のページ、 **受信場所のプロパティ** ダイアログ ボックス。|  
|署名 (送信)|送信ハンドラーに関連付けられているホスト インスタンスが使用するアカウント|実行する各コンピューターにログオン[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]各ホスト インスタンス サービス アカウントに S/MIME エンコーダー パイプラインをホストし、署名証明書をインポートするは、**現在のユーザー \ 個人用**を格納します。|独自のプライベート証明書|MIME/SMIME エンコーダー|-署名証明書の値を指定する**共通名**と**拇印**上、**証明書**のページ、 **BizTalk グループのプロパティ** ダイアログ ボックス。 **注:**ごとに 1 つだけの署名証明書を指定できます[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]グループ。<br />パイプラインを指定して**エンコード**オプション、**パイプラインの構成** ダイアログ ボックス。 **パイプラインの構成** の横に、ボタンをクリックしてダイアログ ボックスが表示されます、**送信パイプライン**ドロップダウン リストで、**全般**のページ、**送信ポートのプロパティ** ダイアログ ボックス。|  
|署名の検証 (受信)|受信ハンドラーに関連付けられているホスト インスタンスが使用するアカウント|実行する各コンピューターにログオン[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]S/MIME デコーダー パイプラインをホストし、署名証明書をインポートするが、**ローカル コンピューター \ その他のユーザー**を格納します。|取引先のパブリック証明書|MIME/SMIME デコーダー|-検証証明書の値を指定する**共通名**と**拇印**上、**証明書**の各ページ**パーティ プロパティ** ダイアログ ボックス。<br />パイプラインを指定して**デコード**オプション、**パイプラインの構成** ダイアログ ボックス。 **パイプラインの構成** の横に、ボタンをクリックしてダイアログ ボックスが表示されます、**受信パイプライン**ドロップダウン リストで、**全般**のページ、 **受信場所のプロパティ** ダイアログ ボックス。 **注:**の構成、**デコード**オプションは、MIME/SMIME デコーダー コンポーネントとパイプラインが展開されている必要があります。|  
|パーティの解決 (受信)|受信ハンドラーに関連付けられているホスト インスタンスが使用するアカウント|ログオン、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]するパーティの解決が構成されているおよびコンピューターに証明書をインポート、**ローカル コンピューター \ その他のユーザー**を格納します。|取引先のパブリック証明書|パーティの解決|-証明書の値を指定する**共通名**と**拇印**上、**証明書**の各ページ**ホストのプロパティ** ダイアログ ボックス.<br />-指定**パーティの解決**オプション、**パイプラインの構成** ダイアログ ボックス。 **パイプラインの構成** の横に、ボタンをクリックしてダイアログ ボックスが表示されます、**受信パイプライン**ドロップダウン リストで、**全般**のページ、 **受信場所のプロパティ** ダイアログ ボックス。 **注:**を含むパイプラインを使用する必要は、このオプションの構成、**パーティの解決**コンポーネントです。 **XMLReceive**パイプラインに含まれる、**パーティの解決**コンポーネントです。|  
|HTTPS (送信)|送信ハンドラーに関連付けられているホスト インスタンスが使用するアカウント|SSL 通信では、クライアント証明書は必要ありません。 クライアント証明書が必要かどうかは、送信先の Web サーバーの管理者が決定します。 送信先の Web サーバーがクライアント証明書を要求する場合は、次の手順を実行します。<br /><br /> -、取引先からパブリック証明書を取得します。<br />実行する各コンピューターにログオン ログ[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]送信ハンドラーに関連付けられているホスト インスタンスによって使用されるアカウントです。<br />-インポートした証明書を**現在のユーザー \ 個人用**を格納します。<br /><br /> Windows Server 2008 証明書サービス Web ページを使用して証明書を取得する方法については、次を参照してください。 [、Web 経由で証明書を要求](http://go.microsoft.com/fwlink/?LinkId=129628)です。|取引先のパブリック証明書|NA|-   **HTTP トランスポート**- 設定、 **SSL クライアント証明書の拇印** オプションを選択、**認証**のタブ、 **HTTP トランスポートのプロパティ** ダイアログ ボックス. **HTTP トランスポートのプロパティ** をクリックしてダイアログ ボックスが表示されます、**構成**のボタンでは、**全般**のページ、**送信ポートのプロパティ**  ダイアログ ボックス。<br />-   **SOAP トランスポート**- 設定、**クライアント証明書の拇印** オプションを選択、**全般**のタブ、 **SOAP トランスポートのプロパティ** ダイアログ ボックス。 **SOAP トランスポートのプロパティ** をクリックしてダイアログ ボックスが表示されます、**構成**のボタンでは、**全般**のページ、**送信ポートのプロパティ**  ダイアログ ボックス。|  
  
#### <a name="to-display-the-certificates-management-console-interface-for-local-computer-and-current-user"></a>[ローカル コンピューター] と [現在のユーザー] の [証明書] 管理コンソール インターフェイスを表示するには、次の手順を実行します。  
  
1.  をクリックして**開始**、 をクリックして**実行**、型**MMC**、 をクリック**OK**を開くには、 **Microsoft 管理コンソール**.  
  
2.  クリックして、**ファイル** メニューをクリックして**スナップインの追加と削除**を表示する、**スナップインの追加と削除** ダイアログ ボックス。  
  
3.  選択**証明書**との一覧利用できるスナップイン をクリックから**追加**です。  
  
4.  選択**コンピューター アカウント**、 をクリックして**次へ**をクリックし、**完了**です。 これは追加、**証明書管理コンソール**のためのインターフェイス**ローカル コンピューター**です。  
  
5.  いることを確認**証明書**クリックして、スナップインの一覧から選択されている**追加**もう一度です。  
  
6.  選択**[ユーザー アカウント**] をクリックし、**完了**です。 これは追加、**証明書管理コンソール**のためのインターフェイス**現在のユーザー**です。  
  
    > [!NOTE]
    >  これが表示されます、**証明書管理コンソール**現在ログオンに使用しているアカウントにします。 サービス アカウントの個人証明書ストアに証明書をインポートする必要がある場合は、最初にサービス アカウントの資格情報を使用してログオンしてください。  
  
7.  をクリックして、 **OK**ボタンをクリックして、**スナップインの追加と削除** ダイアログ ボックス。  
  
## <a name="general-guidelines"></a>一般的なガイドライン  
  
-   **インポートした証明書が本来の目的に使用されていることを確認**: これを行うには、[証明書をダブルクリック、**証明書管理コンソール**インターフェイスし、をクリックして、**の詳細**のタブ、**証明書**] ダイアログ ボックス。 をクリックして、**すべて**オプションを**表示**選択をクリックしてドロップダウン リスト、**キー使用法**や**拡張キー使用法**フィールド使用目的を確認します。 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] が本来の目的以外で証明書を使用しようとした場合、実行時エラーが発生します。  
  
-   **ターゲットの Web サイトへの接続をテスト**: SSL を使用している場合は、HTTP トランスポートまたは SOAP トランスポートのターゲットの Web サイトに接続する前に、Internet Explorer でターゲットの Web サイトに接続できることを確認してください。 ダイアログ ボックスが表示されないこと Internet Explorer でターゲットの Web サイトに接続する場合を確認します。 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]ターゲットの web サイトに接続するときに表示されるダイアログ ボックスをやりとりするためのメカニズムはありません。 ターゲットの web サイト名が SSL 証明書、web サイトに指定された名前と一致しない場合、または SSL 証明書のルート証明機関が適切でない場合、Internet Explorer で、ダイアログ ボックスを表示可能性があります**の信頼されたルート証明機関**を格納します。  
  
-   **SSL 診断ツールを使用して、SSL 接続の問題を分析する:** SSL 診断ツールは、IIS 診断ツールキットのオプションのコンポーネントです。  IIS 診断ツールキットをダウンロード[インターネット インフォメーション サービスの診断ツール](http://go.microsoft.com/fwlink/?LinkId=64426)です。  
  
-   **証明書が有効であることを確認**です。 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]プロンプトが表示されませんが、証明書の有効期限が切れた場合。 代わりに、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] のメッセージが中断されます。  
  
## <a name="see-also"></a>参照  
 [暗号化証明書および署名証明書](../core/encryption-and-signing-certificates.md)