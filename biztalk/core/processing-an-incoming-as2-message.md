---
title: "入力方向の AS2 メッセージの処理 |Microsoft ドキュメント"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 998ff334-71e2-4686-b2b7-44940a0ebed1
caps.latest.revision: "32"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: b221ea3697180c27e347250570b0e96105a50f08
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/20/2017
---
# <a name="processing-an-incoming-as2-message"></a><span data-ttu-id="0ea22-102">受信 AS2 メッセージの処理</span><span class="sxs-lookup"><span data-stu-id="0ea22-102">Processing an Incoming AS2 Message</span></span>
<span data-ttu-id="0ea22-103">AS2 受信パイプラインでは、AS2 を経由して受信メッセージを処理します。</span><span class="sxs-lookup"><span data-stu-id="0ea22-103">The AS2 receive pipelines process an incoming message over AS2.</span></span> <span data-ttu-id="0ea22-104">AS2EdiReceive 受信パイプラインでは、EDI 逆アセンブラーを使用して EDI エンコード メッセージを処理します。</span><span class="sxs-lookup"><span data-stu-id="0ea22-104">The AS2EdiReceive receive pipeline processes an EDI-encoded message, using the EDI Disassembler.</span></span> <span data-ttu-id="0ea22-105">AS2Receive 受信パイプラインでは、AS2 逆アセンブラーを使用して、EDI でエンコードされていないメッセージを処理します。</span><span class="sxs-lookup"><span data-stu-id="0ea22-105">The AS2Receive receive pipeline processes a non-EDI-encoded message, using the AS2 Disassembler.</span></span> <span data-ttu-id="0ea22-106">これらの 2 つのパイプラインは、それぞれ異なる方法で AS2 メッセージのペイロードを処理し、MDN を生成します。ただし、どちらの受信パイプラインも、AS2 デコーダーを使用して AS2 メッセージを処理します。</span><span class="sxs-lookup"><span data-stu-id="0ea22-106">The two pipelines process the payload of the AS2 message and generate an MDN differently; however, both receive pipelines use the AS2 Decoder to process the AS2 message.</span></span>  
  
 <span data-ttu-id="0ea22-107">AS2EdiReceivePipeline が EDI ペイロードを持つ AS2 メッセージを処理するときは、EDI 処理の実行前に受信メッセージの AS2 処理が行われます。</span><span class="sxs-lookup"><span data-stu-id="0ea22-107">When the AS2EdiReceivePipeline processes an AS2 message with an EDI payload, it completes the AS2 processing of the received message before performing the EDI processing.</span></span> <span data-ttu-id="0ea22-108">パイプラインが AS2 メッセージの EDI ペイロードに対して EDI 受信確認を生成するときは、接続が AS2 応答によって閉じられるので、EDI 受信確認を非同期で返す必要があります。</span><span class="sxs-lookup"><span data-stu-id="0ea22-108">When the pipeline generates an EDI acknowledgment for the EDI payload of an AS2 message, it must return the EDI acknowledgment asynchronously, because the connection is closed by the AS2 response.</span></span>  
  
## <a name="the-receive-port"></a><span data-ttu-id="0ea22-109">受信ポート</span><span class="sxs-lookup"><span data-stu-id="0ea22-109">The Receive Port</span></span>  
 <span data-ttu-id="0ea22-110">HTTP 受信ポートは、EDI または非 EDI ペイロードを持つ AS2 メッセージを受信するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="0ea22-110">An HTTP receive port is used to receive an AS2 message with an EDI or non-EDI payload.</span></span> <span data-ttu-id="0ea22-111">MDN が同期的に返される場合、受信ポートは要求 - 応答のポートである必要があります。</span><span class="sxs-lookup"><span data-stu-id="0ea22-111">If an MDN must be returned synchronously, then the receive port must be a request-response port.</span></span>  
  
 <span data-ttu-id="0ea22-112">MDN は、同期または非同期で返すことができます。</span><span class="sxs-lookup"><span data-stu-id="0ea22-112">An MDN can be returned synchronously or asynchronously.</span></span> <span data-ttu-id="0ea22-113">しない限り、AS2 メッセージの処理で通知をヘッダーによって決定される、**検証および MDN に対してメッセージ ヘッダーの代わりにアグリーメントの設定を使用して**の一方向のAS2アグリーメントタブでプロパティが選択されています。**アグリーメントのプロパティ** ダイアログ ボックス。</span><span class="sxs-lookup"><span data-stu-id="0ea22-113">This is determined by the Disposition-notification-to header of the AS2 message, unless the **Use agreement settings for validation and MDN instead of message header** property is selected in the one-way AS2 agreement tab of the **Agreement Properties** dialog box.</span></span> <span data-ttu-id="0ea22-114">プロパティが選択されている場合、MDN が返される方法はによって決まります、**非同期 MDN を要求する**プロパティに、**送信者の MDN 設定**の一方向の AS2 アグリーメント タブのページ、 **アグリーメントのプロパティ** ダイアログ ボックス。</span><span class="sxs-lookup"><span data-stu-id="0ea22-114">If the property is selected, the way the MDN is returned is determined by the **Request asynchronous MDN** property in the **Sender MDN Settings** page of the one-way AS2 agreement tab of the **Agreement Properties** dialog box.</span></span> <span data-ttu-id="0ea22-115">詳細については、次を参照してください。 [AS2 メッセージ](../core/as2-messages.md)と[MDN メッセージ](../core/mdn-messages.md)です。</span><span class="sxs-lookup"><span data-stu-id="0ea22-115">For more information, see [AS2 Messages](../core/as2-messages.md) and [MDN Messages](../core/mdn-messages.md).</span></span>  
  
 <span data-ttu-id="0ea22-116">MDN が同期で返される場合は、双方向の受信場所の送信ポートを経由して返されます。</span><span class="sxs-lookup"><span data-stu-id="0ea22-116">If the MDN will be returned synchronously, the MDN is returned over the send port of the two-way receive location.</span></span> <span data-ttu-id="0ea22-117">この MDN は、たとえばメッセージの正常な受信を示す 200OK などの HTTP 応答として機能します。</span><span class="sxs-lookup"><span data-stu-id="0ea22-117">This MDN serves as the HTTP response, for example, a 200OK indicating successful reception of the message.</span></span>  
  
 <span data-ttu-id="0ea22-118">MDN が非同期に返される場合、別の送信ポートを経由して MDN を返す必要があります。</span><span class="sxs-lookup"><span data-stu-id="0ea22-118">If the MDN will be returned asynchronously, the MDN must be returned over a separate send port.</span></span> <span data-ttu-id="0ea22-119">動的な送信ポートを使用する場合は、Disposition-notification-to ヘッダーに含まれるアドレスに MDN が送信されます。</span><span class="sxs-lookup"><span data-stu-id="0ea22-119">If a dynamic send port is used, the MDN will be sent to the address contained in Disposition-notification-to header.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="0ea22-120">AS2 メッセージの受信に使用される双方向受信ポートを、MDN メッセージの受信に使用しないでください。</span><span class="sxs-lookup"><span data-stu-id="0ea22-120">The two-way receive port used to receive AS2 messages should not be used to receive MDN messages.</span></span> <span data-ttu-id="0ea22-121">MDN メッセージは、静的な一方向の受信ポートで受信する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0ea22-121">MDN messages should be received on a static one-way receive port.</span></span> <span data-ttu-id="0ea22-122">非同期で返された MDN に要求/応答受信ポートを使用すると、着信 MDN に応答する 200OK メッセージが返されなくなるため、MDN 送信の不要な再試行が行われます。</span><span class="sxs-lookup"><span data-stu-id="0ea22-122">Using a request/response receive port for an MDN returned asynchronously would prevent a 200OK message from being returned in response to the incoming MDN, thereby causing unnecessary retries of the MDN transmission.</span></span>  
  
## <a name="how-the-as2-receive-pipelines-work"></a><span data-ttu-id="0ea22-123">AS2 受信パイプラインの機能方法</span><span class="sxs-lookup"><span data-stu-id="0ea22-123">How the AS2 Receive Pipelines Work</span></span>  
 <span data-ttu-id="0ea22-124">AS2 受信パイプラインは、次の手順により受信 AS2 メッセージを処理します。</span><span class="sxs-lookup"><span data-stu-id="0ea22-124">The steps that the AS2 receive pipelines performs in processing an incoming AS2 message are as follows:</span></span>  
  
-   <span data-ttu-id="0ea22-125">AS2 を照合することによって、送信元パーティを決定-メッセージの AS2 ヘッダーの値が AS2 の値からのリストから、**識別子**の一方向の AS2 アグリーメント タブのページ、 **アグリーメントのプロパティ**  ダイアログ ボックス。</span><span class="sxs-lookup"><span data-stu-id="0ea22-125">Determines the sending party by matching the AS2-From value in the AS2 header of the message with the value for AS2-From list in the **Identifiers** page of the one-way AS2 agreement tab of the **Agreement Properties** dialog box.</span></span> <span data-ttu-id="0ea22-126">これに失敗した場合は、受信メッセージに設定されている AS2-From コンテキスト プロパティとパーティ名を照合することによって、送信パーティの決定が試行されます。</span><span class="sxs-lookup"><span data-stu-id="0ea22-126">If that fails, attempts to determine the sending party by matching the AS2-From context property that is set for the incoming message with the name of a party.</span></span> <span data-ttu-id="0ea22-127">一致が見つかった場合、および**検証および MDN に対してメッセージ ヘッダーの代わりにアグリーメントの設定を使用して**の一方向の AS2 アグリーメント タブでプロパティが選択されている、**アグリーメントのプロパティ**ダイアログ ボックスで、 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 、AS2 メッセージを処理するため、パーティのアグリーメントに関連付けられている AS2 プロパティが使用されます。</span><span class="sxs-lookup"><span data-stu-id="0ea22-127">If a match is found, and the **Use agreement settings for validation and MDN instead of message header** property is selected in the one-way AS2 agreement tab of the **Agreement Properties** dialog box, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] will use the AS2 properties associated with the agreement for the party for processing the AS2 message.</span></span> <span data-ttu-id="0ea22-128">プロパティが選択されていない場合、受信パイプラインは受信メッセージ内の AS2 ヘッダー タグを使用します。</span><span class="sxs-lookup"><span data-stu-id="0ea22-128">If the property is not selected, the receive pipeline will use the AS2 header tags in the incoming message.</span></span> <span data-ttu-id="0ea22-129">アグリーメントが見つからない場合、パイプラインは処理を中止し、メッセージを保留して例外を発生させます。</span><span class="sxs-lookup"><span data-stu-id="0ea22-129">If the agreement is not found, the pipeline aborts processing, suspends the message, and raises an exception.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="0ea22-130">**検証および MDN に対してメッセージ ヘッダーの代わりにアグリーメントの設定を使用して**プロパティ検証できるため、受信メッセージが署名、暗号化、および圧縮のプロパティを持つ (でそれらのプロパティが指定されている場合、アグリーメント、**検証**一方向アグリーメントのタブ)、存在しない場合、メッセージを中断し、エラーを送信します。</span><span class="sxs-lookup"><span data-stu-id="0ea22-130">The **Use agreement settings for validation and MDN instead of message header** property allows you to validate that an incoming message has signing, encryption, and compression properties (if those properties are specified in the agreement in the **Validation** tab of the one-way agreement), and if not, to suspend the message and post an error.</span></span> <span data-ttu-id="0ea22-131">これらの変更は、送信元パーティのアグリーメントとネゴシエートする必要があります。</span><span class="sxs-lookup"><span data-stu-id="0ea22-131">These changes must be negotiated with the agreement for the sending party.</span></span> <span data-ttu-id="0ea22-132">詳細については、次を参照してください。 [AS2 プロパティを設定する](../core/configuring-as2-properties.md)です。</span><span class="sxs-lookup"><span data-stu-id="0ea22-132">For more information see [Configuring AS2 Properties](../core/configuring-as2-properties.md).</span></span>  
  
-   <span data-ttu-id="0ea22-133">送信元パーティのアグリーメントが決定された後、受信パイプラインが AS2 メッセージを処理しようとしたときにエラーが発生した場合は、パイプラインによって AS2 メッセージのコンテキスト プロパティ MessageDestination が SuspendQueue に設定されます。</span><span class="sxs-lookup"><span data-stu-id="0ea22-133">If the agreement for the sending party is determined, but an error arises when the receive pipeline attempts to process the AS2 message, the pipeline will set the context property MessageDestination on the AS2 message to SuspendQueue.</span></span> <span data-ttu-id="0ea22-134">その後、受信パイプラインは MessageBox 内のメッセージを保留します。</span><span class="sxs-lookup"><span data-stu-id="0ea22-134">The receive pipeline will then suspend the message in the MessageBox.</span></span> <span data-ttu-id="0ea22-135">また、`EdiIntAS.IsAS2FailedMessage` コンテキスト プロパティを True に設定します。</span><span class="sxs-lookup"><span data-stu-id="0ea22-135">The receive pipeline will also set the `EdiIntAS.IsAS2FailedMessage` context property to True.</span></span> <span data-ttu-id="0ea22-136">設定して、MDN が有効になっている場合**mdn を要求する**で、**送信者の MDN 設定**の一方向の AS2 アグリーメント タブのページ、**アグリーメントのプロパティ**ダイアログ ボックスで、パイプラインは適切な MDN 送信者に返します。</span><span class="sxs-lookup"><span data-stu-id="0ea22-136">If an MDN is enabled by setting **Request MDN** in the **Sender MDN Settings** page of the one-way AS2 agreement tab of the **Agreement Properties** dialog box, the pipeline will then return the appropriate MDN to the sender.</span></span> <span data-ttu-id="0ea22-137">MDN が要求された場合、パイプラインは常に MDN を返そうとします。</span><span class="sxs-lookup"><span data-stu-id="0ea22-137">The pipeline will always attempt to return an MDN if it is requested.</span></span>  
  
-   <span data-ttu-id="0ea22-138">かどうかをメッセージ、重複する場合、**内で重複するメッセージを確認する**オプションがオン、**検証**の一方向の AS2 アグリーメント タブのページ、**アグリーメントプロパティ** ダイアログ ボックス。</span><span class="sxs-lookup"><span data-stu-id="0ea22-138">Determines if the message is a duplicate, if the **Check for duplicate messages within** option is selected in the **Validation** page of the one-way AS2 agreement tab of the **Agreement Properties** dialog box.</span></span> <span data-ttu-id="0ea22-139">メッセージの重複の検出は、受信メッセージの AS2-From、AS2-To、および Message-ID 値と、前に受信したメッセージの値を照合することによって行われます。</span><span class="sxs-lookup"><span data-stu-id="0ea22-139">Duplicate message detection is accomplished by matching the AS2-From, AS2-To, and Message-ID values on the inbound message to values on messages previously received.</span></span> <span data-ttu-id="0ea22-140">3 つすべての値が一致すると、受信パイプラインは、`EdiIntAs.IsAS2MessageDuplicate` コンテキスト プロパティの値を True に設定します。</span><span class="sxs-lookup"><span data-stu-id="0ea22-140">If all three values match, the receive pipeline will set the value of the `EdiIntAs.IsAS2MessageDuplicate` context property to true.</span></span> <span data-ttu-id="0ea22-141">場合、**重複メッセージを中断**オプションがオンになっても、**検証** ページは、メッセージが中断され、エラー ログに記録します。</span><span class="sxs-lookup"><span data-stu-id="0ea22-141">If the **Suspend duplicate messages** option is also selected on the **Validation** page, the message will be suspended and an error logged.</span></span>  
  
-   <span data-ttu-id="0ea22-142">添付ファイルがあれば、各ファイルの名前を取得し、コンテキスト プロパティに昇格させます。</span><span class="sxs-lookup"><span data-stu-id="0ea22-142">Retrieves the file name, if any, of each attachment and promotes this to the context properties.</span></span>  
  
-   <span data-ttu-id="0ea22-143">メッセージ (ワイヤ形式) のコピーを作成し、受信の否認不可データベースに保存します (一方向の AS2 アグリーメント プロパティで有効になっている場合)。</span><span class="sxs-lookup"><span data-stu-id="0ea22-143">Makes a copy of the message (in wire format), and stores the copy in the non-repudiation receipt database, if enabled in the one-way AS2 agreement properties.</span></span>  
  
-   <span data-ttu-id="0ea22-144">MIME 処理を実行します。この処理には、署名の確認とメッセージの解読 (ヘッダー タグに基づく) も含まれます。</span><span class="sxs-lookup"><span data-stu-id="0ea22-144">Performs MIME processing, including verifying the signature and decrypting the message (based upon the header tags).</span></span>  
  
-   <span data-ttu-id="0ea22-145">受信メッセージが圧縮されている場合は、圧縮解除します。</span><span class="sxs-lookup"><span data-stu-id="0ea22-145">Decompresses the received message, if it was compressed.</span></span>  
  
-   <span data-ttu-id="0ea22-146">同期の要求/応答モードで MDN に付けられる HTTP 応答、または非同期モードでスタンドアロン応答として送信される HTTP 応答を生成します。</span><span class="sxs-lookup"><span data-stu-id="0ea22-146">Generates an HTTP response, appended to the MDN in synchronous request-response mode, or sent as a standalone response in asynchronous mode.</span></span>  
  
-   <span data-ttu-id="0ea22-147">要求に応じて MDN 応答を生成します。</span><span class="sxs-lookup"><span data-stu-id="0ea22-147">Generates an MDN response, if requested.</span></span> <span data-ttu-id="0ea22-148">パイプラインは MDN を生成するアグリーメントのプロパティに基づく場合、**検証および MDN に対してメッセージ ヘッダーの代わりにアグリーメントの設定を使用して**プロパティを設定すると、またはそのプロパティが設定されていない場合、コンテキスト プロパティからです。</span><span class="sxs-lookup"><span data-stu-id="0ea22-148">The pipeline will generate an MDN based upon agreement properties, if the **Use agreement settings for validation and MDN instead of message header** property is set, or from context properties, if that property is not set.</span></span> <span data-ttu-id="0ea22-149">受信メッセージの構成設定とヘッダーの間に一貫性がない場合、パイプラインは否定 MDN を生成します。</span><span class="sxs-lookup"><span data-stu-id="0ea22-149">If the configuration settings and the headers in the incoming message are inconsistent, the pipeline will generate a negative MDN.</span></span>  
  
-   <span data-ttu-id="0ea22-150">メッセージが EDI エンコードであり、受信確認が有効になっていた場合は、AS2EdiReceive 受信パイプラインの EDI 逆アセンブラーによって EDI 受信確認が生成されます。</span><span class="sxs-lookup"><span data-stu-id="0ea22-150">The EDI Disassembler in the AS2EdiReceive receive pipeline generates an EDI acknowledgment, if the message was EDI-encoded and an acknowledgment was enabled.</span></span> <span data-ttu-id="0ea22-151">パイプラインは、EDI 受信確認を MessageBox にルーティングします。そこで、動的な送信ポートがこの受信確認を取得して非同期で送信します。</span><span class="sxs-lookup"><span data-stu-id="0ea22-151">The pipeline will route the EDI acknowledgment to the MessageBox, from which a dynamic send port will pick it up and send it out asynchronously.</span></span> <span data-ttu-id="0ea22-152">EDI 受信確認は、AS2 トランスポートを経由して、常に非同期で送信されます。これは、MDN 応答または HTTP 応答のどちらかが同期で送信されるためです。</span><span class="sxs-lookup"><span data-stu-id="0ea22-152">EDI acknowledgments are always sent out asynchronously over AS2 transport, because either an MDN or an HTTP response is sent out synchronously.</span></span>  
  
-   <span data-ttu-id="0ea22-153">MDN のコピーを作成し、受信の否認不可データベースに保存します (一方向の AS2 アグリーメント プロパティで有効になっている場合)。</span><span class="sxs-lookup"><span data-stu-id="0ea22-153">Makes a copy of the MDN, and stores it in the non-repudiation receipt database, if enabled in the one-way AS2 agreement properties.</span></span>  
  
-   <span data-ttu-id="0ea22-154">デコードされたメッセージのコピーを作成し、受信の否認不可データベースに保存します (一方向の AS2 アグリーメント プロパティで有効になっている場合)。</span><span class="sxs-lookup"><span data-stu-id="0ea22-154">Makes a copy of the decoded message, and stores the copy in the non-repudiation receipt database, if enabled in the one-way AS2 agreement properties.</span></span>  
  
 <span data-ttu-id="0ea22-155">AS2 エラーが発生した場合、受信メッセージに対するそれ以上の処理は行われません。</span><span class="sxs-lookup"><span data-stu-id="0ea22-155">If an AS2 error occurs, no further processing will occur on the received message.</span></span> <span data-ttu-id="0ea22-156">ただし、MDN 応答は、受信パイプラインによって生成されます。</span><span class="sxs-lookup"><span data-stu-id="0ea22-156">However, the receive pipeline will still generate an MDN response.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="0ea22-157">参照</span><span class="sxs-lookup"><span data-stu-id="0ea22-157">See Also</span></span>  
 <span data-ttu-id="0ea22-158">[BizTalk Server が AS2 メッセージを受信する方法](../core/how-biztalk-server-receives-as2-messages.md) </span><span class="sxs-lookup"><span data-stu-id="0ea22-158">[How BizTalk Server Receives AS2 Messages](../core/how-biztalk-server-receives-as2-messages.md) </span></span>  
 <span data-ttu-id="0ea22-159">[AS2 メッセージ](../core/as2-messages.md) </span><span class="sxs-lookup"><span data-stu-id="0ea22-159">[AS2 Messages](../core/as2-messages.md) </span></span>  
 [<span data-ttu-id="0ea22-160">MDN メッセージ</span><span class="sxs-lookup"><span data-stu-id="0ea22-160">MDN Messages</span></span>](../core/mdn-messages.md)