---
title: "入力方向の AS2 メッセージの処理 |Microsoft ドキュメント"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 998ff334-71e2-4686-b2b7-44940a0ebed1
caps.latest.revision: "32"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: b221ea3697180c27e347250570b0e96105a50f08
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/20/2017
---
# <a name="processing-an-incoming-as2-message"></a>受信 AS2 メッセージの処理
AS2 受信パイプラインでは、AS2 を経由して受信メッセージを処理します。 AS2EdiReceive 受信パイプラインでは、EDI 逆アセンブラーを使用して EDI エンコード メッセージを処理します。 AS2Receive 受信パイプラインでは、AS2 逆アセンブラーを使用して、EDI でエンコードされていないメッセージを処理します。 これらの 2 つのパイプラインは、それぞれ異なる方法で AS2 メッセージのペイロードを処理し、MDN を生成します。ただし、どちらの受信パイプラインも、AS2 デコーダーを使用して AS2 メッセージを処理します。  
  
 AS2EdiReceivePipeline が EDI ペイロードを持つ AS2 メッセージを処理するときは、EDI 処理の実行前に受信メッセージの AS2 処理が行われます。 パイプラインが AS2 メッセージの EDI ペイロードに対して EDI 受信確認を生成するときは、接続が AS2 応答によって閉じられるので、EDI 受信確認を非同期で返す必要があります。  
  
## <a name="the-receive-port"></a>受信ポート  
 HTTP 受信ポートは、EDI または非 EDI ペイロードを持つ AS2 メッセージを受信するために使用されます。 MDN が同期的に返される場合、受信ポートは要求 - 応答のポートである必要があります。  
  
 MDN は、同期または非同期で返すことができます。 しない限り、AS2 メッセージの処理で通知をヘッダーによって決定される、**検証および MDN に対してメッセージ ヘッダーの代わりにアグリーメントの設定を使用して**の一方向のAS2アグリーメントタブでプロパティが選択されています。**アグリーメントのプロパティ** ダイアログ ボックス。 プロパティが選択されている場合、MDN が返される方法はによって決まります、**非同期 MDN を要求する**プロパティに、**送信者の MDN 設定**の一方向の AS2 アグリーメント タブのページ、 **アグリーメントのプロパティ** ダイアログ ボックス。 詳細については、次を参照してください。 [AS2 メッセージ](../core/as2-messages.md)と[MDN メッセージ](../core/mdn-messages.md)です。  
  
 MDN が同期で返される場合は、双方向の受信場所の送信ポートを経由して返されます。 この MDN は、たとえばメッセージの正常な受信を示す 200OK などの HTTP 応答として機能します。  
  
 MDN が非同期に返される場合、別の送信ポートを経由して MDN を返す必要があります。 動的な送信ポートを使用する場合は、Disposition-notification-to ヘッダーに含まれるアドレスに MDN が送信されます。  
  
> [!NOTE]
>  AS2 メッセージの受信に使用される双方向受信ポートを、MDN メッセージの受信に使用しないでください。 MDN メッセージは、静的な一方向の受信ポートで受信する必要があります。 非同期で返された MDN に要求/応答受信ポートを使用すると、着信 MDN に応答する 200OK メッセージが返されなくなるため、MDN 送信の不要な再試行が行われます。  
  
## <a name="how-the-as2-receive-pipelines-work"></a>AS2 受信パイプラインの機能方法  
 AS2 受信パイプラインは、次の手順により受信 AS2 メッセージを処理します。  
  
-   AS2 を照合することによって、送信元パーティを決定-メッセージの AS2 ヘッダーの値が AS2 の値からのリストから、**識別子**の一方向の AS2 アグリーメント タブのページ、 **アグリーメントのプロパティ**  ダイアログ ボックス。 これに失敗した場合は、受信メッセージに設定されている AS2-From コンテキスト プロパティとパーティ名を照合することによって、送信パーティの決定が試行されます。 一致が見つかった場合、および**検証および MDN に対してメッセージ ヘッダーの代わりにアグリーメントの設定を使用して**の一方向の AS2 アグリーメント タブでプロパティが選択されている、**アグリーメントのプロパティ**ダイアログ ボックスで、 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 、AS2 メッセージを処理するため、パーティのアグリーメントに関連付けられている AS2 プロパティが使用されます。 プロパティが選択されていない場合、受信パイプラインは受信メッセージ内の AS2 ヘッダー タグを使用します。 アグリーメントが見つからない場合、パイプラインは処理を中止し、メッセージを保留して例外を発生させます。  
  
    > [!NOTE]
    >  **検証および MDN に対してメッセージ ヘッダーの代わりにアグリーメントの設定を使用して**プロパティ検証できるため、受信メッセージが署名、暗号化、および圧縮のプロパティを持つ (でそれらのプロパティが指定されている場合、アグリーメント、**検証**一方向アグリーメントのタブ)、存在しない場合、メッセージを中断し、エラーを送信します。 これらの変更は、送信元パーティのアグリーメントとネゴシエートする必要があります。 詳細については、次を参照してください。 [AS2 プロパティを設定する](../core/configuring-as2-properties.md)です。  
  
-   送信元パーティのアグリーメントが決定された後、受信パイプラインが AS2 メッセージを処理しようとしたときにエラーが発生した場合は、パイプラインによって AS2 メッセージのコンテキスト プロパティ MessageDestination が SuspendQueue に設定されます。 その後、受信パイプラインは MessageBox 内のメッセージを保留します。 また、`EdiIntAS.IsAS2FailedMessage` コンテキスト プロパティを True に設定します。 設定して、MDN が有効になっている場合**mdn を要求する**で、**送信者の MDN 設定**の一方向の AS2 アグリーメント タブのページ、**アグリーメントのプロパティ**ダイアログ ボックスで、パイプラインは適切な MDN 送信者に返します。 MDN が要求された場合、パイプラインは常に MDN を返そうとします。  
  
-   かどうかをメッセージ、重複する場合、**内で重複するメッセージを確認する**オプションがオン、**検証**の一方向の AS2 アグリーメント タブのページ、**アグリーメントプロパティ** ダイアログ ボックス。 メッセージの重複の検出は、受信メッセージの AS2-From、AS2-To、および Message-ID 値と、前に受信したメッセージの値を照合することによって行われます。 3 つすべての値が一致すると、受信パイプラインは、`EdiIntAs.IsAS2MessageDuplicate` コンテキスト プロパティの値を True に設定します。 場合、**重複メッセージを中断**オプションがオンになっても、**検証** ページは、メッセージが中断され、エラー ログに記録します。  
  
-   添付ファイルがあれば、各ファイルの名前を取得し、コンテキスト プロパティに昇格させます。  
  
-   メッセージ (ワイヤ形式) のコピーを作成し、受信の否認不可データベースに保存します (一方向の AS2 アグリーメント プロパティで有効になっている場合)。  
  
-   MIME 処理を実行します。この処理には、署名の確認とメッセージの解読 (ヘッダー タグに基づく) も含まれます。  
  
-   受信メッセージが圧縮されている場合は、圧縮解除します。  
  
-   同期の要求/応答モードで MDN に付けられる HTTP 応答、または非同期モードでスタンドアロン応答として送信される HTTP 応答を生成します。  
  
-   要求に応じて MDN 応答を生成します。 パイプラインは MDN を生成するアグリーメントのプロパティに基づく場合、**検証および MDN に対してメッセージ ヘッダーの代わりにアグリーメントの設定を使用して**プロパティを設定すると、またはそのプロパティが設定されていない場合、コンテキスト プロパティからです。 受信メッセージの構成設定とヘッダーの間に一貫性がない場合、パイプラインは否定 MDN を生成します。  
  
-   メッセージが EDI エンコードであり、受信確認が有効になっていた場合は、AS2EdiReceive 受信パイプラインの EDI 逆アセンブラーによって EDI 受信確認が生成されます。 パイプラインは、EDI 受信確認を MessageBox にルーティングします。そこで、動的な送信ポートがこの受信確認を取得して非同期で送信します。 EDI 受信確認は、AS2 トランスポートを経由して、常に非同期で送信されます。これは、MDN 応答または HTTP 応答のどちらかが同期で送信されるためです。  
  
-   MDN のコピーを作成し、受信の否認不可データベースに保存します (一方向の AS2 アグリーメント プロパティで有効になっている場合)。  
  
-   デコードされたメッセージのコピーを作成し、受信の否認不可データベースに保存します (一方向の AS2 アグリーメント プロパティで有効になっている場合)。  
  
 AS2 エラーが発生した場合、受信メッセージに対するそれ以上の処理は行われません。 ただし、MDN 応答は、受信パイプラインによって生成されます。  
  
## <a name="see-also"></a>参照  
 [BizTalk Server が AS2 メッセージを受信する方法](../core/how-biztalk-server-receives-as2-messages.md)   
 [AS2 メッセージ](../core/as2-messages.md)   
 [MDN メッセージ](../core/mdn-messages.md)