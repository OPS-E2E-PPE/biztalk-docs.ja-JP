---
title: "ファイル アダプター |Microsoft ドキュメント"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords: File adapters
ms.assetid: e4f6e94b-89b8-42ba-a4c2-a629f1107bb1
caps.latest.revision: "16"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: ceb4f0728eb6fac66fb0fc5f84b117b37ba84121
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/20/2017
---
# <a name="file-adapter"></a><span data-ttu-id="399c3-102">ファイル アダプタ</span><span class="sxs-lookup"><span data-stu-id="399c3-102">File Adapter</span></span>
<span data-ttu-id="399c3-103">ファイル アダプタを使用すると、Microsoft BizTalk Server との間でファイルを入出力できます。</span><span class="sxs-lookup"><span data-stu-id="399c3-103">The File adapter transfers files into and out of Microsoft BizTalk Server.</span></span> <span data-ttu-id="399c3-104">ファイル アダプターは、2 つのアダプターで構成されます: 受信アダプタと送信アダプター。</span><span class="sxs-lookup"><span data-stu-id="399c3-104">The File adapter consists of two adapters — a receive adapter and a send adapter.</span></span>  
  
 <span data-ttu-id="399c3-105">このセクションでは、ファイル受信アダプタとファイル送信アダプタ両方のワークフローおよびバッチ処理のサポートについて説明します。</span><span class="sxs-lookup"><span data-stu-id="399c3-105">This section discusses the workflow and batching support for both the File receive adapter and the File send adapter.</span></span>  
 
## <a name="file-receive-adapter"></a><span data-ttu-id="399c3-106">ファイル受信アダプター</span><span class="sxs-lookup"><span data-stu-id="399c3-106">File receive adapter</span></span>  
  
<span data-ttu-id="399c3-107">使用して、ファイルは受信アダプターがファイルからメッセージを読み取るし、サーバーに送信します。</span><span class="sxs-lookup"><span data-stu-id="399c3-107">Use the File receive adapter to read messages from files, and submit them to the server.</span></span> <span data-ttu-id="399c3-108">受信アダプターは、ファイルが読み取られ、BizTalk Server がメッセージを処理できるように、BizTalk メッセージ オブジェクトを作成します。</span><span class="sxs-lookup"><span data-stu-id="399c3-108">The receive adapter reads the file, and creates a BizTalk Message object, so that BizTalk Server can process the message.</span></span> <span data-ttu-id="399c3-109">ファイルからの読み取り中には、アダプターは、ファイルの内容を変更が加えないことを確認するファイルをロックします。</span><span class="sxs-lookup"><span data-stu-id="399c3-109">While reading from the file, the adapter locks the file to ensure that no modifications can be made to the file content.</span></span>  
  
> [!NOTE] 
> <span data-ttu-id="399c3-110">ファイル受信アダプターでは、読み取り専用のファイルまたはシステム ファイルは取得されません。</span><span class="sxs-lookup"><span data-stu-id="399c3-110">The File receive adapter does not pick up read-only files or system files.</span></span>  
  
 <span data-ttu-id="399c3-111">ファイル受信アダプターでは、ローカル ファイル システムまたはネットワーク共有にあるファイルからメッセージが読み取られます。</span><span class="sxs-lookup"><span data-stu-id="399c3-111">The File receive adapter reads the messages from files on local file systems or on network shares.</span></span> <span data-ttu-id="399c3-112">ネットワークの問題でネットワーク共有上の指定場所を使用できない場合、読み取り操作を再試行します (この再試行回数は BizTalk Server 管理コンソールで構成できます)。</span><span class="sxs-lookup"><span data-stu-id="399c3-112">When the specified location on a network share is unavailable due to network problems, the receive adapter retries the read operation (the number of retries is configurable in the BizTalk Server Administration console).</span></span> <span data-ttu-id="399c3-113">メッセージが読み取られ、BizTalk メッセージング エンジンによって正常に受け取られると、受信アダプターは、そのファイルをファイル システムまたはネットワーク共有から削除します。</span><span class="sxs-lookup"><span data-stu-id="399c3-113">After the message has been read and successfully accepted by the BizTalk Messaging Engine, the receive adapter deletes the file from the file system or network share.</span></span> <span data-ttu-id="399c3-114">メッセージが読み取られても、パイプラインでそのメッセージが正常に処理されなかった場合は、そのメッセージを保留キューに書き込んだ後、ファイルをファイル システムまたはネットワーク共有から削除します。</span><span class="sxs-lookup"><span data-stu-id="399c3-114">If the message was read but the pipeline did not successfully process the message, the adapter puts the message in the suspended queue and then deletes the file from the file system or network share.</span></span> <span data-ttu-id="399c3-115">メッセージをメッセージ ボックス データベースに送信できないか、保留にできない場合、元のファイルはファイル システムやネットワーク共有から削除されません。</span><span class="sxs-lookup"><span data-stu-id="399c3-115">If the File receive adapter cannot submit or suspend the message to the MessageBox database, it does not delete the original file from the file system or network share.</span></span>  
  
 <span data-ttu-id="399c3-116">ファイル受信アダプターを構成して、ファイルを処理しているときに、ファイル名を変更することもできます。</span><span class="sxs-lookup"><span data-stu-id="399c3-116">You can also configure the File receive adapter to rename files when processing them.</span></span> <span data-ttu-id="399c3-117">ファイル名を変更する場合は、受信場所がシャットダウンされて再起動されたときに、受信アダプターが重複するメッセージを生成しないことを確認する必要があります。</span><span class="sxs-lookup"><span data-stu-id="399c3-117">You should rename files to ensure that the receive adapter does not generate duplicate messages if the receive location is shut down and restarted.</span></span> <span data-ttu-id="399c3-118">ファイル名の変更は、ファイル受信場所の構成可能なオプションです。</span><span class="sxs-lookup"><span data-stu-id="399c3-118">This is a configurable option for File receive locations.</span></span> <span data-ttu-id="399c3-119">既定では、ファイル名の変更は無効になっています。</span><span class="sxs-lookup"><span data-stu-id="399c3-119">By default, renaming is disabled.</span></span> <span data-ttu-id="399c3-120">ファイル名の変更が有効になっている場合、ファイル受信アダプターは、そのファイルに拡張子 .BTS-WIP を付加します。</span><span class="sxs-lookup"><span data-stu-id="399c3-120">When renaming is enabled, the File receive adapter appends the extension .BTS-WIP to the file.</span></span> <span data-ttu-id="399c3-121">受信アダプターは、受信場所にある、ファイル名が変更されたファイルからメッセージを読み取り、読み取ったメッセージをサーバーに送信します。</span><span class="sxs-lookup"><span data-stu-id="399c3-121">The receive adapter then reads the messages from the renamed file in the receive location and submits it to the server.</span></span> <span data-ttu-id="399c3-122">ファイルを正常に送信すると、名前が変更されたファイルをファイル システムまたはネットワーク共有から削除します。</span><span class="sxs-lookup"><span data-stu-id="399c3-122">After the receive adapter has successfully submitted a file, the receive adapter deletes the renamed file from the file system or network share.</span></span> <span data-ttu-id="399c3-123">メッセージが読み取られても、パイプラインでの処理に失敗すると、そのメッセージをメッセージ ボックス データベースの保留キューに書き込んだ後、名前が変更されたファイルをファイル システムまたはネットワーク共有から削除します。</span><span class="sxs-lookup"><span data-stu-id="399c3-123">If a message has been read but failed processing in the pipeline, the receive adapter places the message in the MessageBox database suspended queue, and deletes the renamed file from the network share.</span></span>  
  
> [!NOTE] 
> <span data-ttu-id="399c3-124">ファイル名を変更しても、パフォーマンスには影響しません。</span><span class="sxs-lookup"><span data-stu-id="399c3-124">Renaming files has no impact on performance.</span></span>  
  
 <span data-ttu-id="399c3-125">ファイル受信アダプターがメッセージを正常に読み取っても、そのメッセージをメッセージ ボックス データベースに正常に保存できなかった場合は、名前が変更されたファイルは .BTS-WIP 拡張子の付いていない元の名前に戻されます。</span><span class="sxs-lookup"><span data-stu-id="399c3-125">If the File receive adapter successfully reads the message but did not successfully store the message in the MessageBox database, the renamed file reverts to its original name, without the .BTS-WIP extension.</span></span> <span data-ttu-id="399c3-126">ファイル名変更オプションが有効になっている場合、受信アダプターは拡張子 .BTS-WIP の付いたファイルは読み取らないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="399c3-126">Note that the receive adapter does not read files with the extension .BTS-WIP if the renaming option is turned on.</span></span>  
  
#### <a name="using-file-change-notifications-and-polling"></a><span data-ttu-id="399c3-127">ファイル変更通知を使用して、ポーリング</span><span class="sxs-lookup"><span data-stu-id="399c3-127">Using file change notifications and polling</span></span>
  
 <span data-ttu-id="399c3-128">ファイル受信アダプターでは、Windows ファイル変更通知を使用して、指定されたディレクトリまたは共有からファイルを取得するタイミングを判定します。</span><span class="sxs-lookup"><span data-stu-id="399c3-128">The File receive adapter relies on Windows File Change Notifications to determine when to pick up a file from the specified directory or share.</span></span> <span data-ttu-id="399c3-129">指定されたディレクトリまたは共有へのファイルの書き込みが完了する前にファイル受信アダプターが Windows ファイル変更通知を受け取ると、ファイルがロックされ、ファイル受信アダプターはファイルを取得しません。</span><span class="sxs-lookup"><span data-stu-id="399c3-129">If the File receive adapter receives a Windows File Change Notification before the file has been completely written to the specified directory or share then the file will be locked and the File receive adapter will not retrieve the file.</span></span> <span data-ttu-id="399c3-130">このシナリオでは、ファイルの受信アダプターは積極的にポーリングして、指定されたディレクトリまたはに共有する、**ポーリング間隔 (ミリ秒)**で指定された、**詳細設定** ダイアログ ボックスを構成するときに使用できる、ファイルの受信場所。</span><span class="sxs-lookup"><span data-stu-id="399c3-130">In this scenario, the File receive adapter will actively poll the specified directory or share at the **Polling interval (ms)** specified on the **Advanced settings** dialog box available when configuring a File receive location.</span></span> <span data-ttu-id="399c3-131">ファイル受信アダプターでは、ディレクトリまたは共有をポーリングし、ロックが解除されたファイルを共有から取得すると、このファイルをメッセージ ボックス データベースに送信します。</span><span class="sxs-lookup"><span data-stu-id="399c3-131">When the File receive adapter polls a directory or share it retrieves unlocked files from the share and submits the files to the MessageBox database.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="399c3-132">[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] ファイル アダプターは、NTFS ファイル システムに対してのみテスト済みで、サポートされています。</span><span class="sxs-lookup"><span data-stu-id="399c3-132">The [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] File adapter has only been tested on, and is supported on, the NTFS file system.</span></span>  
  
 <span data-ttu-id="399c3-133">ファイル受信アダプターは、次の Windows ファイル変更通知を受け取ると、指定されたディレクトリまたは共有からファイルを取得します。</span><span class="sxs-lookup"><span data-stu-id="399c3-133">The following Windows File Change Notifications will cause the File receive adapter to pick up a file from the specified location:</span></span>  
  
 `FILE_NOTIFY_CHANGE_ATTRIBUTES`
  
 <span data-ttu-id="399c3-134">監視対象のディレクトリまたはサブツリーで属性が変更されると、変更通知の待機操作から制御が戻ります。</span><span class="sxs-lookup"><span data-stu-id="399c3-134">Any attribute change in the watched directory or subtree causes a change notification wait operation to return.</span></span>  
  
 `FILE_NOTIFY_CHANGE_FILE_NAME`  
  
 <span data-ttu-id="399c3-135">監視対象のディレクトリまたはサブツリーでファイル名が変更されると、変更通知の待機操作から制御が戻ります。</span><span class="sxs-lookup"><span data-stu-id="399c3-135">Any file name change in the watched directory or subtree causes a change notification wait operation to return.</span></span> <span data-ttu-id="399c3-136">ファイル名の変更とは、ファイル名の変更、作成、削除を指します。</span><span class="sxs-lookup"><span data-stu-id="399c3-136">Changes include renaming, creating, or deleting a file name.</span></span>  
  
 `FILE_NOTIFY_CHANGE_SIZE`  
  
 <span data-ttu-id="399c3-137">監視対象のディレクトリまたはサブツリーでファイル サイズが変更されると、変更通知の待機操作から制御が戻ります。</span><span class="sxs-lookup"><span data-stu-id="399c3-137">Any file-size change in the watched directory or subtree causes a change notification wait operation to return.</span></span> <span data-ttu-id="399c3-138">オペレーティング システムでファイル サイズの変更が検出されるのは、ファイルがディスクに書き込まれたときだけです。</span><span class="sxs-lookup"><span data-stu-id="399c3-138">The operating system detects a change in file size only when the file is written to the disk.</span></span> <span data-ttu-id="399c3-139">拡張キャッシュを使用するオペレーティング システムでこの変更が検出されるのは、キャッシュが十分にフラッシュされたときだけです。</span><span class="sxs-lookup"><span data-stu-id="399c3-139">For operating systems that use extensive caching, detection occurs only when the cache is sufficiently flushed.</span></span>  
  
 `FILE_NOTIFY_CHANGE_LAST_WRITE`  
  
 <span data-ttu-id="399c3-140">監視対象のディレクトリまたはサブツリーでファイルに対する最終書き込み日時が変更されると、変更通知の待機操作から制御が戻ります。</span><span class="sxs-lookup"><span data-stu-id="399c3-140">Any change to the last write-time of files in the watched directory or subtree causes a change notification wait operation to return.</span></span> <span data-ttu-id="399c3-141">オペレーティング システムでファイルに対する最終書き込み日時の変更が検出されるのは、ファイルがディスクに書き込まれたときだけです。</span><span class="sxs-lookup"><span data-stu-id="399c3-141">The operating system detects a change to the last write-time only when the file is written to the disk.</span></span> <span data-ttu-id="399c3-142">拡張キャッシュを使用するオペレーティング システムでこの変更が検出されるのは、キャッシュが十分にフラッシュされたときだけです。</span><span class="sxs-lookup"><span data-stu-id="399c3-142">For operating systems that use extensive caching, detection occurs only when the cache is sufficiently flushed.</span></span>  
  
 <span data-ttu-id="399c3-143">詳細については、 **FindFirstChangeNotification**関数」を参照[https://msdn.microsoft.com/library/windows/desktop/aa364417(v=vs.85).aspx](https://msdn.microsoft.com/library/windows/desktop/aa364417(v=vs.85).aspx).</span><span class="sxs-lookup"><span data-stu-id="399c3-143">For more information about the **FindFirstChangeNotification** function see [https://msdn.microsoft.com/library/windows/desktop/aa364417(v=vs.85).aspx](https://msdn.microsoft.com/library/windows/desktop/aa364417(v=vs.85).aspx).</span></span>  
  
### <a name="file-receive-adapter-batching-support"></a><span data-ttu-id="399c3-144">ファイル受信アダプターのバッチ処理のサポート</span><span class="sxs-lookup"><span data-stu-id="399c3-144">File Receive Adapter Batching Support</span></span>
  
 <span data-ttu-id="399c3-145">ファイル受信アダプターでは、メッセージがサーバーにバッチ単位で送信されます。</span><span class="sxs-lookup"><span data-stu-id="399c3-145">The File receive adapter submits messages to the server in batches.</span></span> <span data-ttu-id="399c3-146">ファイル受信アダプターは、まず、受信場所ごとに 1 つのバッチを作成し、その受信場所で使用できる読み取り可能なファイルをすべて収集します。</span><span class="sxs-lookup"><span data-stu-id="399c3-146">The File receive adapter starts by building a single batch per receive location by collecting all the readable files available in the receive location.</span></span> <span data-ttu-id="399c3-147">使用可能なファイルをすべて収集するか、収集しているファイルの容量が最大バッチ サイズを超えると、受信アダプターによってバッチがメッセージ ボックス データベースに送信されます。</span><span class="sxs-lookup"><span data-stu-id="399c3-147">Batches are submitted to the MessageBox database by the receive adapter when all the available files have been collected or when the amount of files collected exceeds the maximum batch size.</span></span>  
  
 <span data-ttu-id="399c3-148">バッチ内のすべてのメッセージが正常に読み取られ、メッセージ ボックス データベースに送信されると、ファイル受信アダプターは対応するファイルを受信場所から削除します。</span><span class="sxs-lookup"><span data-stu-id="399c3-148">After all the messages within the batch have been successfully read and submitted into the MessageBox database, the File receive adapter deletes the corresponding files from the receive location.</span></span> <span data-ttu-id="399c3-149">バッチ内のメッセージの一部の処理に失敗すると、失敗したメッセージを保留し、対応するファイルを受信場所から削除します。</span><span class="sxs-lookup"><span data-stu-id="399c3-149">If some of the messages within the batch failed processing, the File receive adapter suspends them and deletes the corresponding files from the receive location.</span></span> <span data-ttu-id="399c3-150">一部またはすべてのメッセージをメッセージ ボックス データベースに保存できなかった場合は、バッチ操作全体がロールバックされ、対応するすべてのファイルが変更されずに受信場所に残されます。</span><span class="sxs-lookup"><span data-stu-id="399c3-150">If some or all of the messages fail to be stored in the MessageBox database, the entire batch operation is rolled back and all corresponding files are left unchanged in the receive location.</span></span>  
  
## <a name="file-send-adapter"></a><span data-ttu-id="399c3-151">ファイル送信アダプター</span><span class="sxs-lookup"><span data-stu-id="399c3-151">File Send Adapter</span></span>
  
 <span data-ttu-id="399c3-152">ファイル送信アダプターは、メッセージ ボックス データベースのメッセージを、指定された送信先アドレス (URL) に転送します。</span><span class="sxs-lookup"><span data-stu-id="399c3-152">The File send adapter transmits messages from the MessageBox database to a specified destination address (URL).</span></span> <span data-ttu-id="399c3-153">ファイルのパスとファイル名で構成される URL は、メッセージ コンテキストのプロパティに関連するワイルドカード文字を使用して定義します。</span><span class="sxs-lookup"><span data-stu-id="399c3-153">You define the URL, which is a file path and file name, by using wildcard characters related to the message context properties.</span></span> <span data-ttu-id="399c3-154">ファイル送信アダプターは、ワイルドカード文字を実際のファイル名に解決してから、メッセージをファイルに書き込みます。</span><span class="sxs-lookup"><span data-stu-id="399c3-154">The File send adapter resolves the wildcard characters to the actual file name before writing the message to the file.</span></span>  
  
 <span data-ttu-id="399c3-155">ファイル送信アダプターでは、メッセージをファイルに書き込んでいるときに、BizTalk メッセージ オブジェクトのボディ部からメッセージ コンテンツが取得されます。</span><span class="sxs-lookup"><span data-stu-id="399c3-155">When writing a message to a file, the File send adapter gets the message content from the body part of the BizTalk Message object.</span></span> <span data-ttu-id="399c3-156">BizTalk メッセージ オブジェクトのボディ部以外のメッセージ部分は無視されます。</span><span class="sxs-lookup"><span data-stu-id="399c3-156">The File send adapter ignores other message parts in the BizTalk Message object.</span></span> <span data-ttu-id="399c3-157">メッセージがファイルに書き込まれると、そのメッセージがメッセージ ボックス データベースから削除されます。</span><span class="sxs-lookup"><span data-stu-id="399c3-157">After the File adapter writes the message to a file, it deletes the message from the MessageBox database.</span></span> <span data-ttu-id="399c3-158">ファイルをファイル システムに書き込む場合、直接書き込むか、ファイル システムのキャッシュを使用します。キャッシュを使用すると、特に大きなファイルの場合は、パフォーマンスを向上させることができます。</span><span class="sxs-lookup"><span data-stu-id="399c3-158">The File adapter writes files to the file system either directly or by using the file system cache, which can improve performance, particularly for large files.</span></span>  
  
### <a name="file-send-adapter-batching-support"></a><span data-ttu-id="399c3-159">ファイル送信アダプターのバッチ処理のサポート</span><span class="sxs-lookup"><span data-stu-id="399c3-159">File Send Adapter Batching Support</span></span>
  
 <span data-ttu-id="399c3-160">ファイル送信アダプターは、メッセージ ボックス データベースからメッセージのバッチを取得し、ファイル システムまたはネットワーク共有上の送信先にあるファイルに書き込みます。</span><span class="sxs-lookup"><span data-stu-id="399c3-160">The File send adapter gets batches of messages from the MessageBox database and writes them to files in destination locations on the file system or the network share.</span></span> <span data-ttu-id="399c3-161">ファイル送信アダプターのバッチ サイズは構成できず、あらかじめ 20 に設定されています。</span><span class="sxs-lookup"><span data-stu-id="399c3-161">The size of File send adapter batches is not configurable and is preset to 20.</span></span> <span data-ttu-id="399c3-162">BizTalk サーバーがバッチ内のメッセージの一部をファイルに書き込むことができなかった場合は、再試行処理用に、システムからメッセージ ボックス データベースに書き込むことができなかったメッセージが再送信されます。</span><span class="sxs-lookup"><span data-stu-id="399c3-162">If BizTalk Server fails to write some of the messages within a batch to files, the system resubmits those messages to the MessageBox database for retry processing.</span></span> <span data-ttu-id="399c3-163">再試行間隔と再試行回数は、BizTalk Server 管理コンソールで構成できます。</span><span class="sxs-lookup"><span data-stu-id="399c3-163">You can configure the retry interval and retry count by using the BizTalk Server Administration console.</span></span>  
  
 
## <a name="in-this-section"></a><span data-ttu-id="399c3-164">このセクションの内容</span><span class="sxs-lookup"><span data-stu-id="399c3-164">In this section</span></span>  
  
-   [<span data-ttu-id="399c3-165">ファイル アダプターを構成する</span><span class="sxs-lookup"><span data-stu-id="399c3-165">Configure the File adapter</span></span>](../core/configure-the-file-adapter.md) 
  
-   [<span data-ttu-id="399c3-166">ファイル アダプタ構成時の制限事項</span><span class="sxs-lookup"><span data-stu-id="399c3-166">Restrictions when configuring the File adapter</span></span>](../core/restrictions-when-configuring-the-file-adapter.md)  
