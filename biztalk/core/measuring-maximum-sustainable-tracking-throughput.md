---
title: 維持可能な最大の追跡スループットの測定 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 35605427-0217-4bdd-8b4a-3e68b3f5f452
caps.latest.revision: 20
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: d68d1661a86858b8d2bca1bb067c8fa17ea421e3
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/27/2018
ms.locfileid: "37017062"
---
# <a name="measuring-maximum-sustainable-tracking-throughput"></a><span data-ttu-id="76eb4-102">維持できる最大の追跡スループットの測定</span><span class="sxs-lookup"><span data-stu-id="76eb4-102">Measuring Maximum Sustainable Tracking Throughput</span></span>
<span data-ttu-id="76eb4-103">[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] プラットフォームに基幹業務ソリューションを展開した後、次の事項を理解するためにシステムを追跡および監視する必要があります。</span><span class="sxs-lookup"><span data-stu-id="76eb4-103">After you deploy a line of business solution onto the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] platform, you should track and monitor the system to understand the following:</span></span>  
  
- <span data-ttu-id="76eb4-104">システムの動作の状況</span><span class="sxs-lookup"><span data-stu-id="76eb4-104">How the system is performing</span></span>  
  
- <span data-ttu-id="76eb4-105">発生するエラーと例外の内容および発生する理由</span><span class="sxs-lookup"><span data-stu-id="76eb4-105">What exceptions and errors may be occurring and why</span></span>  
  
- <span data-ttu-id="76eb4-106">BizTalk ソリューションとして実装されているビジネス プロセスの現在の状態</span><span class="sxs-lookup"><span data-stu-id="76eb4-106">The current state of the business processes implemented as BizTalk solutions</span></span>  
  
  <span data-ttu-id="76eb4-107">多くの組織にとっても重要です、否認不可のために、システムを流れる実際のメッセージを記録します。</span><span class="sxs-lookup"><span data-stu-id="76eb4-107">For many organizations, it is also important to record the actual raw messages flowing through the system for non-repudiation purposes.</span></span> [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="76eb4-108"> これらの要件に対処する 2 つの種類の追跡機能を提供します。</span><span class="sxs-lookup"><span data-stu-id="76eb4-108"> provides two types of tracking functionality that address these requirements:</span></span>  
  
- <span data-ttu-id="76eb4-109">**データの追跡およびアクティビティ (DTA) 追跡**します。</span><span class="sxs-lookup"><span data-stu-id="76eb4-109">**Data Tracking and Activity (DTA) tracking**.</span></span> <span data-ttu-id="76eb4-110">DTA は、さまざまなユーザー定義メッセージ プロパティ、オーケストレーション デバッグ イベント、メッセージ フロー イベント、およびサービス インスタンス ステータスを追跡します。</span><span class="sxs-lookup"><span data-stu-id="76eb4-110">DTA tracks a variety of user-defined message properties, orchestration debug events, message flow events, and service instance status.</span></span> <span data-ttu-id="76eb4-111">追跡を使用して、BizTalk DTA 追跡データベース (BizTalkDTADb) に格納されたデータに対するクエリを実行できます。</span><span class="sxs-lookup"><span data-stu-id="76eb4-111">You use tracking to query the data stored in the BizTalk DTA Tracking database (BizTalkDTADb).</span></span> <span data-ttu-id="76eb4-112">DTA 追跡には、否認不可および問題解決を目的として、メッセージ本文の追跡も含まれています。</span><span class="sxs-lookup"><span data-stu-id="76eb4-112">DTA tracking also includes the tracking of raw messages, known as message bodies, for non-repudiation and problem resolution purposes.</span></span>  
  
- <span data-ttu-id="76eb4-113">**ビジネス アクティビティ監視 (BAM) 追跡**します。</span><span class="sxs-lookup"><span data-stu-id="76eb4-113">**Business Activity Monitoring (BAM) tracking**.</span></span> <span data-ttu-id="76eb4-114">BAM はユーザー定義追跡プロファイルを使用してビジネス プロセスの状態を追跡し、特別な BAM データベースに記録します。</span><span class="sxs-lookup"><span data-stu-id="76eb4-114">BAM uses a user-defined tracking profile to track the state of a business process into a special set of BAM databases.</span></span>  
  
  <span data-ttu-id="76eb4-115">このトピックでは、DTA アーキテクチャ、および DTA を使用するシステムが無限に維持できる最大スループットを決定する体系的な手法について説明します。</span><span class="sxs-lookup"><span data-stu-id="76eb4-115">In this topic, we describe the DTA architecture and a systematic approach to determine the maximum sustainable throughput that a system employing DTA can sustain indefinitely.</span></span> <span data-ttu-id="76eb4-116">DTA と BAM は同じアーキテクチャ コンポーネントを共有しますが、このトピックでは DTA の動作のみ説明します。</span><span class="sxs-lookup"><span data-stu-id="76eb4-116">Although DTA and BAM share some architectural components, this topic covers the behavior of DTA only.</span></span> <span data-ttu-id="76eb4-117">BAM アーキテクチャについては、次を参照してください。[ビジネス アクティビティ監視 (BAM)](../core/business-activity-monitoring-bam.md)します。</span><span class="sxs-lookup"><span data-stu-id="76eb4-117">For information about BAM architecture, see [Business Activity Monitoring (BAM)](../core/business-activity-monitoring-bam.md).</span></span>  
  
## <a name="overview-of-dta-tracking-architecture"></a><span data-ttu-id="76eb4-118">DTA 追跡アーキテクチャの概要</span><span class="sxs-lookup"><span data-stu-id="76eb4-118">Overview of DTA Tracking Architecture</span></span>  
 <span data-ttu-id="76eb4-119">メッセージがシステムに送信されると、メッセージの本文、プロパティ、イベントなどさまざまな追跡対象の要素は一連のプロセスおよびデータベースを通過しますが、最終的に BizTalkDTADb データベースに書き込まれます。</span><span class="sxs-lookup"><span data-stu-id="76eb4-119">As messages flow through the system, various tracked elements such as message bodies, properties, and events, pass through a series of processes and databases that ultimately result in writing them to the BizTalkDTADb database.</span></span> <span data-ttu-id="76eb4-120">要素が BizTalkDTADb データベースに書き込まれた後で、追跡を使用して、追跡した情報に対するクエリを実行できます。</span><span class="sxs-lookup"><span data-stu-id="76eb4-120">After the elements are written to the BizTalkDTADb database, you can use tracking to query the tracked information.</span></span> <span data-ttu-id="76eb4-121">データベースの設定および BizTalkDTADb を使用する方法については、追跡を参照してください[履歴の表示と追跡データ](../core/viewing-historical-and-tracked-data.md)します。</span><span class="sxs-lookup"><span data-stu-id="76eb4-121">For information about setting up and using the BizTalkDTADb database and tracking, see [Viewing Historical and Tracked Data](../core/viewing-historical-and-tracked-data.md).</span></span>  
  
 <span data-ttu-id="76eb4-122">システムが維持可能で、特定のメッセージ フロー レートで無期限に動作できるようにするには、追跡対象の要素の経路が BizTalkDTADb データベースまでの固有のパスを通り、データベース自体が正常な状態を維持している必要があります。</span><span class="sxs-lookup"><span data-stu-id="76eb4-122">To ensure that the system is sustainable and will run indefinitely at a given message flow rate, the pathway that tracked elements pass through on their way to the BizTalkDTADb database, and the database itself, need to remain healthy.</span></span> <span data-ttu-id="76eb4-123">たとえば、データベース テーブル内の途中、または DTA でメッセージがたまると、データベース ファイルが無制限に増える可能性があります。これらは、適切に管理しないと維持できません。</span><span class="sxs-lookup"><span data-stu-id="76eb4-123">For example, messages building up in database tables along the way, or in the DTA, can cause unbounded database file growth that would not be sustainable if not properly managed.</span></span>  
  
 <span data-ttu-id="76eb4-124">最初に、アーキテクチャおよび追跡情報が通る経路について説明します。</span><span class="sxs-lookup"><span data-stu-id="76eb4-124">So, let's start by understanding the architecture and pathways that tracked information flows through.</span></span> <span data-ttu-id="76eb4-125">ここでは、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] エンジンを通過するメッセージ トラフィックを追跡システムが適正に追跡しているかを判断する場合に、監視対象となる主要なリソースおよびパフォーマンス インジケーターを示します。</span><span class="sxs-lookup"><span data-stu-id="76eb4-125">This will expose the key resources and performance indicators that you must monitor to determine how well the tracking system is keeping up with the message traffic flowing through the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] engine.</span></span>  
  
 <span data-ttu-id="76eb4-126">次の図は、DTA 追跡アーキテクチャおよび経路の概要を示しています。</span><span class="sxs-lookup"><span data-stu-id="76eb4-126">The following figure shows an overview of the DTA tracking architecture and pathways.</span></span>  
  
 <span data-ttu-id="76eb4-127">![DTA 追跡の概要](../core/media/dtatrackingoverview.gif "DTATrackingOverview")</span><span class="sxs-lookup"><span data-stu-id="76eb4-127">![DTA tracking overview](../core/media/dtatrackingoverview.gif "DTATrackingOverview")</span></span>  
  
 <span data-ttu-id="76eb4-128">図に示された番号付きプロセスを順にたどると、すべての DTA 追跡データは次のように BizTalkDTADb データベースに入ったり、データベースから出たりしています。</span><span class="sxs-lookup"><span data-stu-id="76eb4-128">Taking the numbered processes from the figure in order, all DTA tracked data flows into and out of the BizTalkDTADb database as follows:</span></span>  
  
1. <span data-ttu-id="76eb4-129">BizTalk Server ランタイム プロセスには、インターセプターというコンポーネントが含まれます。</span><span class="sxs-lookup"><span data-stu-id="76eb4-129">The BizTalk Server runtime process includes a component called the interceptor.</span></span> <span data-ttu-id="76eb4-130">インターセプターのジョブは、実行時に追跡要素をキャッシュし、次の MessageBox データベースとのやり取りで (たとえば、MessageBox データベースにメッセージをキューに入れるとき)、キャッシュした要素を MessageBox データベースに転送します。</span><span class="sxs-lookup"><span data-stu-id="76eb4-130">The interceptor’s job is to cache the tracked elements at runtime and, upon the next MessageBox database roundtrip (for example, en-queuing a message to the MessageBox database), forwards the cached elements to the MessageBox database.</span></span> <span data-ttu-id="76eb4-131">インターセプターは、追跡構成 (追跡プロファイルとも呼ばれる) を参照して追跡する要素を決定します。追跡構成は、管理データベースから取得され、インターセプターが使用できるように各ホスト ランタイム インスタンスにキャッシュされます。</span><span class="sxs-lookup"><span data-stu-id="76eb4-131">The interceptor determines what elements to track by looking at the tracking configuration (also known as a tracking profile) which is obtained from the management database and cached in each host runtime instance for use by the interceptor.</span></span>  
  
    <span data-ttu-id="76eb4-132">この図に示したように、MessageBox データベースへのデータ ストリームは 2 つあります。</span><span class="sxs-lookup"><span data-stu-id="76eb4-132">As shown in the above figure, there are two data streams inserted into the MessageBox database:</span></span>  
  
   - <span data-ttu-id="76eb4-133">1 つはスプール テーブルによって表されています。</span><span class="sxs-lookup"><span data-stu-id="76eb4-133">One represented by the Spool table</span></span>  
  
   - <span data-ttu-id="76eb4-134">もう 1 つは TrackingData テーブルによって表されています。</span><span class="sxs-lookup"><span data-stu-id="76eb4-134">One by the TrackingData table</span></span>  
  
     <span data-ttu-id="76eb4-135">追跡されるメッセージ本文は両方のストリームを使用します。</span><span class="sxs-lookup"><span data-stu-id="76eb4-135">Tracked message bodies use both streams.</span></span> <span data-ttu-id="76eb4-136">つまり、メッセージ本文 (データの BLOB と見なす) は、スプール テーブルによって表されるテーブルのセットを介して処理されます。</span><span class="sxs-lookup"><span data-stu-id="76eb4-136">That is, the message bodies themselves (think of them as blobs of data) are handled via a set of tables represented by the spool table.</span></span> <span data-ttu-id="76eb4-137">メッセージ本文に関連付けられたメッセージ イベント (たとえば、メッセージ識別子、メッセージ本文がいつ追跡されたか、メッセージ本文がどのインスタンスに関連付けられているか) は、TrackingData テーブルを介して処理されます。</span><span class="sxs-lookup"><span data-stu-id="76eb4-137">The message events associated with the message bodies (for example, message identifiers, when the message bodies were tracked, what instances the message bodies are associated with) are handled via the TrackingData table.</span></span> <span data-ttu-id="76eb4-138">メッセージ本文の追跡に関連付けられていないすべての追跡要素は、TrackingData テーブルを介してのみ処理されます。</span><span class="sxs-lookup"><span data-stu-id="76eb4-138">All tracked elements not associated with message body tracking are handled via the TrackingData table only.</span></span>  
  
2. <span data-ttu-id="76eb4-139">MessageBox データベースは、追跡データの単なる最初の停止であり、その後の追跡データ処理によって直接ブロックされることなくランタイムが処理を続行できるように追跡データをキャッシュするために使用されます。</span><span class="sxs-lookup"><span data-stu-id="76eb4-139">The MessageBox database is just the first stop for tracked data and is used to cache the tracked data so that the runtime can continue processing without being directly blocked by further tracking data processing.</span></span>  
  
    <span data-ttu-id="76eb4-140">追跡メッセージ本文 (BLOB) を表示したり、より永続的なストレージにアーカイブできる、BizTalkDTADb データベースに転送するために、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] は、TrackedMessages_Copy_BizTalkMsgBoxDb という SQL エージェント ジョブを使用します。これは、各 MessageBox データベース サーバーで動作します。</span><span class="sxs-lookup"><span data-stu-id="76eb4-140">To get the tracked message bodies (blobs) transferred to the BizTalkDTADb database where you can view and archive them to more permanent storage, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] employs a SQL Agent job called TrackedMessages_Copy_BizTalkMsgBoxDb which runs on each MessageBox database server.</span></span> <span data-ttu-id="76eb4-141">このジョブは、追跡のマークの付いたメッセージ本文を BizTalkDTADb データベースにコピーします。</span><span class="sxs-lookup"><span data-stu-id="76eb4-141">It is the responsibility of this job to copy the message bodies marked for tracking to the BizTalkDTADb database.</span></span>  
  
3. <span data-ttu-id="76eb4-142">TDDS というサービスによって、メッセージ本文以外の追跡データはすべて MessageBox データベースから BizTalkDTADb データベースに移動されます。このサービスは、1 つ以上の [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] ホストで動作します。</span><span class="sxs-lookup"><span data-stu-id="76eb4-142">All of the tracked data other than message bodies are moved from the MessageBox database to the BizTalkDTADb database by a service called TDDS which runs in one or more of the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] hosts.</span></span> <span data-ttu-id="76eb4-143">BizTalk Server 管理コンソールのホスト プロパティ ページでホストが [Hosts Tracking] として構成されていない限り、TDDS サブサービスはそのホストの各インスタンスで実行されます。</span><span class="sxs-lookup"><span data-stu-id="76eb4-143">Whenever a host is configured as Hosts Tracking via the host property pages in the BizTalk Server administration console, the TDDS sub-service will run in every instance of that host.</span></span>  
  
4. <span data-ttu-id="76eb4-144">BizTalkDTADb データベースは、定期的に削除しない限り、無限に成長し、最終的に運用上の問題を引き起こします。</span><span class="sxs-lookup"><span data-stu-id="76eb4-144">Unless the BizTalkDTADb database is purged periodically, it will grow unbounded which will eventually lead to operational problems.</span></span> <span data-ttu-id="76eb4-145">DTA Purge and Archive (BizTalkDTADb) と呼ばれる 1 つの SQL エージェント ジョブがあります。このジョブは、BizTalkDTADb データベースを削除するタスクを実行します。</span><span class="sxs-lookup"><span data-stu-id="76eb4-145">There is a single SQL Agent job called DTA Purge and Archive (BizTalkDTADb) that performs the task of purging the BizTalkDTADb database.</span></span> <span data-ttu-id="76eb4-146">既定では、このジョブは 1 分ごとに実行され、ユーザーが構成した時間 (たとえば 24 時間) が経過した完了済みインスタンスをすべて削除します。</span><span class="sxs-lookup"><span data-stu-id="76eb4-146">By default, this job runs every minute and purges all completed instances older than some user configured time (for example, 24hours).</span></span>  
  
    <span data-ttu-id="76eb4-147">詳細については、DTA Purge and Archive ジョブに関する、参照してください[DTA Purge and Archive ジョブを構成する方法](../core/how-to-configure-the-dta-purge-and-archive-job.md)します。</span><span class="sxs-lookup"><span data-stu-id="76eb4-147">For more information abut the DTA Purge and Archive job, see [How to Configure the DTA Purge and Archive Job](../core/how-to-configure-the-dta-purge-and-archive-job.md).</span></span>  
  
5. <span data-ttu-id="76eb4-148">必要に応じて、DTA Purge and Archive ジョブで、データの長期保管またはオフライン表示のために、BizTalkDTADb データを SQL バックアップとしてアーカイブすることもできます。</span><span class="sxs-lookup"><span data-stu-id="76eb4-148">Optionally, the DTA Purge and Archive job can also archive the BizTalkDTADb data as a SQL Backup for longer term storage and/or off-line viewing of the data.</span></span> <span data-ttu-id="76eb4-149">アーカイブ済みの BizTalkDTADb データにクエリを実行する必要がある場合は、最初に、SQL Server の新しいデータベースとして復元してから、追跡または SQL クエリ アナライザーを使用してクエリを実行します。</span><span class="sxs-lookup"><span data-stu-id="76eb4-149">If the archived BizTalkDTADb data needs to be queried, it must first be restored as a new database in SQL Server and then you can use tracking or the SQL Query Analyzer to query it.</span></span>  
  
## <a name="in-this-section"></a><span data-ttu-id="76eb4-150">このセクションの内容</span><span class="sxs-lookup"><span data-stu-id="76eb4-150">In This Section</span></span>  
  
-   [<span data-ttu-id="76eb4-151">DTA 追跡のパフォーマンス特性を理解します。</span><span class="sxs-lookup"><span data-stu-id="76eb4-151">Understanding DTA Tracking Performance Behavior</span></span>](../core/understanding-dta-tracking-performance-behavior.md)  
  
-   [<span data-ttu-id="76eb4-152">DTA 追跡の MST を測定するためのテスト シナリオ</span><span class="sxs-lookup"><span data-stu-id="76eb4-152">Test Scenarios for Measuring MST of DTA Tracking</span></span>](../core/test-scenarios-for-measuring-mst-of-dta-tracking.md)  
  
-   [<span data-ttu-id="76eb4-153">DTA 追跡の MST を特定するためのヒントとテクニック</span><span class="sxs-lookup"><span data-stu-id="76eb4-153">Tips and Tricks for Finding MST of DTA Tracking</span></span>](../core/tips-and-tricks-for-finding-mst-of-dta-tracking.md)  
  
## <a name="see-also"></a><span data-ttu-id="76eb4-154">参照</span><span class="sxs-lookup"><span data-stu-id="76eb4-154">See Also</span></span>  
 [<span data-ttu-id="76eb4-155">追跡データベースのサイズに関するガイドライン</span><span class="sxs-lookup"><span data-stu-id="76eb4-155">Tracking Database Sizing Guidelines</span></span>](../core/tracking-database-sizing-guidelines.md)