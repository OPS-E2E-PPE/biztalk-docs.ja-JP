---
title: ホスト制限とは何ですか? | Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- host throttling, outbound
- host throttling, inbound
- host throttling, about host throttling
ms.assetid: 36d1818b-c8a2-4f23-bfb3-c034ee242f69
caps.latest.revision: 29
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: be272ae705fa85af7e240b5c296dae8d9c304de2
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/27/2018
ms.locfileid: "36983715"
---
# <a name="what-is-host-throttling"></a>ホスト制限とは何ですか?
BizTalk サーバーで発生する処理の大半は、BizTalk Server ホスト インスタンスという論理エンティティ内で発生します。これは、BizTalk サーバーで Windows サービスまたは分離ホスト プロセスとして動作するプロセスです。 ホスト インスタンス プロセスによるリソースの使用を管理するために、BizTalk Server では、ホスト インスタンス全体のメッセージのフローおよび処理を管理する、調整可能な制限メカニズムが使用されます。  
  
 制限メカニズムは、ホスト インスタンスの作業負荷がホスト インスタンスまたはダウンストリーム ホスト インスタンスの容量を超えないように、作業負荷を軽減します。 また、制限メカニズムによって、ホスト インスタンス プロセスまたは他のシステム プロセスのパフォーマンス全体を低下させるリソース競合という状況を回避することもできます。 リソース競合は、1 つ以上のプロセスが制限されたリソースを消費して、対象プロセスまたは他のプロセスに悪影響を与える場合に発生します。 たとえば、メモリまたはスレッドが過度に消費されると、メモリ割り当てが失敗したり、スレッド コンテキストの切り替えが多くなり、プロセスのパフォーマンスが低下する場合があります。 このようなリソース競合は、BizTalk Server のパフォーマンス全体を低下させます。  
  
 ホスト制限メカニズムは、利用可能なリソースが十分に利用されていない状況も検出します。 利用可能なリソースが十分に利用されていないと、追加のメッセージをホスト インスタンスによって処理できるようにします。 ホスト制限メカニズムは、利用可能なリソースが制限を超えて使用されているか、または十分に活用されていないかを継続的に監視し、検出した状況に応じて、ホスト インスタンスを使用してメッセージ フローを調整します。  
  
 BizTalk Server ホスト制限メカニズムにより、システムは継続的に最適なレベルで動作できます。  
  
 ホスト制限構成パラメーターは、BizTalk Server 管理コンソールでホストごとに設定されます。 ホストに設定された制限構成パラメーターは、対応するホスト インスタンスに格納されたすべての受信ハンドラー、送信ハンドラー、またはオーケストレーションに適用されます。 特定の受信ハンドラー、送信ハンドラー、またはオーケストレーションにだけ適用する制限パラメーターを設定する場合は、次の手順を実行します。  
  
-   新しいホストを作成し、制限パラメーターを適切に設定します。  
  
-   受信ハンドラー、送信ハンドラー、またはオーケストレーションを、このホストで動作するように構成します。  
  
-   BizTalk サーバーで動作する、このホストのインスタンスを 1 つ以上作成します。  
  
## <a name="inbound-host-throttling"></a>受信ホスト制限  
 受信ホスト制限とも呼ばれます*メッセージ公開の制限*に適用される BizTalk server のホスト インスタンスが含まれている受信アダプターまたはオーケストレーションがメッセージ ボックス データベースにメッセージを発行します。 受信ホスト制限は、次の条件で引き起こされます。  
  
- メモリ、スレッドの数、ホスト インスタンスで使用されるデータベース接続の数の量で定義されている制限のしきい値を超える**設定ダッシュ ボード**BizTalk グループおよび選択**設定**します。 これらの値は 使用可能なパフォーマンス モニターのカウンターで測定可能な**BizTalk:Message Agent**パフォーマンス オブジェクト カテゴリ。  
  
- ダウンストリーム ホストが、公開されたメッセージを処理できない。 値を大きくこれ、 **DB のメッセージ カウント**パラメーター。 しきい値を**DB のメッセージ カウント**値の制限の条件が構成するにはトリガー、**ホスト**オプション**設定ダッシュ ボード**します。 データベースのメッセージ カウント が測定された、**データベース サイズ**カウンター、 **BizTalk:Message Agent**パフォーマンス オブジェクト カテゴリ。  
  
- **メッセージ公開の受信レート**ホストのインスタンスを超えています、**メッセージ公開の送信速度\\*** 指定した**オーバー ドライブ率**値。 **オーバー ドライブ率**で値が定義されている**設定ダッシュ ボード**、**ホスト**し**割合に基づく制限**します。 メッセージ公開の受信および送信の割合を下に対応するパフォーマンス モニター カウンターで測定できます、 **BizTalk:Message Agent**パフォーマンス オブジェクト カテゴリ。  
  
- 既定の制限の動作が変更されています。 [設定ダッシュ ボードを使用して、BizTalk Server パフォーマンス チューニング](../core/using-settings-dashboard-for-biztalk-server-performance-tuning.md)調整の動作に影響を与えるさまざまな値について説明します。  
  
  制限の条件の重大度レベルに応じて、次のアクションが実行されます。  
  
- ホスト インスタンスの処理ロジックで徐々に遅延が増やされる。 遅延が実施されるのは、エンド ポイント マネージャー (EPM) スレッドがトランスポート アダプターからメッセージのバッチを受け取った場合や、公開されるメッセージのバッチを MessageBox データベースに送信した場合です。 処理の遅延時間および遅延時間が長くなる割合は、両方とも、制限の条件の重大度レベルによって変わります。  
  
- エンド ポイント マネージャー (EPM) に対して利用可能なスレッドの数が制限される。 EPM は、アダプターからメッセージのバッチを受け取り、メッセージを MessageBox データベースに公開します。 既定では、EPM は CPU ごとに 20 個のスレッドを使用するように構成されています。 ホストの制限メカニズムは、受信処理のストレス条件を検出すると、ストレス条件がなくなるまで、EPM に対して利用可能なスレッドの数を一時的に削減します。 EPM スレッドを受信メッセージ バッチに利用できるようになるまで、EPM はトランスポート アダプターからのメッセージを処理したり、メッセージ バッチを MessageBox データベースに配信したりできません。  
  
- メモリやその他のリソースの使用が可能な限り削減される。 BizTalk Server では、スケジュール、メモリ キャッシュのサイズの圧縮を実行している退避とメモリを消費スレッドの使用量を制限することによって、メモリ使用量を制限するには、他のサービス クラスに指示を送信できます。  
  
  **アダプターからメッセージ ボックスへの受信メッセージ フロー**  
  
  ![受信アダプターからメッセージ ボックスへのメッセージ フロー](../core/media/inboundmsgflow.gif "InboundMsgFlow")  
  
## <a name="outbound-host-throttling"></a>送信ホスト制限  
 送信ホスト制限とも呼ばれます*メッセージ処理の制限*で BizTalk Server、またはアダプターの受信および配信または処理されているメッセージを送信するオーケストレーションを含むホスト インスタンスに適用されますメッセージ ボックス データベースに発行されます。 送信ホスト制限は、次の条件で引き起こされます。  
  
- メモリ、スレッドの数、ホスト インスタンスで使用されるデータベース接続の数の量で定義されている制限のしきい値を超える**リソース ベースの制限**で**設定ダッシュ ボード**. これらの値は 使用可能なパフォーマンス モニターのカウンターで測定可能な**BizTalk:Message Agent**パフォーマンス オブジェクト カテゴリ。  
  
- **メッセージ配信の受信レート**ホストのインスタンスを超えています、**メッセージ配信の送信比率** \* 、指定した**オーバー ドライブ率**値. **オーバー ドライブ率**で値が定義されている、**割合に基づく制限**] タブの [**設定ダッシュ ボード**します。 カウンターの対応するパフォーマンス モニターで受信および送信の割合を測定できますメッセージの配信、 **BizTalk:Message Agent**パフォーマンス オブジェクト カテゴリ。  
  
- ホスト インスタンスが同時に処理されるメッセージの数を超える、**プロセス CPU あたりのメッセージ**\*ボックスで使用可能な Cpu の数。 **インプロセス メッセージ**のしきい値が定義されている、**リソース ベースの制限**] タブの [**設定ダッシュ ボード**します。 ホスト インスタンスが同時に処理されるメッセージの数が測定された、**インプロセス メッセージ カウント**パフォーマンス カウンター、 **BizTalk:Message Agent**パフォーマンス オブジェクトカテゴリ。  
  
- 既定の制限の動作が変更されています。 [設定ダッシュ ボードを使用して、BizTalk Server パフォーマンス チューニング](../core/using-settings-dashboard-for-biztalk-server-performance-tuning.md)調整の動作に影響を与えるさまざまな値について説明します。  
  
  制限の条件の重大度に応じて、次の操作が実行されます。  
  
- ホスト インスタンスの処理ロジックで徐々に遅延が増やされるのは、メッセージを送信トランスポート アダプター、またはメッセージを処理するオーケストレーション エンジンに配信する前です。 両方の継続時間処理ロジックの遅延期間が長く、制限の条件の重大度の速度。  
  
- インメモリ キューによって保持できるメッセージの数が制限される。 インメモリ キューは、MessageBox からメッセージ エージェントにメッセージを送信するための一時的な格納場所として機能します。メッセージ エージェントはメッセージを XLANG および送信アダプターに配信します。 既定では、CPU ごとに 100 件のメッセージをインメモリ キューに保持できるように設定されています。 キューがいっぱいになると、インメモリ キューが解放されるまで、MessageBox からメッセージが取り出されます。  
  
- メッセージ エージェント スレッド プールのサイズが制限される。 ホスト制限メカニズムは、メッセージ エージェント スレッド プールのサイズを制限することにより、XLANG およびアダプターに配信されるメッセージの数を効率的に減らします。  
  
   既定のメッセージ エージェント スレッド プールのサイズを変更することで変更できます、**エンジン スレッドの最大**で値を**全般**] タブの [**設定ダッシュ ボード**します。 この値を変更する方法の詳細については、次を参照してください。[全般設定を変更する方法](../core/how-to-modify-general-settings.md)します。  
  
- メモリやその他のリソースの使用が可能な限り削減される。 BizTalk Server は、他のサービス クラスに命令を送信し、実行中のスケジュールの退避、メモリ キャッシュ サイズの圧縮、およびメモリ使用量の多いスレッドの使用の制限によって、メモリの使用を制限できます。  
  
  **MessageBox からアダプターおよび XLANG への送信メッセージ フロー**  
  
  ![アダプターおよび XLANG への送信メッセージ フロー](../core/media/outboundmsgflow.gif "OutboundMsgFlow")  
  
## <a name="see-also"></a>参照  
 [BizTalk Server がホスト制限を実装する方法](../core/how-biztalk-server-implements-host-throttling.md)   
 [BizTalk Server パフォーマンス チューニングのための設定ダッシュボードの使用](../core/using-settings-dashboard-for-biztalk-server-performance-tuning.md)