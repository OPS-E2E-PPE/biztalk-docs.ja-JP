---
title: "ファイル アダプターの構成 |Microsoft ドキュメント"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- File adapters, configuring
- configuring [File adapters], about configuring File adapters
- configuring [File adapters]
ms.assetid: 1e0c7e20-80f8-469b-b423-34a2b90f9ec3
caps.latest.revision: "13"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: d2f2de6a4c4cae93db90f0fb2cfc79321bfc7b3e
ms.sourcegitcommit: 3fd1c85d9dc2ce7b77da75a5c2087cc48cfcbe50
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/17/2018
---
# <a name="configure-the-file-adapter"></a>ファイル アダプターを構成します。
ファイル アダプターを構成し、セキュリティに関する推奨事項が読み込まれ、必要なアクセス許可を表示する方法。

受信場所を作成してポートを使用して送信 [!INCLUDE[btsBizTalkServerAdminConsoleui](../includes/btsbiztalkserveradminconsoleui-md.md)], 、またはプログラムを使用しています。 このトピックでは、 [!INCLUDE[btsBizTalkServerAdminConsoleui](../includes/btsbiztalkserveradminconsoleui-md.md)] コンソールです。 移動する手順については、プログラムによる、[受信場所を作成または送信ポートをプログラムで](../core/create-the-receive-location-and-send-port-programmatically.md)です。

> [!IMPORTANT]
> **以降で [!INCLUDE[bts2016_md](../includes/bts2016-md.md)]**, 、ファイル アダプターを使用して Azure ファイル共有に接続することができます。 Azure ストレージ アカウントは、BizTalk Server にマウントする必要があります。 [Windows 上で Azure File ストレージを使ってみる](https://docs.microsoft.com/azure/storage/storage-dotnet-how-to-use-files#mount-the-file-share) 取り付け手順について説明します。

## <a name="security-recommendations"></a>セキュリティに関する推奨事項

ファイル アダプタを使用すると、BizTalk Server とディレクトリの間でファイルを入出力できます。 ファイル アダプタをセキュリティで保護して環境に展開するには、次のガイドラインに従うことをお勧めします。  
  
-   境界ネットワーク内のファイル共有に接続するポートを開かないようにします。 ファイル アダプタは、イントラネットなど、高い信頼レベルの環境で使用する必要があります。 
  
-   受信場所のドロップ ディレクトリに対応する強力な随意アクセス制御リスト (DACL) を設定します。 たとえば、ファイルの受信場所で取得するメッセージが存在するディレクトリに対してファイルに読み取り、書き込み、削除のアクセス許可を設定し、サブフォルダとファイルに削除のアクセス許可を設定して、認証されたユーザーだけがこの場所にメッセージをドロップできるようにする必要があります。  
  
-   ファイル アダプタを使用して重要なデータを取得する場合は、インターネット プロトコル セキュリティ (IPSec) を使用することをお勧めします。  
  
## <a name="required-permissions"></a>必要な権限

アダプターのハンドラーは、選択されたアダプターのハンドラーのホスト インスタンスのセキュリティ コンテキストで実行されます。 ホスト インスタンスを使用して、 `Logon` プロパティに、 ***ホスト名* -ホスト インスタンスのプロパティ** BizTalk 管理コンソールでします。 これは、 `Logon` アカウントは任意のフォルダーまたはファイル アダプターによって使用される共有に特定のアクセス許可が必要です。

ハンドラーで使用するホスト インスタンスのユーザー アカウントには、次のアクセス許可が必要です。 ✔ では、アクセス許可が必要なことを意味します。 空のエントリでは、アクセス許可は不要なことを意味します。

| Permissions | [受信ハンドラー] | 送信ハンドラー |
| --- | --- | --- |
| フル コントロール | ✔ <br/> (ファイル共有にアクセスする) 場合は、共有レベルで |  | 
| フォルダーのスキャンとファイルの実行 |  | ✔ <br/> ファイル レベルで | 
| フォルダーの一覧とデータの読み取り | ✔ <br/> ファイル レベルで | ✔ <br/> ファイル レベルで | 
| 属性の読み取り | | ✔ <br/> ファイル レベルで | 
| 拡張属性の読み取り | | ✔ <br/> ファイル レベルで | 
| ファイルの作成とデータの書き込み | | ✔ <br/> ファイル レベルで | 
| フォルダーの作成とデータの追加 | | ✔ <br/> ファイル レベルで | 
| サブフォルダーとファイルの削除 | ✔ <br/> ファイル レベルで | ✔ <br/> ファイル レベルで | 
| アクセス許可の読み取り | | ✔ <br/> ファイル レベルで | 
| 変更 | | ✔ <br/> (ファイル共有にアクセスする) 場合は、共有レベルで |

> [!TIP] 
> ファイル レベルで開く、 **アクセス許可を高度な** のファイルまたはフォルダーをこれらのアクセス許可を参照してください。

> [!NOTE] 
> 各ホストに関連付けられる受信ハンドラーは 1 つだけです。  

## <a name="configure-the-receive-location"></a>受信場所を構成します。
  
> [!NOTE]
>  次の手順を完了する前にする必要がありますを既に追加した一方向受信ポートです。 参照してください [を作成する方法、受信ポート](../core/how-to-create-a-receive-port.md)します。  
  
1.  BizTalk Server 管理コンソールで、 [!INCLUDE[btsBizTalkServerAdminConsoleui](../includes/btsbiztalkserveradminconsoleui-md.md)]、**[BizTalk グループ]**、**[アプリケーション]**、受信場所を作成するアプリケーションの順に展開します。  
  
2.  左のウィンドウで、 **受信ポート** ノードです。 次に右ウィンドウで、既存の受信場所に関連付けられているか、新しい受信場所に関連付ける受信ポートを右クリックし、**[プロパティ]** をクリックします。  
  
3.  左側のウィンドウで、 **受信ポートのプロパティ** ダイアログ ボックスで、 **受信場所**, で、右側のウィンドウをダブルクリックする受信場所またはをクリックして、既存 **新規** 新しい受信場所を作成します。  
  
4.  **受信場所のプロパティ** ダイアログ ボックスで、 **トランスポート** ] セクションの [ **ファイル** ドロップダウン リストから入力し、クリックして **構成** 受信場所のトランスポートのプロパティを構成します。  
  
5.  **全般**  タブで、次の操作を行います。  
  
    |プロパティ|目的|  
    |--------------|----------------|  
    |**受信フォルダー**|必須。 ファイル システム、ネットワーク共有上のフォルダーにパスを入力するか、ファイルを読み取り、ファイル受信ハンドラー Azure ファイル共有です。 直接のパスを入力する、 **受信フォルダー** テキスト ボックス、または使用して、ファイル システムから選択してから、 **参照**  ボタンをクリックします。 フォルダーの参照をするときに作成することも、フォルダーを使用して新しい **フォルダの新規作成**します。<br /><br /> Azure ファイル ストレージ共有を使用する場合は、入力 `\\yourfilestoragename.file.core.windows.net\yourfilesharename`します。 <br /><br />**型:** 文字列 <br/><br/>**注:**  設定しないでください、 **受信フォルダー** シンボリック リンクを使用して NT の分散ファイル システムを使用するフォルダーのプロパティです。 NT の分散ファイル システムを使用している場合は、直接的なファイル アダプターのネットワーク パスのフォルダーを使用する受信場所のみアクセスできます。 <br /><br /> このプロパティ上の制限については、次を参照してください。 [ファイル アダプターを構成する際の制限](../core/restrictions-when-configuring-the-file-adapter.md)します。 <br/><br/>**注:**  送信のための URI ポートまたは受信場所が 256 文字を超えることはできません。|  
    |**ファイル マスク**|必須。 ファイルのマスクを指定します。 このマスクは、標準のワイルドカード文字を含めることができます"\*"です。<br /><br /> **既定値:** \*.xml<br /><br /> **型:** 文字列<br /><br /> このプロパティ上の制限については、次を参照してください。 [ファイル アダプターを構成する際の制限](../core/restrictions-when-configuring-the-file-adapter.md)します。|  
    |**パブリック アドレス**|この場所のパブリック アドレスを指定します。 このアドレスは、外部のパートナーに公開されます。<br /><br /> このプロパティの値が指定されていない場合、ランタイム エンジンで次のように置き換えられます。<br /><br /> file://\<*受信フォルダー*\>/\<*ファイル マスク*\><br /><br /> このプロパティの値にはアダプター プレフィックスが必要です。<br /><br /> **型:** 文字列<br /><br /> **最小の長さ:** 0<br /><br /> **最大長:** 256|  
    |**再試行の回数**|ネットワーク共有上の受信場所が一時的に使用できない場合に、アクセスを試行する回数を指定します。<br /><br /> **既定値:** 5<br /><br /> **型:** 長<br /><br /> **最小値:** 0<br /><br /> **最大値:** MAX_LONG|  
    |**再試行の間隔 (分)**|ネットワーク共有上の受信場所が一時的に使用できない場合に、アクセスを再試行する時間間隔を分単位で指定します。<br /><br /> **既定値:** 5 分<br /><br /> **型:** 長<br /><br /> **最小値:** 0<br /><br /> **最大値:** MAX_LONG|  
  
6.  **認証**  タブで、次の操作を行います。  
  
    |プロパティ|目的|  
    |--------------|----------------|  
    |**ホストにネットワーク共有へのアクセスがあるない場合に、これらの資格情報を使用してください。**| ネットワーク共有の場合、または Azure ファイル共有を使用する場合にのみ必要です。 <br /><br /> **既定値:** False<br /><br /> **型:** ブール|  
    |**ユーザー名**|ネットワーク共有を使用する場合は、共有へのアクセスを持っているユーザー名を入力します。 <br /><br />  Azure ファイル ストレージを使用して共有する場合は、ストレージ アカウントの名前を入力します。<br/><br/>**型:** 文字列 <br /><br />**注:**  代替資格情報の同じネットワーク共有にマップされている複数の受信場所が構成されているかどうかは、同じ資格情報は、すべての受信場所のために使用する必要があります。 Windows では、1 台のコンピューターから、共有ネットワーク サーバーに、複数の資格情報を使用して複数の接続を確立することはできません。|  
    |**パスワード**|ネットワーク共有を使用して、ネットワーク共有へのアクセスを持っているアカウントのパスワードを入力します。<br /><br />  Azure ファイル ストレージを使用して共有する場合は、ストレージ アカウント アクセス キー。 を入力します。Azure ポータルに表示されます。<br /><br /> **型:** 文字列|  
  
7.  **バッチ処理**  タブで、次の操作を行います。  
  
    |プロパティ|目的|  
    |--------------|----------------|  
    |**バッチ内のメッセージの数**|バッチ送信するメッセージの最大数を指定します。<br /><br /> **既定値:** 5<br /><br /> **型:** Int<br /><br /> **最小値:** 1<br /><br /> **最大値:** 256|  
    |**最大バッチ サイズ (バイト単位)**|バッチの合計バイト数の最大値を指定します。<br /><br /> **既定値:** 102400<br /><br /> **型:** Int<br /><br /> **最小値:** 1024<br /><br /> **最大値:** MAX_LONG|  
  
     ファイル アダプターは、メッセージが最大数または最大サイズ (バイト単位) のどちらかに到達したときにバッチを制限します。  
  
9. **[OK]** を選択します。  
  
10. 適切な値を入力、 **受信場所のプロパティ** 受信場所の構成を完了し、をクリックして ダイアログ ボックス **OK** 設定を保存します。 については、 **受信場所のプロパティ** ダイアログ ボックスを参照してください [受信場所を作成する方法](../core/how-to-create-a-receive-location.md)します。  

## <a name="configure-the-send-port"></a>送信ポートを構成します。

1.  BizTalk Server 管理コンソールでは、新しい送信ポートを作成または変更する既存の送信ポートをダブルクリックします。 参照してください [送信ポートを作成する方法](../core/how-to-create-a-send-port2.md)します。 すべての送信ポートのオプションを構成し、指定 **ファイル** の **型** オプション、 **トランスポート** のセクションで、 **全般**  タブをクリックします。  
  
2.  選択、 **構成** ボックスの横に **型**します。  
  
3.  **全般**  タブで、次の操作を行います。  
  
    |プロパティ|目的|  
    |--------------|----------------|  
    |**先の場所**|必須。 ファイル システム、共有、または出力メッセージを書き込むように Azure ファイル共有の場所にパスを入力します。 直接のパスを入力することができます、 **先**, 、または使用して、ファイル システムから選択、 **参照**  ボタンをクリックします。 内のフォルダーを参照するとき、 **フォルダーの参照** ダイアログ ボックスで、作成することも、新しいフォルダーをクリックして **フォルダの新規作成**します。<br /><br /> Azure ファイル ストレージ共有を使用する場合は、入力 `\\yourfilestoragename.file.core.windows.net\yourfilesharename`します。<br /><br /> **型:** 文字列 <br /><br />**注:**  送信のための URI ポートまたは受信場所が 256 文字を超えることはできません。|  
    |**ファイル名**|ファイル送信ハンドラがメッセージを書き込むファイルの名前を指定します。<br /><br /> このプロパティ上の制限については、マクロを使用して、ファイル名を参照してください [ファイル アダプターを構成する際の制限](../core/restrictions-when-configuring-the-file-adapter.md)します。|  
    |**[コピー モード]**|ファイルにメッセージを書き込むときに使用するコピー モードを定義します。 以下の値が有効です。<br /><br /> **追加します。** ファイルが存在する場合は、ファイル送信ハンドラがファイルを開き、ファイルの末尾にメッセージを追加します。 ファイルが存在しない場合は、ファイル送信ハンドラが新しいファイルを作成します。<br /><br /> **上書き**します。 ファイルが存在する場合は、ファイル送信ハンドラがファイルを開き、ファイルの内容を上書きします。 ファイルが存在しない場合は、ファイル送信ハンドラが新しいファイルを作成します。<br /><br /> **[新規作成]**します。 ファイルが存在しない場合は、ファイル送信ハンドラが新しいファイルを作成し、そのファイルにメッセージを書き込みます。 ファイルが存在する場合は、ファイル送信ハンドラがエラーを報告し、送信ポートの通常のアダプタ再試行ロジックに従ってメッセージを処理します。 これはファイル送信ハンドラの既定のコピー モードです。|  
    |**書き込みキャッシュを許可します。**|ファイルにメッセージを書き込む際にファイル システム キャッシュを使用するかどうかを定義します。<br /><br /> 有効なオプションを次に示します。<br /><br /> **False** ファイル システム キャッシュを使用しないでください。<br /><br /> **True** ファイル システム キャッシュを使用します。<br /><br /> **既定値:** False **重要:**  このプロパティを設定 **True** 、停電が存在し、すべてのデータが書き込まれる場合、データ損失の可能性を覚悟ファイル アダプターのパフォーマンスを向上させることができますをディスクにします。|  
    |**書き込み中に一時ファイルの使用**|最初に一時ファイルに出力ファイルを書き込み、この書き込み操作が完了した後でファイル名を変更するかどうかを定義します。 このオプションが有効になっているかどうかは、拡張子を持つ一時ファイルを作成、 **BTS-WIP**します。<br /><br /> 有効なオプションは次のとおりです。<br /><br /> **True** : ファイル アダプタはターゲット フォルダに書き込むときに一時ファイルを作成します。<br /><br /> **False** : ファイル アダプタはターゲット フォルダに書き込むときに一時ファイルを作成できません。<br /><br /> **既定値:** False **注:**  ときにこのオプションは利用可能なのみ、 **CopyMode** の値にプロパティが設定されている **新規作成**|  
  
4.  **認証**  タブで、次の操作を行います。  
  
    |プロパティ|目的|  
    |--------------|----------------|  
    |**ホストにネットワーク共有へのアクセスがあるない場合に、これらの資格情報を使用してください。**| ネットワーク共有の場合、または Azure ファイル共有を使用する場合にのみ必要です。 <br /><br /> **既定値:** False<br /><br /> **型:** ブール|  
    |**ユーザー名**|ネットワーク共有を使用する場合は、共有へのアクセスを持っているユーザー名を入力します。 <br /><br />  Azure ファイル ストレージを使用して共有する場合は、ストレージ アカウントの名前を入力します。<br /><br /> **型:** 文字列|  
    |**パスワード**|ネットワーク共有を使用して、ネットワーク共有へのアクセスを持っているアカウントのパスワードを入力します。<br /><br />  Azure ファイル ストレージを使用して共有する場合は、ストレージ アカウント アクセス キー。 を入力します。Azure ポータルに表示されます。<br /><br /> **型:** 文字列|  
  
5.  選択 **OK** して設定を保存します。  

## <a name="set-the-properties-for-a-dynamic-send-port"></a>動的送信ポートのプロパティを設定します。
  
 動的送信ポートには、BizTalk Server 管理コンソールのトランスポート構成オプションが用意されていません。これは、これらのプロパティがメッセージに関連付けられたコンテキスト プロパティで提供されることが前提となっているためです。 これらのプロパティは、カスタム パイプラインまたはオーケストレーションで設定できます。 オーケストレーションでメッセージ構成プロパティを設定するには、次の操作を行うことができます。  
  
-   追加、 **メッセージの構築** 図形をオーケストレーションにします。  
  
-   構成、 **メッセージの構築** 図形に新しいメッセージを作成します。 (例、Message_2)。  
  
-   追加、 **メッセージの割り当て** 図形を **メッセージの構築** 図形です。  
  
-   コードを追加して、 **メッセージの割り当て** 図形を作成したメッセージを初期化し、メッセージの適切な構成プロパティを設定します。 次のコードで構築された Message_2 というメッセージの初期化、 **メッセージの構築** 図形し、メッセージの 2 つの構成プロパティを設定します。 このシナリオでは、Message_1 が最初にオーケストレーションで受信されました。  
  
    ```  
    Message_2=Message_1;  
    Message_2(FILE.CopyMode)= 0; //0=Append  
    Message_2(FILE.AllowCacheOnWrite)= true;  
    Message_2(FILE.UseTempFileOnWrite)= true;  
    ```  
 
  
## <a name="configure-the-receive-or-send-handler"></a>構成、受信または送信ハンドラー
  
1.  BizTalk Server 管理コンソールで [ **BizTalk Server 管理コンソール**, 、展開 **BizTalk グループ**, 、展開 **プラットフォームの設定**, 、] をクリックし、 **アダプター**します。  
  
2.  アダプターの拡張の一覧でクリックして **ファイル**, 右側のウィンドウで、受信を右クリックし、または送信ハンドラーを構成します。 選択 **プロパティ**します。  
  
3.  **ホスト名** 一覧で、ハンドラーを実行するホストを選択します。  
  
4.  **[OK]**をクリックします。  

## <a name="more-topics-in-this-section"></a>このセクションの他のトピック

[ファイルを作成する受信場所または送信ポートをプログラムで](../core/create-the-receive-location-and-send-port-programmatically.md)

[ファイル アダプタ プロパティ スキーマおよびプロパティ](../core/file-adapter-property-schema-and-properties.md)

[ファイル アダプターを構成する際の制限](../core/restrictions-when-configuring-the-file-adapter.md)

## <a name="see-also"></a>参照

 [受信と送信サーバーのポート](../core/ports-for-the-receive-and-send-servers.md)   
 [最小限のセキュリティ ユーザー権限](../core/minimum-security-user-rights.md)