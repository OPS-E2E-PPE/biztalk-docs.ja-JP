---
title: Wcf-nettcprelay アダプター |Microsoft ドキュメント
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 7f6c6afc-6aa9-4962-91e6-1fcd92744534
caps.latest.revision: 6
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 1c8ca33c5568d7a36777e8ed08adea70f476a80f
ms.sourcegitcommit: 5abd0ed3f9e4858ffaaec5481bfa8878595e95f7
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/28/2017
ms.locfileid: "25975861"
---
# <a name="wcf-nettcprelay-adapter"></a>WCF-NetTcpRelay アダプター
Microsoft[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]を使用して、 **Wcf-nettcprelay**を介して WCF サービス要求を送受信するためのアダプター、 [NetTcpRelayBinding クラス](https://msdn.microsoft.com/library/azure/microsoft.servicebus.nettcprelaybinding.aspx)です。  

このトピックの内容を構成する手順を一覧表示、 **Wcf-nettcprelay**受信場所と送信ポートを使用して、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理コンソールです。  

## <a name="before-you-begin"></a>アンインストールの準備

以降で[!INCLUDE[bts2016_md](../includes/bts2016-md.md)]、このアダプターは Service Bus でアクセス制御サービス (ACS) または athenticate に Shared Access Signature (SAS) を使用できます。 Service Bus で認証するときに、Shared Access Signature (SAS) を使用することをお勧めします。 

Service Bus 名前空間を作成するときに、アクセス制御 (ACS) 名前空間は自動的に作成されません。 認証に ACS を使用する場合は、新しい ACS 名前空間を作成する必要があります。 参照してください[Sb-messaging アダプター](../core/sb-messaging-adapter.md) ACS キーの値を取得する手順を含む詳細については、します。
  
## <a name="create-the-receive-location"></a>受信場所を作成します。
 
> [!NOTE]
>  次の手順を完了する前にする必要がありますが既に追加して、一方向受信ポート。 参照してください[を作成する方法、受信ポート](../core/how-to-create-a-receive-port.md)です。  
  
1.  BizTalk 管理コンソールで、展開**BizTalk Server 管理コンソール**、展開**BizTalk グループ**、展開**アプリケーション**アプリケーションを展開します。受信場所を作成します。  
  
2.  BizTalk 管理コンソールの左側のウィンドウで、**[受信ポート]** ノードをクリックします。 次に右ウィンドウで、既存の受信場所に関連付けられているか、新しい受信場所に関連付ける受信ポートを右クリックし、**[プロパティ]** をクリックします。  
  
3.  **[受信ポートのプロパティ]** ダイアログ ボックスの左ウィンドウで **[受信場所]** を選択します。次に、右ウィンドウで既存の受信場所をダブルクリックするか、または **[新規作成]** をクリックして、新しい受信場所を作成します。  
  
4.  **[受信場所のプロパティ]** ダイアログ ボックスの **[トランスポート]** セクションで、**[種類]** ドロップダウン リストから **[WCF-NetTcpRelay]** を選択します。次に、**[構成]** をクリックして、受信場所のトランスポートのプロパティを構成します。  
  
5.  **[WCF-NetTcpRelay トランスポートのプロパティ]** ダイアログ ボックスの **[全般]** タブで、WCF-NetTcpRelay 受信場所のエンドポイント アドレスとエンドポイント ID を構成します。  
  
    |プロパティ|目的|  
    |--------------|----------------|  
    |**アドレス (URI)**|必須。 この受信場所の完全修飾 URI を指定します。 通常は次の形式になります。<br /><br /> `sb://<Namespace>.servicebus.windows.net/`|  
    |**エンドポイント Id**|省略可。 エンドポイント ID を指定します。 これらの設定により、エンドポイントはこの受信場所を認証できます。 エンドポイントと受信場所の間のハンドシェイク プロセスでは、Windows Communication Foundation (WCF) インフラストラクチャによって、この要素の値とエンドポイントの ID が照合されます。<br /><br /> 最小長: 0<br /><br /> 最大長:32767<br /><br /> 既定値は空の文字列です。|  
  
6.  **[WCF-NetTcpRelay トランスポートのプロパティ]** ダイアログ ボックスの **[バインド]** タブで、タイムアウトおよびトランザクションのプロパティを構成します。  
  
    |プロパティ|目的|  
    |--------------|----------------|  
    |**オープン タイムアウト (hh:mm:ss)**|チャネルを開く操作が完了するまでの間隔を示す期間値を指定します。 **System.TimeSpan.Zero**以上の値を指定してください。<br /><br /> 既定値:00:01:00<br /><br /> 最大値: 23:59:59|  
    |**送信タイムアウト (hh:mm:ss)**|送信操作が完了するまでの間隔を示す期間値を指定します。 **System.TimeSpan.Zero**以上の値を指定してください。 要求 - 応答受信ポートを使用する場合、この値は、対話処理がすべて完了するまでの時間を指定します。これは、クライアントが大きなメッセージを返した場合にも適用されます。<br /><br /> 既定値:00:01:00<br /><br /> 最大値: 23:59:59|  
    |**クローズ タイムアウト (hh:mm:ss)**|チャネルを閉じる操作が完了するまでの間隔を示す期間値を指定します。 **System.TimeSpan.Zero**以上の値を指定してください。<br /><br /> 既定値:00:01:00<br /><br /> 最大値: 23:59:59|  
    |**受信したメッセージの最大サイズ (バイト)**|有線ネットワーク上で受信できる、ヘッダーを含むメッセージの最大サイズをバイト単位で指定します。 メッセージのサイズは、各メッセージに割り当てられているメモリの量に制限されます。 このプロパティを使用して、サービス拒否 (DoS) 攻撃にさらされる危険性を制限できます。<br /><br /> Wcf-nettcprelay アダプター活用して、 [NetTcpRelayBinding](https://msdn.microsoft.com/library/azure/microsoft.servicebus.nettcprelaybinding.aspx)クラス、エンドポイントと通信するために、バッファリングされた送信モードにします。 バッファリングされたトランスポート モードの場合、 [NetTcpRelayBindingBase.MaxBufferSize](https://msdn.microsoft.com/library/azure/microsoft.servicebus.nettcprelaybindingbase.maxbuffersize.aspx)プロパティは常にこのプロパティの値とします。<br /><br /> 既定値:65536<br /><br /> 最大値: 2147483647|  
    |**同時呼び出しの最大数**|単一のサービス インスタンスに対する同時呼び出しの数を指定します。 制限を超える呼び出しはキューに格納されます。 この値を 0 に設定することは、 **Int32.MaxValue**に設定するのと同じです。<br /><br /> 既定値:200|  
  
7.  **[WCF-NetTcpRelay トランスポートのプロパティ]** ダイアログ ボックスの **[セキュリティ]** タブで、WCF-NetTcpRelay 受信場所のセキュリティ機能を定義します。  
  
    |プロパティ|目的|  
    |--------------|----------------|  
    |**セキュリティ モード**|使用するセキュリティの種類を指定します。 有効な値は次のとおりです。<br /><br /> -                          **None**: メッセージが転送中にセキュリティ保護されません。<br /><br /> - **トランスポート**: を使用してトランスポート セキュリティを確保**TLS over TCP**または**SPNego**です。 このモードでは保護レベルを制御することができます。 このセキュリティ モードで、**[トランスポート クライアントの資格情報の種類]** プロパティに対して **[なし]** または **[証明書]** を選択した場合、**[サービス証明書の拇印]** プロパティを使用してこの受信場所に対するサービスの証明書を指定する必要があります。<br /><br /> - **メッセージ**: SOAP メッセージ セキュリティを使用してセキュリティを提供します。 既定では、SOAP **Body** は暗号化および署名されます。 このモードでは、サービスの資格情報が帯域外のクライアントで利用できるかどうかの情報や、使用するアルゴリズム スイートなどのさまざまな機能が提供されます。 このセキュリティ モードで、**[メッセージ クライアントの資格情報の種類]** プロパティに対して **[なし]**、**[ユーザー名]**、または **[証明書]** を選択した場合、**[サービス証明書の拇印]** プロパティを使用してこの受信場所に対するサービスの証明書を指定する必要があります。<br /><br /> -                          **TransportWithMessageCredential**: トランスポート セキュリティは、メッセージ セキュリティと組み合わせて使用します。 トランスポート セキュリティは、 **TLS over TCP** または **SPNego** によって提供され、整合性、機密性、およびサーバー認証が保証されます。 このセキュリティ モードで、**[メッセージ クライアントの資格情報の種類]** プロパティに対して **[Windows]**、**[ユーザー名]**、または **[証明書]** を選択した場合、**[サービス証明書の拇印]** プロパティを使用してこの受信場所に対するサービスの証明書を指定する必要があります。<br /><br /> **注:** でこのセキュリティ モードは使用できません、**クライアント資格情報の種類のトランスポート**プロパティ、 **None**です。<br /><br /> 既定値は **[トランスポート]** です。|  
    |**トランスポート保護レベル**|TCP トランスポートのレベルでセキュリティを定義します。 メッセージに署名を付けることで、メッセージの転送中に第三者によって改ざんされるリスクが軽減されます。 暗号化によって、トランスポート中にデータ レベルのプライバシーが提供されます。 有効な値は次のとおりです。<br /><br /> -                          **None**: 保護されません。<br /><br /> - **サインオン**: メッセージは署名されます。<br /><br /> - **EncryptAndSign**: メッセージの暗号化および署名されます。<br /><br /> 既定値は **[EncryptAndSign]** です。|  
    |**メッセージ クライアント資格情報の種類**|メッセージ ベースのセキュリティを使用してクライアント認証を実行するときに使用する、資格情報の種類を指定します。 これは、**[セキュリティ モード]** が **[メッセージ]** または **[TransportWithMessageCredential]** に設定されている場合にのみ必要です。 有効な値は次のとおりです。<br /><br /> -                          **None**: これにより、匿名クライアントとの対話をサービスします。 これは、このクライアントがクライアントの資格情報を提供しないということを示します。<br /><br /> - **Windows**: SOAP 交換を Windows 資格情報の認証されたコンテキスト下にあることを許可します。 クライアントの資格情報は、 **WSS SOAP Message Security Kerberos Token Profile 1.0** プロトコルを使用して、SOAP **ヘッダー** 要素によって渡されます。 クライアントの資格情報に対応するドメイン ユーザー アカウントまたはローカル ユーザー アカウントを作成する必要があります。 また、この受信ハンドラーを実行しているユーザー アカウント名を使用して、クライアントの **userPrincipalName** 要素を構成する必要があります。<br /><br /> - **ユーザー名**: クライアントがこの認証での受信場所、**ユーザー名**資格情報。 資格情報は、 **WSS SOAP Message Security UsernameToken Profile 1.0** プロトコルを使用して、SOAP **ヘッダー** 要素によって渡されます。 クライアントの資格情報に対応するドメイン ユーザー アカウントまたはローカル ユーザー アカウントを作成する必要があります。<br /><br /> -**証明書**: このクライアントを認証の受信場所を介して指定されたクライアント証明書を使用して、**サービス証明書の拇印**プロパティです。 資格情報は、 **WSS SOAP Message Security X509 Token Profile 1.0** プロトコルを使用して、SOAP **ヘッダー** 要素によって渡されます。 クライアント証明書を認証するには、このコンピューターの信頼されたルート証明機関の証明書ストアに、クライアント証明書に対する CA 証明書チェーンをインストールする必要があります。 また、**[サービス証明書の拇印]** プロパティによって、この受信場所に対するサービス証明書を指定する必要があります。<br /><br /> 既定値は **[Windows]** です。|  
    |**アルゴリズム スイート**|メッセージの暗号化とキー ラップのアルゴリズムを指定します。 これらのアルゴリズムは、セキュリティ ポリシー言語 (WS-SecurityPolicy) 仕様で指定されたアルゴリズムにマップされます。 有効な値は次のとおりです。<br /><br /> -                          **Basic128**: Aes128 暗号化、メッセージ ダイジェストに Sha1、Rsa oaep-mgf1p キー ラップします。<br /><br /> -                          **[Basic128rsa15]**: メッセージの暗号化に Aes128、メッセージ ダイジェストに Sha1、キー ラップに rsa15 を使用します。<br /><br /> -                          **Basic128Sha256**: メッセージの暗号化に Aes256、メッセージ ダイジェストに Sha256、キー ラップには Rsa-oaep-mgf1p です。<br /><br /> -                          **Basic128Sha256Rsa15**: メッセージの暗号化に Aes128、メッセージ ダイジェストに Sha256、キー ラップに rsa15 を使用します。<br /><br /> - **Basic192**: Aes192 暗号化、メッセージ ダイジェストに Sha1、キー ラップには Rsa-oaep-mgf1p です。<br /><br /> - **Basic192Rsa15**: メッセージの暗号化に Aes192、メッセージ ダイジェストに Sha1、キー ラップに rsa15 を使用します。<br /><br /> -                          **Basic192Sha256**: メッセージの暗号化に Aes192、メッセージ ダイジェストに Sha256、キー ラップには Rsa-oaep-mgf1p です。<br /><br /> -                          **Basic192Sha256Rsa15**: メッセージの暗号化に Aes192、メッセージ ダイジェストに Sha256、キー ラップに rsa15 を使用します。<br /><br /> - **Basic256**: Aes256 暗号化、メッセージ ダイジェストに Sha1、Rsa oaep-mgf1p キー ラップします。<br /><br /> -                          **Basic256Rsa15**: メッセージの暗号化に Aes256、メッセージ ダイジェストに Sha1、キー ラップに rsa15 を使用します。<br /><br /> - **Basic256Sha256**: メッセージの暗号化に Aes256、メッセージ ダイジェストに Sha256、キー ラップには Rsa-oaep-mgf1p です。<br /><br /> - **Basic256Sha256Rsa15**: メッセージの暗号化に Aes256、メッセージ ダイジェストに Sha256、キー ラップに rsa15 を使用します。<br /><br /> - **TripleDes**: TripleDes 暗号化、メッセージ ダイジェスト認証、Rsa oaep-mgf1p キー ラップには Sha1 です。<br /><br /> -                          **TripleDesRsa15**: TripleDes 暗号化、メッセージ ダイジェストに Sha1、キー ラップに rsa15 を使用します。<br /><br /> - **TripleDesSha256**: メッセージの暗号化に TripleDes、メッセージ ダイジェストに Sha256、キー ラップには Rsa-oaep-mgf1p です。<br /><br /> -                          **TripleDesSha256Rsa15**: メッセージの暗号化に TripleDes、メッセージ ダイジェストに Sha256、キー ラップに rsa15 を使用します。<br /><br /> 既定値は **[Basic256]** です。|  
    |**サービス証明書の拇印**|クライアントがサービスの認証に使用する、この受信場所に対する X.509 証明書の拇印を指定します。 拇印は、**[参照]** ボタンを使用して **[現在のユーザー]** の場所の **[My]** ストアを参照して選択できます。<br /><br /> **注:** にサービス証明書をインストールする必要があります、**現在のユーザー**この受信場所をホストする受信ハンドラーのユーザー アカウントの場所。<br /><br /> 最小長: 0<br /><br /> 最大長:40<br /><br /> 既定値は空の文字列です。|  
    |**リレー クライアントの認証の種類**|メッセージの送信元となる Service Bus リレー エンドポイントでの認証のオプションを指定します。 有効な値は次のとおりです。<br /><br /> -                          **None**: 認証は必要ありません。<br /><br /> -                          **RelayAccessToken**: Service Bus リレー エンドポイントに承認するために、セキュリティ トークンを使用する場合に指定します。<br /><br /> 既定値は **[RelayAccessToken]** です。|  
    |**サービスの検出を有効にします。**|サービスの動作をサービス レジストリに発行するには、このチェック ボックスをオンにします。<br /><br /> -                          **表示名**– サービス レジストリに、サービスを公開名を指定します。<br /><br /> - **探索モード**– サービス レジストリで発行するサービスの検出モードを設定します。 探索モードの詳細については、次を参照してください。 [https://msdn.microsoft.com/library/microsoft.servicebus.discoverytype.aspx](https://msdn.microsoft.com/library/microsoft.servicebus.discoverytype.aspx)です。|  
    |**アクセス制御サービス**|適用されます[!INCLUDE[bts2013r2_md](../includes/bts2013r2-md.md)]と[!INCLUDE[btsBizTalkServerNoVersion_md](../includes/btsbiztalkservernoversion-md.md)]2013。<br/><br/>**[リレー クライアントの認証の種類]** を **[RelayAccessToken]** に設定した場合は、**[編集]** ボタンをクリックして、以下の詳細を指定してください。<br /><br /> - **アクセス制御サービス STS Uri** – これを設定して`https://<Namespace>-sb.accesscontrol.windows.net/`ここで、\<名前空間\>Service Bus 名前空間です。<br /><br /> - **発行者名**– 発行者名を指定します。 通常は所有者に設定します。<br /><br /> - **発行者キー** – 発行者キーを指定します。<br /><br /> |  
        |**Service Bus の接続情報** | 始まる新しい[!INCLUDE[bts2016_md](../includes/bts2016-md.md)]です。<br/><br/>Shared Access Signature (SAS) または Service Bus 名前空間のアクセス制御サービス (ACS) の使用を選択します。 <br/><br/>オプションを選択し、**編集**キー情報を入力します。<br/><br/> - **Shared Access Signature** : アクセスのキー名とアクセス キーを入力します。 両方の値は、「、 [Azure ポータル](https://portal.azure.com)です。<br/> - **アクセス制御サービス**: STS URI を入力 (`https://<yourNamespace>-sb.accesscontrol.windows.net/`)、発行者名、および発行者キー。 これらの値を取得する」の説明に従って Windows PowerShell を使用して[Sb-messaging アダプター](../core/sb-messaging-adapter.md)です。 |
  
8.  **[WCF-NetTcpRelay トランスポートのプロパティ]** ダイアログ ボックスの **[メッセージ]** タブで、SOAP **Body** 要素のデータ選択を指定します。  
  
    |プロパティ|目的|  
    |--------------|----------------|  
    |**-エンベロープ\<Soap:envelope\>**|受信メッセージの SOAP **Envelope** 全体から、BizTalk メッセージのボディ部を作成します。<br /><br /> 既定値はオフです。|  
    |**本文--内容\<Soap:body\>要素**|受信メッセージの SOAP **Body** 要素の内容を使用して、BizTalk メッセージのボディ部を作成します。 **Body** 要素に複数の子要素がある場合は、最初の要素のみが BizTalk メッセージのボディ部になります。<br /><br /> これが既定の設定です。|  
    |**本文のパスで見つかったコンテンツ パス--**|**[本文のパス式]** ボックスのボディ パス式を使用して、BizTalk メッセージのボディ部を作成します。 ボディ パス式は、受信メッセージの SOAP **Body** 要素のすぐ下の子要素に対して評価されます。<br /><br /> 既定値はオフです。|  
    |**ボディ パス式**|BizTalk メッセージのボディ部を作成するために使用する受信メッセージの特定の部分を示すボディ パス式を入力します。 このボディ パス式は、受信メッセージの SOAP **Body** 要素のすぐ下の子要素に対して評価されます。 このボディ パス式で複数のノードが返される場合は、最初のノードのみが BizTalk メッセージのボディ部に対して選択されます。 **[パス -- 本文のパスで見つかったコンテンツ]** オプションが選択されている場合は、このプロパティが必要です。<br /><br /> 型:文字列<br /><br /> 最小長: 0<br /><br /> 最大長:32767<br /><br /> 既定値は空の文字列です。|  
    |**ノードのエンコード**|**[本文のパス式]** ボックスのボディ パス式で識別されるノードに対して、WCF-NetTcpRelay 受信アダプターがデコードに使用するエンコードの種類を指定します。 **[パス -- 本文のパスで見つかったコンテンツ]** オプションが選択されている場合は、このプロパティが必要です。 有効な値は次のとおりです。<br /><br /> - **Base64**: Base64 エンコードします。<br /><br /> - **16 進**: 16 進エンコードします。<br /><br /> -                          **文字列**: テキスト エンコード - utf-8<br /><br /> -                          **XML**: WCF アダプターは、ボディ パス式で選択されたノードの外部の XML での BizTalk メッセージ本文の作成、**本文のパス式**テキスト ボックス。<br /><br /> 既定値は **[XML]** です。|  
    |**ボディ--BizTalk 応答メッセージ本文**|BizTalk メッセージのボディ部を使用して、送信応答メッセージの SOAP **Body** 要素の内容を作成します。 このプロパティは、要求 - 応答の受信場所に対してのみ有効です。<br /><br /> これが既定の設定です。|  
    |**テンプレート--テンプレートで指定されたコンテンツ**|**[XML]** ボックスで指定されているテンプレートを使用して、送信メッセージの SOAP **Body** 要素の内容を作成します。 このプロパティは、要求 - 応答の受信場所に対してのみ有効です。<br /><br /> 既定値はオフです。|  
    |**XML**|送信メッセージの SOAP **Body** 要素の内容に対する XML 形式のテンプレートを入力します。 **[ボディ -- BizTalk 応答メッセージ本文]** オプションが選択されている場合は、このプロパティが必要です。 このプロパティは、要求 - 応答の受信場所に対してのみ有効です。<br /><br /> 型:文字列<br /><br /> 最小長: 0<br /><br /> 最大長:32767<br /><br /> 既定値は **\<bts メッセージ本文の xmlns ="http://www.microsoft.com/schemas/bts2007"encoding ="xml"\>** です。|
    |**エラー発生時に要求メッセージを中断します。**|受信パイプラインまたはルーティングの障害によって受信処理に失敗した要求メッセージを保留するかどうかを指定します。<br /><br /> 既定値はオフです。|  
    |**例外の詳細をエラーに含める**|エラーが発生した場合に、デバッグのために SOAP エラーを返すかどうかを指定します。<br /><br /> 既定値はオフです。|  
  
9. **[OK]** をクリックします。  
  
10. **[受信場所のプロパティ]** ダイアログ ボックスで、受信場所を構成するための適切な値を入力し、**[OK]** をクリックして設定を保存します。 については、**受信場所のプロパティ**ダイアログ ボックスを参照してください[受信場所を作成する方法](../core/how-to-create-a-receive-location.md)です。 
  
## <a name="create-the-send-port"></a>送信ポートを作成します。
  
1.  BizTalk 管理コンソールで、新しい送信ポートを作成するか、既存の送信ポートをダブルクリックして変更します。 詳細については、次を参照してください。[送信ポートを作成する方法](../core/how-to-create-a-send-port2.md)です。 すべての送信ポートのオプションを構成し、指定**Wcf-nettcprelay**の**型**オプション、**トランスポート**のセクションで、**全般**タブです。  
  
2.  **全般**] タブの [、**トランスポート**セクションで、をクリックして、**構成**ボタンをクリックします。  
  
3.  **Wcf-nettcprelay トランスポートのプロパティ** ダイアログ ボックスで、**全般** タブで、次の指定します。  
  
    |プロパティ|目的|  
    |--------------|----------------|  
    |**アドレス (URI)**|必須。 送信ポートの完全修飾 URI を指定します。 通常は次の形式になります。<br /><br /> `sb://<Namespace>.servicebus.windows.net/`<br /><br /> 最大長: 255<br /><br /> 既定値: net.tcp://localhost/|  
    |**エンドポイント Id**|省略可。 この送信ポートがメッセージを送信する宛先エンドポイントの ID を指定します。 これらの設定により、この送信ポートでエンドポイントを認証できます。 エンドポイントと送信ポート間のハンドシェイク プロセスでは、Windows Communication Foundation (WCF) インフラストラクチャによって、この要素の値とエンドポイントの ID が照合されます。 指定できる値、**エンドポイント id**プロパティが、セキュリティ構成によって異なります。<br /><br /> 既定値はオフです。|  
    |**操作**|指定して、 **SOAP アクション**送信メッセージのヘッダー フィールド。 このプロパティは、メッセージ コンテキスト プロパティからも設定できます**WCF です。アクション**パイプラインまたはオーケストレーションでします。 2 つの異なる方法でこの値を指定することができます。 シングル アクション形式とアクション マッピング形式です。 シングル アクション形式 http://contoso.com/Svc/Op1-など、このプロパティを設定する場合、 **SOAPAction**ヘッダーは常に送信メッセージの値に設定、このプロパティで指定します。<br /><br /> 送信アクション マッピング形式でこのプロパティを設定する場合**SOAPAction**ヘッダーはによって決定されます、 **BTS です。操作**コンテキスト プロパティです。 たとえば、このプロパティは、次の XML 形式に設定されている場合、 **BTS です。操作**プロパティを Op1、WCF 送信アダプターに`uses http://contoso.com/Svc/Op1`アウトゴーイング**SOAPAction**ヘッダー。<br /><br /> `<BtsActionMapping> <Operation Name="Op1" Action="http://contoso.com/Svc/Op1" /> <Operation Name="Op2" Action="http://contoso.com/Svc/Op2" /> </BtsActionMapping>`<br /><br /> 送信メッセージには、オーケストレーション ポートから場合、オーケストレーション インスタンスは動的に設定、 **BTS です。操作**ポートの操作の名前を持つプロパティです。 コンテンツ ベースのルーティングと、送信メッセージのルーティングされる場合は、設定、 **BTS です。操作**パイプライン コンポーネントのプロパティです。<br /><br /> 最小長: 0<br /><br /> 最大長:32767<br /><br /> 既定値は空の文字列です。|  
  
4.  **[WCF-NetTcpRelay トランスポートのプロパティ]** ダイアログ ボックスの **[バインド]** タブで、タイムアウトおよびトランザクションのプロパティを構成します。  
  
    |プロパティ|目的|  
    |--------------|----------------|  
    |**オープン タイムアウト (hh:mm:ss)**|チャネルを開く操作が完了するまでの間隔を示す期間値を指定します。 **System.TimeSpan.Zero**以上の値を指定してください。<br /><br /> 既定値:00:01:00<br /><br /> 最大値: 23:59:59|  
    |**送信タイムアウト (hh:mm:ss)**|送信操作が完了するまでの間隔を示す期間値を指定します。 **System.TimeSpan.Zero**以上の値を指定してください。 送信請求 - 応答の送信ポートを使用する場合は、サービスから大きいメッセージが返される場合でも、この値には対話処理がすべて完了するまでの時間を指定します。<br /><br /> 既定値:00:01:00<br /><br /> 最大値: 23:59:59|  
    |**クローズ タイムアウト (hh:mm:ss)**|チャネルを閉じる操作が完了するまでの間隔を示す期間値を指定します。 **System.TimeSpan.Zero**以上の値を指定してください。<br /><br /> 既定値:00:01:00<br /><br /> 最大値: 23:59:59|  
    |**受信したメッセージの最大サイズ (バイト)**|有線ネットワーク上で受信できる、ヘッダーを含むメッセージの最大サイズをバイト単位で指定します。 メッセージのサイズは、各メッセージに割り当てられているメモリの量に制限されます。 このプロパティを使用して、サービス拒否 (DoS) 攻撃にさらされる危険性を制限できます。<br /><br /> Wcf-nettcprelay アダプター活用して、 [NetTcpRelayBinding](https://msdn.microsoft.com/library/azure/microsoft.servicebus.nettcprelaybinding.aspx)クラス、エンドポイントと通信するために、バッファリングされた送信モードにします。 バッファリングされたトランスポート モードの場合、 [NetTcpRelayBindingBase.MaxBufferSize](https://msdn.microsoft.com/library/azure/microsoft.servicebus.nettcprelaybindingbase.maxbuffersize.aspx)プロパティは常にこのプロパティの値とします。<br /><br /> 既定値:65536<br /><br /> 最大値: 2147483647|  
  
5.  **Wcf-nettcprelay トランスポートのプロパティ** ダイアログ ボックスで、**セキュリティ** タブで、Wcf-nettcprelay 送信ポートのセキュリティ機能を定義します。  
  
    |プロパティ|目的|  
    |--------------|----------------|  
    |**セキュリティ モード**|使用するセキュリティの種類を指定します。 有効な値は次のとおりです。<br /><br /> - **None**: メッセージが転送中にセキュリティ保護されません。<br /><br /> - **トランスポート**: を使用してトランスポート セキュリティを確保**TLS over TCP**または**SPNego**です。 このモードでは保護レベルを制御することができます。<br /><br /> -                          **メッセージ**: SOAP メッセージ セキュリティを使用してセキュリティを提供します。 既定では、SOAP **Body** は暗号化および署名されます。 このモードでは、サービスの資格情報が帯域外のクライアントで利用できるかどうかの情報や、使用するアルゴリズム スイートなどのさまざまな機能が提供されます。<br /><br /> - **TransportWithMessageCredential**: トランスポート セキュリティは、メッセージ セキュリティと組み合わせて使用します。 によってトランスポート セキュリティが提供される**TLS over TCP**、または**SPNego**整合性、機密性、およびサーバー認証を保証します。 SOAP メッセージのセキュリティはクライアント認証を提供します。 このモードを使用するには、サービスを送信ポートに対して認証できるように、サービスの X.509 証明書の CA 証明書チェーンをこのコンピューターの信頼されたルート証明機関の証明書ストアにインストールする必要があります。<br /><br /> **注:** でこのセキュリティ モードは使用できません、**クライアント資格情報の種類のトランスポート**プロパティ、 **None**です。<br /><br /> 既定値は **[トランスポート]** です。|  
    |**トランスポート保護レベル**|TCP トランスポートのレベルでセキュリティを定義します。 メッセージに署名を付けることで、メッセージの転送中に第三者によって改ざんされるリスクが軽減されます。 暗号化によって、トランスポート中にデータ レベルのプライバシーが提供されます。 有効な値は次のとおりです。<br /><br /> -                          **None**: 保護されません。<br /><br /> - **サインオン**: メッセージは署名されます。<br /><br /> -                          **EncryptAndSign**: メッセージの暗号化および署名されます。<br /><br /> 既定値は **[EncryptAndSign]** です。|  
    |**メッセージ クライアント資格情報の種類**|メッセージ ベースのセキュリティを使用してクライアント認証を実行するときに使用する、資格情報の種類を指定します。 これは、**[セキュリティ モード]** が **[メッセージ]** または **[TransportWithMessageCredential]** に設定されている場合にのみ必要です。 有効な値は次のとおりです。<br /><br /> - **None**: これにより、匿名クライアントとの対話をサービスします。 これは、この送信ポートがクライアントの資格情報を提供しないことを示します。 送信ポートにサービスを認証できるように、このコンピューターの信頼されたルート証明機関証明書ストアにサービスの X.509 証明書の CA 証明書チェーンをインストールする必要があります。<br /><br /> -                          **Windows**: SOAP 交換を Windows 資格情報の認証されたコンテキスト下にあることを許可します。 この送信ポートを実行するユーザー アカウントは、サービスがこの送信ポートを認証するために使用されます。 クライアントの資格情報は、 **WSS SOAP Message Security Kerberos Token Profile 1.0** プロトコルを使用して、SOAP **ヘッダー** 要素によって渡されます。 構成する必要があります、**ユーザー プリンシパル名**プロパティを使用して、転送先サービスを実行しているユーザー アカウント名を**Id エディター**  ダイアログ ボックス。<br /><br /> - **ユーザー名**: この送信ポートがサービスに認証、 **UserName**資格情報。 資格情報は、 **WSS SOAP Message Security UsernameToken Profile 1.0** プロトコルを使用して、SOAP **ヘッダー** 要素によって渡されます。 このオプションは、構成する必要があります、**クライアントの資格情報**プロパティです。 送信ポートにサービスを認証できるように、このコンピューターの信頼されたルート証明機関証明書ストアにサービスの X.509 証明書の CA 証明書チェーンをインストールする必要があります。<br /><br /> - **証明書**: この送信ポートは認証を使用して指定するクライアント証明書を使用してサービスを**クライアント証明書の拇印**プロパティです。 資格情報は、 **WSS SOAP Message Security X509 Token Profile 1.0** プロトコルを使用して、SOAP **ヘッダー** 要素によって渡されます。 送信ポートにサービスを認証できるように、このコンピューターの信頼されたルート証明機関証明書ストアにサービスの X.509 証明書の CA 証明書チェーンをインストールする必要があります。<br /><br /> 既定値は **[Windows]** です。|  
    |**アルゴリズム スイート**|メッセージの暗号化とキー ラップのアルゴリズムを指定します。 これらのアルゴリズムは、セキュリティ ポリシー言語 (WS-SecurityPolicy) 仕様で指定されたアルゴリズムにマップされます。 有効な値は次のとおりです。<br /><br /> - **Basic128**: Aes128 暗号化、メッセージ ダイジェストに Sha1、Rsa oaep-mgf1p キー ラップします。<br /><br /> - **[Basic128rsa15]**: メッセージの暗号化に Aes128、メッセージ ダイジェストに Sha1、キー ラップに rsa15 を使用します。<br /><br /> -                          **Basic128Sha256**: メッセージの暗号化に Aes256、メッセージ ダイジェストに Sha256、キー ラップには Rsa-oaep-mgf1p です。<br /><br /> -                          **Basic128Sha256Rsa15**: メッセージの暗号化に Aes128、メッセージ ダイジェストに Sha256、キー ラップに rsa15 を使用します。<br /><br /> - **Basic192**: Aes192 暗号化、メッセージ ダイジェストに Sha1、キー ラップには Rsa-oaep-mgf1p です。<br /><br /> -                          **Basic192Rsa15**: メッセージの暗号化に Aes192、メッセージ ダイジェストに Sha1、キー ラップに rsa15 を使用します。<br /><br /> - **Basic192Sha256**: メッセージの暗号化に Aes192、メッセージ ダイジェストに Sha256、キー ラップには Rsa-oaep-mgf1p です。<br /><br /> -                          **Basic192Sha256Rsa15**: メッセージの暗号化に Aes192、メッセージ ダイジェストに Sha256、キー ラップに rsa15 を使用します。<br /><br /> -                          **Basic256**: Aes256 暗号化、メッセージ ダイジェストに Sha1、Rsa oaep-mgf1p キー ラップします。<br /><br /> - **Basic256Rsa15**: メッセージの暗号化に Aes256、メッセージ ダイジェストに Sha1、キー ラップに rsa15 を使用します。<br /><br /> - **Basic256Sha256**: メッセージの暗号化に Aes256、メッセージ ダイジェストに Sha256、キー ラップには Rsa-oaep-mgf1p です。<br /><br /> - **Basic256Sha256Rsa15**: メッセージの暗号化に Aes256、メッセージ ダイジェストに Sha256、キー ラップに rsa15 を使用します。<br /><br /> -                          **TripleDes**: TripleDes 暗号化、メッセージ ダイジェスト認証、Rsa oaep-mgf1p キー ラップには Sha1 です。<br /><br /> - **TripleDesRsa15**: TripleDes 暗号化、メッセージ ダイジェストに Sha1、キー ラップに rsa15 を使用します。<br /><br /> - **TripleDesSha256**: メッセージの暗号化に TripleDes、メッセージ ダイジェストに Sha256、キー ラップには Rsa-oaep-mgf1p です。<br /><br /> -                          **TripleDesSha256Rsa15**: メッセージの暗号化に TripleDes、メッセージ ダイジェストに Sha256、キー ラップに rsa15 を使用します。<br /><br /> 既定値は **[Basic256]** です。|  
    |**クライアント証明書の拇印**|サービスには、この送信ポートの認証に X.509 証明書の拇印を指定します。 拇印は、**[参照]** ボタンを使用して **[現在のユーザー]** の場所の **[My]** ストアを参照して選択できます。<br /><br /> **注:** にクライアント証明書をインストールする必要があります、**現在のユーザー**これをホストする送信ハンドラーのユーザー アカウントの場所の送信ポート。<br /><br /> 最小長: 0<br /><br /> 最大長:40<br /><br /> 既定値は空の文字列です。|  
    |**ユーザー名資格情報**|使用する場合は、メッセージを送信するための資格情報を指定**UserName**の**クライアント資格情報の種類のメッセージ**プロパティです。 プロパティを指定すると、必要なをクリックして、**資格情報の編集**ボタンをクリックします。<br /><br /> 既定値は**シングル サインオンを使用しない**です。|  
    |**ACS サービス id を使用します。**|適用されます[!INCLUDE[bts2013r2_md](../includes/bts2013r2-md.md)]と[!INCLUDE[btsBizTalkServerNoVersion_md](../includes/btsbiztalkservernoversion-md.md)]2013。<br/><br/>このチェック ボックスを選択し、クリックして**編集**Service Bus での認証に次の値を指定します。<br /><br /> - **アクセス制御サービス STS Uri** – これを設定して`https://<Namespace>-sb.accesscontrol.windows.net/`ここで、\<名前空間\>Service Bus 名前空間です。<br /><br /> - **発行者名**– 発行者名を指定します。 通常は所有者に設定します。<br /><br /> - **発行者キー** – 発行者キーを指定します。|  
    |**Service Bus の接続情報** | 始まる新しい[!INCLUDE[bts2016_md](../includes/bts2016-md.md)]です。<br/><br/>Shared Access Signature (SAS) または Service Bus 名前空間のアクセス制御サービス (ACS) の使用を選択します。 <br/><br/>オプションを選択し、**編集**キー情報を入力します。<br/><br/> - **Shared Access Signature** : アクセスのキー名とアクセス キーを入力します。 両方の値は、「、 [Azure ポータル](https://portal.azure.com)です。<br/> - **アクセス制御サービス**: STS URI を入力 (`https://<yourNamespace>-sb.accesscontrol.windows.net/`)、発行者名、および発行者キー。 これらの値を取得する」の説明に従って Windows PowerShell を使用して[Sb-messaging アダプター](../core/sb-messaging-adapter.md)です。 |
  
6.  **[WCF-NetTcpRelay トランスポートのプロパティ]** ダイアログ ボックスの **[メッセージ]** タブで、SOAP **Body** 要素のデータ選択を指定します。  
  
    |プロパティ|目的|  
    |--------------|----------------|  
    |**ボディ--BizTalk 要求メッセージの本文**|BizTalk メッセージのボディ部を使用して、SOAP のコンテンツを作成する**本文**送信メッセージの要素。<br /><br /> これが既定の設定です。|  
    |**テンプレート--テンプレートで指定されたコンテンツ**|**[XML]** ボックスで指定されているテンプレートを使用して、送信メッセージの SOAP **Body** 要素の内容を作成します。<br /><br /> 既定値はオフです。|  
    |**XML**|送信メッセージの SOAP **Body** 要素の内容に対する XML 形式のテンプレートを入力します。 **[ボディ -- BizTalk 応答メッセージ本文]** オプションが選択されている場合は、このプロパティが必要です。<br /><br /> 型:文字列<br /><br /> 最小長: 0<br /><br /> 最大長:32767<br /><br /> 既定値は < bts メッセージ本文<br /><br /> xmlns ="http://www.microsoft.com/schemas/bts2007"encoding ="xml"/>|  
    |**-エンベロープ\<Soap:envelope\>**|全体の SOAP から BizTalk メッセージのボディ部を作成する**エンベロープ**入力方向のです。 このプロパティは、送信請求 - 応答のポートに対してのみ有効です。<br /><br /> 既定値はオフです。|  
    |**本文--内容\<Soap:body\>要素**|受信メッセージの SOAP **Body** 要素の内容を使用して、BizTalk メッセージのボディ部を作成します。 **Body** 要素に複数の子要素がある場合は、最初の要素のみが BizTalk メッセージのボディ部になります。 このプロパティは、送信請求 - 応答のポートに対してのみ有効です。<br /><br /> これが既定の設定です。|  
    |**本文のパスで見つかったコンテンツ パス--**|**[本文のパス式]** ボックスのボディ パス式を使用して、BizTalk メッセージのボディ部を作成します。 ボディ パス式は、受信メッセージの SOAP **Body** 要素のすぐ下の子要素に対して評価されます。 このプロパティは、送信請求 - 応答のポートに対してのみ有効です。<br /><br /> 既定値はオフです。|  
    |**ボディ パス式**|BizTalk メッセージのボディ部を作成するために使用する受信メッセージの特定の部分を示すボディ パス式を入力します。 このボディ パス式が、SOAP の直接の子要素に対して評価されます**本文**受信メッセージのノードです。 このボディ パス式で複数のノードが返される場合は、最初のノードのみが BizTalk メッセージのボディ部に対して選択されます。 **[パス -- 本文のパスで見つかったコンテンツ]** オプションが選択されている場合は、このプロパティが必要です。 このプロパティは、送信請求 - 応答のポートに対してのみ有効です。<br /><br /> 型:文字列<br /><br /> 最小長: 0<br /><br /> 最大長:32767<br /><br /> 既定値は空の文字列です。|  
    |**ノードのエンコード**|ボディ パス式で識別されるノードに対して、Wcf-nettcprelay 送信アダプターがデコードに使用するエンコードの種類を指定、**本文のパス式**テキスト ボックス。 **[パス -- 本文のパスで見つかったコンテンツ]** オプションが選択されている場合は、このプロパティが必要です。 このプロパティは、送信請求 - 応答のポートに対してのみ有効です。 有効な値は次のとおりです。<br /><br /> -                          **Base64**: Base64 エンコードします。<br /><br /> - **16 進**: 16 進エンコードします。<br /><br /> - **文字列**: テキスト エンコード - utf-8<br /><br /> -                          **XML**: WCF アダプターは、ボディ パス式で選択されたノードの外部の XML での BizTalk メッセージ本文の作成、**本文のパス式**テキスト ボックス。<br /><br /> 既定値は **[XML]** です。|  
    |**エラー メッセージを伝達します。**|送信処理に失敗したメッセージを、他の受信ポートやオーケストレーション スケジュールなど、そのメッセージをサブスクライブしているアプリケーションに回送する場合は、このチェック ボックスをオンにします。 失敗したメッセージを保留し、否定の確認 (NACK) を生成する場合は、このチェック ボックスをオフにします。 このプロパティは、送信請求 - 応答のポートに対してのみ有効です。<br /><br /> 既定値が選択されます。|  
  
7.  をクリックして **[ok]** と**OK**もう一度設定を保存します。  
  
## <a name="set-maxconnections-in-the-handler"></a>ハンドラーでセット MaxConnections

1.  [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理コンソールで、展開[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理、展開**BizTalk グループ**、展開**プラットフォームの設定**、順に展開**アダプター**.  
  
2.  アダプターの一覧で選択**Wcf-nettcprelay**送信を選択するか、ハンドラーを受信します。  
  
3.  **アダプター ハンドラーのプロパティ**の**全般**] タブで [**プロパティ**です。  
  
4.  **ハンドラー**  タブ。   
  
    |プロパティ|目的|  
    |--------------|----------------|  
    |**接続の最大数**|(受信ハンドラー) の受信接続と接続プールにキャッシュされている各エンドポイントの発信接続 (送信ハンドラー) の最大数を指定します。 これによって、一意のリモート エンドポイントのそれぞれに対してキャッシュされる接続数が制限されます。 この値は、一意のリモート エンドポイントに対してキャッシュされることを想定している最大接続数よりも大きい値に設定する必要があります。 アクティブな接続の数は、この最大値を超えた場合、サービスは、この送信ハンドラーで実行されている Wcf-nettcprelay 送信ポートに応答しないように見える場合があります。<br /><br /> 既定値は、10 です。|  
  
5.  **[OK]** を選択して変更を保存します。  

## <a name="see-also"></a>参照
[Sb-messaging アダプター](../core/sb-messaging-adapter.md)

[アダプターの使用](../core/using-adapters.md)