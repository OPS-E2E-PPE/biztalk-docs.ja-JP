---
title: 'チュートリアル: オーケストレーションからのポリシーの呼び出し |Microsoft Docs'
ms.custom: ''
ms.date: 2016-04-05
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: cb2d2974-8a36-4d36-905c-799e4236ef99
caps.latest.revision: 30
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 33bef51b2c702e71fcf6ef0ea0c4fd63b28fbde8
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/27/2018
ms.locfileid: "36976561"
---
# <a name="walkthrough-invoking-the-policy-from-an-orchestration"></a>チュートリアル: オーケストレーションからのポリシーの呼び出し
ポリシーは、次のいずれかの方法でオーケストレーションから呼び出すことができます。  

- 使用して、**ルールの呼び出し**図形  

- 使用して、**式**図形、およびポリシーを実行するルール エンジンをプログラムで呼び出す (**Policy.Execute**メソッド)  

  使用して、**ルールの呼び出し**図形は、最も一般的な方法ともオーケストレーションからポリシーを呼び出すをお勧めします。 このチュートリアルでは、詳細な手順を使用して、**ルールの呼び出し**図形を呼び出す、 **ProcessPurchaseOrder**ポリシー。  

## <a name="prerequisites"></a>前提条件  
 完了する必要があります、[チュートリアル: ポリシーのテスト](../core/walkthrough-testing-the-policy.md)このチュートリアルを実行する前にチュートリアル。  

## <a name="overview-of-this-walkthrough"></a>このチュートリアルの概要  
 次の表に示すように、このチュートリアルには 7 つの手順が含まれています。  

|プロシージャ タイトル|手順の説明|  
|---------------------|---------------------------|  
|スキーマとオーケストレーションを使用して BizTalk プロジェクトを作成するには|スキーマと呼び出すオーケストレーションを作成するための手順について説明します、 **ProcessPurchaseOrder**ポリシー。|  
|メッセージ変数を作成するには|ステップごとの説明に従って、オーケストレーションで使用されるメッセージ変数を作成します。|  
|図形を構成するには|ステップごとの説明に従って、オーケストレーションの図形を構成します。|  
|ポートを作成するには|ステップごとの説明に従って、オーケストレーションのポートを作成します。|  
|ポートを図形に接続するには|ステップごとの説明に従って、ポートを図形に接続します。|  
|ソリューションをビルドおよび配置するには|ステップごとの説明に従って、ソリューションをビルドおよび展開します。|  
|ソリューションをテストするには、次の操作を行います。|ソリューションをテストします。|  

### <a name="to-create-a-biztalk-project-with-a-schema-and-an-orchestration"></a>スキーマとオーケストレーションを使用して BizTalk プロジェクトを作成するには  

1. 開始**Microsoft Visual Studio**します。  

2. [!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)], の **ファイル** メニューをポイント **新規**, 、クリックして **プロジェクト**します。  

3. **新しいプロジェクト** ダイアログ ボックスで、次の操作を行います。  


   |             プロパティ              |                             目的                              |
   |-----------------------------------|---------------------------------------------------------------------|
   |         **プロジェクトの種類**         |                     クリックして**BizTalk プロジェクト**します。                     |
   |           **[テンプレート]**           |               クリックして**空の BizTalk Server プロジェクト**します。               |
   |             **名前**              |                         型**RuleTest**します。                          |
   |           **場所**            |                  指定**C:\BRE-Walkthroughs**します。                   |
   |         **[ソリューション名]**         |                        型**RuleTestSol**します。                        |
   | **ソリューションのディレクトリを作成します。** | ソリューション ファイルのディレクトリを作成するには、このチェック ボックスをオンにします。 |


4. **[OK]** をクリックします。 **RuleTest**プロジェクトがソリューション エクスプ ローラーで表示されます。 ソリューション エクスプ ローラーが表示されない場合はクリックして**ソリューション エクスプ ローラー**上、**ビュー**メニュー。  

5. ソリューション エクスプ ローラーで右クリック**RuleTest**、 をポイント**追加**、 をクリックし、**既存項目の**。  

6. 参照し、追加、 **PO.xsd**で作成したスキーマ ファイル、[チュートリアル: 単純なビジネス ポリシーを作成する](../core/walkthrough-creating-a-simple-business-policy.md)チュートリアル。 Visual Studio でのコピー、 **PO.xsd**ファイルを開き、プロジェクトに追加します。  

7. ソリューション エクスプ ローラーで右クリック**RuleTest**、 をポイント**追加**、 をクリックし、**新しい項目の**。  

8. **新しい項目の追加** ダイアログ ボックスで、次の操作を行います。  


   |    プロパティ    |            目的            |
   |----------------|----------------------------------|
   | **カテゴリ** |  クリックして**オーケストレーション ファイル**します。  |
   | **[テンプレート]**  | クリックして**BizTalk オーケストレーション**します。 |
   |    **名前**    |      型**RuleTest.odx**します。      |


9. **[追加]** をクリックします。  

10. 右クリックして**ここで、ツールボックスから図形をドロップ**、 をポイント**図形の挿入**、順にクリックします**受信**します。  

11. [プロパティ] ウィンドウでの名前変更、**受信**図形を **[receivepo]** の値を設定し、**アクティブ化**プロパティを`true`します。  

12. ツールボックスで、上、 **BizTalk オーケストレーション** タブで、ドラッグ、**ルールの呼び出し**図形を区分線の下に、**受信**図形。  

13. [プロパティ] ウィンドウでの名前変更、**ルールの呼び出し**図形を**CallProcessPOPolicy**します。  

14. 下を右クリック、**ルールの呼び出し**図形をポイントして、**図形の挿入**、 をクリックし、**送信**します。  

15. [プロパティ] ウィンドウでの名前変更、**送信**図形を**SendPO**します。 オーケストレーションは次の図のようになります。  

     ![BRE&#45;チュートリアル&#45;UnconfiguredOrch](../core/media/1f3502ac-82a9-40bf-ae31-6e8356a283e2.gif "1f3502ac-82a9-40bf-ae31-6e8356a283e2")  

### <a name="to-create-message-variables"></a>メッセージ変数を作成するには  

1.  オーケストレーションの種類 ウィンドウで、右クリック**メッセージ**、 をクリックし、**新しいメッセージ**します。 オーケストレーションの種類 ウィンドウが表示されない場合はクリックして、**ビュー**メニューで、**その他の Windows**、順にクリックします**オーケストレーション**。 通常、[オーケストレーションの種類] ウィンドウは、[ソリューション エクスプローラー] タブの隣のタブにあります。既定では、新しいメッセージが名前付き**Message_1**します。  

     ![BRE&#45;チュートリアル&#45;OrchViewNewMsg](../core/media/a0b7fee3-af90-4c01-9464-146f0ca449e5.gif "a0b7fee3-af90-4c01-9464-146f0ca449e5")  

2.  オーケストレーションの種類] ウィンドウで、[ **Message_1**します。  

3.  [プロパティ ウィンドウ] で、次の操作を行います。  

    |プロパティ|目的|  
    |--------------|----------------|  
    |**[Identifier]**|型 **[poinst]**、し、ENTER キーを押します。|  
    |**メッセージの種類**|ドロップダウン リストから展開**スキーマ**、し、 **RuleTest.PO**します。|  

     ![BRE&#45;チュートリアル&#45;MsgProps](../core/media/c82cfb67-63f6-4133-95bf-daadac0e213a.gif "c82cfb67-63f6-4133-95bf-daadac0e213a")  

### <a name="to-configure-shapes"></a>図形を構成するには  

1. 選択、**受信**オーケストレーション デザイナーで図形。  

2. [プロパティ] ウィンドウで次のように選択します。 **[poinst]** の、**メッセージ**プロパティ。  

3. ダブルクリックして、**ルールの呼び出し**オーケストレーション デザイナーで図形。  

4. **ルールの呼び出しのポリシー構成**ダイアログ ボックスで、 **ProcessPurchaseOrder**ポリシー。  

5. [横] をクリックして**\\**<em>下の * * パラメーター名</em><em>を選択して **[poinst]</em>* ポリシーへのパラメーターとして。  

    ![BRE&#45;チュートリアル&#45;ConfigureCallRules](../core/media/0e7dab04-41db-433b-bbf5-b13901033b41.gif "0e7dab04-41db-433b-bbf5-b13901033b41")  

6. **[OK]** をクリックします。  

7. 選択、**送信**オーケストレーションの図形。  

8. [プロパティ] ウィンドウでの値を設定、**メッセージの種類**プロパティを **[poinst]** します。  

### <a name="to-create-ports"></a>ポートを作成するには  

1.  2 つのフォルダーを作成する**入力**と**出力**、C:\BRE-Walkthroughs\RuleTestSol フォルダー内です。  

2.  オーケストレーションの左のポート画面を右クリックし、クリックして**新しい構成済みポート**。  

3.  **[次へ]** をクリックします。 型**ReceivePOPrt**ポートの名前をします。  

4.  クリックして**次**2 回クリックします。  

5.  選択**今指定**の**ポートのバインド**します。  

6.  指定**ファイル**の**トランスポート**、入力ディレクトリの名前を入力および**C:\BRE-Walkthroughs\RuleTestSol\Input\\\*.xml**ファイル マスク (**\*.xml**) の URI。  

7.  **[次へ]** をクリックし、 **[完了]** をクリックします。  

8.  クリックして、オーケストレーションの右ポート画面を右クリックして**新しい構成ポート**します。  

9. **[次へ]** をクリックします。 型**SendPOPort**ポートの名前をします。  

10. クリックして**次**2 回クリックします。  

11. 変更、**ポートの通信方向**に**は常にメッセージを送信しますこのポートで**します。  

12. 選択**今指定**の**ポートのバインド**します。  

13. 指定**ファイル**の**トランスポート**、として出力ディレクトリの名前を入力および**C:\BRE-Walkthroughs\RuleTestSol\Output**、%messageid%.xml 出力ファイル名前。  

14. **[次へ]** をクリックし、 **[完了]** をクリックします。  

### <a name="to-connect-ports-with-the-shapes"></a>ポートを図形に接続するには  

1.  接続、 **ReceivePOPrt**ポートを**ReceivePO**図形。 ポート画面の [ReceivePOPrt] ポートの右側の矢印を [ReceivePO] 図形のボックスにドラッグします。  

     ![BRE&#45;チュートリアル&#45;ConnectRP](../core/media/75bdf79e-ca98-43bb-8ff6-5f46005a6490.gif "75bdf79e-ca98-43bb-8ff6-5f46005a6490")  

2.  接続、 **SendPO**図形を **[sendpoprt]** ポート。  

     ![BRE&#45;チュートリアル&#45;ConnectSP](../core/media/7513f52b-2782-4357-b8eb-1874dec33869.gif "7513f52b-2782-4357-b8eb-1874dec33869")  

### <a name="to-build-and-deploy-the-solution"></a>ソリューションをビルドおよび配置するには  

1. 開始**Microsoft Visual Studio**します。  

2. [!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)]、ソリューション エクスプ ローラーで右クリックし、 **RuleTest**プロジェクトをクリックして**プロパティ**します。  

3. プロジェクト デザイナー (中央のウィンドウ) で、次のようにクリックします。**署名**します。  

4. 署名 タブで確認**アセンブリに署名**チェック ボックスをオンにします。ドロップダウン リストで**厳密な名前キー ファイルを選択して**、 をクリックして**新規**;**キー ファイル名**フィールドに、ルールのテストの入力**パスワード**(省略可能) をフィールドにパスワードを設定してクリックして**OK**します。  

5. プロジェクト デザイナーで、次のようにクリックします。**展開**展開 タブに切り替えます。  

6. 指定**RuleTestApp**アプリケーション名として。  

    ![BRE&#45;チュートリアル&#45;RuleTestApp](../core/media/b153e5b0-ca46-4d27-bfa1-9ad4e58e9787.gif "b153e5b0-ca46-4d27-bfa1-9ad4e58e9787")  

7. **[OK]** をクリックします。  

8. 右クリックし、 **RuleTest**プロジェクトをクリックして**ビルド**します。  

9. 右クリックし、 **RuleTest**プロジェクトをクリックして**デプロイ**します。  

### <a name="to-test-the-solution"></a>ソリューションをテストするには、次の操作を行います。  

1. ビジネス ルール作成ツールで展開**ポリシー**、展開**ProcessPurchaseOrder**を右クリックして**バージョン 1.0**、 をクリックし、**発行**.  

2. 右クリック**バージョン 1.0 - 公開済み**、 をクリックし、**デプロイ**します。  

3. **開始**] メニューの [open **BizTalk Server 管理**します。 BizTalk Server 管理コンソールを既に開いている場合は、F5 キーを押して更新します。  

4. 展開**コンソール ルート**、展開[!INCLUDE[btsBizTalkServerAdminConsoleui](../includes/btsbiztalkserveradminconsoleui-md.md)]、展開**BizTalk グループ**、順に展開**アプリケーション**します。  

5. 右クリック**RuleTestApp**、 をクリックし、**構成**します。  

6. をクリックして**Orchestration_1**、し、指定**BizTalkServerApplication**としてホストします。  

    ![BRE&#45;チュートリアル&#45;AppHost](../core/media/ba348a98-661f-4e71-8b9b-b8c5fadf035a.gif "ba348a98-661f-4e71-8b9b-b8c5fadf035a")  

7. **[OK]** をクリックします。  

8. 右クリック**RuleTestApp**、 をクリックし、**開始**します。  

9. **'RuleTestApp' アプリケーションの起動**ダイアログ ボックスで、をクリックして**開始**アプリケーションが正常に開始されるを待ちます。  

10. 開いている**SamplePO.xml**と**SamplePO2.xml**メモ帳での値を変更し、**状態**フィールドを**XYZ**します。  

11. コピー、 **SamplePO.xml**オーケストレーション用の C:\BRE-Walkthroughs\RuleTestSol\Input ディレクトリに C:\BRE-Walkthroughs ディレクトリからファイル。  

12. オーケストレーションの C:\BRE-Walkthroughs\RuleTestSol\Output ディレクトリに出力ファイルが表示されます。 出力 XML ファイルを開き、注意の値、**状態**にフィールドが設定されている**Approved**します。  

13. 手順 11. ~ 12. を繰り返します**SamplePO2.xml**、いることを確認しの値、**状態**出力ドキュメント内のフィールドは、入力ドキュメントと同じ (**xyz**)。  

## <a name="comments"></a>コメント  

-   このチュートリアルでは、オーケストレーションに図形を追加する際に、ツールボックスの図形は使用しませんでした。 代わりに、マウスの右ボタンをクリックして挿入する図形を選択しました。  

-   構成、**ルールの呼び出し**図形が使用される型を決定するときに保存されている最新バージョンは。 実行時に、展開されている最新のバージョンが使用されます。  

-   使用する必要が展開されている最新バージョン以外のポリシー バージョンを使用する場合は、**式**図形し、その特定のバージョンのポリシーを実行するには、プログラムによってルール エンジンを呼び出しています。 詳細については、次を参照してください。[ポリシーの実行方法](../core/how-to-execute-policies.md)します。  

-   **ルールの呼び出し**図形を使用したかのように、メッセージを再構築、**メッセージの構築**図形、失われたメッセージのコンテキスト プロパティがさらに可能性があります。  

-   公開されたポリシーは、変更できません。  

-   クライアント アプリケーションは、展開されているポリシーのみにアクセスできます。 ルール エンジンを生成するクライアント アプリケーションに展開されていないポリシーが呼び出される場合、 **RuleEngineDeploymentNotDeployedException**例外。 アプリケーション イベント ログで、詳細エラー メッセージを確認できます。  

## <a name="next-steps"></a>次の手順  
 これで、このチュートリアルを完了すると、実行、[チュートリアル: ポリシーでのボキャブラリの作成と](../core/walkthrough-creating-and-using-a-vocabulary-in-the-policy.md)ボキャブラリを作成すると、では、ボキャブラリを使用して詳細な手順を説明するチュートリアル、**ProcessPurchaseOrder**ポリシー。  

## <a name="see-also"></a>参照  
 [条件の評価とアクションの実行](../core/condition-evaluation-and-action-execution.md)   
 [議題と優先度](../core/agenda-and-priority.md)   
 [オーケストレーションでのビジネス ルールの呼び出し](../core/invoking-business-rules-in-orchestrations.md)