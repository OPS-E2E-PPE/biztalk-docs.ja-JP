---
title: 'チュートリアル: がオーケストレーションからポリシーを呼び出す |Microsoft ドキュメント'
ms.custom: ''
ms.date: 2016-04-05
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: cb2d2974-8a36-4d36-905c-799e4236ef99
caps.latest.revision: 30
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 36de942d34a4235b689b464192a460451e7c921a
ms.sourcegitcommit: 8418b1a8f38b7f56979cd6e203f0b591e2f40fe1
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/28/2018
ms.locfileid: "22291346"
---
# <a name="walkthrough-invoking-the-policy-from-an-orchestration"></a>チュートリアル: オーケストレーションからのポリシーの呼び出し
ポリシーは、次のいずれかの方法でオーケストレーションから呼び出すことができます。  
  
-   使用して、 **ルールの呼び出し** 図形  
  
-   使用して、 **式** 形状、およびプログラムを使用してポリシーを実行するルール エンジンの呼び出し (**Policy.Execute** メソッド)  
  
 使用して、 **ルールの呼び出し** 図形が最も一般的な方法と、オーケストレーションからポリシーを呼び出すことをお勧めします。 このチュートリアルでは、詳細な手順を使用して、 **ルールの呼び出し** 図形を呼び出す、 **ProcessPurchaseOrder** ポリシーです。  
  
## <a name="prerequisites"></a>前提条件  
 完了する必要があります、[チュートリアル: ポリシーのテスト](../core/walkthrough-testing-the-policy.md)このチュートリアルを実行する前にチュートリアルです。  
  
## <a name="overview-of-this-walkthrough"></a>このチュートリアルの概要  
 次の表に示すように、このチュートリアルには 7 つの手順が含まれています。  
  
|手順のタイトル|手順の説明|  
|---------------------|---------------------------|  
|スキーマとオーケストレーションを使用して BizTalk プロジェクトを作成するには|スキーマとを呼び出すオーケストレーションを作成する手順については、 **ProcessPurchaseOrder** ポリシーです。|  
|メッセージ変数を作成するには|ステップごとの説明に従って、オーケストレーションで使用されるメッセージ変数を作成します。|  
|図形を構成するには|ステップごとの説明に従って、オーケストレーションの図形を構成します。|  
|ポートを作成するには|ステップごとの説明に従って、オーケストレーションのポートを作成します。|  
|ポートを図形に接続するには|ステップごとの説明に従って、ポートを図形に接続します。|  
|ソリューションをビルドおよび配置するには|ステップごとの説明に従って、ソリューションをビルドおよび展開します。|  
|ソリューションをテストするには、次の操作を行います。|ソリューションをテストします。|  
  
### <a name="to-create-a-biztalk-project-with-a-schema-and-an-orchestration"></a>スキーマとオーケストレーションを使用して BizTalk プロジェクトを作成するには  
  
1.  開始 **Microsoft Visual Studio**します。  
  
2.  [!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)], の **ファイル** メニューをポイント **新規**, 、クリックして **プロジェクト**します。  
  
3.  **新しいプロジェクト**  ダイアログ ボックスで、次の操作します。  
  
    |プロパティ|目的|  
    |--------------|----------------|  
    |**プロジェクトの種類**|クリックして **BizTalk プロジェクト**します。|  
    |**テンプレート**|クリックして **空の BizTalk Server プロジェクト**します。|  
    |**名**|型 **RuleTest**します。|  
    |**場所**|指定 **C:\BRE-Walkthroughs**します。|  
    |**ソリューション名**|型 **RuleTestSol**します。|  
    |**ソリューションのディレクトリを作成します。**|ソリューション ファイルのディレクトリを作成するには、このチェック ボックスをオンにします。|  
  
4.  **[OK]** をクリックします。 **RuleTest** プロジェクトがソリューション エクスプ ローラーで表示されます。 ソリューション エクスプ ローラーが表示されない場合はクリックして **ソリューション エクスプ ローラー** 上、 **ビュー** メニュー。  
  
5.  ソリューション エクスプ ローラーで右クリック **RuleTest**, 、 をポイント **追加**, 、 をクリックし、 **既存項目の**です。  
  
6.  参照したり追加したり、 **PO.xsd**で作成したスキーマ ファイル、[チュートリアル: 単純なビジネス ポリシーを作成する](../core/walkthrough-creating-a-simple-business-policy.md)チュートリアルです。 Visual Studio でのコピーを作成、 **PO.xsd** ファイルをプロジェクトに追加します。  
  
7.  ソリューション エクスプ ローラーで右クリック **RuleTest**, 、 をポイント **追加**, 、 をクリックし、 **新しい項目の**です。  
  
8.  **新しい項目の追加**  ダイアログ ボックスで、次の操作します。  
  
    |プロパティ|目的|  
    |--------------|----------------|  
    |**カテゴリ**|クリックして **オーケストレーション ファイル**します。|  
    |**テンプレート**|クリックして **BizTalk オーケストレーション**します。|  
    |**名**|型 **RuleTest.odx**します。|  
  
9. **[追加]** をクリックします。  
  
10. 右クリック **ツールボックスからここに図形をドロップ**, 、 をポイント **図形の挿入**, 、クリックして **受信**します。  
  
11. [プロパティ] ウィンドウでの名前変更、 **受信** 図形を **ReceivePO**, の値を設定し、 **をアクティブにする** プロパティを `true`します。  
  
12. ツールボックスで、上、 **BizTalk オーケストレーション**  タブで、ドラッグ、 **ルールの呼び出し** 下の区分線に図形、 **受信** 図形です。  
  
13. [プロパティ] ウィンドウでの名前変更、 **ルールの呼び出し** 図形を **CallProcessPOPolicy**します。  
  
14. 下を右クリック、 **ルールの呼び出し** 図形をポイントし、 **図形の挿入**, 、クリックして **送信**します。  
  
15. [プロパティ] ウィンドウでの名前変更、 **送信** 図形を **SendPO**します。 オーケストレーションは次の図のようになります。  
  
     ![BRE&#45;チュートリアル&#45;UnconfiguredOrch](../core/media/1f3502ac-82a9-40bf-ae31-6e8356a283e2.gif "1f3502ac-82a9-40bf-ae31-6e8356a283e2")  
  
### <a name="to-create-message-variables"></a>メッセージ変数を作成するには  
  
1.  オーケストレーションの種類 ウィンドウを右クリックして **メッセージ**, 、クリックして **新しいメッセージ**します。 オーケストレーションの種類 ウィンドウが表示されない場合はクリックして、 **ビュー** メニューをポイントし **その他のウィンドウ**, 、クリックして **オーケストレーションの種類**します。 通常、[オーケストレーションの種類] ウィンドウは、[ソリューション エクスプローラー] タブの隣のタブにあります。既定では、新しいメッセージの名前は **Message_1**します。  
  
     ![BRE&#45;チュートリアル&#45;OrchViewNewMsg](../core/media/a0b7fee3-af90-4c01-9464-146f0ca449e5.gif "a0b7fee3-af90-4c01-9464-146f0ca449e5")  
  
2.  オーケストレーションの種類] ウィンドウで [ **Message_1**します。  
  
3.  [プロパティ ウィンドウ] で、次の操作を行います。  
  
    |プロパティ|目的|  
    |--------------|----------------|  
    |**識別子**|型 **[poinst]**, 、ENTER キーを押します。|  
    |**メッセージの種類**|ドロップダウン リストから、展開 **スキーマ**, 、し、 **RuleTest.PO**します。|  
  
     ![BRE&#45;Walkthrough&#45;MsgProps](../core/media/c82cfb67-63f6-4133-95bf-daadac0e213a.gif "c82cfb67-63f6-4133-95bf-daadac0e213a")  
  
### <a name="to-configure-shapes"></a>図形を構成するには  
  
1.  選択、 **受信** オーケストレーション デザイナーでの図形です。  
  
2.  プロパティ ウィンドウで  **poinst** の **メッセージ** プロパティです。  
  
3.  ダブルクリックして、 **ルールの呼び出し** オーケストレーション デザイナーでの図形です。  
  
4.  **ルールの呼び出しのポリシー構成** ダイアログ ボックスで、 **ProcessPurchaseOrder** ポリシーです。  
  
5.  横をクリックして **\***, 、下 **パラメーター名**, を選択して **[poinst]** ポリシーへのパラメーターとして。  
  
     ![BRE&#45;チュートリアル&#45;ConfigureCallRules](../core/media/0e7dab04-41db-433b-bbf5-b13901033b41.gif "0e7dab04-41db-433b-bbf5-b13901033b41")  
  
6.  **[OK]** をクリックします。  
  
7.  選択、 **送信** 、オーケストレーションの図形です。  
  
8.  [プロパティ] ウィンドウの値を設定、 **メッセージの種類** プロパティを **[poinst]** します。  
  
### <a name="to-create-ports"></a>ポートを作成するには  
  
1.  2 つのフォルダーを作成する **入力** と **出力**, 、C:\BRE-Walkthroughs\RuleTestSol フォルダーにします。  
  
2.  オーケストレーションの左のポート画面を右クリックし、をクリックし、 **新しい構成済みポート**します。  
  
3.  **[次へ]** をクリックします。 型 **ReceivePOPrt** ポートの名前をします。  
  
4.  クリックして **次** 2 回クリックします。  
  
5.  選択 **今指定する** の **ポートのバインド**します。  
  
6.  指定 **ファイル** の **トランスポート**, 、入力ディレクトリの名前を入力し、 **C:\BRE-Walkthroughs\RuleTestSol\Input\\\*.xml** ファイル マスクと共に (**\*.xml**) の URI。  
  
7.  **[次へ]** をクリックし、 **[完了]** をクリックします。  
  
8.  オーケストレーションの右ポート画面を右クリックし、クリックして **新しい構成ポート**します。  
  
9. **[次へ]** をクリックします。 型 **SendPOPort** ポートの名前をします。  
  
10. クリックして **次** 2 回クリックします。  
  
11. 変更、 **ポートの通信方向** に **は常にメッセージを送信しますこのポートで**します。  
  
12. 選択 **今指定する** の **ポートのバインド**します。  
  
13. 指定 **ファイル** の **トランスポート**, と出力ディレクトリの名前を入力し、 **C:\BRE-Walkthroughs\RuleTestSol\Output**,、出力ファイル名「%messageid%.xml です。  
  
14. **[次へ]** をクリックし、 **[完了]** をクリックします。  
  
### <a name="to-connect-ports-with-the-shapes"></a>ポートを図形に接続するには  
  
1.  接続、 **ReceivePOPrt** ポートを **ReceivePO** 図形です。 ポート画面の [ReceivePOPrt] ポートの右側の矢印を [ReceivePO] 図形のボックスにドラッグします。  
  
     ![BRE&#45;チュートリアル&#45;ConnectRP](../core/media/75bdf79e-ca98-43bb-8ff6-5f46005a6490.gif "75bdf79e-ca98-43bb-8ff6-5f46005a6490")  
  
2.  接続、 **SendPO** 図形を **SendPOPrt** ポートです。  
  
     ![BRE&#45;チュートリアル&#45;ConnectSP](../core/media/7513f52b-2782-4357-b8eb-1874dec33869.gif "7513f52b-2782-4357-b8eb-1874dec33869")  
  
### <a name="to-build-and-deploy-the-solution"></a>ソリューションをビルドおよび配置するには  
  
1.  開始 **Microsoft Visual Studio**します。  
  
2.  [!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)]、ソリューション エクスプ ローラーで右クリックし、 **RuleTest**プロジェクトをクリックして**プロパティ**です。  
  
3.  プロジェクト デザイナー (中央のウィンドウ)、クリックして **署名**します。  
  
4.  署名 タブの 確認 **アセンブリに署名** チェック ボックスをオンにします。ドロップダウン リストで **厳密な名前キー ファイルを選択して**, をクリックして **新規**です。 **キー ファイル名** フィールドに、ルールのテストを入力してください。 **パスワード** (省略可能) をフィールド、パスワードを設定し、クリックして **OK**します。  
  
5.  プロジェクト デザイナーでクリックして **展開** 展開 タブに切り替えます。  
  
6.  指定 **RuleTestApp** アプリケーション名として。  
  
     ![BRE&#45;チュートリアル&#45;RuleTestApp](../core/media/b153e5b0-ca46-4d27-bfa1-9ad4e58e9787.gif "b153e5b0-ca46-4d27-bfa1-9ad4e58e9787")  
  
7.  **[OK]** をクリックします。  
  
8.  右クリックし、 **RuleTest** [プロジェクト] をクリックして **ビルド**します。  
  
9. 右クリックし、 **RuleTest** [プロジェクト] をクリックして **展開**します。  
  
### <a name="to-test-the-solution"></a>ソリューションをテストするには、次の操作を行います。  
  
1.  ビジネス ルール作成ツールで展開 **ポリシー**, 、展開 **ProcessPurchaseOrder**, を右クリックして **バージョン 1.0**, 、 をクリックし、 **発行**します。  
  
2.  右クリック **バージョン 1.0 - 公開済み**, 、クリックして **展開**します。  
  
3.  **開始** ] メニューの [開く **BizTalk Server 管理コンソール**します。 BizTalk Server 管理コンソールを既に開いている場合は、F5 キーを押して更新します。  
  
4.  展開**コンソール ルート**、展開[!INCLUDE[btsBizTalkServerAdminConsoleui](../includes/btsbiztalkserveradminconsoleui-md.md)]、展開**BizTalk グループ**、順に展開**アプリケーション**です。  
  
5.  右クリック **RuleTestApp**, 、クリックして **構成**します。  
  
6.  をクリックして **Orchestration_1**, を指定して **BizTalkServerApplication** ホストとします。  
  
     ![BRE&#45;Walkthrough&#45;AppHost](../core/media/ba348a98-661f-4e71-8b9b-b8c5fadf035a.gif "ba348a98-661f-4e71-8b9b-b8c5fadf035a")  
  
7.  **[OK]** をクリックします。  
  
8.  右クリック **RuleTestApp**, 、 をクリックし、 **開始**します。  
  
9. **'RuleTestApp' アプリケーションの起動** ダイアログ ボックスで、をクリックして **開始**, 、し、アプリケーションが正常に開始されるを待ちます。  
  
10. 開いている **SamplePO.xml** と **SamplePO2.xml** メモ帳での値を変更し、 **ステータス** フィールドを **XYZ**します。  
  
11. コピー、 **SamplePO.xml** オーケストレーション用の C:\BRE-Walkthroughs\RuleTestSol\Input ディレクトリに C:\BRE-Walkthroughs ディレクトリからファイルです。  
  
12. オーケストレーションの C:\BRE-Walkthroughs\RuleTestSol\Output ディレクトリに出力ファイルが表示されます。 出力 XML ファイルを開き、ことに注意しての値、 **ステータス** フィールドに設定されている **Approved**します。  
  
13. 手順 11 ~ 12. を繰り返して **SamplePO2.xml**, 、ことを確認の値、 **ステータス** 出力ドキュメント内のフィールドは、入力ドキュメントと同じ (**xyz**)。  
  
## <a name="comments"></a>コメント  
  
-   このチュートリアルでは、オーケストレーションに図形を追加する際に、ツールボックスの図形は使用しませんでした。 代わりに、マウスの右ボタンをクリックして挿入する図形を選択しました。  
  
-   構成、 **ルールの呼び出し** 使用される型を決定するとき、図形が保存されている最新のバージョンは検索します。 実行時に、展開されている最新のバージョンが使用されます。  
  
-   使用する必要が展開されている最新のバージョン以外のポリシー バージョンを使用する場合、 **式** 形状、およびその特定バージョンのポリシーを実行するプログラムを使用して、ルール エンジンを起動します。 詳細については、次を参照してください。[ポリシーの実行方法](../core/how-to-execute-policies.md)です。  
  
-   **ルールの呼び出し** 図形を使用するかのように、メッセージを再構築、 **メッセージの構築** 順番が失われるメッセージのコンテキスト プロパティを引き起こす可能性のある図形です。  
  
-   公開されたポリシーは、変更できません。  
  
-   クライアント アプリケーションは、展開されたポリシーのみにアクセスできます。 クライアント アプリケーションが展開されていないポリシーを呼び出す場合、ルール エンジンを生成、 **RuleEngineDeploymentNotDeployedException** 例外です。 アプリケーション イベント ログで、詳細エラー メッセージを確認できます。  
  
## <a name="next-steps"></a>次の手順  
 これで、このチュートリアルを完了すると、実行、[チュートリアル: ポリシーで作成およびボキャブラリ](../core/walkthrough-creating-and-using-a-vocabulary-in-the-policy.md)およびでボキャブラリを使用するボキャブラリを作成するための手順を説明するチュートリアルについては、**ProcessPurchaseOrder**ポリシー。  
  
## <a name="see-also"></a>参照  
 [条件の評価とアクションの実行](../core/condition-evaluation-and-action-execution.md)   
 [議題と優先度](../core/agenda-and-priority.md)   
 [オーケストレーションでのビジネス ルールの呼び出し](../core/invoking-business-rules-in-orchestrations.md)