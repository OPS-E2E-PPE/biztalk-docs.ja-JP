---
title: アグリーメントの解決と送信 EDI メッセージ スキーマの決定 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: e37aeb9d-1e95-464d-bb71-73653c1d4674
caps.latest.revision: 24
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: a718f386686b8a23bc8c97108b94b5fba717ee90
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/27/2018
ms.locfileid: "36992027"
---
# <a name="agreement-resolution-and-schema-determination-for-outgoing-edi-messages"></a><span data-ttu-id="78be0-102">送信 EDI メッセージのアグリーメントの解決とスキーマの決定</span><span class="sxs-lookup"><span data-stu-id="78be0-102">Agreement Resolution and Schema Determination for Outgoing EDI Messages</span></span>
<span data-ttu-id="78be0-103">取引先への EDI メッセージを生成するには、EDI 送信パイプラインは次の作業を行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="78be0-103">To generate an EDI message to a trading partner, the EDI send pipeline must do the following:</span></span>  
  
-   <span data-ttu-id="78be0-104">メッセージの解決先となるアグリーメントを指定する。</span><span class="sxs-lookup"><span data-stu-id="78be0-104">Determine the agreement that the message resolves to</span></span>  
  
-   <span data-ttu-id="78be0-105">メッセージの検証に使用するスキーマを指定する。</span><span class="sxs-lookup"><span data-stu-id="78be0-105">Determine the schema to use to validate the message</span></span>  
  
## <a name="agreement-resolution"></a><span data-ttu-id="78be0-106">アグリーメント解決</span><span class="sxs-lookup"><span data-stu-id="78be0-106">Agreement Resolution</span></span>  
 <span data-ttu-id="78be0-107">EDI 送信パイプラインは、送信インターチェンジとアグリーメントのプロパティとの間に一致があるかどうかを判断する一連の手順を実行することで、アグリーメントの参照を実行します。</span><span class="sxs-lookup"><span data-stu-id="78be0-107">The EDI send pipeline performs agreement lookup by performing a series of steps to determine whether there is a match between the outgoing interchange and the properties of an agreement.</span></span> <span data-ttu-id="78be0-108">[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] によってアグリーメントが特定されると、次に、そのインターチェンジに適用されるドキュメント スキーマが特定されます (後述)。</span><span class="sxs-lookup"><span data-stu-id="78be0-108">Once [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] has determined the agreement, it determines the document schema that applies to the interchange (see below).</span></span> <span data-ttu-id="78be0-109">一致するアグリーメントに関連付けられたプロパティと関連するスキーマを使用して、送信メッセージの生成と検証が行われます。</span><span class="sxs-lookup"><span data-stu-id="78be0-109">It uses the properties associated with the matching agreement and the relevant schema to generate and validate the outgoing message.</span></span>  
  
 <span data-ttu-id="78be0-110">[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] がアグリーメント解決を実行する手順は、次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="78be0-110">To perform agreement resolution, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] proceeds as follows:</span></span>  
  
1. <span data-ttu-id="78be0-111">AgreementPartIDForSend コンテキスト プロパティを一方向アグリーメントの ID と照合してアグリーメントを解決します。</span><span class="sxs-lookup"><span data-stu-id="78be0-111">Resolves the agreement by matching the AgreementPartIDForSend context property with the ID of the one-way agreement.</span></span> <span data-ttu-id="78be0-112">このプロパティには整数型を指定する必要があり、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] ではなくカスタム コンポーネントで設定できます。</span><span class="sxs-lookup"><span data-stu-id="78be0-112">This property should be an integer type, it can be set in a custom component; it is not set by [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span></span>  
  
2. <span data-ttu-id="78be0-113">手順 1. で一致するものが見つからない場合は、3 つのコンテキスト プロパティ (AgreementNameForSend、SenderPartyNameForSend、および ReceiverPartyNameForSend) すべてをアグリーメントのプロパティと照合して、アグリーメントを解決します。</span><span class="sxs-lookup"><span data-stu-id="78be0-113">If step 1 does not succeed, resolves the agreement by matching all the following three context properties with the agreement properties: AgreementNameForSend, SenderPartyNameForSend, ReceiverPartyNameForSend.</span></span> <span data-ttu-id="78be0-114">アグリーメントを正しく解決するには、3 つのプロパティがすべて設定されている必要があります。</span><span class="sxs-lookup"><span data-stu-id="78be0-114">Note that all the three properties must be set in order to successfully resolve to an agreement.</span></span> <span data-ttu-id="78be0-115">これらのプロパティは、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] ではなくカスタム コンポーネントで設定できます。</span><span class="sxs-lookup"><span data-stu-id="78be0-115">These properties can be set in a custom component; it is not set by [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span></span>  
  
3. <span data-ttu-id="78be0-116">手順 2. が成功しなかった場合は、メッセージ コンテキスト プロパティで、その他のアグリーメント リゾルバーとして設定された DestinationPartyName プロパティのパーティ名を照合してアグリーメントを解決、**識別子**のタブアグリーメントのプロパティ。</span><span class="sxs-lookup"><span data-stu-id="78be0-116">If step 2 does not succeed, resolves the agreement by matching the party name in the message context properties with the DestinationPartyName property, which is set as additional agreement resolver in the **Identifiers** tab of agreement properties.</span></span>  
  
4. <span data-ttu-id="78be0-117">手順 3. で一致するものが見つからない場合は、メッセージのコンテキスト内の DestinationPartySenderIdentifier、DestinationPartySenderQualifier、DestinationPartyReceiverIdentifier、および DestinationPartyReceiverQualifier プロパティを、アグリーメントのプロパティと照合して、アグリーメントを解決します。</span><span class="sxs-lookup"><span data-stu-id="78be0-117">If step 3 does not succeed, resolves the agreement by matching the following properties in the context of a message with those in agreement properties: DestinationPartySenderIdentifier, DestinationPartySenderQualifier, DestinationPartyReceiverIdentifier, and DestinationPartyReceiverQualifier.</span></span> <span data-ttu-id="78be0-118">アグリーメントを正しく解決するには、4 つのプロパティがすべて設定されている必要があります。</span><span class="sxs-lookup"><span data-stu-id="78be0-118">Note that all the four properties must be set in order to successfully resolve to an agreement.</span></span> <span data-ttu-id="78be0-119">カスタム コンポーネントでこれらのプロパティを設定できます。設定されていない[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]します。</span><span class="sxs-lookup"><span data-stu-id="78be0-119">These properties can be set in a custom component; they are not set by [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span></span> <span data-ttu-id="78be0-120">詳細については、以下を参照してください。</span><span class="sxs-lookup"><span data-stu-id="78be0-120">For more information, see below.</span></span>  
  
   > [!NOTE]
   >  <span data-ttu-id="78be0-121">上記のコンテキスト プロパティのセットのいずれかが昇格されていて、それらのコンテキスト プロパティに関連付けられたアグリーメントを [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] で見つけることができない場合は、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] によってメッセージが中断されます。</span><span class="sxs-lookup"><span data-stu-id="78be0-121">If any of the above sets of context properties are promoted and [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] is unable to find an agreement associated with those context properties, then [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] suspends the message.</span></span>  
   > 
   >  <span data-ttu-id="78be0-122">ユーザーが意図的にアグリーメント解決用のコンテキスト プロパティのセットを記述し、リゾルバーが OnewayAgreement を識別できない場合は、メッセージが中断されます。</span><span class="sxs-lookup"><span data-stu-id="78be0-122">If the user intentionally writes a set of context properties for agreement resolution, and if the resolver fails to identify the OnewayAgreement, then the message is suspended.</span></span> <span data-ttu-id="78be0-123">コンテキスト プロパティのセットに基づいてアグリーメントを解決できない場合、そのことを示す警告メッセージが EventLog にスローされます。</span><span class="sxs-lookup"><span data-stu-id="78be0-123">On failure to resolve to an agreement based on a set of context properties, a corresponding warning message is thrown in the EventLog.</span></span>  
  
5. <span data-ttu-id="78be0-124">手順 4. が成功せず、または昇格上記のコンテキスト プロパティのいずれも、EDI メッセージがアグリーメントに解決アグリーメントに関連付けられている送信ポートとメッセージをサブスクライブした送信ポートを照合することによりします。</span><span class="sxs-lookup"><span data-stu-id="78be0-124">If step 4 does not succeed or none of the above context properties are promoted, then the EDI message is resolved to an agreement by matching the send port that subscribed to the message with the send port associated with an agreement.</span></span>  
  
   > [!NOTE]
   >  <span data-ttu-id="78be0-125">1 つの送信ポートが複数のアグリーメントに関連付けられていると、[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] によってエラーが生成されます。</span><span class="sxs-lookup"><span data-stu-id="78be0-125">If the same send port is associated with multiple agreements, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] will generate an error.</span></span>  
  
6. <span data-ttu-id="78be0-126">手順 1.、2.、3.、または 4. でアグリーメントが見つからない場合、送信パイプラインはフォールバック アグリーメント設定を使用して、送信メッセージを生成します。</span><span class="sxs-lookup"><span data-stu-id="78be0-126">If no agreement is found in steps 1, 2, 3, or 4, the send pipeline uses the fallback agreement settings to generate the outgoing message.</span></span>  
  
   <span data-ttu-id="78be0-127">**送信者と受信者のコンテキスト プロパティ照合によるアグリーメントの解決**</span><span class="sxs-lookup"><span data-stu-id="78be0-127">**Agreement Resolution by Matching Sender and Receiver Context Properties**</span></span>  
  
   <span data-ttu-id="78be0-128">前の 2 番目の手順で、照合に使用されたコンテキスト プロパティは EDI.DestinationPartySenderIdentifier、EDI.DestinationPartySenderQualifier、EDI.DestinationPartyReceiverIdentifier、および EDI.DestinationPartyReceiverQualifier の 4 つです。</span><span class="sxs-lookup"><span data-stu-id="78be0-128">In the second step above, the four context properties used in the match are EDI.DestinationPartySenderIdentifier, EDI.DestinationPartySenderQualifier, EDI.DestinationPartyReceiverIdentifier, and EDI.DestinationPartyReceiverQualifier.</span></span> <span data-ttu-id="78be0-129">これらのコンテキスト プロパティの名前空間は、`http://schemas.microsoft.com/Edi/PropertySchema` です。</span><span class="sxs-lookup"><span data-stu-id="78be0-129">The namespace for these context properties is `http://schemas.microsoft.com/Edi/PropertySchema`.</span></span> [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="78be0-130"> は、これらの値と、一方向のアグリーメント プロパティ内の関連する送信者および受信者の識別子および修飾子との照合を試みます。</span><span class="sxs-lookup"><span data-stu-id="78be0-130"> attempts to match these values with the related sender and receiver identifiers and qualifiers in the one-way agreement properties.</span></span> <span data-ttu-id="78be0-131">これらのフィールドは isa05、isa06、isa07、および ISA08 x12 の場合、**識別子**で一方向アグリーメント タブのページ、**アグリーメントのプロパティ**; ダイアログ ボックス、UNB2.1、UNB2.2、EDIFACT の場合、これらのフィールドUnb3.1、および unb3.2 で、**識別子**で一方向アグリーメント タブのページ、**アグリーメントのプロパティ** ダイアログ ボックス。</span><span class="sxs-lookup"><span data-stu-id="78be0-131">For X12, these fields are ISA05, ISA06, ISA07, and ISA08 in the **Identifiers** page of the one-way agreement tab in the **Agreement Properties** dialog box; for EDIFACT, these fields are UNB2.1, UNB2.2, UNB3.1, and UNB3.2 in the **Identifiers** page of the one-way agreement tab in the **Agreement Properties** dialog box.</span></span>  
  
   <span data-ttu-id="78be0-132">送信者と受信者の識別子および修飾子の 4 つすべてを使用して送信側アグリーメントの解決を有効にするには、これらの 4 つのコンテキスト プロパティをすべて設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="78be0-132">To enable send-side agreement resolution using all four sender and receiver identifiers and qualifiers, you will have to set all four context properties.</span></span> <span data-ttu-id="78be0-133">この操作により、アグリーメントが一意に識別されます。</span><span class="sxs-lookup"><span data-stu-id="78be0-133">Doing so uniquely identifies the agreement.</span></span> <span data-ttu-id="78be0-134">アグリーメント参照についてこの方法を使用することで、送信側の処理の柔軟性が高まります。</span><span class="sxs-lookup"><span data-stu-id="78be0-134">Using this method of agreement lookup gives you more flexibility in send-side processing.</span></span> <span data-ttu-id="78be0-135">たとえば、この方法を使用すると、場合によっては複数の送信ポートを作成する必要がなくなり、送信ポート フィルターが複雑にならないようにすることができます。</span><span class="sxs-lookup"><span data-stu-id="78be0-135">For example, this method may enable you to avoid creating multiple send ports in some circumstances, and to avoid complicated send port filters.</span></span> <span data-ttu-id="78be0-136">また、必要に応じて、OneWayAgreementId プロパティの設定を回避できます。</span><span class="sxs-lookup"><span data-stu-id="78be0-136">It also enables you to avoid setting the OneWayAgreementId property, if desired.</span></span>  
  
   <span data-ttu-id="78be0-137">あるメッセージに 4 つのコンテキスト プロパティがすべて設定されている場合で、これらのコンテキスト プロパティとこのプロパティの間に一致が見られないときは、そのメッセージは中断されます。</span><span class="sxs-lookup"><span data-stu-id="78be0-137">If all four context properties have been set for a message, and no match is found between those context properties and the property properties, the message is suspended.</span></span> <span data-ttu-id="78be0-138">アグリーメントは、4 つのすべてのコンテキスト プロパティが設定されていない場合にのみ、アグリーメントに関連付けられた送信ポートを使用して解決されます。</span><span class="sxs-lookup"><span data-stu-id="78be0-138">The agreement will be resolved using the send port associated with an agreement only if all four context properties have not been set.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="78be0-139">EDI パイプライン内のメッセージは、有効な状態のアグリーメントに解決されるまで、アグリーメント解決における次の手順に進みます。</span><span class="sxs-lookup"><span data-stu-id="78be0-139">A message in the EDI pipeline goes to the succeeding step in Agreement Resolution till the message gets resolved with the step having Agreement in enable state.</span></span> <span data-ttu-id="78be0-140">たとえば、メッセージがアグリーメント解決の最初の手順で解決されたとしても、アグリーメントが無効な状態の場合、メッセージは次の解決手順に進みます。</span><span class="sxs-lookup"><span data-stu-id="78be0-140">For example, if the message gets resolved in the first step of Agreement Resolution but the Agreement is in a disabled state then the message goes to the succeeding step for resolution.</span></span>  
  
## <a name="schema-determination"></a><span data-ttu-id="78be0-141">スキーマの決定</span><span class="sxs-lookup"><span data-stu-id="78be0-141">Schema Determination</span></span>  
 <span data-ttu-id="78be0-142">EDI 送信パイプラインは、各トランザクション セットの中間 XML ファイル (ドキュメントの種類情報またはルート ノード内) に含まれているスキーマ名とスキーマ名前空間から作成されるメッセージに適用するスキーマを決定します。</span><span class="sxs-lookup"><span data-stu-id="78be0-142">The EDI send pipeline determines the schema that applies to the message from the schema name and schema namespace contained in the intermediate XML file for each transaction set (either as doc type information or in the root node).</span></span>  
  
 <span data-ttu-id="78be0-143">保存されているインターチェンジの場合、送信パイプラインは、中間 XML ファイルの個々のトランザクション セットにあるドキュメントの種類情報を使用して完全なインターチェンジを作成します。</span><span class="sxs-lookup"><span data-stu-id="78be0-143">For an interchange that has been preserved, the send pipeline uses the doc type information in the individual transaction sets of the intermediate XML file for the complete interchange.</span></span> <span data-ttu-id="78be0-144">エンベロープ セグメントの処理には、制御セグメントのスキーマが使用されます。</span><span class="sxs-lookup"><span data-stu-id="78be0-144">It uses the control segment schemas for processing the envelope segments.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="78be0-145">参照</span><span class="sxs-lookup"><span data-stu-id="78be0-145">See Also</span></span>  
 [<span data-ttu-id="78be0-146">BizTalk Server が EDI メッセージを送信する方法</span><span class="sxs-lookup"><span data-stu-id="78be0-146">How BizTalk Server Sends EDI Messages</span></span>](../core/how-biztalk-server-sends-edi-messages.md)