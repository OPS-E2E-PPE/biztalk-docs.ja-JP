---
title: アグリーメントの解決と送信 EDI メッセージ スキーマの決定 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: e37aeb9d-1e95-464d-bb71-73653c1d4674
caps.latest.revision: 24
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 5e9d652e352fb7bc3d18ae83f04784d8e112b2ef
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/07/2019
ms.locfileid: "65359994"
---
# <a name="agreement-resolution-and-schema-determination-for-outgoing-edi-messages"></a><span data-ttu-id="e0e32-102">送信 EDI メッセージのアグリーメントの解決とスキーマの決定</span><span class="sxs-lookup"><span data-stu-id="e0e32-102">Agreement Resolution and Schema Determination for Outgoing EDI Messages</span></span>
<span data-ttu-id="e0e32-103">取引先に EDI メッセージを生成するには、EDI 送信パイプラインは、次の操作を行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="e0e32-103">To generate an EDI message to a trading partner, the EDI send pipeline must do the following:</span></span>  
  
-   <span data-ttu-id="e0e32-104">メッセージが解決されるアグリーメントを特定します。</span><span class="sxs-lookup"><span data-stu-id="e0e32-104">Determine the agreement that the message resolves to</span></span>  
  
-   <span data-ttu-id="e0e32-105">メッセージの検証に使用するスキーマを決定します。</span><span class="sxs-lookup"><span data-stu-id="e0e32-105">Determine the schema to use to validate the message</span></span>  
  
## <a name="agreement-resolution"></a><span data-ttu-id="e0e32-106">アグリーメントの解決</span><span class="sxs-lookup"><span data-stu-id="e0e32-106">Agreement Resolution</span></span>  
 <span data-ttu-id="e0e32-107">EDI 送信パイプラインは、一連の送信インターチェンジとアグリーメントのプロパティ間の一致があるかどうかを判断する手順を実行することで、アグリーメント参照を実行します。</span><span class="sxs-lookup"><span data-stu-id="e0e32-107">The EDI send pipeline performs agreement lookup by performing a series of steps to determine whether there is a match between the outgoing interchange and the properties of an agreement.</span></span> <span data-ttu-id="e0e32-108">1 回[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]アグリーメントが決定されます (下記参照) のインターチェンジに適用されるドキュメント スキーマを決定します。</span><span class="sxs-lookup"><span data-stu-id="e0e32-108">Once [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] has determined the agreement, it determines the document schema that applies to the interchange (see below).</span></span> <span data-ttu-id="e0e32-109">生成および送信メッセージを検証する、一致するアグリーメントと関連するスキーマに関連付けられたプロパティを使用します。</span><span class="sxs-lookup"><span data-stu-id="e0e32-109">It uses the properties associated with the matching agreement and the relevant schema to generate and validate the outgoing message.</span></span>  
  
 <span data-ttu-id="e0e32-110">アグリーメントの解決を実行する[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]次のように進みます。</span><span class="sxs-lookup"><span data-stu-id="e0e32-110">To perform agreement resolution, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] proceeds as follows:</span></span>  
  
1. <span data-ttu-id="e0e32-111">AgreementPartIDForSend コンテキスト プロパティは、一方向のアグリーメントの ID と照合してアグリーメントを解決します。</span><span class="sxs-lookup"><span data-stu-id="e0e32-111">Resolves the agreement by matching the AgreementPartIDForSend context property with the ID of the one-way agreement.</span></span> <span data-ttu-id="e0e32-112">このプロパティは、整数型、カスタム コンポーネントで設定できます。設定されていない[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]します。</span><span class="sxs-lookup"><span data-stu-id="e0e32-112">This property should be an integer type, it can be set in a custom component; it is not set by [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span></span>  
  
2. <span data-ttu-id="e0e32-113">手順 1. が成功しなかった場合は、すべて以下 3 つのコンテキスト プロパティでアグリーメントのプロパティを照合してアグリーメントを解決します。AgreementNameForSend、SenderPartyNameForSend、ReceiverPartyNameForSend します。</span><span class="sxs-lookup"><span data-stu-id="e0e32-113">If step 1 does not succeed, resolves the agreement by matching all the following three context properties with the agreement properties: AgreementNameForSend, SenderPartyNameForSend, ReceiverPartyNameForSend.</span></span> <span data-ttu-id="e0e32-114">アグリーメントを正常に解決するには 3 つすべてのプロパティを設定する必要がありますに注意してください。</span><span class="sxs-lookup"><span data-stu-id="e0e32-114">Note that all the three properties must be set in order to successfully resolve to an agreement.</span></span> <span data-ttu-id="e0e32-115">カスタム コンポーネントでこれらのプロパティを設定できます。設定されていない[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]します。</span><span class="sxs-lookup"><span data-stu-id="e0e32-115">These properties can be set in a custom component; it is not set by [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span></span>  
  
3. <span data-ttu-id="e0e32-116">手順 2. が成功しなかった場合は、メッセージ コンテキスト プロパティで、その他のアグリーメント リゾルバーとして設定された DestinationPartyName プロパティのパーティ名を照合してアグリーメントを解決、**識別子**のタブアグリーメントのプロパティ。</span><span class="sxs-lookup"><span data-stu-id="e0e32-116">If step 2 does not succeed, resolves the agreement by matching the party name in the message context properties with the DestinationPartyName property, which is set as additional agreement resolver in the **Identifiers** tab of agreement properties.</span></span>  
  
4. <span data-ttu-id="e0e32-117">手順 3 が成功しなかった場合は、アグリーメントのプロパティと、メッセージのコンテキストでは、次のプロパティを照合することで、アグリーメントを解決します。DestinationPartySenderIdentifier、DestinationPartySenderQualifier、DestinationPartyReceiverIdentifier、および DestinationPartyReceiverQualifier します。</span><span class="sxs-lookup"><span data-stu-id="e0e32-117">If step 3 does not succeed, resolves the agreement by matching the following properties in the context of a message with those in agreement properties: DestinationPartySenderIdentifier, DestinationPartySenderQualifier, DestinationPartyReceiverIdentifier, and DestinationPartyReceiverQualifier.</span></span> <span data-ttu-id="e0e32-118">アグリーメントを正常に解決するには 4 つすべてのプロパティを設定する必要がありますに注意してください。</span><span class="sxs-lookup"><span data-stu-id="e0e32-118">Note that all the four properties must be set in order to successfully resolve to an agreement.</span></span> <span data-ttu-id="e0e32-119">カスタム コンポーネントでこれらのプロパティを設定できます。設定されていない[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]します。</span><span class="sxs-lookup"><span data-stu-id="e0e32-119">These properties can be set in a custom component; they are not set by [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span></span> <span data-ttu-id="e0e32-120">詳細については、以下を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e0e32-120">For more information, see below.</span></span>  
  
   > [!NOTE]
   >  <span data-ttu-id="e0e32-121">上記のセットのコンテキスト プロパティのいずれかが昇格される場合と[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]し、これらのコンテキスト プロパティに関連するアグリーメントを検索するようになって[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]メッセージを中断します。</span><span class="sxs-lookup"><span data-stu-id="e0e32-121">If any of the above sets of context properties are promoted and [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] is unable to find an agreement associated with those context properties, then [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] suspends the message.</span></span>  
   > 
   >  <span data-ttu-id="e0e32-122">ユーザーが意図的にアグリーメントの解決のコンテキスト プロパティのセットを作成し、リゾルバーが OnewayAgreement を識別するために失敗した場合は、メッセージは中断されます。</span><span class="sxs-lookup"><span data-stu-id="e0e32-122">If the user intentionally writes a set of context properties for agreement resolution, and if the resolver fails to identify the OnewayAgreement, then the message is suspended.</span></span> <span data-ttu-id="e0e32-123">コンテキスト プロパティのセットに基づいてアグリーメントを解決するのには失敗した場合、対応する警告メッセージがイベント ログでスローされます。</span><span class="sxs-lookup"><span data-stu-id="e0e32-123">On failure to resolve to an agreement based on a set of context properties, a corresponding warning message is thrown in the EventLog.</span></span>  
  
5. <span data-ttu-id="e0e32-124">手順 4. が成功せず、または昇格上記のコンテキスト プロパティのいずれも、EDI メッセージがアグリーメントに解決アグリーメントに関連付けられている送信ポートとメッセージをサブスクライブした送信ポートを照合することによりします。</span><span class="sxs-lookup"><span data-stu-id="e0e32-124">If step 4 does not succeed or none of the above context properties are promoted, then the EDI message is resolved to an agreement by matching the send port that subscribed to the message with the send port associated with an agreement.</span></span>  
  
   > [!NOTE]
   >  <span data-ttu-id="e0e32-125">1 つの送信ポートは複数のアグリーメントに関連付けられている場合[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]エラーが生成されます。</span><span class="sxs-lookup"><span data-stu-id="e0e32-125">If the same send port is associated with multiple agreements, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] will generate an error.</span></span>  
  
6. <span data-ttu-id="e0e32-126">1、2、3、または 4 の手順でアグリーメントが見つからない場合、送信パイプラインはフォールバック アグリーメント設定を使用して、送信メッセージの生成します。</span><span class="sxs-lookup"><span data-stu-id="e0e32-126">If no agreement is found in steps 1, 2, 3, or 4, the send pipeline uses the fallback agreement settings to generate the outgoing message.</span></span>  
  
   <span data-ttu-id="e0e32-127">**送信者と受信者のコンテキスト プロパティ照合によるアグリーメントの解決**</span><span class="sxs-lookup"><span data-stu-id="e0e32-127">**Agreement Resolution by Matching Sender and Receiver Context Properties**</span></span>  
  
   <span data-ttu-id="e0e32-128">2 番目の手順では、一致に使用される 4 つのコンテキスト プロパティは、EDI が。DestinationPartySenderIdentifier、EDI を使用します。DestinationPartySenderQualifier、EDI を使用します。DestinationPartyReceiverIdentifier、および EDI です。DestinationPartyReceiverQualifier します。</span><span class="sxs-lookup"><span data-stu-id="e0e32-128">In the second step above, the four context properties used in the match are EDI.DestinationPartySenderIdentifier, EDI.DestinationPartySenderQualifier, EDI.DestinationPartyReceiverIdentifier, and EDI.DestinationPartyReceiverQualifier.</span></span> <span data-ttu-id="e0e32-129">これらのコンテキスト プロパティの名前空間は`http://schemas.microsoft.com/Edi/PropertySchema`します。</span><span class="sxs-lookup"><span data-stu-id="e0e32-129">The namespace for these context properties is `http://schemas.microsoft.com/Edi/PropertySchema`.</span></span> [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] <span data-ttu-id="e0e32-130">これらの値を関連する送信者と受信者の識別子と一方向アグリーメント プロパティの修飾子と一致を試みます。</span><span class="sxs-lookup"><span data-stu-id="e0e32-130">attempts to match these values with the related sender and receiver identifiers and qualifiers in the one-way agreement properties.</span></span> <span data-ttu-id="e0e32-131">これらのフィールドは isa05、isa06、isa07、および ISA08 x12 の場合、**識別子**で一方向アグリーメント タブのページ、**アグリーメントのプロパティ**; ダイアログ ボックス、UNB2.1、UNB2.2、EDIFACT の場合、これらのフィールドUnb3.1、および unb3.2 で、**識別子**で一方向アグリーメント タブのページ、**アグリーメントのプロパティ** ダイアログ ボックス。</span><span class="sxs-lookup"><span data-stu-id="e0e32-131">For X12, these fields are ISA05, ISA06, ISA07, and ISA08 in the **Identifiers** page of the one-way agreement tab in the **Agreement Properties** dialog box; for EDIFACT, these fields are UNB2.1, UNB2.2, UNB3.1, and UNB3.2 in the **Identifiers** page of the one-way agreement tab in the **Agreement Properties** dialog box.</span></span>  
  
   <span data-ttu-id="e0e32-132">すべてを使用して送信側アグリーメントの解決を有効にするすべての 4 つのコンテキスト プロパティを設定する必要があります 4 つの送信者と受信者の識別子と修飾子、します。</span><span class="sxs-lookup"><span data-stu-id="e0e32-132">To enable send-side agreement resolution using all four sender and receiver identifiers and qualifiers, you will have to set all four context properties.</span></span> <span data-ttu-id="e0e32-133">一意に行うには、アグリーメントが識別されます。</span><span class="sxs-lookup"><span data-stu-id="e0e32-133">Doing so uniquely identifies the agreement.</span></span> <span data-ttu-id="e0e32-134">アグリーメント参照には、このメソッドを使用してより柔軟で送信側の処理。</span><span class="sxs-lookup"><span data-stu-id="e0e32-134">Using this method of agreement lookup gives you more flexibility in send-side processing.</span></span> <span data-ttu-id="e0e32-135">などをこのメソッドでは、状況によっては、複数の送信ポートを作成しないようにしたり、複雑な送信ポート フィルターを回避するために、有効可能性があります。</span><span class="sxs-lookup"><span data-stu-id="e0e32-135">For example, this method may enable you to avoid creating multiple send ports in some circumstances, and to avoid complicated send port filters.</span></span> <span data-ttu-id="e0e32-136">これは、こともできます、OneWayAgreementId プロパティの設定を回避するために必要な場合。</span><span class="sxs-lookup"><span data-stu-id="e0e32-136">It also enables you to avoid setting the OneWayAgreementId property, if desired.</span></span>  
  
   <span data-ttu-id="e0e32-137">メッセージは、すべての 4 つのコンテキスト プロパティが設定されているこれらのコンテキスト プロパティと property プロパティの間で一致が見つからない場合は、メッセージは中断されます。</span><span class="sxs-lookup"><span data-stu-id="e0e32-137">If all four context properties have been set for a message, and no match is found between those context properties and the property properties, the message is suspended.</span></span> <span data-ttu-id="e0e32-138">すべての 4 つのコンテキスト プロパティが設定されていない場合にのみ、アグリーメントに関連付けられている送信ポートを使用して、アグリーメントが解決されます。</span><span class="sxs-lookup"><span data-stu-id="e0e32-138">The agreement will be resolved using the send port associated with an agreement only if all four context properties have not been set.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="e0e32-139">EDI パイプライン内のメッセージは次の手順にアグリーメントで解決、メッセージがアグリーメントを持つ有効な状態の手順に解決されるまでします。</span><span class="sxs-lookup"><span data-stu-id="e0e32-139">A message in the EDI pipeline goes to the succeeding step in Agreement Resolution till the message gets resolved with the step having Agreement in enable state.</span></span> <span data-ttu-id="e0e32-140">たとえば場合は、メッセージがアグリーメントの解決の最初の手順で解決を取得しますが、アグリーメントが無効の状態が次の解決手順をメッセージが通過します。</span><span class="sxs-lookup"><span data-stu-id="e0e32-140">For example, if the message gets resolved in the first step of Agreement Resolution but the Agreement is in a disabled state then the message goes to the succeeding step for resolution.</span></span>  
  
## <a name="schema-determination"></a><span data-ttu-id="e0e32-141">スキーマの決定</span><span class="sxs-lookup"><span data-stu-id="e0e32-141">Schema Determination</span></span>  
 <span data-ttu-id="e0e32-142">EDI 送信パイプラインは、各トランザクション セット (ドキュメントの種類情報またはルート ノード内) の中間 XML ファイルに含まれているスキーマの名前空間とスキーマの名前から、メッセージに該当するスキーマを決定します。</span><span class="sxs-lookup"><span data-stu-id="e0e32-142">The EDI send pipeline determines the schema that applies to the message from the schema name and schema namespace contained in the intermediate XML file for each transaction set (either as doc type information or in the root node).</span></span>  
  
 <span data-ttu-id="e0e32-143">インターチェンジを保存されている個々 のトランザクションでドキュメントの種類の情報が中間 XML ファイルの完全なインターチェンジの設定、送信パイプラインは使用できます。</span><span class="sxs-lookup"><span data-stu-id="e0e32-143">For an interchange that has been preserved, the send pipeline uses the doc type information in the individual transaction sets of the intermediate XML file for the complete interchange.</span></span> <span data-ttu-id="e0e32-144">エンベロープ セグメントを処理するための制御セグメントのスキーマを使用します。</span><span class="sxs-lookup"><span data-stu-id="e0e32-144">It uses the control segment schemas for processing the envelope segments.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="e0e32-145">参照</span><span class="sxs-lookup"><span data-stu-id="e0e32-145">See Also</span></span>  
 [<span data-ttu-id="e0e32-146">BizTalk Server が EDI メッセージを送信する方法</span><span class="sxs-lookup"><span data-stu-id="e0e32-146">How BizTalk Server Sends EDI Messages</span></span>](../core/how-biztalk-server-sends-edi-messages.md)