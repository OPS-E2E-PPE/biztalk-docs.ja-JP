---
title: "パブリッシュ/サブスクライブ アーキテクチャ |Microsoft ドキュメント"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- publish/subscribe architecture, publishers
- architecture, publish/subscribe
- publishing, publish/subscribe architecture
- publish/subscribe architecture, about publish/subscribe architecture
- creating, subscriptions
- publish/subscribe architecture, Messaging Engine
- routing, publishing
- Messaging Engine, publishing
- publish/subscribe architecture, subscribers
- publish/subscribe architecture
- subscriptions, publish/subscribe architecture
- publish/subscribe architecture, creating subscriptions
- subscriptions, creating
- Messaging Engine, subscribing
- publishing, routing
- Messaging Engine, publish/subscribe architecture
- publish/subscribe architecture, events
ms.assetid: 5ed36c1f-077d-468f-a99e-60f97377cef6
caps.latest.revision: "11"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: b11ed175fc047eee59761547d8d13ab798ac860c
ms.sourcegitcommit: 5abd0ed3f9e4858ffaaec5481bfa8878595e95f7
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/28/2017
---
# <a name="publish-and-subscribe-architecture"></a><span data-ttu-id="11b1d-102">パブリッシュ/サブスクライブ アーキテクチャ</span><span class="sxs-lookup"><span data-stu-id="11b1d-102">Publish and Subscribe Architecture</span></span>
<span data-ttu-id="11b1d-103">パブリッシュ/サブスクライブ型の設計の場合、その構成要素は次の 3 つです。</span><span class="sxs-lookup"><span data-stu-id="11b1d-103">In a publish/subscribe design, you have three components:</span></span>  
  
-   <span data-ttu-id="11b1d-104">パブリッシャー</span><span class="sxs-lookup"><span data-stu-id="11b1d-104">Publishers</span></span>  
  
-   <span data-ttu-id="11b1d-105">[サブスクライバー]</span><span class="sxs-lookup"><span data-stu-id="11b1d-105">Subscribers</span></span>  
  
-   <span data-ttu-id="11b1d-106">イベント</span><span class="sxs-lookup"><span data-stu-id="11b1d-106">Events</span></span>  
  
 <span data-ttu-id="11b1d-107">パブリッシャーには、受信場所で受信するメッセージを公開する受信ポート、メッセージを送信する際または別のオーケストレーションを非同期的に開始する際にメッセージを公開するオーケストレーション、および対象アプリケーションまたはトランスポートから応答を受け取る際にメッセージを公開する送信請求 - 応答の送信ポートが含まれます。</span><span class="sxs-lookup"><span data-stu-id="11b1d-107">Publishers include receive ports that publish messages that arrive in their receive locations, orchestrations that publish messages when sending messages or starting another orchestration asynchronously, and solicit/response send ports that publish messages when they receive a response from the target application or transport.</span></span>  
  
 <span data-ttu-id="11b1d-108">BizTalk Server には、主要なサブスクリプションが 2 つあります。アクティベーションとインスタンスです。</span><span class="sxs-lookup"><span data-stu-id="11b1d-108">In BizTalk Server, there are two main types of subscriptions: activation and instance.</span></span> <span data-ttu-id="11b1d-109">*アクティベーションのサブスクリプション*は 1 つを指定するサブスクリプションを処理するメッセージがアクティブ化、または受信時にサブスクライバーの新しいインスタンスを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="11b1d-109">An *activation subscription* is one specifying that a message that fulfills the subscription should activate, or create, a new instance of the subscriber when it is received.</span></span> <span data-ttu-id="11b1d-110">アクティベーションのサブスクリプションを作成する例としては、フィルター処理を行う送信ポートやオーケストレーションにバインドされている送信ポート、"アクティブ化" プロパティが True に設定されているオーケストレーションの受信図形などがあります。</span><span class="sxs-lookup"><span data-stu-id="11b1d-110">Examples of things that create activation subscriptions include send ports with filters or send ports that are bound to orchestrations, and orchestration receive shapes that have their Activate property set to true.</span></span> <span data-ttu-id="11b1d-111">*インスタンス サブスクリプション*サブスクリプションを処理するメッセージが、サブスクライバーの既に実行中のインスタンスにルーティングされることを示します。</span><span class="sxs-lookup"><span data-stu-id="11b1d-111">An *instance subscription* indicates that messages that fulfill the subscription should be routed to an already-running instance of the subscriber.</span></span> <span data-ttu-id="11b1d-112">インスタンスのサブスクリプションを作成する例としては、関連付けられた受信を行い、BizTalk Server からの応答を待つ要求/応答形式の受信ポートを使用するオーケストレーションがあります。</span><span class="sxs-lookup"><span data-stu-id="11b1d-112">Examples of things that create instance subscriptions are orchestrations with correlated receives and request/response-style receive ports waiting for a response from BizTalk Server.</span></span>  
  
 <span data-ttu-id="11b1d-113">2 種類のサブスクリプションの情報レベルでの違いは、インスタンスのサブスクリプションでは一意のインスタンス ID が使用されることです。インスタンス ID はマスターのメッセージ ボックス データベースのサブスクリプション テーブルに保存されます。</span><span class="sxs-lookup"><span data-stu-id="11b1d-113">The difference between the two types of subscription at the information level is that an instance subscription includes the unique instance ID, stored in the subscription table in the master MessageBox database.</span></span> <span data-ttu-id="11b1d-114">オーケストレーション インスタンスまたは受信ポートの処理が終了すると、インスタンスのサブスクリプションは、メッセージ ボックス データベースから削除されます。アクティベーションのサブスクリプションは、オーケストレーションまたは送信ポートが参加している限り、アクティブのままです。</span><span class="sxs-lookup"><span data-stu-id="11b1d-114">When an orchestration instance or receive port completes processing, instance subscriptions are removed from the MessageBox while activation subscriptions remain active as long as the orchestration or send port is enlisted.</span></span>  
  
## <a name="creating-subscriptions"></a><span data-ttu-id="11b1d-115">サブスクリプションの作成</span><span class="sxs-lookup"><span data-stu-id="11b1d-115">Creating Subscriptions</span></span>  
 <span data-ttu-id="11b1d-116">サブスクリプションは、BizTalk Server 管理データベースの adm_ServiceClass テーブルに表示される BizTalk Server のサービス クラスで作成されます。</span><span class="sxs-lookup"><span data-stu-id="11b1d-116">Subscriptions are created by service classes in BizTalk Server, which are listed in the adm_ServiceClass table in the BizTalk Server Management database.</span></span> <span data-ttu-id="11b1d-117">これらのサービスには、キャッシュ サービス、エンドポイント マネージャーでホストされるインプロセスおよび分離メッセージング、および XLANG サブサービスでホストされるオーケストレーション/XLANG が含まれます。</span><span class="sxs-lookup"><span data-stu-id="11b1d-117">These services include the caching service; in-process and isolated messaging, hosted by the Endpoint Manager; and orchestrations/XLANG hosted by the XLANG subservice.</span></span> <span data-ttu-id="11b1d-118">これらの各サービス クラスで、サブスクリプションの作成および公開されたメッセージの受信を行うことができます。</span><span class="sxs-lookup"><span data-stu-id="11b1d-118">Each of these service classes can create subscriptions and receive published messages.</span></span>  
  
 <span data-ttu-id="11b1d-119">サブスクリプションは、比較ステートメント (述語と呼ばれる) を集めたもので、メッセージ コンテキスト プロパティとサブスクリプションに固有の値が使用されます。</span><span class="sxs-lookup"><span data-stu-id="11b1d-119">A subscription is a collection of comparison statements, known as predicates, involving message context properties and the values specific to the subscription.</span></span> <span data-ttu-id="11b1d-120">たとえば、多くのサブスクリプションでは、メッセージ コンテキスト プロパティである "メッセージの種類" を使用して、メッセージの種類を指定します。</span><span class="sxs-lookup"><span data-stu-id="11b1d-120">For example, Message Type is a context property of messages and many subscriptions specify the message type in their subscription.</span></span> <span data-ttu-id="11b1d-121">サブスクリプションの一般的な情報は、メッセージ エージェントによってサブスクリプション テーブルに挿入されます。また、サブスクリプションに指定された操作の種類に応じて、次の述語テーブルのいずれかに特定の述語が格納されます。</span><span class="sxs-lookup"><span data-stu-id="11b1d-121">General information about the subscription is inserted into the subscriptions table by the Message Agent while the specific predicates go into one of the following predicate tables, depending on the type of operation specified for the subscription:</span></span>  
  
-   <span data-ttu-id="11b1d-122">BitwiseANDPredicates</span><span class="sxs-lookup"><span data-stu-id="11b1d-122">BitwiseANDPredicates</span></span>  
  
-   <span data-ttu-id="11b1d-123">EqualsPredicates</span><span class="sxs-lookup"><span data-stu-id="11b1d-123">EqualsPredicates</span></span>  
  
-   <span data-ttu-id="11b1d-124">EqualsPredicates2ndPass</span><span class="sxs-lookup"><span data-stu-id="11b1d-124">EqualsPredicates2ndPass</span></span>  
  
-   <span data-ttu-id="11b1d-125">ExistsPredicates</span><span class="sxs-lookup"><span data-stu-id="11b1d-125">ExistsPredicates</span></span>  
  
-   <span data-ttu-id="11b1d-126">FirstPassPredicates</span><span class="sxs-lookup"><span data-stu-id="11b1d-126">FirstPassPredicates</span></span>  
  
-   <span data-ttu-id="11b1d-127">GreaterThanOrEqualsPredicates</span><span class="sxs-lookup"><span data-stu-id="11b1d-127">GreaterThanOrEqualsPredicates</span></span>  
  
-   <span data-ttu-id="11b1d-128">GreaterThanPredicates</span><span class="sxs-lookup"><span data-stu-id="11b1d-128">GreaterThanPredicates</span></span>  
  
-   <span data-ttu-id="11b1d-129">LessThenOrEqualsPredicates</span><span class="sxs-lookup"><span data-stu-id="11b1d-129">LessThenOrEqualsPredicates</span></span>  
  
-   <span data-ttu-id="11b1d-130">LessThenPredicates</span><span class="sxs-lookup"><span data-stu-id="11b1d-130">LessThenPredicates</span></span>  
  
-   <span data-ttu-id="11b1d-131">NotEqualsPredicates</span><span class="sxs-lookup"><span data-stu-id="11b1d-131">NotEqualsPredicates</span></span>  
  
 <span data-ttu-id="11b1d-132">このすべては、実行を呼び出すことにより実現は\<アプリケーション名\>と bts_insertpredicate _\<アプリケーション名\>メッセージ ボックス データベース内のストアド プロシージャはデータベースに\<アプリケーション名\>サブスクリプションを作成している BizTalk ホストの名前を指定します。</span><span class="sxs-lookup"><span data-stu-id="11b1d-132">All of this is accomplished by calling the Bts_CreateSubscription_\<application name\> and Bts_InsertPredicate_\<application name\> stored procedures in the MessageBox database where \<application name\> is the name of the BizTalk host that is creating the subscription.</span></span>  
  
 <span data-ttu-id="11b1d-133">送信ポートを参加させる場合、ポートは、少なくともコンテキストの送信ポートのトランスポート ID を持つメッセージのサブスクリプションを作成します。</span><span class="sxs-lookup"><span data-stu-id="11b1d-133">When a send port is enlisted, the port creates, at a minimum, a subscription for any message with that send port's transport ID in the context.</span></span> <span data-ttu-id="11b1d-134">これにより、送信ポートは、専用のメッセージを常に受信できます。</span><span class="sxs-lookup"><span data-stu-id="11b1d-134">This allows the send port to always receive messages intended specifically for it.</span></span> <span data-ttu-id="11b1d-135">オーケストレーション ポートが特定の送信ポートにバインドされる場合、バインドに関する情報は、BizTalk 管理データベースに保存されます。</span><span class="sxs-lookup"><span data-stu-id="11b1d-135">When an orchestration port is bound to a particular send port, the information about that binding is stored in the BizTalk Management database.</span></span> <span data-ttu-id="11b1d-136">物理送信ポートにバインドされているポートを通じて、メッセージがオーケストレーションから送信される場合、メッセージを送信ポートにルーティングできるように、トランスポート ID がコンテキストに格納されます。</span><span class="sxs-lookup"><span data-stu-id="11b1d-136">When messages are sent from the orchestration through the port bound to the physical send port, the Transport ID is included in the context so that the message gets routed to that send port.</span></span> <span data-ttu-id="11b1d-137">ただし、この送信ポートがオーケストレーションから送信されるメッセージを受信できる唯一の送信ポートではないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="11b1d-137">However, it is important to note that this send port is not the only send port that can receive messages sent from the orchestration.</span></span> <span data-ttu-id="11b1d-138">オーケストレーションでメッセージを送信すると、そのメッセージは、関連するすべての昇格させたプロパティと一緒にメッセージ ボックス データベースに公開されます。</span><span class="sxs-lookup"><span data-stu-id="11b1d-138">When an orchestration sends a message, that message is published to the MessageBox with all of the relevant promoted properties.</span></span> <span data-ttu-id="11b1d-139">バインド済みの送信ポートは、トランスポート ID がコンテキストに含まれるので、メッセージのコピーを受信できます。ただし、他の送信ポート (つまり、オーケストレーション) は、メッセージ プロパティも一致するサブスクリプションを使用できます。</span><span class="sxs-lookup"><span data-stu-id="11b1d-139">The bound send port is guaranteed to receive a copy of the message because the transport ID is in the context, but any other send port, or orchestration, can have a subscription that also matches the message properties.</span></span> <span data-ttu-id="11b1d-140">メッセージを直接メッセージ ボックス データベースに公開する場合はいつでも、一致するサブスクリプションを持つすべてのサブスクライバーがメッセージのコピーを受け取ることを理解しておく必要があります。</span><span class="sxs-lookup"><span data-stu-id="11b1d-140">It is very important to understand that any time a message is published directly to the MessageBox, all subscribers with matching subscriptions will receive a copy of the message.</span></span>  
  
## <a name="publishing-and-routing"></a><span data-ttu-id="11b1d-141">公開とルーティング</span><span class="sxs-lookup"><span data-stu-id="11b1d-141">Publishing and Routing</span></span>  
 <span data-ttu-id="11b1d-142">サブスクリプションを作成して有効にした後、処理を行う前にメッセージを公開する必要があります。</span><span class="sxs-lookup"><span data-stu-id="11b1d-142">After a subscription is created and enabled, a message must be published before any processing takes place.</span></span> <span data-ttu-id="11b1d-143">前述のいずれかのサービスから BizTalk Server にメッセージが受信されると、メッセージは公開されます。</span><span class="sxs-lookup"><span data-stu-id="11b1d-143">Messages are published when they are received into BizTalk Server from one of the services mentioned previously.</span></span> <span data-ttu-id="11b1d-144">ここでのルーティングの説明では、アダプターを通じて BizTalk Server に受信されるメッセージに注目します。</span><span class="sxs-lookup"><span data-stu-id="11b1d-144">For this discussion of routing, we will focus on messages received into BizTalk Server through an adapter.</span></span>  
  
 <span data-ttu-id="11b1d-145">メッセージの受信パイプライン処理が行われると、プロパティは、メッセージ コンテキストに昇格されます。</span><span class="sxs-lookup"><span data-stu-id="11b1d-145">When messages go through the receive pipeline processing, properties are promoted into the message context.</span></span> <span data-ttu-id="11b1d-146">受信アダプターと受信パイプラインによってメッセージが処理された後にメッセージ ボックス データベースにメッセージを公開する準備が整った場合、最初に行われる処理は、メッセージ エージェントが昇格させたプロパティのプロパティ値とメッセージ コンテキストの述語の値をマスターのメッセージ ボックス SQL Server データベースに挿入することです。</span><span class="sxs-lookup"><span data-stu-id="11b1d-146">After a message is ready to be published into the MessageBox after being processed by the receive adapter and pipeline, the first thing that happens is the Message Agent inserts the property values for the promoted properties and predicate values from the message context into the master MessageBox SQL Server database.</span></span> <span data-ttu-id="11b1d-147">データベースにこれらの値が格納されると、メッセージ エージェントは、ルーティングの決定を行うことができます。</span><span class="sxs-lookup"><span data-stu-id="11b1d-147">Having these values in the database enables the Message Agent to make routing decisions.</span></span>  
  
 <span data-ttu-id="11b1d-148">次のステップで、メッセージ エージェントは、マスターのメッセージ ボックス データベースに問い合わせて、公開されるメッセージの現在のバッチのサブスクリプションを検索します。</span><span class="sxs-lookup"><span data-stu-id="11b1d-148">The next step is for the Message Agent to ask the master MessageBox database to find subscriptions for the current batch of messages being published.</span></span> <span data-ttu-id="11b1d-149">メッセージがデータベースにまだ書き込まれていないことに注意してください。コンテキストのプロパティだけが書き込まれています。</span><span class="sxs-lookup"><span data-stu-id="11b1d-149">Keep in mind that the messages have not yet been written to the database, only the properties from the context.</span></span> <span data-ttu-id="11b1d-150">Bts_FindSubscriptions ストアド プロシージャでメッセージ ボックス データベース クエリでは、サブスクリプションと格納されているメッセージの現在のバッチのメッセージ プロパティにリンクして、上の指定された述語テーブル。</span><span class="sxs-lookup"><span data-stu-id="11b1d-150">The bts_FindSubscriptions stored procedure in the MessageBox queries the subscription and predicate tables identified above, linking them to the message properties stored for the current batch of messages.</span></span>  
  
 <span data-ttu-id="11b1d-151">この情報を使用して、メッセージ エージェントは、bts_InsertMessage ストアド プロシージャを呼び出し、サブスクリプションのある各メッセージ ボックス データベースに 1 回メッセージを挿入します。</span><span class="sxs-lookup"><span data-stu-id="11b1d-151">With this information, the Message Agent inserts the message once into each MessageBox database that has a subscription by calling the bts_InsertMessage stored procedure.</span></span> <span data-ttu-id="11b1d-152">サブスクリプション ID に、bts_InsertMessage ストアド プロシージャが最初に呼び出されました。</span><span class="sxs-lookup"><span data-stu-id="11b1d-152">The bts_InsertMessage stored procedure is first called with a subscription ID.</span></span> <span data-ttu-id="11b1d-153">この最初のパス上、int_EvaluateSubscriptions ストアド プロシージャの呼び出しには、メッセージが、ことをチェックして、アプリケーションのセキュリティ要件を満たしていることを確認しています。 サブスクリプションの詳細についてを検索するための手順が格納されています。メッセージの述語のホスト、およびアプリケーションの特定のキューまたはアプリケーション固有の保留キューの状態に応じて、メッセージへの参照を挿入するアプリケーションのプロパティに一致します。</span><span class="sxs-lookup"><span data-stu-id="11b1d-153">On this first pass, the stored procedure calls the int_EvaluateSubscriptions stored procedure which is responsible for looking up the subscription detail information, verifying that the message meets security requirements for the application by checking that message predicates match application properties for the host, and inserting a reference to the message in the application specific queue or application specific suspended queue depending on the state.</span></span> <span data-ttu-id="11b1d-154">メッセージ ID、サブスクリプション ID、サービス ID、および他のサブスクリプション情報は、このアプリケーションで見つかった各サブスクリプション用のアプリケーション固有のキューのテーブルに挿入されます。</span><span class="sxs-lookup"><span data-stu-id="11b1d-154">The message ID, subscription ID, service ID, and other subscription information are inserted into the application specific queue table for each subscription that was found for this application.</span></span> <span data-ttu-id="11b1d-155">メッセージが挿入されると、メッセージのプロパティ テーブルとメッセージの述語テーブルのバッチに関連した値が消去されます。</span><span class="sxs-lookup"><span data-stu-id="11b1d-155">After the messages are inserted, the message properties and message predicates tables are cleared of the batch related values.</span></span>  
  
 <span data-ttu-id="11b1d-156">その後、メッセージの部分ごとに、bts_InsertMessage ストアド プロシージャが呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="11b1d-156">The bts_InsertMessage stored procedure is called subsequently for each part in the message.</span></span> <span data-ttu-id="11b1d-157">最初の呼び出しでは、メッセージ コンテキストが渡され、メッセージ部分、ボディ部の名前と ID の数などについてのメタデータと共に SPOOL テーブルに挿入して</span><span class="sxs-lookup"><span data-stu-id="11b1d-157">On the first call, the message context is passed and is then inserted into the SPOOL table along with metadata about the message such as the number of parts, the body part name and ID.</span></span> <span data-ttu-id="11b1d-158">さらにメッセージのボディ部が、int_InsertPart ストアド プロシージャを使用して部品テーブルに挿入されます。</span><span class="sxs-lookup"><span data-stu-id="11b1d-158">In addition the message body part is inserted into the PARTS table using the int_InsertPart stored procedure.</span></span> <span data-ttu-id="11b1d-159">次に、bts_InsertMessage ストアド プロシージャが、int_InsertPart ストアド プロシージャに渡されて PARTS テーブルに保存される残りの各メッセージ部分に対して呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="11b1d-159">The bts_InsertMessage stored procedure is then called for each of the remaining message parts where they are simply passed to the int_InsertPart stored procedure to be persisted in the PARTS table.</span></span>  
  
 <span data-ttu-id="11b1d-160">メッセージがルーティングされると、レコードを次のテーブルに挿入して、メッセージの特定のインスタンスとその部分を受信する各サービスに参照が追加されます。</span><span class="sxs-lookup"><span data-stu-id="11b1d-160">When messages are routed, references are added for each service that receives the specific instance of the message and its parts by inserting records into the following tables:</span></span>  
  
-   <span data-ttu-id="11b1d-161">MessageRefCountLog1</span><span class="sxs-lookup"><span data-stu-id="11b1d-161">MessageRefCountLog1</span></span>  
  
-   <span data-ttu-id="11b1d-162">MessageRefCountLog2</span><span class="sxs-lookup"><span data-stu-id="11b1d-162">MessageRefCountLog2</span></span>  
  
-   <span data-ttu-id="11b1d-163">PartRefCountLog1</span><span class="sxs-lookup"><span data-stu-id="11b1d-163">PartRefCountLog1</span></span>  
  
-   <span data-ttu-id="11b1d-164">PartRefCountLog2</span><span class="sxs-lookup"><span data-stu-id="11b1d-164">PartRefCountLog2</span></span>  
  
 <span data-ttu-id="11b1d-165">これらの参照を使用すると、システムで使用しなくなったメッセージのメッセージ データでメッセージ ボックス データベースがいっぱいにならないように定期的に実行されるクリーンアップ ジョブでメッセージと部分が削除されることを防止できます。</span><span class="sxs-lookup"><span data-stu-id="11b1d-165">These references keep the messages and parts from being deleted by cleanup jobs that run periodically to keep the MessageBox from getting full with message data for messages that are no longer in the system.</span></span> <span data-ttu-id="11b1d-166">ロックの競合を減らすために、テーブルが 2 つ使用されます。</span><span class="sxs-lookup"><span data-stu-id="11b1d-166">Two tables are used to reduce contention and locking issues.</span></span>  
  
 <span data-ttu-id="11b1d-167">メッセージが適切なキューにルーティングされ、スプール テーブルおよび Parts テーブルに格納され、アプリケーション固有のキューで参照されるため、アプリケーション インスタンスで、メッセージをキューから取り出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="11b1d-167">Now that the message has been routed to the right queue, stored in the Spool and Parts tables, and referenced in the application specific queues, the messages must be pulled off the queues by the application instances.</span></span> <span data-ttu-id="11b1d-168">各ホスト インスタンスには、BizTalk 管理データベースの adm_ServiceClass テーブルで構成されている間隔で継続してデータベースをポーリングする、キューから取り出すスレッドの数が設定されます。</span><span class="sxs-lookup"><span data-stu-id="11b1d-168">Each host instance has a number of dequeuing threads that continuously poll the database on an interval that is configured in the adm_ServiceClass table in the BizTalk Management database.</span></span> <span data-ttu-id="11b1d-169">このテーブルには、キューから取り出すスレッドの使用数を示す列があります。</span><span class="sxs-lookup"><span data-stu-id="11b1d-169">This same table has a column to indicate the number of dequeuing threads to be used.</span></span> <span data-ttu-id="11b1d-170">各スレッドは、メッセージ ボックス データベースにして、bts_dequeuemessages _\<アプリケーション名\>ストアド プロシージャで実行されているホスト アプリケーションに適しています。</span><span class="sxs-lookup"><span data-stu-id="11b1d-170">Each thread calls into the MessageBox database and calls the bts_DequeueMessages_\<application name\> stored procedure appropriate for the host application it is running in.</span></span> <span data-ttu-id="11b1d-171">このストアド プロシージャでは、ロック セマンティクスを使用して、1 つのインスタンスを確認し、1 つのキューから取り出すスレッドが特定の時点で、キューにメッセージを処理することがします。</span><span class="sxs-lookup"><span data-stu-id="11b1d-171">This stored procedure uses locking semantics to make sure that only one instance and one dequeuing thread are able to operate on a message in the queue at a given time.</span></span> <span data-ttu-id="11b1d-172">ロックを設定するホスト インスタンスは、メッセージを取得し、メッセージを対象のサブサービスに渡します。</span><span class="sxs-lookup"><span data-stu-id="11b1d-172">The host instance that gets the lock gets the message, and is then responsible for handing the message to the subservice for which it is intended.</span></span>  
  
 <span data-ttu-id="11b1d-173">メッセージを受信するサービスがエンドポイント マネージャーの場合、送信ポート (または要求/応答の受信ポートの応答部分) が呼び出されます。メッセージを受信するサービスが XLANG/s サブサービスの場合、サブスクリプションのインスタンス ID が存在するかどうかによって、オーケストレーションが作成されるか、オーケストレーションを検索してサブスクリプションを処理するかが決まります。</span><span class="sxs-lookup"><span data-stu-id="11b1d-173">If the service receiving the message is the Endpoint Manager, then the send port is invoked (or the response portion of a request/response receive port) and if it is the XLANG/s subservice, an orchestration is either created, or located to service the subscription depending on whether there is an instance ID in the subscription.</span></span> <span data-ttu-id="11b1d-174">次に、このサービスは、他のサービスに参照がない場合にメッセージ データを削除できるように、メッセージおよびメッセージ部分への参照を解放します。</span><span class="sxs-lookup"><span data-stu-id="11b1d-174">The service then releases the reference to the message and its part so that if no other services have references, the message data can be deleted.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="11b1d-175">参照</span><span class="sxs-lookup"><span data-stu-id="11b1d-175">See Also</span></span>  
 [<span data-ttu-id="11b1d-176">メッセージング エンジン</span><span class="sxs-lookup"><span data-stu-id="11b1d-176">The Messaging Engine </span></span>](../core/the-messaging-engine.md)