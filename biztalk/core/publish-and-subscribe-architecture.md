---
title: パブリッシュ/サブスクライブ アーキテクチャ |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- publish/subscribe architecture, publishers
- architecture, publish/subscribe
- publishing, publish/subscribe architecture
- publish/subscribe architecture, about publish/subscribe architecture
- creating, subscriptions
- publish/subscribe architecture, Messaging Engine
- routing, publishing
- Messaging Engine, publishing
- publish/subscribe architecture, subscribers
- publish/subscribe architecture
- subscriptions, publish/subscribe architecture
- publish/subscribe architecture, creating subscriptions
- subscriptions, creating
- Messaging Engine, subscribing
- publishing, routing
- Messaging Engine, publish/subscribe architecture
- publish/subscribe architecture, events
ms.assetid: 5ed36c1f-077d-468f-a99e-60f97377cef6
caps.latest.revision: 11
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: bf90d1f0fe1ed298d42c6ed9b0cf1086abe8eb7f
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/07/2019
ms.locfileid: "65398431"
---
# <a name="publish-and-subscribe-architecture"></a>パブリッシュ/サブスクライブ アーキテクチャ
パブリッシュ/サブスクライブの設計では、3 つのコンポーネントがあります。  
  
- [ディストリビューターのプロパティ]  
  
- [サブスクライバー]  
  
- イベント  
  
  発行元を含めるに到着するメッセージを公開する受信ポート、受信場所、送信ポートを公開するメッセージまたは別のオーケストレーションを非同期的に開始し、送信請求-応答を送信するときにメッセージを公開するオーケストレーションメッセージのターゲット アプリケーションまたはトランスポートからの応答を受け取ったとき。  
  
  BizTalk Server では、2 つの主な種類のサブスクリプション: アクティベーションとインスタンス。 *アクティベーションのサブスクリプション*は 1 つを指定するサブスクリプションを処理するメッセージがアクティブ化、または受信時にサブスクライバーの新しいインスタンスを作成する必要があります。 アクティベーションのサブスクリプションを作成することの例は、フィルターを使用した送信ポートを含めるまたは送信ポート、オーケストレーションにバインドされていると、オーケストレーションの受信図形をアクティブ化プロパティが true に設定します。 *インスタンス サブスクリプション*サブスクリプションを処理するメッセージが、サブスクライバーの既に実行中のインスタンスにルーティングすることを示します。 インスタンスのサブスクリプションを作成することの例としては、オーケストレーションに関連付けられた受信と要求/応答形式の受信ポートの BizTalk Server からの応答を待機しています。  
  
  情報レベルでサブスクリプションの 2 つの型の間の違いは、インスタンスのサブスクリプションがサブスクリプション テーブルに、マスター メッセージ ボックス データベースに格納されている、一意のインスタンス ID が含まれることです。 オーケストレーション インスタンスまたは受信ポートには、処理が完了すると、オーケストレーションまたは送信ポートが参加している限り、アクティベーションのサブスクリプションがアクティブなまま中にインスタンスのサブスクリプションがメッセージ ボックス データベースから削除されます。  
  
## <a name="creating-subscriptions"></a>サブスクリプションの作成  
 BizTalk Server では、BizTalk Server 管理データベースの adm_ServiceClass テーブルに記載されているサービス クラスでは、サブスクリプションを作成します。 これらのサービスには、キャッシュ サービスが含まれます。インプロセスおよび分離メッセージング、エンドポイント マネージャーによってホストされます。オーケストレーション/XLANG XLANG サブサービスでホストされています。 サブスクリプションを作成し、公開されたメッセージが表示されるこれらのサービス クラスのことができます。  
  
 サブスクリプションは、メッセージ コンテキスト プロパティと、サブスクリプションに固有の値を含む述語と呼ばれる、比較ステートメントのコレクションです。 たとえば、メッセージの種類ではメッセージと多数のサブスクリプションのコンテキスト プロパティは、サブスクリプションでメッセージ型を指定します。 サブスクリプションの詳細については、特定の述語が指定されたサブスクリプション操作の種類に応じて、次の述語テーブルのいずれかに移動中に、メッセージ エージェントによってサブスクリプション テーブルに挿入されます。  
  
- BitwiseANDPredicates  
  
- EqualsPredicates  
  
- EqualsPredicates2ndPass  
  
- ExistsPredicates  
  
- FirstPassPredicates  
  
- GreaterThanOrEqualsPredicates  
  
- GreaterThanPredicates  
  
- LessThenOrEqualsPredicates  
  
- LessThenPredicates  
  
- NotEqualsPredicates  
  
  このすべては、実行を呼び出すことにより実現が\<アプリケーション名\>と bts_insertpredicate _\<アプリケーション名\>ストアド プロシージャでメッセージ ボックス データベース\<アプリケーション名\>サブスクリプションを作成している BizTalk ホストの名前を指定します。  
  
  送信ポートが参加しているときに、ポートを作成、最低限、サブスクリプションを持つメッセージのコンテキストでポートのトランスポートの ID を送信します。 これにより、常に専用のメッセージを受信する送信ポートができます。 オーケストレーション ポートは、特定の送信ポートにバインドするときに、そのバインドに関する情報が BizTalk 管理データベースに格納されます。 送信されたメッセージは、物理的にバインドされたポートをオーケストレーションの送信ポート、メッセージを取得にルーティングされるようにする送信ポートに、コンテキストで、トランスポート ID が含まれています。 ただしは、この送信ポートが唯一の送信ポート、オーケストレーションから送信されたメッセージを受信できるいないことに注意してください。 オーケストレーションでは、メッセージを送信するときに、そのメッセージは、すべての関連する昇格させたプロパティと一緒にメッセージ ボックス データベースに公開されます。 バインド済み送信ポートであるため、トランスポート ID コンテキストでは、他の送信ポートまたはオーケストレーションがメッセージのプロパティにも一致するサブスクリプションを持つことができます、メッセージのコピーを受信することが保証されます。 いつでもメッセージが、メッセージ ボックスに直接発行されたサブスクリプションに一致するすべてのサブスクライバーが受信するメッセージのコピーを理解する非常に重要ですが。  
  
## <a name="publishing-and-routing"></a>公開とルーティング  
 サブスクリプションが作成され、有効になっている場合は後、は、処理を行う前にメッセージを公開する必要があります。 既に説明したように、サービスのいずれかから BizTalk Server に受信されると、メッセージが発行されます。 ここのルーティングでは、アダプターを通じて BizTalk Server に受信するメッセージについて説明します。  
  
 メッセージが受信パイプラインの処理を通過するときは、プロパティがメッセージ コンテキストに昇格されます。 メッセージの受信アダプターとパイプラインによって処理された後、メッセージ ボックスに公開する準備が最初に行われるが、メッセージ エージェントは、メッセージから昇格させたプロパティのプロパティ値および述語の値を挿入します。マスター メッセージ ボックス SQL Server データベースにコンテキスト。 データベースにこれらの値を持つには、ルーティングの決定を行うメッセージ エージェントができるようにします。  
  
 次の手順は、マスター メッセージ ボックス データベース公開されるメッセージの現在のバッチのサブスクリプションへの問い合わせへのメッセージ エージェントによってです。 データベース コンテキストのプロパティのみにメッセージがまだ書き込まれていないことに注意してください。 Bts_FindSubscriptions は、メッセージのクエリでプロシージャを保存するサブスクリプションを述語テーブル上に示した、格納されているメッセージの現在のバッチのメッセージ プロパティにリンクすることです。  
  
 この情報により、メッセージ エージェントは、1 回、bts_InsertMessage ストアド プロシージャを呼び出すことでサブスクリプションのある各メッセージ ボックス データベースにメッセージを挿入します。 サブスクリプション ID に、bts_InsertMessage ストアド プロシージャが最初に呼び出されました。 この最初のパスで、この int_EvaluateSubscriptions ストアド プロシージャの呼び出しにをチェックして、メッセージが、アプリケーションのセキュリティ要件を満たしていることを確認するサブスクリプションの詳細については、検索するための手順が格納されています。述語のホスト、およびアプリケーションの特定のキューまたはアプリケーション固有の保留キューの状態によってメッセージへの参照を挿入するアプリケーションのプロパティに一致するメッセージ。 メッセージ ID、サブスクリプション ID、サービス ID、およびその他のサブスクリプション情報は、サブスクリプションごとにこのアプリケーションで検出されたアプリケーションの特定のキュー テーブルに挿入されます。 バッチのメッセージのプロパティとメッセージの述語テーブルを消去後、メッセージを挿入して、関連する値。  
  
 Bts_InsertMessage ストアド プロシージャが、その後、メッセージ部分ごとに呼び出されます。 最初の呼び出しでは、メッセージ コンテキストが渡され、メッセージの部分では、ボディ部の名前および ID の数などに関するメタデータと共に SPOOL テーブルに挿入し、 さらにメッセージのボディ部が、int_InsertPart ストアド プロシージャを使用して部品テーブルに挿入されます。 Bts_InsertMessage ストアド プロシージャは PARTS テーブルに保存される、int_InsertPart ストアド プロシージャに渡されるだけで、残りのメッセージ部分ごとに呼び出されます。  
  
 メッセージがルーティングされると、次のテーブルにレコードを挿入して、メッセージとその要素の特定のインスタンスを受信する各サービスの参照が追加されます。  
  
- MessageRefCountLog1  
  
- MessageRefCountLog2  
  
- PartRefCountLog1  
  
- PartRefCountLog2  
  
  これらの参照は、メッセージ ボックスは、システムでメッセージのメッセージ データでいっぱいになりつつを定期的に実行されるクリーンアップ ジョブによって削除されているからメッセージと部分を保持します。 2 つのテーブルを使用して、競合とロックの問題を軽減します。  
  
  これで、メッセージは、右側のキューにルーティングされているが、スプールとパーツのテーブルに保存され、アプリケーションの特定のキューで参照されているメッセージする必要があるキューから取り出すアプリケーション インスタンスによって。 各ホスト インスタンスでは、さまざまな BizTalk 管理データベースの adm_ServiceClass テーブルで構成されている間隔で継続的に、データベースをポーリングするキューから取り出すスレッドがあります。 この同じテーブルには、使用するキューから取り出すスレッドの数を示す列があります。 各スレッドがメッセージ ボックス データベースに呼び出しを呼び出し、bts_dequeuemessages\<アプリケーション名\>ストアド プロシージャで実行されているホスト アプリケーションに適しています。 このストアド プロシージャでは、ロック セマンティクスを使用して、1 つだけのインスタンスし、1 つのキューから取り出すスレッドが特定の時点でキューにメッセージを処理することができます。 ロックを取得するホスト インスタンスでは、メッセージを取得しは、メッセージの処理の対象となるサブサービスする責任を負います。  
  
  作成されたかに配置されているサービス、サブスクリプション、メッセージを受信するサービスは、エンドポイント マネージャーでは、し、送信ポートが呼び出されます (または受信ポートの要求/応答の応答部分)、xlang/s サブサービスである場合は、オーケストレーションとはかどうかに応じて、サブスクリプションでインスタンス ID があります。 サービスは、他のサービスには、参照がない、メッセージ データが削除されるようにし、メッセージおよびメッセージ部分への参照を解放します。  
  
## <a name="see-also"></a>参照  
 [メッセージング エンジン ](../core/the-messaging-engine.md)