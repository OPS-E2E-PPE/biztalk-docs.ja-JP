---
title: "コンボイ シナリオの |Microsoft ドキュメント"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 1028ab37-7ead-41a6-a186-53e5344d1a28
caps.latest.revision: "19"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 42f1c9931fe91b284c53a05c7868554c622306fb
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/20/2017
---
# <a name="working-with-convoy-scenarios"></a>コンボイ シナリオの活用
A*コンボイ*複数の単一メッセージは、必要な結果を得るに関連付ける必要があるときに存在します。 大きく分けて、コンボイには "シーケンシャル" と "パラレル" という 2 つの種類があります。  
  
 状況によっては、オーケストレーション インスタンスに、関連付けられた複数のメッセージがすべて一度に渡される場合があります。 このような場合、グループ内のいずれかのメッセージがオーケストレーション インスタンスの関連付けセットを初期化してからでないと、他のメッセージをそのオーケストレーション インスタンスに関連付けることができないという、競合状態が発生する可能性があります。  
  
 BizTalk Server は、こうした競合状態が発生する可能性を検知し、関連付けられたメッセージをコンボイとして処理することで、すべてのメッセージを同一のオーケストレーション インスタンスで受信できるようにします。 ランタイムは、参加時に全般サブスクリプションを作成し、それをコンボイの一部として識別します。 このサブスクリプションの入力が完了した後、メッセージング エンジンは、あらかじめ定義された関連付けプロパティの値に基づいて一時サブスクリプションを作成します。 この一時サブスクリプションと呼ばれる、*コンボイ セット*です。 コンボイ セットは、コンボイで使用される関連付けセットのグループです。 これ以降、全般サブスクリプションに一致するメッセージはすべてコンボイ セットに対して評価され、コンボイ セットに一致するメッセージが既存のポートに送られます。  
  
## <a name="using-convoys-with-business-processes"></a>ビジネス プロセスでのコンボイの使用  
 次に、ビジネス プロセスでコンボイ処理を使用する際の注意事項を示します。  
  
-   A*関連付けセット*特定のビジネス プロセスにメッセージをルーティングを使用する特定の値を持つプロパティの一覧を示します。 関連付けセットで使用される、**受信**図形で関連付けに使用される 4 つ以上のプロパティを含めることはできません。 これらの値は、最大で 3 つのパラメーターをサポートするデータベース レベルで識別および格納されるためです。  
  
-   パラレルなコンボイとシーケンシャルなコンボイは、同じビジネス プロセス内で共存できますが、関連付けセットを共有することはできません。 これは、各関連付けセットが 1 つのコンボイにしか属すことができないためです。  
  
-   コンボイ処理を使用するときに、BizTalk Server でサポートされません、**オーケストレーションの開始**渡すよう初期化済みの関連付けセットが、新しいオーケストレーションに図形です。 これは、既に実行中のオーケストレーション インスタンスとは無関係に、コンボイ セットがデータベース レベルで処理されるためです。  
  
-   1 つを使用することはできません**受信**図形を別々 のコンボイで使用される 2 つまたは複数の関連付けセットを初期化します。 たとえば、受信図形 r1 で最初のコンボイ用の関連付けセット c1 および c2 を初期化し、受信図形 r2 が 2 番目のコンボイ用の c1 に、受信図形 r3 が 3 番目のコンボイ用の c2 にそれぞれ従うものと仮定します。 2 番目のコンボイ用のコンボイ セットは c1 および r2 で、3 番目のコンボイ用のコンボイ セットは c2 および r3 です。これらはすべて r1 によって初期化されます。 この場合、オーケストレーション エンジンは、これらをコンボイとして処理しません。 r2 と r3 の両方が c1 と c2 の両方に従うか (c1、r2、r3、および c2、r2、r3)、両方が c1 のみに従うか (c1、r2、r3)、または両方が c2 のみに従う (c2、r2、r3) 場合、この例は有効なコンボイ シナリオになります。  
  
## <a name="zombies"></a>ゾンビ  
 コンボイを使用する場合、ゾンビと呼ばれる "失われた" メッセージが発生する可能性があります。 実行中のオーケストレーション内の非アクティブな受信サブスクリプションがメッセージ ボックス データベース内のメッセージに一致した場合、メッセージ ボックスはそのメッセージをオーケストレーションに配信します。 メッセージ ボックスは、オーケストレーション内のビジネス ロジックを認識できません。したがって、サブスクリプションに一致するすべてのメッセージをオーケストレーションに配信するだけです。 これらのメッセージが配信されたとき、オーケストレーション実行フローが、そのメッセージを処理する受信サブスクリプションを既に過ぎていた場合、配信されたメッセージはゾンビになります。  
  
 たとえば、処理を 17 回繰り返すループに受信サブスクリプションが設定されており、そのサブスクリプションに一致するメッセージを 18 件受け取った場合にゾンビが発生します  (メッセージ ボックスは、17 個のメッセージのみがオーケストレーション ロジックで処理されるということを認識しません)。18 番目のメッセージが配信されたとき、実行フローは既にループから抜けているので、この最後のメッセージはオーケストレーションで処理されません。 オーケストレーションはメッセージを破棄して終了します。オーケストレーション インスタンスが既に終了しているため、破棄されたメッセージ (ゾンビ) は再開できません。  
  
 ゾンビを管理するには、Windows Management Instrumentation (WMI) スクリプトを使用して、"中断 (再開不可)" 状態のインスタンスをクエリします。 また、メッセージング エンジンは、"メッセージを破棄して完了" というエラー メッセージをイベント ログに書き込みます。  
  
 さらに、トランザクション スコープが長時間にわたるシーケンシャル コンボイがあり、そのスコープにタイムアウトを設定している場合は、一部のオーケストレーション インスタンスが "中断 (再開不可)" 状態になる可能性があります。 また、出力メッセージの数と "中断 (再開不可)" インスタンスの数の和が、入力メッセージの数より少なくなることもあります。 この動作は仕様による結果です。 タイムアウト例外が発生すると、コード内の例外ハンドラーに処理が移ります。 BizTalk Server は、例外ハンドラーを呼び出して例外を処理させます (ゾンビの処理など)。 例外ハンドラーで送信ポートを使用し、ゾンビを別の場所へ送信すると、後で詳しく調べて処理することができます。  
  
 コンボイ以外のシナリオでもゾンビが発生することがあります。 たとえば、オーケストレーション インスタンスが、ビジネス プロセスから 1 件の応答メッセージを受け取ると想定しているときに、何らかの理由でサブスクリプションに一致する応答メッセージを 2 件受け取った場合などです。 この場合、2 番目の応答メッセージはゾンビになります。 別の例がある場合、**リッスン**図形を含み、**受信**1 つの分岐に図形と**遅延**他の分岐に図形です。 メッセージの到着と同時にタイムアウトが発生した場合、そのメッセージはゾンビになります。  
  
 ゾンビを管理する方法の詳細については、次を参照してください。**中断サービス インスタンスを削除する**[!INCLUDE[ui-guidance-developers-reference](../includes/ui-guidance-developers-reference.md)]です。
  
## <a name="next-steps"></a>次の手順
 [シーケンシャルなコンボイ](../core/sequential-convoys.md)  
  
 [パラレルなコンボイ](../core/parallel-convoys.md)  
  
## <a name="see-also"></a>参照  
 [オーケストレーションでの相関関係の使用](../core/using-correlations-in-orchestrations.md)