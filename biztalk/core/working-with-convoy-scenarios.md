---
title: コンボイ シナリオの |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 1028ab37-7ead-41a6-a186-53e5344d1a28
caps.latest.revision: 19
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: e3eb1e6656b6aa725cbc110030257df77657b631
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/07/2019
ms.locfileid: "65258527"
---
# <a name="working-with-convoy-scenarios"></a><span data-ttu-id="2c7fc-102">コンボイ シナリオの</span><span class="sxs-lookup"><span data-stu-id="2c7fc-102">Working with Convoy Scenarios</span></span>
<span data-ttu-id="2c7fc-103">A*コンボイ*必要な結果を実現するために複数の単一メッセージを関連付ける必要があります、必ず存在します。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-103">A *convoy* exists any time that multiple single messages must be related to achieve the required result.</span></span> <span data-ttu-id="2c7fc-104">コンボイの 2 つの主な種類があります: シーケンシャルおよび並列です。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-104">There are two main types of convoys: sequential and parallel.</span></span>  
  
 <span data-ttu-id="2c7fc-105">特定の状況では、オーケストレーション インスタンスは、すべて同時に関連付けられたメッセージのグループを受信する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-105">Under certain conditions, an orchestration instance might receive a group of correlated messages all at the same time.</span></span> <span data-ttu-id="2c7fc-106">このような状況で、競合状態が発生するを相関関係が、他のメッセージがオーケストレーション インスタンスに関連付ける前に、オーケストレーション インスタンスで設定を初期化、グループ内のメッセージのいずれかの必要があります。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-106">In this situation, a race condition might occur, in which one of the messages in the group must initialize a correlation set in the orchestration instance before the other messages can be correlated to that orchestration instance.</span></span>  
  
 <span data-ttu-id="2c7fc-107">同じオーケストレーション インスタンスによって受信されるすべてのメッセージを相関させるは、BizTalk Server は、このような競合状態が発生する可能性を検出しをコンボイとして処理します。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-107">To ensure that all of the correlated messages are received by the same orchestration instance, BizTalk Server detects the potential for such a race condition and treats these messages as a convoy.</span></span> <span data-ttu-id="2c7fc-108">、参加時に、ランタイムは、一般的なサブスクリプションを作成し、なコンボイの一部として識別します。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-108">At enlistment, the runtime creates a general subscription and identifies it as part of a convoy.</span></span> <span data-ttu-id="2c7fc-109">このサブスクリプションの入力後は、メッセージング エンジンは、定義済みの関連付けのプロパティの値に基づいて一時サブスクリプションを作成します。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-109">After filling this subscription, the messaging engine creates a temporary subscription based on the values in the predefined correlation properties.</span></span> <span data-ttu-id="2c7fc-110">この一時サブスクリプションと呼ばれる、*コンボイ セット*します。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-110">This temporary subscription is called a *convoy set*.</span></span> <span data-ttu-id="2c7fc-111">コンボイ セットは、なコンボイで使用される関連付けセットのグループです。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-111">A convoy set is a group of correlation sets that are used in a convoy.</span></span> <span data-ttu-id="2c7fc-112">全般サブスクリプションに一致するすべての後続のメッセージが、コンボイ セットに対して評価されと一致するものは、既存のポートにルーティングされます。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-112">All subsequent messages that match the general subscription are evaluated against the convoy set, and those that match are routed to an existing port.</span></span>  
  
## <a name="using-convoys-with-business-processes"></a><span data-ttu-id="2c7fc-113">ビジネス プロセスでコンボイの使用</span><span class="sxs-lookup"><span data-stu-id="2c7fc-113">Using Convoys with Business Processes</span></span>  
 <span data-ttu-id="2c7fc-114">ビジネス プロセスでコンボイ処理を使用する場合は、次を考慮してください。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-114">Consider the following when using convoy processing with a business process:</span></span>  
  
-   <span data-ttu-id="2c7fc-115">A*関連付けセット*特定のビジネス プロセスにメッセージをルーティングを使用する特定の値を持つプロパティの一覧を示します。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-115">A *correlation set* is a list of properties with specific values that you use to route messages to a specific business process.</span></span> <span data-ttu-id="2c7fc-116">関連付けセットで使用される、**受信**図形で関連付けに使用される 4 つ以上のプロパティを含めることはできません。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-116">The correlation set used on a **Receive** shape cannot contain more than three properties used for correlation.</span></span> <span data-ttu-id="2c7fc-117">これらの値が識別され、最大 3 つのパラメーターをサポートするデータベース レベルで格納されているためにです。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-117">This is because these values are identified and stored at the database level, which supports a maximum of three parameters.</span></span>  
  
-   <span data-ttu-id="2c7fc-118">並列および順次のコンボイは、同じビジネス プロセスで共存させることができますが、相互関連付けセットを共有することはできません。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-118">Parallel and sequential convoys can coexist in the same business process, but they cannot share any correlation sets with each other.</span></span> <span data-ttu-id="2c7fc-119">各関連付けセットを 1 つだけのコンボイに所属できるためです。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-119">This is because each correlation set can belong to only one convoy.</span></span>  
  
-   <span data-ttu-id="2c7fc-120">コンボイ処理を使用する場合は、BizTalk Server でサポートされません、**オーケストレーションの開始**渡すよう初期化済みの関連付けセットに新しいオーケストレーションに図形。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-120">BizTalk Server does not support convoy processing when you use the **Start Orchestration** shape to pass an already-initialized correlation set into a new orchestration.</span></span> <span data-ttu-id="2c7fc-121">これは、コンボイ セットが既に実行中のオーケストレーション インスタンスの独立したデータベース レベルで処理されるためです。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-121">This is because convoy sets are handled at the database level, independent of already-running orchestration instances.</span></span>  
  
-   <span data-ttu-id="2c7fc-122">1 つを使用することはできません**受信**図形を別々 のコンボイで使用される 2 つ以上の関連付けセットを初期化します。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-122">You cannot use a single **Receive** shape to initialize two or more correlation sets that will be used in separate convoys.</span></span> <span data-ttu-id="2c7fc-123">たとえば、受信するとします r1 初期化関連付けセット c1 と c2 最初のコンボイ用は 2 番目のコンボイ用の c1 に r2 を受信して、3 番目のコンボイ用の次のように c2 に r3 を受信します。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-123">For example, suppose that receive r1 initializes correlation sets c1 and c2 for the first convoy, receive r2 follows c1 for the second convoy, and receive r3 follows c2 for the third convoy.</span></span> <span data-ttu-id="2c7fc-124">2 番目のコンボイ用のコンボイ セットは c1、r2 と 3 番目のコンボイ用のコンボイ セットは c2 および r3 はすべて r1 によって初期化されます。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-124">The intended convoy sets for the second convoy are c1, r2 and the intended convoy sets for the third convoy are c2, r3, which are all initialized by r1.</span></span> <span data-ttu-id="2c7fc-125">この場合、オーケストレーション エンジンでは、これらをコンボイとして処理はしません。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-125">In this case, the orchestration engine will not treat these as convoys.</span></span> <span data-ttu-id="2c7fc-126">R2 と r3 の両方が c1 と c2 の両方に従う場合、この例は有効なコンボイ シナリオ (c1、r2、r3、および c2、r2、r3)、どちらも次の c1 のみ (c1、r2、r3)、または次 c2 のみ (c2、r2、r3) の両方。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-126">The example is a valid convoy scenario if both r2 and r3 follow both c1 and c2 (c1, r2, r3 and c2, r2, r3), both follow c1 only (c1, r2, r3), or both follow c2 only (c2, r2, r3).</span></span>  
  
## <a name="zombies"></a><span data-ttu-id="2c7fc-127">ゾンビ</span><span class="sxs-lookup"><span data-stu-id="2c7fc-127">Zombies</span></span>  
 <span data-ttu-id="2c7fc-128">ゾンビと呼ばれる「失われた」メッセージのコンボイの使用は可能性があります。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-128">The use of convoys can result in "lost" messages called zombies.</span></span> <span data-ttu-id="2c7fc-129">非アクティブな受信時に実行中のオーケストレーション内のサブスクリプション、メッセージ ボックス データベース内のメッセージに一致し、メッセージ ボックスは、オーケストレーションにメッセージを配信します。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-129">When a non-activating receive subscription in a running orchestration matches a message in the MessageBox database, then the MessageBox delivers the message to the orchestration.</span></span> <span data-ttu-id="2c7fc-130">メッセージ ボックスに、オーケストレーション内のビジネス ロジックを把握していないため、単にオーケストレーションに配信するサブスクリプションに一致するすべてのメッセージ。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-130">Because the MessageBox does not know the business logic inside the orchestration, it simply delivers to the orchestration all the messages that match the subscription.</span></span> <span data-ttu-id="2c7fc-131">オーケストレーションの実行フローがメッセージを処理する受信サブスクリプションを渡されるときにこれらのメッセージが配信される場合、このようなメッセージはゾンビ状態になります。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-131">If any of these messages are delivered when the orchestration execution flow has passed the receive subscriptions that can consume the messages, then such messages become zombies.</span></span>  
  
 <span data-ttu-id="2c7fc-132">ゾンビを作成する状況の例は、17 回、反復処理するループ内での受信が 18 のメッセージが配信される、ループに受信サブスクリプションに一致します。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-132">An example of a situation that creates zombies is a receive inside a loop that iterates 17 times, but 18 messages are delivered that match the receive subscription in the loop.</span></span> <span data-ttu-id="2c7fc-133">(メッセージ ボックスを認識しませんオーケストレーション ロジックは 17 個のメッセージのみが処理される。)実行フローには、ループが既に終了しているので、18 のメッセージが配信されるは、オーケストレーションによって処理されませんが。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-133">(The MessageBox does not know that the orchestration logic only handles 17 messages.) The 18th message delivered is not consumed by the orchestration because execution flow has already exited the loop.</span></span> <span data-ttu-id="2c7fc-134">破棄されたメッセージ (ゾンビ) は、オーケストレーション インスタンスが既に完了したため、再開可能なオーケストレーションが完了しました。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-134">The orchestration is completed with discarded messages (zombies), which are not resumable because the orchestration instance has already completed.</span></span>  
  
 <span data-ttu-id="2c7fc-135">ゾンビを管理するには、「中断 (再開不可)」状態を使用して、インスタンスのクエリを実行する Windows Management Instrumentation (WMI) スクリプトを使用します。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-135">You can manage zombies by using a Windows Management Instrumentation (WMI) script to query the instances with the "Suspended-NonResumable" state.</span></span> <span data-ttu-id="2c7fc-136">「完了メッセージを破棄して」、イベントにはさらに、ログ、メッセージング エンジンは、エラー メッセージを書き込みます。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-136">In addition, the messaging engine writes an error message, "Completed with discarded messages", to the event log.</span></span>  
  
 <span data-ttu-id="2c7fc-137">さらに、実行時間の長いトランザクションのスコープを持つシーケンシャルなコンボイがあり、スコープはタイムアウトに設定されている場合一部のオーケストレーション インスタンスを「中断 (再開不可)」状態終了可能性があります。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-137">Moreover, if you have a sequential convoy with a long-running transactional scope, and the scope has a time-out setting, some orchestration instances may end up in the "Suspended-NonResumable" state.</span></span> <span data-ttu-id="2c7fc-138">出力メッセージの数と「中断 (再開不可)」インスタンスの数が入力メッセージの数より少なくすることもあります。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-138">You may also notice that the number of output messages plus the number of "Suspended-NonResumable" instances is less than the number of input messages.</span></span> <span data-ttu-id="2c7fc-139">この動作は仕様による結果です。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-139">This behavior is by design.</span></span> <span data-ttu-id="2c7fc-140">タイムアウト例外が発生したときに、コードは、例外ハンドラーに移動します。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-140">When a time-out exception happens, the code goes into the exception handler.</span></span> <span data-ttu-id="2c7fc-141">BizTalk Server では、ゾンビの処理を含む、例外を処理できるようにする例外ハンドラーを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-141">BizTalk Server calls the exception handler to let it handle the exception, including handling the zombies.</span></span> <span data-ttu-id="2c7fc-142">例外ハンドラーで送信ポートを使用して、ゾンビをこれ以上のレビューと処理のための変換先に送信することができます。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-142">You can use a send port in the exception handler to send the zombies to a destination for further review and processing.</span></span>  
  
 <span data-ttu-id="2c7fc-143">コンボイ以外のシナリオでもゾンビを生成できます。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-143">Scenarios other than convoys can also generate zombies.</span></span> <span data-ttu-id="2c7fc-144">たとえば、何らかの理由で一致する 2 つのサブスクリプションの応答メッセージを受信、オーケストレーション インスタンスが、ビジネス プロセスの 1 つの応答メッセージを指定してください。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-144">For example, suppose that an orchestration instance is expecting one response message from a business process, and for some reason, it receives two matching subscription response messages.</span></span> <span data-ttu-id="2c7fc-145">この場合、2 番目の応答メッセージはゾンビになります。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-145">In this case, the second response message becomes a zombie.</span></span> <span data-ttu-id="2c7fc-146">別の例は、ある場合、**リッスン**図形の**受信**1 つの分岐に図形と**遅延**他の分岐にある図形です。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-146">Another example is when you have a **Listen** shape with a **Receive** shape at one branch and a **Delay** shape at the other branch.</span></span> <span data-ttu-id="2c7fc-147">同時に、タイムアウトが発生するメッセージが到着すると、メッセージはゾンビになります。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-147">If a message arrives at the same time that the time-out occurs, the message becomes a zombie.</span></span>  
  
 <span data-ttu-id="2c7fc-148">ゾンビを管理する方法の詳細については、次を参照してください。**中断サービス インスタンスを削除する**[!INCLUDE[ui-guidance-developers-reference](../includes/ui-guidance-developers-reference.md)]します。</span><span class="sxs-lookup"><span data-stu-id="2c7fc-148">For more information about how to manage zombies, see **Removing Suspended Service Instances** [!INCLUDE[ui-guidance-developers-reference](../includes/ui-guidance-developers-reference.md)].</span></span>
  
## <a name="next-steps"></a><span data-ttu-id="2c7fc-149">次のステップ</span><span class="sxs-lookup"><span data-stu-id="2c7fc-149">Next steps</span></span>
 [<span data-ttu-id="2c7fc-150">シーケンシャルなコンボイ</span><span class="sxs-lookup"><span data-stu-id="2c7fc-150">Sequential Convoys</span></span>](../core/sequential-convoys.md)  
  
 [<span data-ttu-id="2c7fc-151">パラレルなコンボイ</span><span class="sxs-lookup"><span data-stu-id="2c7fc-151">Parallel Convoys</span></span>](../core/parallel-convoys.md)  
  
## <a name="see-also"></a><span data-ttu-id="2c7fc-152">参照</span><span class="sxs-lookup"><span data-stu-id="2c7fc-152">See Also</span></span>  
 [<span data-ttu-id="2c7fc-153">オーケストレーションでの関連付けの使用</span><span class="sxs-lookup"><span data-stu-id="2c7fc-153">Using Correlations in Orchestrations</span></span>](../core/using-correlations-in-orchestrations.md)