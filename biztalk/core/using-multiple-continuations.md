---
title: 複数の Continuation の使用 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 01a38087-71ee-40b3-a957-6a2653bd6435
caps.latest.revision: 10
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 78468438dbd04583f8936bab28e80bf400e83d72
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/27/2018
ms.locfileid: "36987139"
---
# <a name="using-multiple-continuations"></a><span data-ttu-id="23dd0-102">複数の Continuation の使用</span><span class="sxs-lookup"><span data-stu-id="23dd0-102">Using Multiple Continuations</span></span>
<span data-ttu-id="23dd0-103">複数のアクティビティが存在する環境で追跡プロファイル エディター (TPE) を使用するには、受信ポート、オーケストレーション、および送信ポートを正しい順序でマップするために、アクティビティが追跡されるシナリオを理解する必要があります。</span><span class="sxs-lookup"><span data-stu-id="23dd0-103">Using the Tracking Profile Editor (TPE) in environments in which there are multiple activities requires that you understand the scenario in which the activities are being tracked in order to map the receive ports, orchestrations, and send ports in the proper sequence.</span></span>  
  
 <span data-ttu-id="23dd0-104">追跡プロファイルでは、TPE によってアクティビティの開始と終了が自動的に評価されます。</span><span class="sxs-lookup"><span data-stu-id="23dd0-104">In a tracking profile, the TPE assesses the beginning and end of the activity automatically.</span></span> <span data-ttu-id="23dd0-105">アクティビティの開始は最初のデータが収集されたときであり、終了は最後のデータが収集されたときです。</span><span class="sxs-lookup"><span data-stu-id="23dd0-105">The activity starts when the first piece of data is collected and ends when the last piece is collected.</span></span>  
  
 <span data-ttu-id="23dd0-106">ほとんどの場合、2 つのオーケストレーション間の Continuation など、単一の Continuation を作成する手順は、開発者にとって難しいものではありません。</span><span class="sxs-lookup"><span data-stu-id="23dd0-106">In most cases creating a single continuation, such as a continuation between two orchestrations, is a straightforward process for developers.</span></span> <span data-ttu-id="23dd0-107">TPE が複雑になるのは、複数の Continuation の場合です。 </span><span class="sxs-lookup"><span data-stu-id="23dd0-107">Where TPE exhibits complexity is in the case of multiple continuations.</span></span> <span data-ttu-id="23dd0-108">複数の Continuation のシナリオは、ビジネス アクティビティ監視 (BAM) アクティビティが複数の受信ポート、オーケストレーション、および送信ポートにまたがる場合です。</span><span class="sxs-lookup"><span data-stu-id="23dd0-108">A multiple continuation scenario  is where a Business Activity Monitoring (BAM) activity spans multiple receive ports, orchestrations, and send ports.</span></span> <span data-ttu-id="23dd0-109">1 つのレコードに BAM データを収集するには、すべての BizTalk Server スケジュール間に Continuation を作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="23dd0-109">In order to collect the BAM data in one record, you must create continuations between all the BizTalk Server schedules.</span></span> <span data-ttu-id="23dd0-110">このプロセスは、TPE ユーザー インターフェイス (UI) を使用して完了させる場合には、複雑になります。</span><span class="sxs-lookup"><span data-stu-id="23dd0-110">This process can be complex when completed through the TPE user interface (UI).</span></span>  
  
 <span data-ttu-id="23dd0-111">このトピックでは、異なるシナリオで単一および複数の Continuation を作成する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="23dd0-111">This topic describes how to create single and multiple continuations in different scenarios.</span></span>  
  
#### <a name="base-scenario-description---multiple-receive-ports-orchestrations-and-send-ports"></a><span data-ttu-id="23dd0-112">基本シナリオの説明 - 複数の受信ポート、オーケストレーション、および送信ポート</span><span class="sxs-lookup"><span data-stu-id="23dd0-112">Base Scenario Description - Multiple Receive Ports, Orchestrations, and Send Ports</span></span>  
 <span data-ttu-id="23dd0-113">このシナリオは、複数の受信ポート (R)、オーケストレーション (O)、および送信ポート (S) を持つ BizTalk Server で構成されます。</span><span class="sxs-lookup"><span data-stu-id="23dd0-113">The scenario consists of a BizTalk server that has a number of receive ports (R), orchestrations (O), and send ports (S).</span></span> <span data-ttu-id="23dd0-114">Continuation をリンクするには、一般的な interchangeID コンテキスト プロパティが使用されます。</span><span class="sxs-lookup"><span data-stu-id="23dd0-114">There is a generic interchangeID context property that is used to link the continuations.</span></span> <span data-ttu-id="23dd0-115">activityID や他の一意識別子など、任意のコンテキスト プロパティを使用できます。</span><span class="sxs-lookup"><span data-stu-id="23dd0-115">You can use any context property, such as the activityID or other unique identifier.</span></span> <span data-ttu-id="23dd0-116">特定のコンテンツの選択は、このシナリオの説明とは関係ありません。</span><span class="sxs-lookup"><span data-stu-id="23dd0-116">The choice of the specific content is not germane to the discussion of the scenario.</span></span>  
  
 <span data-ttu-id="23dd0-117">このシナリオでは、これらのポートおよびオーケストレーションから追跡されるデータ項目、マイルストーン、およびコンテキストの各プロパティの値に関する情報は指定されていません。</span><span class="sxs-lookup"><span data-stu-id="23dd0-117">For the purposes of the scenario, discussions of the data item/milestone/context-property-value being tracked from these ports and orchestrations are not specified.</span></span> <span data-ttu-id="23dd0-118">マッピングのその部分は、ビジネス ロジックに固有です。</span><span class="sxs-lookup"><span data-stu-id="23dd0-118">That part of the mapping is specific to the business logic.</span></span> <span data-ttu-id="23dd0-119">目標は、完了したアクティビティ テーブルの 1 行に、すべてのポートおよびオーケストレーションから全 BAM データを取得することです。</span><span class="sxs-lookup"><span data-stu-id="23dd0-119">The goal is to capture all BAM data from all the ports and orchestrations in a single row in the completed activity table.</span></span> <span data-ttu-id="23dd0-120">オーケストレーションでメッセージを受信および処理できるさまざまな方法によって、興味深い課題とソリューションを示します。</span><span class="sxs-lookup"><span data-stu-id="23dd0-120">The different ways in which a message can be received and processed by orchestrations presents some interesting challenges and solutions.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="23dd0-121">1 つのポートまたは 1 つのオーケストレーションのシナリオは、複数のポートおよび複数のオーケストレーションのシナリオの特殊なケースと見なすことができます。</span><span class="sxs-lookup"><span data-stu-id="23dd0-121">The scenario of one port or one orchestration can be considered a special case of the many port and many orchestrations scenario.</span></span>  
  
#### <a name="scenario-solution-1---one-receive-port-and-one-orchestration"></a><span data-ttu-id="23dd0-122">シナリオのソリューション 1 - 1 つの受信ポートと 1 つのオーケストレーション</span><span class="sxs-lookup"><span data-stu-id="23dd0-122">Scenario Solution 1 - One Receive Port and One Orchestration</span></span>  
 <span data-ttu-id="23dd0-123">このシナリオでは、メッセージは 1 つの受信ポート (R1) だけで受信され、1 つのオーケストレーション (O1) だけで処理されます。</span><span class="sxs-lookup"><span data-stu-id="23dd0-123">In this scenario, a message arrives at exactly one of the receive ports (R1) and is processed by exactly one of the orchestrations (O1).</span></span>  
  
 <span data-ttu-id="23dd0-124">Continuation の作成手順は次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="23dd0-124">The process to create the continuation is as follows:</span></span>  
  
1. <span data-ttu-id="23dd0-125">追跡プロファイルのフォルダー アクティビティ ツリー ビューで Continuation を作成します。</span><span class="sxs-lookup"><span data-stu-id="23dd0-125">Create a continuation in the folder activity tree view of the tracking profile.</span></span>  
  
2. <span data-ttu-id="23dd0-126">クリックして、コンテキスト プロパティ スキーマを選択、**イベント ソースの選択**ボタンをクリックして、 **コンテキスト プロパティの**メニュー項目。</span><span class="sxs-lookup"><span data-stu-id="23dd0-126">Choose the context property schema by clicking the **Select Event Source** button, and then clicking the **Select Context Property** menu item.</span></span>  
  
3. <span data-ttu-id="23dd0-127">検索、 **interchangeId プロパティ**で、**コンテキスト プロパティ名**ボックスの一覧し、それを選択します。</span><span class="sxs-lookup"><span data-stu-id="23dd0-127">Locate the **interchangeId property** in the **Context Property Name** list, and then select it.</span></span>  
  
4. <span data-ttu-id="23dd0-128">プロパティ スキーマから、作成した Continuation フォルダーに interchangeID をマップします。</span><span class="sxs-lookup"><span data-stu-id="23dd0-128">From the property schema, map the interchangeID to the continuation folder that you just created.</span></span>  
  
5. <span data-ttu-id="23dd0-129">アクティビティ ツリーで新しく作成された interchangeID ノードを右クリックして、マップ元になるポートを選択します。</span><span class="sxs-lookup"><span data-stu-id="23dd0-129">Right-click the newly created interchangeID node in the activity tree, and then select the ports from which to map.</span></span>  
  
6. <span data-ttu-id="23dd0-130">**ポートの選択**すべて表示されるダイアログ ボックスが選択**N**受信ポート。</span><span class="sxs-lookup"><span data-stu-id="23dd0-130">In the **Select Ports** dialog box that is displayed, select all **N** receive ports.</span></span>  
  
7. <span data-ttu-id="23dd0-131">フォルダー アクティビティ ツリーで ContinuationID フォルダーを作成します。</span><span class="sxs-lookup"><span data-stu-id="23dd0-131">Create a continuationID folder in the folder activity tree.</span></span>  
  
8. <span data-ttu-id="23dd0-132">クリックして、各オーケストレーションを開き、**イベント ソースの選択**ボタンをクリックして、 **オーケストレーション スケジュールの**メニュー項目。</span><span class="sxs-lookup"><span data-stu-id="23dd0-132">Open each orchestration by clicking the **Select Event Source** button, and then clicking the **Select Orchestration Schedule** menu item.</span></span> <span data-ttu-id="23dd0-133">各オーケストレーションから、オーケストレーションの図形を右クリックして、新しく作成された continuationID に interchangeID コンテキスト プロパティをマップします。</span><span class="sxs-lookup"><span data-stu-id="23dd0-133">From each orchestration, right-click a shape in the orchestration, and then map the interchangeID context property to the newly created continuationID.</span></span>  
  
   <span data-ttu-id="23dd0-134">3 つのオーケストレーションによる展開では、追跡プロファイルは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="23dd0-134">In a deployment with three orchestrations, your tracking profile would look similar to this:</span></span>  
  
   <span data-ttu-id="23dd0-135">![TPE 複数 continuation シナリオ 1](../core/media/4761d680-7218-4404-a636-06739f70f344.gif "4761d680-7218-4404-a636-06739f70f344")</span><span class="sxs-lookup"><span data-stu-id="23dd0-135">![TPE multiple continuation scenario 1](../core/media/4761d680-7218-4404-a636-06739f70f344.gif "4761d680-7218-4404-a636-06739f70f344")</span></span>  
  
#### <a name="scenario-solution-2---one-receive-port-and-multiple-orchestrations"></a><span data-ttu-id="23dd0-136">シナリオのソリューション 2 - 1 つの受信ポートと複数のオーケストレーション</span><span class="sxs-lookup"><span data-stu-id="23dd0-136">Scenario Solution 2 - One Receive Port and Multiple Orchestrations</span></span>  
 <span data-ttu-id="23dd0-137">このシナリオでは、メッセージは 1 つの受信ポートだけで受信され、個別のオーケストレーションによって処理されます。</span><span class="sxs-lookup"><span data-stu-id="23dd0-137">In this scenario, a message arrives at exactly one of the receive ports and is processed by each and every orchestration.</span></span> <span data-ttu-id="23dd0-138">この状況は、メッセージが各オーケストレーションに同時に送信された場合に発生します。</span><span class="sxs-lookup"><span data-stu-id="23dd0-138">This happens as the message is simultaneously sent to each of the orchestrations.</span></span>  
  
 <span data-ttu-id="23dd0-139">この場合、オーケストレーションごとに Continuation と continuationID が必要になります。</span><span class="sxs-lookup"><span data-stu-id="23dd0-139">In this case, we would need a continuation and continuationID for each orchestration.</span></span> <span data-ttu-id="23dd0-140">Continuation の作成プロセスは、シナリオのソリューション 1 で説明されている手順を実行するようになります。</span><span class="sxs-lookup"><span data-stu-id="23dd0-140">The process for creating the continuations would be similar to the steps outlined in scenario solution 1.</span></span> <span data-ttu-id="23dd0-141">3 つのオーケストレーションの展開で、生成された追跡プロファイルを次に示します。</span><span class="sxs-lookup"><span data-stu-id="23dd0-141">For a three-orchestration deployment, your resulting tracking profile looks something like this:</span></span>  
  
 <span data-ttu-id="23dd0-142">![TPE 複数 continuation シナリオ 2](../core/media/3cebd82f-9192-4d52-84c7-584f24e8ecca.gif "3cebd82f-9192-4d52-84c7-584f24e8ecca")</span><span class="sxs-lookup"><span data-stu-id="23dd0-142">![TPE Multiple continuation scenario 2](../core/media/3cebd82f-9192-4d52-84c7-584f24e8ecca.gif "3cebd82f-9192-4d52-84c7-584f24e8ecca")</span></span>  
  
#### <a name="scenario-solution-3---content-based-routing"></a><span data-ttu-id="23dd0-143">シナリオのソリューション 3 - コンテンツ ベースのルーティング</span><span class="sxs-lookup"><span data-stu-id="23dd0-143">Scenario Solution 3 - Content Based Routing</span></span>  
 <span data-ttu-id="23dd0-144">このシナリオでは、コンテンツ ベースのルーティング (CBR) のソリューションを定義します。</span><span class="sxs-lookup"><span data-stu-id="23dd0-144">This scenario defines a content based routing (CBR) solution.</span></span> <span data-ttu-id="23dd0-145">メッセージは 1 つの受信ポートだけで受信され、1 つの送信ポートだけに送信されます。</span><span class="sxs-lookup"><span data-stu-id="23dd0-145">A message arrives at exactly one of the receive ports and is sent to exactly one of the send ports.</span></span> <span data-ttu-id="23dd0-146">このルーティングは、メッセージのコンテキスト プロパティの値に基づいて行われます。</span><span class="sxs-lookup"><span data-stu-id="23dd0-146">This routing happens based on a context property value in the message.</span></span> <span data-ttu-id="23dd0-147">この場合は、1 つの Continuation が必要です。</span><span class="sxs-lookup"><span data-stu-id="23dd0-147">In this case, we would need one continuation.</span></span> <span data-ttu-id="23dd0-148">マッピングは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="23dd0-148">The mapping looks something like this:</span></span>  
  
 <span data-ttu-id="23dd0-149">![Continuation CBR シナリオ] (../core/media/4459a73d-515f-4d6d-a68f-b18eee072df8.gif "4459a73d-515f-4d6d-a68f-b18eee072df8")</span><span class="sxs-lookup"><span data-stu-id="23dd0-149">![Continuation CBR scenario.](../core/media/4459a73d-515f-4d6d-a68f-b18eee072df8.gif "4459a73d-515f-4d6d-a68f-b18eee072df8")</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="23dd0-150">上記のマッピングは、1 つの受信ポートだけで受信され、すべての送信ポートに送信されるメッセージでも有効です。</span><span class="sxs-lookup"><span data-stu-id="23dd0-150">The above mapping is also valid for a message that arrives at exactly one of the receive ports and is sent to all of the send ports.</span></span>  
  
#### <a name="scenario-solution-4---one-orchestration-multiple-send-ports"></a><span data-ttu-id="23dd0-151">シナリオのソリューション 4 - 1 つのオーケストレーション、複数の送信ポート</span><span class="sxs-lookup"><span data-stu-id="23dd0-151">Scenario Solution 4 - One Orchestration, Multiple Send Ports</span></span>  
 <span data-ttu-id="23dd0-152">このシナリオでは、複数の送信を使用します。</span><span class="sxs-lookup"><span data-stu-id="23dd0-152">In this scenario, there are multiple send.</span></span> <span data-ttu-id="23dd0-153">ポート。</span><span class="sxs-lookup"><span data-stu-id="23dd0-153">ports.</span></span> <span data-ttu-id="23dd0-154">メッセージは、これは、処理ルールによって決定され、すべての送信ポートに送信されると、オーケストレーションの 1 つだけで処理されます。</span><span class="sxs-lookup"><span data-stu-id="23dd0-154">A message is processed by exactly one of the orchestrations, which is determined by the processing rules, and is sent to all of the send ports.</span></span> <span data-ttu-id="23dd0-155">この場合は、1 つの Continuation が必要です。</span><span class="sxs-lookup"><span data-stu-id="23dd0-155">In this case, we would need one continuation.</span></span> <span data-ttu-id="23dd0-156">マッピングは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="23dd0-156">The mapping looks something like this:</span></span>  
  
 <span data-ttu-id="23dd0-157">![Coninuation シナリオ 4](../core/media/3ab10b51-d306-4ad1-acb6-6731e23394ac.gif "3ab10b51-d306-4ad1-acb6-6731e23394ac")</span><span class="sxs-lookup"><span data-stu-id="23dd0-157">![Coninuation Scenario 4](../core/media/3ab10b51-d306-4ad1-acb6-6731e23394ac.gif "3ab10b51-d306-4ad1-acb6-6731e23394ac")</span></span>  
  
#### <a name="scenario-solution-5---sequential-orchestrations"></a><span data-ttu-id="23dd0-158">シナリオのソリューション 5 - 順次オーケストレーション</span><span class="sxs-lookup"><span data-stu-id="23dd0-158">Scenario Solution 5 - Sequential Orchestrations</span></span>  
 <span data-ttu-id="23dd0-159">このシナリオでは、メッセージは各オーケストレーションで順に 1 つずつ処理され、Continuation を介して次のオーケストレーションに渡されます。</span><span class="sxs-lookup"><span data-stu-id="23dd0-159">In this scenario, a message is processed by each orchestration in sequence, one by one, and is passed to the next orchestration via the continuation.</span></span> <span data-ttu-id="23dd0-160">マッピングは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="23dd0-160">The mapping looks something like this:</span></span>  
  
 <span data-ttu-id="23dd0-161">![Continuation のシナリオ 5](../core/media/563cacee-104c-4f8a-9836-da90aecb7487.gif "563cacee-104c-4f8a-9836-da90aecb7487")</span><span class="sxs-lookup"><span data-stu-id="23dd0-161">![Continuation scenario 5](../core/media/563cacee-104c-4f8a-9836-da90aecb7487.gif "563cacee-104c-4f8a-9836-da90aecb7487")</span></span>  
  
### <a name="collecting-data-in-an-asynchronous-environment"></a><span data-ttu-id="23dd0-162">非同期環境でのデータの収集</span><span class="sxs-lookup"><span data-stu-id="23dd0-162">Collecting Data in an Asynchronous Environment</span></span>  
 <span data-ttu-id="23dd0-163">Continuation を設定すると、BAM によって到着するデータが要求されます。</span><span class="sxs-lookup"><span data-stu-id="23dd0-163">When you set up continuations, BAM expects the data to arrive.</span></span> <span data-ttu-id="23dd0-164">非同期環境では、応答をバックエンド プロセスから受信できません。</span><span class="sxs-lookup"><span data-stu-id="23dd0-164">In an asynchronous environment you may not receive a response from a backend process.</span></span>  
  
 <span data-ttu-id="23dd0-165">応答データが受信されないと、アクティビティ インスタンスは無限に待機します。</span><span class="sxs-lookup"><span data-stu-id="23dd0-165">If you do not receive the response data, the activity instance waits indefinitely.</span></span> <span data-ttu-id="23dd0-166">アクティビティは完了せず、レコードは BAM プライマリ インポート データベースのテーブルに残ります。</span><span class="sxs-lookup"><span data-stu-id="23dd0-166">The activity will never complete and the records remain in the tables in the BAM Primary Import database.</span></span> <span data-ttu-id="23dd0-167">長時間実行されるトランザクションのケース、つまり残りのデータがいつ到着するかを確認する手段がない場合を考えてみます。</span><span class="sxs-lookup"><span data-stu-id="23dd0-167">Consider the case of long-running transactions, where there is no way to tell when the remaining data will arrive.</span></span> <span data-ttu-id="23dd0-168">データの到着がビジネス ロジックまたはプロセスによって異なる場合は、アクティビティが完了としてマークされるタイムアウトが発生しません。</span><span class="sxs-lookup"><span data-stu-id="23dd0-168">There is no time-out, as data arrival will depend on business logic or processes, after which the activity is marked as complete.</span></span> <span data-ttu-id="23dd0-169">データは同日に到着したり、極端な場合には翌年に到着したりします。</span><span class="sxs-lookup"><span data-stu-id="23dd0-169">The data could arrive the same day, or in extreme cases, the following year.</span></span>  
  
 <span data-ttu-id="23dd0-170">これを解決するには、関連アクティビティを使用します。</span><span class="sxs-lookup"><span data-stu-id="23dd0-170">The solution is to use related activities.</span></span>  
  
 <span data-ttu-id="23dd0-171">アクティビティを 2 つのアクティビティに分割します。</span><span class="sxs-lookup"><span data-stu-id="23dd0-171">Split your activity into two activities.</span></span> <span data-ttu-id="23dd0-172">2 つのアクティビティを関連付け、元のアクティビティに応答を関連付けます。</span><span class="sxs-lookup"><span data-stu-id="23dd0-172">Relate the two activities, and relate the response to the original activity.</span></span>  
  
 <span data-ttu-id="23dd0-173">関連するアクティビティに関する詳細については、次を参照してください。[アクティビティ リレーションシップ](../core/activity-relationships.md)します。</span><span class="sxs-lookup"><span data-stu-id="23dd0-173">For more information about related activities, see [Activity Relationships](../core/activity-relationships.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="23dd0-174">参照</span><span class="sxs-lookup"><span data-stu-id="23dd0-174">See Also</span></span>  
 [<span data-ttu-id="23dd0-175">Xml-data Reduced を参照してください。</span><span class="sxs-lookup"><span data-stu-id="23dd0-175">Tracking Profile Editor</span></span>](../core/tracking-profile-editor.md)