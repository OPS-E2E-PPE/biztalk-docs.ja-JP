---
title: "SQL Server 層のスケール アウト |Microsoft ドキュメント"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- scaling, MessageBox database
- scaling, scaling out
- SQL Server, scaling
- MessageBox database, scaling
- scaling, strategies
ms.assetid: d5b2ebba-401e-4fde-8818-407fa626043a
caps.latest.revision: "7"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 702c253a0135c1dc4af4cea15a9b47c77792586f
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/20/2017
---
# <a name="scaling-out-the-sql-server-tier"></a>SQL Server 層のスケール アウト
各 BizTalk グループには、マスター メッセージ ボックス データベースを 1 つ追加します。 以降追加したメッセージ ボックス データベースはすべて、セカンダリ メッセージ ボックスと呼ばれます。 マスター メッセージ ボックスは、すべてのサブスクリプションとメッセージ ルーティングを処理し、 メッセージの公開も行えます。 セカンダリ メッセージ ボックス データベースは、特定の構成を行った場合にのみ、メッセージを公開します。  
  
## <a name="how-to-add-a-secondary-messagebox-database"></a>セカンダリ メッセージ ボックス データベースを追加する方法  
 セカンダリ メッセージ ボックス データベースを追加する方法は 2 とおりあります。  
  
-   セカンダリ メッセージ ボックス データベースを同じ物理サーバー上に追加する。  
  
     既存のメッセージ ボックス物理サーバーに十分な CPU および I/O リソースがあり、ボトルネックの発生原因がロックの競合に限られている場合は、この方法を使用します。 セカンダリ メッセージ ボックス データベースを別の IO ドライブ上に作成します。  
  
     利点 :   
  
    -   余分な CPU ヘッドルームを他のメッセージ ボックスに利用できます。  
  
    -   SQL サーバー ライセンスが少なくて済みます。  
  
    -   ネットワーク ホップがなくなります。  
  
-   セカンダリ メッセージ ボックス データベースを別の物理サーバー上に追加する。  
  
     この場合は、追加のメッセージ ボックス データベースとして固有の IO を持つ専用の物理サーバーを使用します。  
  
 次の図は、SQL 層を 1 つのメッセージ ボックス データベースから 3 つのメッセージ ボックス データベースにスケール アウトするシナリオを示しています。  
  
 ![MSGBOX のスケール アウト](../core/media/scaleoutmsgbox.gif "ScaleOutMSGBOX")  
  
## <a name="when-to-scale-out-the-messagebox-database"></a>メッセージ ボックス データベースのスケール アウトが必要になるケース  
  
-   メッセージ ボックス データベースがボトルネックとなる場合。 次のボトルネックが考えられます。  
  
    -   **CPU**非常に複雑なオーケストレーション シナリオが発生した場合、メッセージ ボックス データベースは大量の CPU リソースを消費します。 公開メッセージ ボックス データベースを追加すると、スループットが向上します。  
  
    -   **ロックの競合**複雑なシナリオで複数のホスト インスタンスやオーケストレーションがメッセージ ボックス データベースにロックの競合を作成する傾向があります。 この場合も、公開メッセージ ボックス データベースを追加すると、スループットが向上します。  
  
-   スケール アップしても、ボトルネックが解消されない場合。 たとえば、マスター メッセージ ボックス データベースがロックの競合による制約を受けている場合、スケール アウトするしかありません。  
  
-   スケール アップのコストが高すぎる場合。 たとえば、既存のクアッド プロセッサ サーバーを 8 ウェイ サーバーにアップグレードするコストが、クアッド プロセッサをもう 1 つ追加するコストを上回るような場合は、スケール アウトすることをお勧めします。  
  
## <a name="when-you-cant-scale-out-the-sql-tier"></a>SQL 層をスケール アウトできないケース  
 マスター メッセージ ボックス データベースがボトルネックにならない限り、理論上は、SQL 層は無限にスケール アウトできます。 そのためには、マスター メッセージ ボックス データベースを非公開データベースにして、ルーティング専用にすることを検討してください。 ただし、マスター メッセージ ボックス データベースがロックの競合によってボトルネックとなった場合は、SQL 層をそれ以上スケール アウトすることはできません。  
  
## <a name="scale-out-strategies-and-considerations"></a>スケール アウトの方法と検討事項  
  
-   まずマスター メッセージ ボックス データベースをスケール アップし、その後スケール アウトします。  
  
-   スケール アウト 1 から 1 ~ 2 ではなく 3 つの SQL メッセージ ボックス データベースにします。 「4 つの BizTalk Server, 1 の SQL サーバーのトポロジでは、」というタイトル上の図に示す 1 の SQL server トポロジが考慮され、SQL server は CPU バインド、つまり、CPU の処理は、ボトルネックを前提としています。 このトポロジにメッセージ ボックス データベースを 1 つしか追加しない場合は、依然としてマスター メッセージ ボックス データベースが CPU に依存しており、セカンダリ メッセージ ボックス データベースは有効に利用されません。 そのため、スケール ファクターはほぼ 1 はします。 専用のルーティングを行う場合にのみ、マスター メッセージ ボックス データベースをマスター メッセージ ボックス データベースでパブリッシングを無効にする場合、セカンダリ メッセージ ボックス データベースには公開が行われます。 これでは、セカンダリ メッセージ ボックス データベースが唯一のパブリッシャーであり、やはりボトルネックとなってしまうので、全体のスループットは改善されません。 したがって、セカンダリ メッセージ ボックス データベースを 2 つ追加し、マスター メッセージ ボックス データベースでの公開を無効にして、このシナリオをスケールアウトすることをお勧めします。  
  
-   マスター メッセージ ボックス データベースは、いずれはボトルネックとなります。 そのため、マスター メッセージ ボックス データベースをホストする物理コンピューターの処理速度を速く、容量を大きくする必要があります。  
  
-   ネットワーク上で送信するデータ (および関連する DTC オーバーヘッド) を最小限に抑えるには、専用のドライブを持つ同一の物理コンピューター上に複数のメッセージ ボックス データベースを配置することを検討してください。 それと同時に、これらの複数のデータベースを保持しているコンピューターでは、複数のマスター メッセージ ボックス データベースによってリソースが共有されているので、ボトルネックが生じないようにしてください。  
  
-   すべての公開メッセージ ボックス データベース間で処理が均一に分散されるので、すべてのセカンダリ メッセージ ボックス データベースで同等のハードウェアを使用する必要があります。  
  
-   マスター メッセージ ボックス データベースがボトルネックとならない限り、セカンダリ メッセージ ボックス データベースをスケール アウトできるので、セカンダリ メッセージ ボックス データベースは、マスター メッセージ ボックス データベース サーバーで必要とする CPU リソースよりも少ない CPU リソースのコンピューターで実行できます。  
  
## <a name="see-also"></a>参照  
 [BizTalk Server 層のスケール アウト](../core/scaling-out-the-biztalk-server-tier.md)   
 [BizTalk Server 層のスケール アップ](../core/scaling-up-the-biztalk-server-tier.md)   
 [SQL Server 層のスケール アップ](../core/scaling-up-the-sql-server-tier.md)   
 [スケール アウト受信ホスト](../core/scaled-out-receiving-hosts.md)   
 [スケール アウトされた処理ホスト](../core/scaled-out-processing-hosts.md)   
 [スケール アウトされた送信ホスト](../core/scaled-out-sending-hosts.md)   
 [Windows Server クラスターを使用して BizTalk Server Hosts2 の高可用性を実現するには](../core/use-windows-cluster-to-provide-high-availability-for-biztalk-hosts.md)   
 [スケール アウト データベース](../core/scaled-out-databases.md)   
 [BizTalk Server データベースをクラスタ リング](../core/clustering-the-biztalk-server-databases1.md)