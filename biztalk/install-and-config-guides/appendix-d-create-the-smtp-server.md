---
title: '付録 d: SMTP サーバーの作成 |Microsoft ドキュメント'
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: f7441ba9-a498-42ec-a04d-7f2731407373
caps.latest.revision: 7
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 9f4d4acc35f5cb38be5f783ee7c4017c8ada83e2
ms.sourcegitcommit: 36350889f318e1f7e0ac9506dc8df794d475bda6
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/20/2018
ms.locfileid: "22300138"
---
# <a name="appendix-d-create-the-smtp-server"></a>付録 D: SMTP サーバーの作成
SQL Server Database Mail で使用される SMTP サーバーを作成します。  
  
次の SQL バージョンのいずれかを使用する場合は、BAM 警告の構成に SQL Server Database Mail が必要です。 

* [!INCLUDE[sqlserver2016_md](../includes/sqlserver2016-md.md)]
* [!INCLUDE[sqlserver2014](../includes/sqlserver2014-md.md)]
* [!INCLUDE[sqlserver2012](../includes/sqlserver2012-md.md)] 
  
 SQL Server Database Mail では SMTP サーバーを使用して BAM 警告を送信します。 SMTP サーバーは、インターネット インフォメーション サービス (IIS) に含まれています。 SMTP サーバーは BizTalk Server のローカル、または IIS のインストールされた別のサーバーにインストールできます。  
  
> [!IMPORTANT]
>  通常、Windows 10 や Windows 7 などのクライアント オペレーティング システムには、SMTP サーバーの機能は含まれません。 IIS 内の *SMTP Email* 機能を使用して、Windows Server の既存の SMTP サーバーに接続することができます。 *SMTP Email* 機能は、SQL Server Database Mail で必要とされる SMTP サーバーではないため、 このトピックではクライアント オペレーティング システムでの SMTP サーバーのインストールと構成手順は省きます。  

## <a name="install-and-configure-the-smtp-server"></a>SMTP サーバーのインストールと構成  
  
この手順の適用対象:

* Windows Server 2016
* Windows Server 2012 R2
* Windows Server 2012
  
### <a name="install-smtp-server"></a>SMTP サーバーのインストール  
   
1.  **[サーバー マネージャー]** で、左ペインにある **[ダッシュボード]** を選択します。  
  
3.  **[役割と機能の追加]** を選択します。 **[役割と機能の追加]** は、右上隅にある **[管理]** メニューから開くこともできます。  
  
4.  **[はじめに]** で、**[次へ]** を選択します。  
  
5.  **[役割ベースまたは機能ベースのインストール]**、**[次へ]** の順に選択します。  
  
6.  **[サーバー プールからサーバーを選択]** を選択し、必要なサーバーを選択して **[次へ]** を選択します。 **[サーバーの選択]** ウィンドウには、**[サーバー マネージャー]** の **[サーバーの追加]** で追加したサーバーの一覧が表示されます。 既定では、ローカル サーバーが選択されます。  
  
7.  **[サーバーの役割]** で **[次へ]** を選択します。  
  
8.  **[機能]** で、**[SMTP サーバー]** のチェック ボックスをオンにします。 メッセージが表示されたら、**[機能の追加]** を選択します。 **[次へ]** を選択します。  
  
9. **[確認]** で、**[必要に応じて対象サーバーを自動的に再起動する]** を選択し、**[インストール]** を選択します。 完了したら、**[閉じる]** を選択します。  

### <a name="configure-the-smtp-server"></a>SMTP サーバーの構成  
 IIS 6.0 マネージャーを使用して SMTP 仮想サーバーを構成するには、次の手順を実行します:  
  
1.  IIS マネージャーを開く: [スタート] で、**inetmgr6.exe** を検索して開きます。  
  
2.  コンピューター名を展開します。 **[SMTP Virtual Server #1]** を右クリックして **[プロパティ]** を選択します。  
  
3.  **[アクセス]** タブの **[リレー]** ボタンを選択します。  
  
4.  **[追加]** を選択します。 **[1 台のコンピューター]** で、「`127.0.0.1`」と入力して **[OK]** を選択します。  
  
     「127.0.0.1」を追加することで、ローカル サーバーがこの SMTP サーバーからメッセージを送信できるようになります。 他にこの SMTP サーバーからメッセージを送信するコンピューターがある場合は、その IP アドレスを入力します。  
  
5.  **[配信]** タブで **[送信のセキュリティ]** を選択します。 以下から選択します:  
  
     **匿名アクセス**: アカウント名やパスワードは不要です。 このオプションを使用すると、SMTP サーバーの認証が無効になります。  
  
     **基本認証**: 接続先のサーバーのアカウント名とパスワードがクリア テキストとして送信されます。 入力したこのアカウントからメールを送信します。 基本認証は、個人アカウントや Exchange アカウントにメールを送信する場合に選択できます。 資格情報がクリア テキストとして渡されるため、**[TLS 暗号化]** を有効にすることをお勧めします。  
  
     **統合 Windows 認証**: Windows のドメイン アカウント名とパスワードが認証に使用されます。 入力したアカウントからメールを送信します。  
  
     **TLS 暗号化**: SSL と同様に、TLS では安全な接続が確保されます。 有効な SSL サーバー証明書がこのサーバーにインストールされている必要があります。  
  
    > [!TIP]
    >  個人用メール アカウント (Exchange アカウントを含む) を使用して SMTP のコア機能をテストするには、**[匿名アクセス]** を選択します。 基本認証を選択している場合、SMTP は AUTH コマンドを使用します。 メールのプロバイダーによっては、AUTH コマンドが原因でエラーが生じる場合があります。 AUTH コマンドに失敗した場合は、SMTP サーバーの Windows イベント ログにエラーが記録される場合があります。  
  
6.  **[配信]** タブで **[送信接続]** を選択します。 既定の TCP ポートは 25 です。 ファイアウォール内で空いていれば、他のポートを入力することもできます。 **[OK]** を選択します。  
  
7.  **[配信]** タブで **[詳細設定]** を選択します。 既定では、ローカル サーバーの**完全修飾ドメイン名**が一覧に表示されます。 インターネット プロバイダーによっては、**スマート ホスト**のプロパティを空白にしておくことができます。 スマート ホストが必要かどうか、インターネット プロバイダーに問い合わせる必要がある場合があります。 または、「smtp.*EMailProvider*.com」と入力します。  
  
    > [!NOTE]
    >  **スマート ホスト**は別名リレー ホストと呼ばれ、Exchange Server でのすべての送信メッセージのルーティングに使用される専用サーバーです。 **スマートホスト**がメッセージを受信すると、**スマートホスト**はメッセージをリモートドメインに転送します。 **スマート ホスト** の目的は、Exchange Server のパフォーマンスを向上させることです。 Exchange Server は、接続が確立するまでリモート ドメインに繰り返し通信する代わりに、スマート ホストにのみ送信します。  
  
8.  **[OK]** をクリックして、すべてのウィンドウを閉じます。  
  
9. SMTP Server を再起動する: **[SMTP Virtual Server #1]** を右クリックして、**[停止]** を選択し、**[起動]** を選択します。 SMTP サーバーの設定を適用するには、再起動する必要があります。 

  
## <a name="windows-server-2008-r2-install-and-configure-smtp-server"></a>Windows Server 2008 R2: SMTP サーバーのインストールと構成  
  
### <a name="install-smtp-server"></a>SMTP サーバーのインストール  
 SMTP サーバー機能をインストールするには、次の手順を実行します:  
  
1.  **[サーバー マネージャー]** で、**[機能]**、**[機能の追加]** の順に選択します。  
  
3.  **[機能の追加]** で、**[SMTP サーバー]** を選択します。 メッセージが表示されたら、**[必要な役割サービスを追加]**、**[次へ]** の順に選択します。  
  
4.  **[次へ]** を選択してインストールを続けます。  
  
5.  **[インストール オプションの確認]** ウィンドウで、**[インストール]** を選択します。 完了したら、**[閉じる]** を選択します。  
  
### <a name="configure-the-smtp-server"></a>SMTP サーバーの構成  
 IIS 6.0 マネージャーを使用して SMTP 仮想サーバーを構成するには、次の手順を実行します:  
  
1.  IIS 6.0 マネージャーを開く: **[スタート]** で、**IIS** を検索し、**[インターネット インフォメーション サービス (IIS) 6.0 マネージャー]** を選択します。  
  
2.  コンピューター名を展開します。 **[SMTP Virtual Server #1]** を右クリックして **[プロパティ]** を選択します。  
  
3.  **[アクセス]** タブの **[リレー]** ボタンを選択します。  
  
4.  **[追加]** を選択します。 **[1 台のコンピューター]** で、「`127.0.0.1`」と入力して **[OK]** を選択します。  
  
     「127.0.0.1」を追加することで、ローカル サーバーがこの SMTP サーバーからメッセージを送信できるようになります。 他にこの SMTP サーバーからメッセージを送信するコンピューターがある場合は、その IP アドレスを入力します。  
  
5.  **[配信]** タブで **[送信のセキュリティ]** を選択します。 以下から選択します:  
  
     **匿名アクセス**: アカウント名やパスワードは不要です。 このオプションを使用すると、SMTP サーバーの認証が無効になります。  
  
     **基本認証**: 接続先のサーバーのアカウント名とパスワードがクリア テキストとして送信されます。 基本認証は、個人アカウントや Exchange アカウントにメールを送信する場合に選択できます。 資格情報がクリア テキストとして渡されるため、**[TLS 暗号化]** を有効にすることをお勧めします。  
  
     **統合 Windows 認証**: Windows のドメイン アカウント名とパスワードが認証に使用されます。 入力したアカウントからメールを送信します。  
  
     **TLS 暗号化**: SSL と同様に、TLS では安全な接続が確保されます。 有効な SSL サーバー証明書がこのサーバーにインストールされている必要があります。  
  
    > [!TIP]
    >  個人用メール アカウント (Exchange アカウントを含む) を使用して SMTP のコア機能をテストするには、**[匿名アクセス]** を選択します。 基本認証を選択している場合、SMTP は AUTH コマンドを使用します。 メールのプロバイダーによっては、AUTH コマンドが原因でエラーが生じる場合があります。 AUTH コマンドに失敗した場合は、SMTP サーバーの Windows イベント ログにエラーが記録される場合があります。  
  
6.  **[配信]** タブで **[送信接続]** を選択します。 既定の TCP ポートは 25 です。 ファイアウォール内で空いていれば、他のポートを入力することもできます。 **[OK]** を選択します。  
  
    > [!TIP]
    >  TCP ポートは、受信接続と送信接続に使用できます。  
  
7.  **[配信]** タブで **[詳細設定]** を選択します。 既定では、ローカル サーバーの**完全修飾ドメイン名**が一覧に表示されます。 インターネット プロバイダーによっては、**スマート ホスト**のプロパティを空白にしておくことができます。 スマート ホストが必要かどうか、インターネット プロバイダーに問い合わせる必要がある場合があります。 または、「smtp.*EMailProvider*.com」と入力します。  
  
    > [!NOTE]
    >  **スマート ホスト**は別名リレー ホストと呼ばれ、Exchange Server でのすべての送信メッセージのルーティングに使用される専用サーバーです。 **スマートホスト**がメッセージを受信すると、**スマートホスト**はメッセージをリモートドメインに転送します。 **スマート ホスト** の目的は、Exchange Server のパフォーマンスを向上させることです。 Exchange Server は、接続が確立するまでリモート ドメインに繰り返し通信する代わりに、スマート ホストにのみ送信します。  
  
8.  **[OK]** をクリックして、すべてのウィンドウを閉じます。  
  
9. SMTP サーバーの設定を適用するには、再起動する必要があります。 SMTP Server を再起動する: **[SMTP Virtual Server #1]** を右クリックして、**[停止]** を選択し、**[起動]** を選択します。  
  
  
## <a name="test-the-smtp-server"></a>SMTP サーバーのテスト  
 Telnet を使用して、SMTP サーバーの構成をテストできます。 次の手順では、構成した SMTP サーバーを使用して、メール アドレスにメッセージを送信します。 [http://support.microsoft.com/kb/153119](http://support.microsoft.com/kb/153119) telnet コマンドの説明を示します。  
  
1.  管理者としてコマンド ウィンドウを開きます。
  
2.  コマンド プロンプトで、次のように入力します:  
  
     `telnet localhost 25`  
  
     telnet がインストールされていない場合は、次のように入力してインストールします:  
  
     `pkgmgr /iu:"TelnetClient"`  
  
3.  次のように入力して通信を開始します:  
  
     `EHLO server`  
  
4.  送信者アドレスを入力します:  
  
     `MAIL FROM: *YourEmailAddress*@*YourProvider*.com`  
  
     たとえば、次のように入力します。  
  
     `MAIL FROM: EmailAddress@outlook.com`  
  
5.  送信先アドレスを入力します:  
  
     `RCPT TO: *YourEmailAddress*@*YourProvider*.com`  
  
     たとえば、次のように入力します。  
  
     `RCPT TO: EmailAddress@outlook.com`  
  
6.  次のように入力して SMTP サーバーにデータの送信準備ができたことを伝えます:  
  
     `DATA`  
  
7.  次のように入力して件名を入力します:  
  
     `Subject: Test Message`  
  
8.  Enter キーを 2 回押します。  
  
9. 次のようにメッセージ本文を入力します:  
  
     `This is the message body of the test message.`  
  
10. Enter を押し、ピリオド (.) を入力して、Enter を押します。  
  
 メール メッセージの RCPT TO アドレスを確認します。 メールが配信されない場合は (受信トレイと迷惑メール フォルダーを確認してください)、メッセージが正常に送信されておらず、SMTP キュー フォルダー (C:\inetpub\mailroot\Queue) に残っている可能性があります。  
  